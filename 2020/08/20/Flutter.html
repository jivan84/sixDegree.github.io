<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Flutter</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="app,flutter,dart">
  
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
	
		<link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
	
    
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">Starter</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">Install</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">模拟器</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">Hello World</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">第三方库</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-6"><span class="sidebar-nav nav-text">Flutter 组件树</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-7"><span class="sidebar-nav nav-text">StatelessWidget</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-8"><span class="sidebar-nav nav-text">StatefulWidget</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-9"><span class="sidebar-nav nav-text">Scaffold</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-10"><span class="sidebar-nav nav-text">容器和布局</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-11"><span class="sidebar-nav nav-text">容器</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-12"><span class="sidebar-nav nav-text">基础布局</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-13"><span class="sidebar-nav nav-text">辅助布局</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-14"><span class="sidebar-nav nav-text">高级布局</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-15"><span class="sidebar-nav nav-text">基础控件</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-16"><span class="sidebar-nav nav-text">事件与通知</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-17"><span class="sidebar-nav nav-text">本地资源</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-18"><span class="sidebar-nav nav-text">路由</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-19"><span class="sidebar-nav nav-text">Navigator 导航器</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-20"><span class="sidebar-nav nav-text">Navigator & Router</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-21"><span class="sidebar-nav nav-text">动态路由框架 Fluro</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-22"><span class="sidebar-nav nav-text">动态路由框架 auto_route</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-23"><span class="sidebar-nav nav-text">导航栏组件</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-24"><span class="sidebar-nav nav-text">顶部导航栏</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-25"><span class="sidebar-nav nav-text">底部导航栏</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-4"><a class="sidebar-nav nav-link" href="#header-26"><span class="sidebar-nav nav-text">BottomNavigationBar</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-4"><a class="sidebar-nav nav-link" href="#header-27"><span class="sidebar-nav nav-text">BottomAppBar</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-4"><a class="sidebar-nav nav-link" href="#header-28"><span class="sidebar-nav nav-text">页面切换保持状态</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-29"><span class="sidebar-nav nav-text">标签栏</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-4"><a class="sidebar-nav nav-link" href="#header-30"><span class="sidebar-nav nav-text">DefaultTabController</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-4"><a class="sidebar-nav nav-link" href="#header-31"><span class="sidebar-nav nav-text">TabController</span></a></li></ol></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-32"><span class="sidebar-nav nav-text">Banner组件</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-33"><span class="sidebar-nav nav-text">刷新组件</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-34"><span class="sidebar-nav nav-text">RefreshIndicator</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-35"><span class="sidebar-nav nav-text">flutter_easyrefresh</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-36"><span class="sidebar-nav nav-text">滚动控件（Scroll）</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-37"><span class="sidebar-nav nav-text">ScrollController</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-38"><span class="sidebar-nav nav-text">ScrollPosition</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-39"><span class="sidebar-nav nav-text">ScrollController控制原理</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-40"><span class="sidebar-nav nav-text">ScrollNotification</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-41"><span class="sidebar-nav nav-text">NotificationListener</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-42"><span class="sidebar-nav nav-text">ScrollController VS. NotificationListener</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-43"><span class="sidebar-nav nav-text">ScrollPhysics</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-44"><span class="sidebar-nav nav-text">应用：ListView滑动到底部自动加载更多</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-45"><span class="sidebar-nav nav-text">应用：滚动到指定位置</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-46"><span class="sidebar-nav nav-text">ScrollView</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-47"><span class="sidebar-nav nav-text">CustomScrollView</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-48"><span class="sidebar-nav nav-text">SliverAppBar</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-49"><span class="sidebar-nav nav-text">SliverList</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-50"><span class="sidebar-nav nav-text">SliverGrid</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-51"><span class="sidebar-nav nav-text">SliverToBoxAdapter</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-52"><span class="sidebar-nav nav-text">SliverFillRemaining</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-53"><span class="sidebar-nav nav-text">SliverFillViewport</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-54"><span class="sidebar-nav nav-text">NestedScrollView</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-55"><span class="sidebar-nav nav-text">NestedScrollView 滚动问题</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-56"><span class="sidebar-nav nav-text">异常处理</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-57"><span class="sidebar-nav nav-text">Flutter项目IOS真机部署及问题</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-58"><span class="sidebar-nav nav-text">TextField & Keyboard</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-59"><span class="sidebar-nav nav-text">TextField</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-60"><span class="sidebar-nav nav-text">键盘弹起/隐藏问题</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-61"><span class="sidebar-nav nav-text">状态管理</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-62"><span class="sidebar-nav nav-text">Bloc</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-63"><span class="sidebar-nav nav-text">Provider</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-64"><span class="sidebar-nav nav-text">Consumer</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-65"><span class="sidebar-nav nav-text">FutureBuilder & StreamBuilder</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-66"><span class="sidebar-nav nav-text">MVVM</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-67"><span class="sidebar-nav nav-text">应用</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-68"><span class="sidebar-nav nav-text">获取某个控件的坐标</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-69"><span class="sidebar-nav nav-text">隐藏和显示widget</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-70"><span class="sidebar-nav nav-text">透明渐变 AppBar</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-71"><span class="sidebar-nav nav-text">LayoutBuilder</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-72"><span class="sidebar-nav nav-text">Json处理</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-73"><span class="sidebar-nav nav-text">ios不受信任的应用开发者如何设置</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-74"><span class="sidebar-nav nav-text">综合Demo</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-75"><span class="sidebar-nav nav-text">启动初始化设置</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-76"><span class="sidebar-nav nav-text">SharedPreferences本地存储</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-77"><span class="sidebar-nav nav-text">全局状态控制</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-78"><span class="sidebar-nav nav-text">路由</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-79"><span class="sidebar-nav nav-text">底部导航</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-80"><span class="sidebar-nav nav-text">Login</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-81"><span class="sidebar-nav nav-text">Banner</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-82"><span class="sidebar-nav nav-text">ListView 下滑加载更多</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-83"><span class="sidebar-nav nav-text">Provider</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-84"><span class="sidebar-nav nav-text">Tab</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-85"><span class="sidebar-nav nav-text">Radio Play</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-86"><span class="sidebar-nav nav-text">setState导致的内存泄漏</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-87"><span class="sidebar-nav nav-text">Video Player</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-88"><span class="sidebar-nav nav-text">Photo Preview</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-89"><span class="sidebar-nav nav-text">底部评论</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-90"><span class="sidebar-nav nav-text">瀑布流</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-91"><span class="sidebar-nav nav-text">Chat 聊天框</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-92"><span class="sidebar-nav nav-text">WebView</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-93"><span class="sidebar-nav nav-text">Html</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-94"><span class="sidebar-nav nav-text">More Reference</span></a></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">Flutter</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2020-08-19T16:00:00.000Z">2020-08-20</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-app">app</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h2 id="header-1">Starter</h2>
<ul>
<li>新兴的 New</li>
<li>移动端 Mobile</li>
<li>动态化 Dynamic</li>
<li>跨平台 Cross-platform</li>
</ul>
<p>创建2D App的SDK
Dart语言构建的编程框架
用一种语言编程（dart） ＝&gt; 为不同的平台定制（ios／android）＝&gt; Build &amp; 发布</p>
<p><a href="https://flutter.dev/">Flutter Dev</a> | <a href="https://flutterchina.club/">Flutter中文网</a> | <a href="https://github.com/flutter/flutter">Flutter Github</a></p>
<h3 id="header-2">Install</h3>
<p><a href="https://flutter.dev/docs/get-started/install">install doc</a></p>
<ol>
<li><p>下载zip包解压 <code>flutter_macos_1.20.4-stable</code> =&gt; <code>/Users/cj/soft/flutter</code></p>
</li>
<li><p>配置环境变量</p>
<pre><code class="lang-bash"> &gt; vi ~/.bash_profile
 # Flutter
 export FLUTTER_HOME=/Users/cj/soft/flutter
 export DART_HOME=$FLUTTER_HOME/bin/cache/dart-sdk
 # Flutter temp visit images (创建的flutter项目会使用这个镜像下载依赖)
 export PUB_HOSTED_URL=https://pub.flutter-io.cn
 export FLUTTER_STORAGE_BASE_URL=https://storage.flutter-io.cn

 # Path
 export PATH=$PATH:$FLUTTER_HOME/bin:$DART_HOME/bin

 &gt; source ~/.bash_profile
</code></pre>
<pre><code class="lang-bash"> &gt; flutter --version
 Flutter 1.20.4 • channel stable • https://github.com/flutter/flutter.git
 Framework • revision fba99f6cf9 (9 days ago) • 2020-09-14 15:32:52 -0700
 Engine • revision d1bc06f032
 Tools • Dart 2.9.2

 &gt; dart --version
 Dart SDK version: 2.9.2 (stable) (Wed Aug 26 12:44:28 2020 +0200) on &quot;macos_x64&quot;

 &gt; which flutter
 /Users/cj/soft/flutter/bin/flutter
 &gt; which dart
 /Users/cj/soft/flutter/bin/dart
</code></pre>
</li>
<li><p>诊断依赖项</p>
<pre><code class="lang-bash"> &gt; flutter doctor
 Doctor summary (to see all details, run flutter doctor -v):
 [✓] Flutter (Channel stable, 1.20.4, on Mac OS X 10.11.2 15C50, locale zh-Hans)
 [✗] Android toolchain - develop for Android devices
     ✗ Unable to locate Android SDK.
       Install Android Studio from: https://developer.android.com/studio/index.html
       On first launch it will assist you in installing the Android SDK components.
       (or visit https://flutter.dev/docs/get-started/install/macos#android-setup for detailed instructions).
       If the Android SDK has been installed to a custom location, set ANDROID_SDK_ROOT to that location.
       You may also want to add it to your PATH environment variable.

 [!] Xcode - develop for iOS and macOS (Xcode 7.2)
     ✗ Flutter requires a minimum Xcode version of 11.0.0.
       Download the latest version or update via the Mac App Store.
     ✗ CocoaPods not installed.
         CocoaPods is used to retrieve the iOS and macOS platform side&#39;s plugin code that responds to your plugin usage on the Dart side.
         Without CocoaPods, plugins will not work on iOS or macOS.
         For more info, see https://flutter.dev/platform-plugins
       To install:
         sudo gem install cocoapods
 [!] Android Studio (not installed)
 [!] IntelliJ IDEA Community Edition (version 2017.3.4)
     ✗ Flutter plugin not installed; this adds Flutter specific functionality.
     ✗ Dart plugin not installed; this adds Dart specific functionality.
 [!] Connected device
     ! No devices available

 ! Doctor found issues in 5 categories.
</code></pre>
</li>
<li><p>安装更新 <a href="https://developer.apple.com/download/more/">Xcode</a> =&gt; XCode ( with IOS Simulator )</p>
</li>
<li><p>安装 <a href="https://developer.android.google.cn/studio/">Android Studio</a> =&gt; Android Studio ( AVD Manager -&gt; Android Simulator )</p>
</li>
<li><p>安装 <a href="https://code.visualstudio.com/">VS Code</a></p>
</li>
<li><p>各个IDE安装Flutter &amp; Dart插件</p>
</li>
</ol>
<h3 id="header-3">模拟器</h3>
<pre><code class="lang-bash"># 列出模拟器
&gt; flutter emulator
3 available emulators:

apple_ios_simulator • iOS Simulator   • Apple  • ios
Pixel_API_28        • Pixel API 28    • Google • android
Pixel_XL_API_30     • Pixel XL API 30 • Google • android

To run an emulator, run &#39;flutter emulators --launch &lt;emulator id&gt;&#39;.
To create a new emulator, run &#39;flutter emulators --create [--name xyz]&#39;.

You can find more information on managing emulators at the links below:
  https://developer.android.com/studio/run/managing-avds
  https://developer.android.com/studio/command-line/avdmanager

&gt; flutter emulator --launch
</code></pre>
<h3 id="header-4">Hello World</h3>
<ol>
<li>IOS =&gt; <code>Xcode -&gt; Open Developer Tool -&gt; Simulator</code> 或者 cmd: <code>open -a Simulator</code><pre><code class="lang-bash"> &gt; open -a Simulator
 &gt; flutter create first_app
 &gt; cd first_app
 &gt; flutter run
</code></pre>
</li>
<li>Android =&gt; 创建Android模拟器 <code>Android Studio -&gt; Tools -&gt; AVD Manager -&gt; Create Virtual Device</code></li>
</ol>
<p><strong> Sample: main.dart </strong></p>
<pre><code class="lang-js">import &#39;package:flutter/material.dart&#39;;

void main() =&gt; runApp(MyApp());

class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Center(
        child: Text(
          &quot;Hello World&quot;,
          textDirection: textDirection.ltr,
          style: TextStyle(fontSize: 30, color: Colors.orange),
        ),
    );
  }
}
</code></pre>
<p>运行打包</p>
<pre><code class="lang-bash">flutter run --target=src/app.dart
flutter build apk --target=src/app.dart
</code></pre>
<h3 id="header-5">第三方库</h3>
<p><a href="https://pub.dev/">第三方库</a></p>
<p>pubspec.yaml:</p>
<pre><code class="lang-yaml">dependencies:
  flutter:
    sdk: flutter
  dio: ^3.0.10
</code></pre>
<pre><code class="lang-bash">&gt; cd first_app
&gt; flutter pub get
</code></pre>
<h2 id="header-6">Flutter 组件树</h2>
<p><a href="https://zhuanlan.zhihu.com/p/151964543">https://zhuanlan.zhihu.com/p/151964543</a></p>
<p>flutter生命周期
<a href="https://www.jianshu.com/p/7e8dff26f81a">https://www.jianshu.com/p/7e8dff26f81a</a></p>
<ul>
<li>StatelessWidget</li>
<li>StatefulWidget</li>
</ul>
<h3 id="header-7">StatelessWidget</h3>
<pre><code class="lang-java">/// for example: StatelessWidget
class ProductItemWidget extends StatelessWidget {
  final String title;
  final String subTitle;
  final String imageUrl;

  const ProductItemWidget(this.title, this.subTitle, this.imageUrl);

  @override
  Widget build(BuildContext context) {
    return Container(
        padding: EdgeInsets.all(10),
        margin: EdgeInsets.all(10),
        decoration: BoxDecoration(border: Border.all(width: 2)),
        child: Column(
          children: [
            Text(
              title,
              style: TextStyle(fontSize: 20),
            ),
            Text(subTitle, style: TextStyle(fontSize: 16)),
            SizedBox(
              height: 10,
            ),
            Image.network(imageUrl),
          ],
        ));
  }
}
</code></pre>
<h3 id="header-8">StatefulWidget</h3>
<pre><code class="lang-java">import &#39;package:flutter/material.dart&#39;;

/// for test: StatefulWidget 生命周期
/*
第一次初始化
flutter: StatefulWidgetLcDemo constructor()
flutter: StatefulWidgetLcDemo createState()
flutter: _StatefulWidgetLcDemoState constructor()
flutter: _StatefulWidgetLcDemoState initState()
flutter: _StatefulWidgetLcDemoState didChangeDependencies()
flutter: _StatefulWidgetLcDemoState build(ctx)

保存-热加载更新
flutter: StatefulWidgetLcDemo constructor()
flutter: _StatefulWidgetLcDemoState didUpdateWidget(oldWidget)
flutter: _StatefulWidgetLcDemoState build(ctx)

press-setState
flutter: _StatefulWidgetLcDemoState setState() before
flutter: _StatefulWidgetLcDemoState setState() do
flutter: _StatefulWidgetLcDemoState setState() after
flutter: _StatefulWidgetLcDemoState build(ctx)
*/

class StatefulWidgetLcDemo extends StatefulWidget {
  StatefulWidgetLcDemo() {
    print(&quot;StatefulWidgetLcDemo constructor()&quot;);
  }

  @override
  _StatefulWidgetLcDemoState createState() {
    print(&quot;StatefulWidgetLcDemo createState()&quot;);
    return _StatefulWidgetLcDemoState();
  }
}

class _StatefulWidgetLcDemoState extends State&lt;StatefulWidgetLcDemo&gt; {
  int count = 0;

  _StatefulWidgetLcDemoState() {
    print(&quot;_StatefulWidgetLcDemoState constructor()&quot;);
  }

  @override
  void initState() {
    super.initState();
    print(&quot;_StatefulWidgetLcDemoState initState()&quot;);
  }

  @override
  void didChangeDependencies() {
    super.didChangeDependencies();
    print(&quot;_StatefulWidgetLcDemoState didChangeDependencies()&quot;);
  }

  @override
  void didUpdateWidget(StatefulWidgetLcDemo oldWidget) {
    super.didUpdateWidget(oldWidget);
    print(&quot;_StatefulWidgetLcDemoState didUpdateWidget(oldWidget)&quot;);
  }

  @override
  Widget build(BuildContext context) {
    print(&quot;_StatefulWidgetLcDemoState build(ctx)&quot;);
    return Container(
      child: RaisedButton(
        child: Text(&quot;Test StatefulWidget Lifecycle - Count: $count&quot;),
        onPressed: () {
          print(&quot;_StatefulWidgetLcDemoState setState() before&quot;);
          setState(() {
            count++;
            print(&quot;_StatefulWidgetLcDemoState setState() do&quot;);
          });
          print(&quot;_StatefulWidgetLcDemoState setState() after&quot;);
        },
      ),
    );
  }
}
</code></pre>
<h2 id="header-9">Scaffold</h2>
<p>App页面框架</p>
<ul>
<li>drawer 左侧滑出</li>
<li>主屏幕<ul>
<li>appBar: <ul>
<li>leading,title,actions</li>
<li>flexibleSpace</li>
<li>bottom</li>
</ul>
</li>
<li>body</li>
<li>bottomSheet</li>
<li>persistentFooterButtons</li>
<li>BottomNavigationBar</li>
</ul>
</li>
<li>endDrawer 右侧滑出</li>
</ul>
<h2 id="header-10">容器和布局</h2>
<p>容器：包含单个Widget
布局：包含多个Widget</p>
<h3 id="header-11">容器</h3>
<p>万能容器 Container</p>
<ul>
<li>绘制顺序<ul>
<li>transform</li>
<li>decoration</li>
<li>child</li>
<li>foregroundDecoration</li>
</ul>
</li>
<li>属性<ul>
<li>alignment 容器内child的对齐方式</li>
<li>padding,margin: EdgeInsetsGeometry </li>
<li>width,height</li>
<li>constraints: BoxConstrants 容器大小限制 eg: BoxConstrants.expand() 占满全屏</li>
<li>color 容器背景色 （注：不能和decoration同时使用）</li>
<li>decoration : Decoration 容器背景装饰<ul>
<li>color</li>
<li>border: Border.all(...) 往外扩展，即占用外边距的宽度</li>
<li>borderRadius: BorderRadius.circle() 边框圆角</li>
<li>boxShadow: <BoxShadow>[] 阴影效果</li>
<li>gradient: Gradient 渐变效果（LinearGradient,RadiaGradient,SweepGradient）,会覆盖color</li>
<li>image: DecorationImage(image)</li>
<li>shape: BoxShape.circle</li>
</ul>
</li>
<li>foregroundDecoration : Decoration 容器前景装饰，绘制在child智商</li>
<li>transform: Matrix4 容器变化</li>
<li>child: Widget</li>
</ul>
</li>
<li>说明<ul>
<li>本身是一个盒子模型</li>
<li>未设置约束和宽高<ul>
<li>无child，Container占满全屏</li>
<li>有child<ul>
<li>设置了alignment，Container占满全屏</li>
<li>未设置了alignment，Container同child一般大</li>
</ul>
</li>
</ul>
</li>
<li>Decoration <ul>
<li>BoxDecoration</li>
<li>ShapeDecoration 通常用于单独为四条边绘制不同效果,特别：shape属性同BoxDecoration不同，类型为ShapeBorder<ul>
<li>Border 绘制四边</li>
<li>UnderlineInputBorder 绘制底边线</li>
<li>RoundedRectangleBorder 绘制矩形边框</li>
<li>CircleBorder 绘制圆形边框</li>
<li>StadiumBorder 绘制竖向椭圆边框</li>
<li>BeveledRectangleBorder 绘制八角边框</li>
</ul>
</li>
<li>UnderlineTabIndicator</li>
</ul>
</li>
<li>EdgeInsetsGeometry<ul>
<li>EdgeInsets 不支持国际化: .all(),.symmetric(),.fromLTRB(),.only()</li>
<li>EdgeInsetsDirectional 支持国际化（左右切换）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="header-12">基础布局</h3>
<ul>
<li>弹性 Flex<ul>
<li>direction: Axis 主轴方向 Axis.horizontal ,Axis.vertical</li>
<li>mainAxisAlignment,crossAxisAlignment 主轴/交叉轴上的对齐方式</li>
<li>mainAxisSize: 主轴应占用多大空间 MainAxisSize.min,MainAxisSize.max </li>
<li>textDirection,verticalDirection : TextDirection 子组件布局顺序</li>
<li>textBaseline 基线</li>
<li>children: List<Widget></li>
</ul>
</li>
<li>线性 Row, Column (继承自Flex)</li>
<li>流式 Wrap 自动换行（像水一样自动流过去，换行）<ul>
<li>direction: Axis</li>
<li>alignment,crossAxisAlignment 主轴/交叉轴上的对齐方式</li>
<li>runAlignment 纵轴对齐方式</li>
<li>runSpacing: double 纵轴间距（默认0.0)</li>
<li>textDirection,verticalDirection</li>
<li>children: List<Widget></li>
</ul>
</li>
<li>层叠 Stack 重叠组件（子组件列表后米的重置在前面，超过渲染区可剪切掉）</li>
</ul>
<h3 id="header-13">辅助布局</h3>
<ul>
<li>Padding 边距布局<ul>
<li>padding</li>
<li>child</li>
</ul>
</li>
<li>Center 水平垂直居中布局<ul>
<li>child</li>
</ul>
</li>
<li>SizedBox 固定宽高布局<ul>
<li>width,height</li>
<li>child</li>
</ul>
</li>
<li>AspectRatio 宽高比布局 </li>
<li>FractionallySizedBox 百分比布局</li>
<li>Card 卡片布局</li>
</ul>
<h3 id="header-14">高级布局</h3>
<ul>
<li>ListView 可滚动列表（特定化的Column，支持垂直和水平滚动）<ul>
<li>ListView()</li>
<li>ListView.builder()</li>
<li>ListView.separated() 可添加分割线</li>
<li>ListView custom()</li>
</ul>
</li>
<li>GridView 可滚动的二维网格列表 （二维列表，内容超过渲染区时将自动滚动）<ul>
<li>GrideView()</li>
<li>GrideView.count 交叉轴上为固定个数的网格（必设属性：crossAxisCount)</li>
<li>GrideView.extend 交叉轴上最大可容纳的网格（必设属性：maxCrossAxisExtent 一个网格的最大宽度)</li>
<li>GrideView.builder</li>
<li>GrideView.custom</li>
</ul>
</li>
<li>Table/TableRow 表格 （类似线性布局）</li>
<li>IndexStack 栈索引 （继承自Stack，用于显示第index个child，其他child不可见，默认显示index为0的元素）</li>
</ul>
<p><strong> Sample: GridView </strong></p>
<pre><code class="lang-js">_buildContent(context,value){
    return Container(
      height: StationTheme.stationHeight,
      child: GridView.builder(
        padding: EdgeInsets.all(8),
        scrollDirection: Axis.horizontal,
        itemCount: value.stationItems.length,
        itemBuilder: (context,index){
          return InkWell(
            child:_buildStation(value.stationItems[index]),
            onTap: ()=&gt;Navigator.of(context)
              .pushNamed(GlobalRoutes.Route_Detail,arguments: {&#39;item&#39;:value.stationItems[index]}),
          );
        },
        gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
          crossAxisCount: 2, 
          crossAxisSpacing: 8, 
          mainAxisSpacing: 8,
          childAspectRatio:0.6
        ),
      )
    );
}
</code></pre>
<h2 id="header-15">基础控件</h2>
<ul>
<li>Text<ul>
<li>data: String </li>
<li>style: TextStyle</li>
<li>textAlign: TextAlign</li>
<li>textDirection: TextDirection</li>
<li>softWrap: bool 是否自动换行</li>
<li>overflow: TextOverflow 溢出处理 （clip,fade,ellipsis,visible)</li>
<li>textScaleFator: double 字体缩放系数</li>
<li>maxLines: int 最多可显示行数，溢出的按overflow属性规则处理</li>
<li>textSpan: TextSpan 需使用Text.rich方法创建</li>
</ul>
</li>
<li>Image<ul>
<li>构造：<ul>
<li>Image(...)</li>
<li>Image.asset 加载资源目录中的图片</li>
<li>Image.network 加载网络图片 = Image(image:NetworkImage(src))</li>
<li>Image.file 加载本地图片文件</li>
<li>Image.memory 加载Uint8List资源图片</li>
</ul>
</li>
<li>属性：<ul>
<li>image: ImageProvider </li>
<li>width/height: double</li>
<li>fit: BoxFit 填充模式</li>
<li>color</li>
<li>colorBlendMode: BlendMode 混色处理</li>
<li>alignment</li>
<li>repeat: ImageRepeat</li>
<li>centerSlice: Rect 点9的8个方向拉伸处理</li>
<li>gaplessPlayback: bool 当ImageProvider发生变化，true则保留图片知道新图出现，否则中间显示空</li>
</ul>
</li>
</ul>
</li>
<li>Icon</li>
<li>SelectableText 可选文本</li>
<li>TextField 文本输入框</li>
<li>Button<ul>
<li>RaisedButton 凸起按钮</li>
<li>FlatButton 扁平按钮</li>
<li>IconButton 图标按钮</li>
<li>OutlineButton 线框按钮</li>
</ul>
</li>
<li>Radio 单选框</li>
<li>Checkbox 多选框</li>
<li>Chip 碎片（类似tag）</li>
<li>Switch 开/关按钮</li>
<li>Slider 滑块（类似进度条）</li>
<li>Placeholder 占位</li>
</ul>
<h2 id="header-16">事件与通知</h2>
<p>Flutter手势系统分为两个层级</p>
<ul>
<li>下层：识别原始的指针事件，描述指针的位置和移动<ul>
<li>指针事件：<ul>
<li>PointerDownEvent</li>
<li>PointerMoveEvent</li>
<li>PointerUpEvent</li>
<li>PointerCancelEvent</li>
</ul>
</li>
<li>当指针按下时，事件指派给最内层的组件，后续指针事件以冒泡方式向上传递给到根组件的所有途径组件</li>
<li>无法取消或停止事件冒泡传递</li>
<li>可使用Listener监听指针事件，不过应尽量使用更高层的手势</li>
</ul>
</li>
<li>上层：识别手势，即语义动作，由一个活多个指针事件组成<ul>
<li>手势事件:<ul>
<li>点击(Tap)</li>
<li>拖动(Drag)</li>
<li>缩放(Scale)</li>
</ul>
</li>
<li>生命周期内会发送一个或多个事件，使用<code>GestureDetector</code>来监听手势事件</li>
<li><code>GestureDetector</code>通过检查出不为null的手势事件处理器来获悉需要识别的手势</li>
</ul>
</li>
</ul>
<p><code>GestureDetector</code> 手势检测，有7种类型事件：</p>
<ul>
<li>单击事件(Tap): onTapDown,onTapUp,onTap,onTapCancel</li>
<li>双击事件(Double Tap): onDoubleTap</li>
<li>长按事件(Long Press): onLongPress,onLongPressMoveUpdate,onLongPressUp,onLongPressEnd</li>
<li>垂直滑动(Vertical Drap):  onVerticalDrapDown,onVerticalDrapStart,onVerticalDrapUpdate,onVerticalDrapEnd,onVerticalDrapCancel</li>
<li>水平滑动(Horizontal Drap): onHorizontalDragStart,onHorizontalDrapUpdate,onHorizontalDragEnd</li>
<li>指针事件(Pan): onPanDown,onPanStart,onPanUpdate,onPanEnd,onPanCacel</li>
<li>缩放事件(Scale) onScaleStart,onScaleUpdate,onScaleEnd</li>
</ul>
<p><code>InkWell</code> 具有水波纹效果（溅墨效果）的点击事件控件
注：
当InkWell的子控件设置了背景色，是看不到溅墨效果的，需进行特殊处理（用Material &amp; Ink 包裹）
用InkWell包裹Image时，也是看不到溅墨效果的，建议使用 Ink.Image控件</p>
<h2 id="header-17">本地资源</h2>
<p>静态化本地资源 <code>assets</code>,<code>fonts</code></p>
<p>pubspec.yaml: </p>
<pre><code class="lang-yaml">dependencies:
  flutter:
    sdk: flutter
  flutter_svg: ^0.19.1                    # svg
  flutter_staggered_grid_view: &quot;^0.3.2&quot;   # 瀑布流插件

flutter:
    assets:
        - assets/images/
        - assets/icons/
    fonts:
        - family: Nunito
          fonts:
            - asset: assets/fonts/Nunito/Nunito-Regular.ttf
            - asset: assets/fonts/Nunito/Nunito-SemiBold.ttf
              weight: 600
            - asset: assets/fonts/Nunito/Nunito-Bold.ttf
              weight: 700
</code></pre>
<h2 id="header-18">路由</h2>
<h3 id="header-19">Navigator 导航器</h3>
<ul>
<li>按照堆栈方式管理子组件</li>
<li>内部使用<code>Overlay</code>组件管理多个页面，位于最上层的页面可见</li>
<li>通过调整<code>Overlay</code>里页面顺序来切换页面</li>
<li>页面<code>Page</code>也称为<code>Screen</code>或<code>Route</code></li>
<li><code>WidgetsApp</code>和<code>MaterialApp</code>里会自动创建一个导航器，组件里可使用<code>Navigator.of(context)</code>来获取其祖先组件里的导航器</li>
</ul>
<ol>
<li><p>进入新页和返回</p>
<ul>
<li>使用MaterialApp的home属性制定首页，该页位于导航器堆栈的最底层</li>
<li>使用<code>Navigator.push</code>方法进入某个页面（传递一个MaterialPageRoute对象）</li>
<li>使用<code>Navigator.pop</code>方法返回上一页</li>
<li>如果页面使用了<code>Scaffold</code>，则导航条上会自动出现返回按钮</li>
</ul>
</li>
<li><p>跨页面传递数据</p>
<ul>
<li>可通过页面组件的构造函数传递数据</li>
<li><code>Navigator.push</code> 返回<code>Future</code>对象，会在<code>Navigator.pop(value)</code>退出页面时完成，<code>Future</code>得到<code>pop</code>的值</li>
<li>可先创建命名路由，后使用<code>Navigator.pushNamed</code>进入指定名字的路由</li>
</ul>
</li>
<li><p>导航器嵌套</p>
<ul>
<li>应用内所有导航器为树状结构，有一个根root导航器</li>
<li>使用<code>WillPopScope</code>来使内层导航器响应Android实体返回键</li>
</ul>
</li>
</ol>
<h3 id="header-20">Navigator &amp; Router</h3>
<ol>
<li>MaterialApp.routes 路由<pre><code class="lang-js"> initialRoute:&#39;/&#39;,
 routes:{ 
     &#39;/&#39;: (context) =&gt; NavigatorDemo(), 
     &#39;/home&#39;: (context) =&gt; Home(),
     &#39;/about&#39;: (context) =&gt; MyPage(title: &quot;About&quot;),
 }
</code></pre>
</li>
<li>Navigator.push 进入<pre><code class="lang-js"> onPressed: () {
   // Navigator.of(context).push(
   //  MaterialPageRoute(
   //    builder: (BuildContext context) =&gt; MyPage(title: &#39;About&#39;))
   //);
   Navigator.pushNamed(context, &#39;/about&#39;);
 },
</code></pre>
</li>
<li>Navigator.pop 返回上一页<pre><code class="lang-js"> onPressed: () {
       Navigator.pop(context);
 },
</code></pre>
</li>
</ol>
<p>静态路由&amp;动态路由 <a href="https://www.jianshu.com/p/66fa8c85cdc6">https://www.jianshu.com/p/66fa8c85cdc6</a></p>
<h3 id="header-21">动态路由框架 Fluro</h3>
<ol>
<li><p>pubspec.yaml</p>
<pre><code class="lang-yaml"> dependencies:
   flutter:
     sdk: flutter
   flutter_localizations:
     sdk: flutter
   # 动态路由
   fluro: 1.7.7
</code></pre>
</li>
<li><p>routes.dart: </p>
<pre><code class="lang-java">
 import &#39;package:fluro/fluro.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;
 import &#39;package:third_app/components/main_body.dart&#39;;
 import &#39;package:third_app/pages/detail/detail.dart&#39;;

 /*
 https://dart-pub.mirrors.sjtug.sjtu.edu.cn/packages/fluro
 https://zhuanlan.zhihu.com/p/107383867
 https://segmentfault.com/a/1190000021488577
 */

 Handler homePageHandler = Handler(
   handlerFunc: (context, params) =&gt;  MyMainBodyPageItem(Colors.grey,title: Text(&quot;Home Page&quot;),),
 );

 Handler detailPageHandler = Handler(
   handlerFunc: (context, params){
     String detailId = params[&#39;id&#39;].first;
     Map args = context.settings.arguments;
     debugPrint(&quot;detailPageHandler get detailId:$detailId,args:$args&quot;);
     return DetailPage(detailId: detailId,args: args);
   },
 );

 Handler notFoundHandler = Handler(
   handlerFunc: (context, parameters){
     return Container(
       alignment: Alignment.center,
       child: Text(&quot;出错啦。。。&quot;),
     );
   },
 );

 class Routes{
   static String homePage = &#39;/home&#39;;
   static String detailPage = &#39;/details/:id&#39;;

   static void configRoutes(FluroRouter router) {
     router..define(homePage,handler:homePageHandler)
           ..define(detailPage, handler: detailPageHandler)
           ..notFoundHandler=notFoundHandler;
   }
 }
</code></pre>
</li>
<li><p>global.dart</p>
<pre><code class="lang-java"> import &#39;package:fluro/fluro.dart&#39;;
 class Global{
   static FluroRouter router;
 }
</code></pre>
</li>
<li><p>main.dart</p>
<pre><code class="lang-java"> void main() {
   final router = FluroRouter();
   Routes.configRoutes(router);
   Global.router=router;

   runApp(MyApp());
 }

 class MyApp extends StatelessWidget {
   @override
   Widget build(BuildContext context) {
     return MaterialApp(
       title: &#39;Hi Dear&#39;,
       home: MyFrame(),
       // routes:
       onGenerateRoute: Global.router.generator,
     );
   }
 }
</code></pre>
</li>
<li><p>Page A -&gt; Page B </p>
<pre><code class="lang-js"> Navigator.pushNamed(
     context, 
     Routes.detailPage,
     arguments: {&#39;title&#39;:items[index][&#39;title&#39;]}
 ).then((value)=&gt;debugPrint(&quot;Get returnData: $value&quot;));

 Global.router.navigateTo(
     context, 
     items[index][&#39;path&#39;],
     transition: TransitionType.material,
     routeSettings: RouteSettings(
       arguments:{&#39;title&#39;:items[index][&#39;title&#39;]}
     ),
 ).then((value) =&gt; debugPrint(&quot;Get returnData: $value&quot;));
</code></pre>
</li>
<li><p>Page B return to Page A</p>
<pre><code class="lang-js"> onPressed: () {
   // Global.router.pop(context, args);
   Navigator.pop(context,args);
 },
</code></pre>
</li>
</ol>
<h3 id="header-22">动态路由框架 auto_route</h3>
<ol>
<li><p>pubspec.yaml</p>
<pre><code class="lang-yaml"> dependencies:
   flutter:
     sdk: flutter
   flutter_localizations:
     sdk: flutter
   # 动态路由
   auto_route: ^0.6.9
 dev_dependencies:
   flutter_test:
     sdk: flutter
   # 路由生成
   auto_route_generator: ^0.6.9
   build_runner:
</code></pre>
</li>
<li><p>auto_routes/auto_routes.dart</p>
<pre><code class="lang-java"> import &#39;package:auto_route/auto_route_annotations.dart&#39;;
 import &#39;package:third_app/auto_routes/auth_grard.dart&#39;;
 import &#39;package:third_app/pages/detail/detail.dart&#39;;
 import &#39;package:third_app/pages/frame/frame.dart&#39;;
 import &#39;package:third_app/pages/home/home.dart&#39;;

 @MaterialAutoRouter(
   routes: &lt;AutoRoute&gt;[
     MaterialRoute(path: &#39;/&#39;,page: MyFrame,initial: true),
     MaterialRoute(path:&#39;/home&#39;,page: HomePage),
     MaterialRoute(path:&#39;/details/:id&#39;,page: DetailPage,guards: [AuthGuard]),
   ],
 )  //CustomAutoRoute(..config)
 class $AppRouter {
 }
</code></pre>
</li>
<li><p>auto_routes/auth_guard.dart</p>
<pre><code class="lang-java"> import &#39;package:auto_route/auto_route.dart&#39;;

 class AuthGuard extends RouteGuard{
   @override
   Future&lt;bool&gt; canNavigate(ExtendedNavigatorState&lt;RouterBase&gt; navigator, String routeName, Object arguments) async {
     print(&quot;This is AuthGuard canNavigate: $routeName,$arguments&quot;);
     return true;
   }
 }
</code></pre>
</li>
<li><p>cmd to generate <code>auto_routes/auto_routes.gr.dart</code></p>
<pre><code class="lang-bash"> flutter packages pub run build_runner build
</code></pre>
</li>
<li><p>main.dart</p>
<pre><code class="lang-java"> void main() {
   runApp(MyApp());
 }

 class MyApp extends StatelessWidget {
   @override
   Widget build(BuildContext context) {
     return MaterialApp(
       title: &#39;Hi Dear&#39;,
       home: MyFrame(),
       // 注册路由 （auto_flutter) - Without ExtendedNavigator will lose support for RouteGuards and auto-nested navigation handling
       // onGenerateRoute: AppRouter(),
       // 注册路由 （auto_flutter)
       builder: ExtendedNavigator&lt;AppRouter&gt;(
         // initialRoute: Routes.myFrame,
         router: AppRouter(),
         guards:[AuthGuard()]
       ),
     );
   }
 }
</code></pre>
</li>
<li><p>Page A -&gt; Page B</p>
<pre><code class="lang-js"> ExtendedNavigator.of(context).push(
     items[index][&#39;path&#39;],
     arguments:DetailPageArguments(detailId:&#39;$index&#39;,args:{&#39;title&#39;:items[index][&#39;title&#39;]} ),
   ).then((value) =&gt; debugPrint(&quot;Get returnData: $value&quot;));
</code></pre>
</li>
<li><p>Page B return to Page A</p>
<pre><code class="lang-js"> ExtendedNavigator.of(context).pop(args);
</code></pre>
</li>
</ol>
<h2 id="header-23">导航栏组件</h2>
<h3 id="header-24">顶部导航栏</h3>
<p>AppBar</p>
<pre><code class="lang-js">return Scaffold(
    backgroundColor: Colors.grey[300],
    appBar: AppBar(
      leading: IconButton(
        icon:Icon(Icons.menu),
        tooltip: &#39;Navigation&#39;,
        onPressed: ()=&gt;debugPrint(&#39;Navigation button is pressed.&#39;),
      ),
      actions: [
        IconButton(
          icon:Icon(Icons.search),
          tooltip: &#39;Search&#39;,
          onPressed: ()=&gt;debugPrint(&#39;Search button is pressed.&#39;),
        )
      ],
      title: Text(&quot;Second App&quot;)
    ),
    body: null
  );
</code></pre>
<h3 id="header-25">底部导航栏</h3>
<ul>
<li>BottomNavigationBar</li>
<li>BottomAppBar</li>
</ul>
<h4 id="header-26">BottomNavigationBar</h4>
<pre><code class="lang-js">import &#39;package:flutter/material.dart&#39;;

class BottomNavigationBarDemo extends StatefulWidget {
  BottomNavigationBarDemo({Key key}) : super(key: key);

  @override
  _BottomNavigationBarDemoState createState() =&gt;
      _BottomNavigationBarDemoState();
}

class _BottomNavigationBarDemoState extends State&lt;BottomNavigationBarDemo&gt; {
  int _currentIndex = 0;

  void _onTapHandler(int index) {
    setState(()=&gt;_currentIndex=index);
  }

  @override
  Widget build(BuildContext context) {
    return BottomNavigationBar(
        // 底部导航栏
        type: BottomNavigationBarType.fixed, // item大于等于4个时需设置
        fixedColor: Colors.black,
        currentIndex: _currentIndex,
        onTap: _onTapHandler,
        items: [
          BottomNavigationBarItem(icon: Icon(Icons.explore), title: Text(&quot;Explore&quot;)),
          BottomNavigationBarItem(icon: Icon(Icons.history), title: Text(&quot;History&quot;)),
          BottomNavigationBarItem(icon: Icon(Icons.list), title: Text(&quot;List&quot;)),
          BottomNavigationBarItem(icon: Icon(Icons.person), title: Text(&quot;My&quot;)),
        ]);
  }
}
</code></pre>
<h4 id="header-27">BottomAppBar</h4>
<ul>
<li><p>Example 1 :</p>
<pre><code class="lang-js">  return BottomAppBar(
    child: Row(
      mainAxisAlignment: MainAxisAlignment.spaceAround,
      children: [
        IconButton(icon: Icon(Icons.home),onPressed: null,),
        IconButton(icon: Icon(Icons.list),onPressed: null,),
        IconButton(icon: Icon(Icons.person),onPressed: null,),
      ],
    )
  );
</code></pre>
</li>
<li><p>Example 2 :</p>
<pre><code class="lang-js">  return BottomAppBar(
    child: Expanded(
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceAround,
        children:[
          Expanded(child:IconButton(icon: Icon(Icons.home),onPressed: null,)),
          Expanded(child:IconButton(icon: Icon(Icons.list_alt_rounded),onPressed: null,)),
          Expanded(child:IconButton(icon: Icon(Icons.person),onPressed: null,)),
          Expanded(child:IconButton(icon: Icon(Icons.person),onPressed: null,)),
          Expanded(child:IconButton(icon: Icon(Icons.person),onPressed: null,)),
          Expanded(child:IconButton(icon: Icon(Icons.person),onPressed: null,)),
          Expanded(child:IconButton(icon: Icon(Icons.person),onPressed: null,)),
          Expanded(child:IconButton(icon: Icon(Icons.person),onPressed: null,)),
          Expanded(child:IconButton(icon: Icon(Icons.person),onPressed: null,)),
          Expanded(child:IconButton(icon: Icon(Icons.ac_unit),onPressed: null,)),
        ]
      ),
    ),
  );
</code></pre>
</li>
<li><p>Example 3:</p>
<pre><code class="lang-js">  return BottomAppBar(
    child: Container(
      padding: EdgeInsets.symmetric(vertical: 8),
      child: Row(
        mainAxisAlignment: MainAxisAlignment.spaceAround,
        crossAxisAlignment: CrossAxisAlignment.end,
        children: [
          InkWell(
            onTap: ()=&gt;_onTapHandler(0),
            child: Column(
              mainAxisSize: MainAxisSize.min,
              children: [
                Icon(Icons.home,color: _currentIndex==0?Colors.red:Colors.black,),
                Text(&quot;首页&quot;,style: TextStyle(color: _currentIndex==0?Colors.red:Colors.black),)
              ],
            ),
          ),
          InkWell(
            onTap: ()=&gt;_onTapHandler(1),
            child:Container(
              child:Text(&quot;Do&quot;,style: TextStyle(color:Colors.white),),
              padding: EdgeInsets.all(12),
              decoration: BoxDecoration(
                borderRadius: BorderRadius.circular(35),
                color: _currentIndex==1?Colors.red:Colors.grey,
              ),
            )
          ),
          InkWell(
            onTap: ()=&gt;_onTapHandler(2),
            child: Column(
              mainAxisSize: MainAxisSize.min,
              children: [
                Icon(Icons.person,color: _currentIndex==2?Colors.red:Colors.black,),
                Text(&quot;我的&quot;,style: TextStyle(color: _currentIndex==2?Colors.red:Colors.black),)
              ],
            ),
          ),
        ],
      ),
    )
  );
</code></pre>
</li>
</ul>
<h4 id="header-28">页面切换保持状态</h4>
<p><a href="https://juejin.cn/post/6844903660816695309">https://juejin.cn/post/6844903660816695309</a></p>
<p>Flutter BottomNavigationBar切换页面被重置问题（保存状态）
<a href="https://www.jianshu.com/p/87e545b889cd">https://www.jianshu.com/p/87e545b889cd</a></p>
<p>Flutter底部tab切换保持页面状态的2种方法(转)
<a href="https://www.jianshu.com/p/b7dd54f0bcbd?utm_campaign=haruki">https://www.jianshu.com/p/b7dd54f0bcbd?utm_campaign=haruki</a>
<a href="https://www.jianshu.com/p/369f00a40cc2">https://www.jianshu.com/p/369f00a40cc2</a></p>
<p>切换后页面状态的保持 <code>AutomaticKeepAliveClientMixin</code></p>
<p><a href="https://blog.csdn.net/niceyoo/article/details/92855534">https://blog.csdn.net/niceyoo/article/details/92855534</a>
<a href="https://blog.csdn.net/u010842313/article/details/105554390">https://blog.csdn.net/u010842313/article/details/105554390</a></p>
<p>Flutter实现页面切换后保持原页面状态的3种方法
<a href="https://www.jb51.net/article/157680.htm">https://www.jb51.net/article/157680.htm</a>
<a href="https://my.oschina.net/u/4581368/blog/4372254">https://my.oschina.net/u/4581368/blog/4372254</a></p>
<ul>
<li>使用 IndexedStack, eg: BottomNavigationBar/BottomAppBar &amp; IndexedStack<ul>
<li>缺点在于第一次加载时便实例化了所有的子页面State</li>
</ul>
</li>
<li><code>AutomaticKeepAliveClientMixin</code><ul>
<li>对于未使用的页面状态不会进行实例化，减小了应用初始化时的开销</li>
<li>先决条件：<ul>
<li>使用的页面必须是 StatefulWidget，如果是 StatelessWidget 是没办法办法使用的。</li>
<li>其实只有两个前置组件才能保持页面状态：PageView 和 IndexedStack。</li>
<li>重写 wantKeepAlive 方法，如果不重写也是实现不了的。</li>
</ul>
</li>
</ul>
</li>
<li>扩展：<a href="https://juejin.cn/post/6844903705192431623">如何在列表中的item不被摧毁？</a><ul>
<li>Flutter提供了一个KeepAlive()小部件，它可以保持项目处于活动状态，否则可能会被摧毁。在列表中，元素默认包装在AutomaticKeepAlive小部件中。</li>
<li>可以通过将addAutomaticKeepAlives字段设置为false来禁用AutomaticKeepAlives。这在元素不需要保持活动或KeepAlive的自定义实现的情况下非常有用。</li>
</ul>
</li>
</ul>
<p><strong> Sample: IndexedStack </strong></p>
<pre><code class="lang-js">class IndexBody extends StatelessWidget {
  final int currentIndex;
  final List&lt;Widget&gt; items = [
    HomePage(),
    DoPage(),
    MyPage(),
  ];
  IndexBody({Key key,this.currentIndex=0}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    debugPrint(&quot;build IndexBody&quot;);
    return IndexedStack(
      index: currentIndex,
      children: items,
    );
  }
}
</code></pre>
<p><strong> Sample: AutomaticKeepAliveClientMixin </strong></p>
<pre><code class="lang-js">class ProjectAnnounceView extends StatefulWidget {
  ProjectAnnounceView({Key key}) : super(key: key);
  @override
  _ProjectAnnounceViewState createState() =&gt; _ProjectAnnounceViewState();
}

class _ProjectAnnounceViewState extends State&lt;ProjectAnnounceView&gt; with AutomaticKeepAliveClientMixin{

  @override
  // TODO: implement wantKeepAlive
  bool get wantKeepAlive =&gt; true;

  @override
  Widget build(BuildContext context) {
    return _buildAnnouncementList(getDataOfAnnouncements());
  }

  Widget _buildAnnouncementList(announcementList){
    return Container(
      margin: EdgeInsets.only(top:10),
      child: ListView.builder(
        itemCount: announcementList.length+1,
        itemBuilder: (_,index){
          if(index==announcementList.length)
            return Container(
              margin: EdgeInsets.all(20),
              alignment: Alignment.center,
              child: Text(&quot;——  End  ——&quot;,style: TextStyle(color: Colors.grey),),
            );
          return _buildItem(announcementList[index]);
        },
      )
    );
  }

}
</code></pre>
<h3 id="header-29">标签栏</h3>
<p>TabBar &amp; TabView &amp; TabController
<a href="https://www.cnblogs.com/joe235/p/11213861.html">https://www.cnblogs.com/joe235/p/11213861.html</a></p>
<p>Flutter TabBar、TabBarView、 TabController 实现 Tab 标签菜单布局
<a href="http://www.ptbird.cn/flutter-tab-tabcontroller.html">http://www.ptbird.cn/flutter-tab-tabcontroller.html</a></p>
<p>TabController</p>
<ul>
<li>创建有两种形式<ul>
<li>使用系统的<code>DefaultTabController</code></li>
<li>自己定义一个<code>TabController</code>实现<code>SingleTickerProviderStateMixin</code></li>
</ul>
</li>
<li>一般放入有状态控件中使用，以适应标签页数量和内容有动态变化的场景</li>
<li>如果标签页在APP中是静态固定的格局，则可以在无状态控件中加入简易版的DefaultTabController以提高运行效率，毕竟无状态控件要比有状态控件更省资源，运行效率更快。</li>
</ul>
<h4 id="header-30">DefaultTabController</h4>
<pre><code class="lang-js">class Home extends StatelessWidget {
  const Home({Key key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    // TabController &amp; TabBar(tabs) &amp; TabBarView
    return DefaultTabController(
        length: 5,
        child: Scaffold(
          backgroundColor: Colors.grey[300],
          floatingActionButton: FloatingActionButton(
            child: Icon(Icons.arrow_back),
            onPressed: () {
              Navigator.pop(context);
            },
          ),
          appBar: AppBar(
              elevation: 0, 
              actions: [
                IconButton(
                  icon: Icon(Icons.search),
                  tooltip: &#39;Search&#39;,
                  onPressed: () =&gt; debugPrint(&#39;Search button is pressed.&#39;),
                )
              ],
              bottom: TabBar(
                tabs: [
                  Tab(icon: Icon(Icons.local_florist)),
                  Tab(icon: Icon(Icons.change_history)),
                  Tab(icon: Icon(Icons.directions_bike)),
                  Tab(icon: Icon(Icons.view_quilt)),
                  Tab(icon: Icon(Icons.view_agenda)),
                ],
                unselectedLabelColor: Colors.black38,
                indicatorColor: Colors.black54,
                indicatorSize: TabBarIndicatorSize.label,
                indicatorWeight: 1.0,
              ),
              title: Text(&quot;Second App&quot;)),
          body: TabBarView(
            children: [
              Icon(Icons.local_florist, size: 128, color: Colors.black12),
              Icon(Icons.change_history, size: 128, color: Colors.black12),
              Icon(Icons.directions_bike, size: 128, color: Colors.black12),
              Icon(Icons.view_quilt, size: 128, color: Colors.black12),
              Icon(Icons.view_agenda, size: 128, color: Colors.black12),
            ],
          ),
          bottomNavigationBar: BottomNavigationBarDemo(),
        ));
  }
}
</code></pre>
<h4 id="header-31">TabController</h4>
<pre><code class="lang-js">class ChannelFmIndex extends StatefulWidget {
  ChannelFmIndex({Key key}) : super(key: key);
  @override
  _ChannelFmIndexState createState() =&gt; _ChannelFmIndexState();
}

class _ChannelFmIndexState extends State&lt;ChannelFmIndex&gt;  with SingleTickerProviderStateMixin {

  TabController _tabController;

  @override
  void initState() { 
    super.initState();
    _tabController = TabController(length: 3, vsync: this); // 创建 TabController
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      // appBar: _buildAppBar(context),
      appBar: _buildHeader(),
      body: _buildTabView(context),
    );
  }

  _buildHeader(){
    return AppBar(
      elevation: 0,
      automaticallyImplyLeading: false,
      titleSpacing: 0,
      toolbarHeight: 160,
      title: _buildHeadCard(),
      bottom: PreferredSize(
        preferredSize: Size.fromHeight(50),
        child: _buildHeadTabBar(),
      ),
    );
  }

  _buildHeadTabBar(){
    return Container(
      decoration: BoxDecoration(
        color: Colors.white,
        border: Border.symmetric(
          horizontal: BorderSide(color: Colors.grey[50],width: 8)
        )
      ),
      child: TabBar(
        controller: _tabController,     // 配置 TabController
        indicatorColor: Colors.black87,
        indicatorSize: TabBarIndicatorSize.label,
        indicatorWeight: 1.0,
        tabs: [
          Tab(child: Text(&quot;最新&quot;),),
          Tab(child: Text(&quot;动态&quot;),),
          Tab(child: Text(&quot;简介&quot;),),
        ],
      ),
    );
  }

  _buildTabView(BuildContext context){
    return TabBarView(
      controller: _tabController,   // 配置 TabController
      children: &lt;Widget&gt;[ 
        _buildTabOfLatest(context),
        _buildTabOfActivity(context),
        _buildTabOfIntro()
      ],
    );
  }

  _buildTabOfLatest(BuildContext context){
    // ...
  }

  _buildTabOfActivity(context){
    // ...
  }

  _buildTabOfIntro(){
    // ...
  }

}
</code></pre>
<h2 id="header-32">Banner组件</h2>
<p>第三方组件： <code>flutter_swiper</code></p>
<p><a href="https://www.jianshu.com/p/9bdfc5a00877">https://www.jianshu.com/p/9bdfc5a00877</a>
<a href="https://zhuanlan.zhihu.com/p/88790923">https://zhuanlan.zhihu.com/p/88790923</a></p>
<ol>
<li><p>pubspec.yaml</p>
<pre><code class="lang-yaml"> dependencies:
   flutter:
     sdk: flutter
   # 轮播图
   flutter_swiper: ^1.1.6
</code></pre>
</li>
<li><p>home_banner.dart</p>
<pre><code class="lang-js"> import &#39;package:flutter/material.dart&#39;;
 import &#39;package:flutter_swiper/flutter_swiper.dart&#39;;

 /*
 Ref Doc:
 https://www.cnblogs.com/joe235/p/11251710.html
 https://zhuanlan.zhihu.com/p/88790923
 https://segmentfault.com/a/1190000021488577
 */

 class HomeBanner extends StatelessWidget {
   final List items;

   HomeBanner({Key key, this.items})
       : assert(items != null &amp;&amp; items.length != 0),
         super(key: key);

   @override
   Widget build(BuildContext context) {
     return Container(
       height: 200,
       child: Swiper(
         itemCount: items.length,
         itemBuilder: (context, index) {
           // return InkWell(
           //   child: Image.network(items[index][&#39;image&#39;], fit: BoxFit.fill),
           //   onTap: (){
           //     debugPrint(&#39;banner click to path: ${items[index][&#39;path&#39;]}&#39;);
           //   },
           // );
           return Image.network(items[index][&#39;image&#39;], fit: BoxFit.fill);
         },
         pagination: new SwiperPagination(
           // builder: SwiperPagination.fraction
           // builder: RectSwiperPaginationBuilder(
           //   color: Colors.black,
           //   size: Size(20,10)
           // )
         ),
         autoplay: true,
         autoplayDelay:3000,
         onTap: (index){
           debugPrint(&quot;banner onTap:$index ${items[index][&#39;path&#39;]}&quot;);
         }
         // viewportFraction: 0.8,
         // scale: 0.9,
       ),
     );
   }
 }
</code></pre>
</li>
<li><p>home.dart</p>
<pre><code class="lang-js"> Widget _buildHomeBanner(){
     List items=[
       {
         &#39;image&#39;:&#39;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1603365312,3218205429&amp;fm=26&amp;gp=0.jpg&#39;,
         &#39;path&#39;:&#39;/details/a&#39;,
         &#39;title&#39;:&#39;AAA&#39;
       },
       {
         &#39;image&#39;:&#39;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=2005235653,1742582269&amp;fm=26&amp;gp=0.jpg&#39;,
         &#39;path&#39;:&#39;/details/b&#39;,
         &#39;title&#39;:&#39;BBB&#39;
       },
       {
         &#39;image&#39;:&#39;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1355153719,3297569375&amp;fm=26&amp;gp=0.jpg&#39;,
         &#39;path&#39;:&#39;/details/c&#39;,
         &#39;title&#39;:&#39;CCC&#39;
       },
     ];
     return HomeBanner(items: items);
   }
</code></pre>
</li>
</ol>
<h2 id="header-33">刷新组件</h2>
<h3 id="header-34"><code>RefreshIndicator</code></h3>
<p>下拉刷新
<a href="https://www.cnblogs.com/darecy/archive/2020/05/10/12863080.html">https://www.cnblogs.com/darecy/archive/2020/05/10/12863080.html</a></p>
<pre><code class="lang-js">_buildRefreshIndicator(String name,Widget child){
    return RefreshIndicator(
      onRefresh: () async {
        debugPrint(&quot;+++ $name onRefresh! +++&quot;);
      },
      child: child
    );
}
</code></pre>
<h3 id="header-35"><code>flutter_easyrefresh</code></h3>
<p>第三方组件</p>
<p>下拉刷新以及上拉加载</p>
<ol>
<li><p>pubspec.yaml</p>
<pre><code class="lang-yaml"> dependencies:
   flutter:
     sdk: flutter
   # 下拉刷新以及上拉加载
   flutter_easyrefresh: ^2.1.6
</code></pre>
</li>
<li><p>home.dart</p>
<pre><code class="lang-js">   Widget _buildHomeBody(){
     /*
     https://github.com/xuelongqy/flutter_easyrefresh/blob/v2/README.md
     */
     return EasyRefresh(
       child:  _buildHomeBodyList(),
       header: ClassicalHeader(
         refreshText:&#39;下拉刷新&#39;,
         refreshReadyText:&#39;准备刷新&#39;,
         refreshingText:&#39;刷新获取中&#39;,
         refreshedText:&#39;刷新完成&#39;,
         refreshFailedText: &#39;刷新失败&#39;,
         infoText: &#39;更新时间 %T&#39;,
         completeDuration: Duration(milliseconds: 300),
         textColor: Colors.black54,
         infoColor: Colors.black54,
         showInfo:false
       ),
       footer: ClassicalFooter(
         loadText:&#39;上滑加载&#39;,
         loadReadyText: &#39;加载中&#39;,
         loadingText:&#39;加载中&#39;,
         loadedText:&#39;加载完成&#39;,
         loadFailedText:&#39;加载失败&#39;,
         noMoreText: &#39;我也是有底线的&#39;,
         infoText: &#39;更新时间 %T&#39;,
         textColor: Colors.black54,
         showInfo: false
       ),
       onRefresh: () async{
         debugPrint(&quot;HomePage onRefresh&quot;);
       },
       onLoad: () async{
         debugPrint(&quot;HomePage onLoad&quot;);
       },
     );
   }

   Widget _buildHomeBodyList(){
     return ListView(
         children: [
           _buildHomeBanner(),
         ],
     );
   }
</code></pre>
</li>
</ol>
<h2 id="header-36">滚动控件（Scroll）</h2>
<p>Flutter 滚动控件篇--&gt;滚动监听及控制(ScrollController)
<a href="https://www.mk2048.com/blog/blog_h1ck21icak0hj.html">https://www.mk2048.com/blog/blog_h1ck21icak0hj.html</a></p>
<p>Flutter 滚动监听及实战appBar滚动渐变
<a href="https://www.jianshu.com/p/b0b1c6308674">https://www.jianshu.com/p/b0b1c6308674</a></p>
<h3 id="header-37">ScrollController</h3>
<ul>
<li><code>offset</code>：可滚动组件当前的滚动位置。</li>
<li><code>jumpTo(double offset)</code> 跳转到指定位置，offset 为滚动偏移量。</li>
<li><code>animateTo(double offset,@required Duration duration,@required Curve curve)</code> 同 <code>jumpTo(double offset)</code> 一样，不同的是 <code>animateTo</code> 跳转时会执行一个动画，需要传入执行动画需要的时间和动画曲线。</li>
</ul>
<h3 id="header-38">ScrollPosition</h3>
<ul>
<li>用来保存可滚动组件的滚动位置的</li>
<li>一个 ScrollController 对象可能会被多个可滚动的组件使用</li>
<li>ScrollController 会为每一个滚动组件创建一个 ScrollPosition 对象来存储位置信息</li>
<li>ScrollPosition 中存储的是在 ScrollController 的 positions 属性里面，他是一个 <code>List&lt;ScrollPosition&gt;</code> 数组</li>
<li><code>controller.positions.elementAt(0).pixels</code></li>
<li>ScrollPosition 有两个常用方法：分别是 <code>animateTo()</code> 和 <code>jumpTo()</code>，他们才是真正控制跳转到滚动位置的方法，在 ScrollController 中这两个同名方法，内部最终都会调用 ScrollPosition 这两个方法</li>
</ul>
<h3 id="header-39">ScrollController控制原理</h3>
<p>ScrollController方法<code>createScrollPosition</code></p>
<ul>
<li>当 ScrollController 和可滚动组件关联时，可滚动组件首先会调 ScrollController 的 createScrollPosition 方法来创建一个ScrollPosition来存储滚动位置信息。</li>
<li>在滚动组件调用 createScrollPosition 方法之后，接着会调用 <code>void attach(ScrollPosition position)</code> 方法来将创建好的 ScrollPosition 信息添加到 positions 属性中，这一步称为“注册位置”，只有注册后<code>animateTo()</code> 和 <code>jumpTo()</code>才可以被调用。</li>
<li>最后当可滚动组件被销毁时，会调用 <code>void detach(ScrollPosition position)</code> 方法，将其 ScrollPosition 对象从 ScrollController 的positions 属性中移除，这一步称为“注销位置”，注销后 animateTo() 和 jumpTo() 将不能再被调用。</li>
</ul>
<h3 id="header-40">ScrollNotification</h3>
<p>在接收到滚动事件时，参数类型为<code>ScrollNotification</code></p>
<ul>
<li>包括一个<code>metrics</code>属性，类型是<code>ScrollMetrics</code>，该属性包含当前<code>ViewPort</code>及滚动位置等信息：<ul>
<li>pixels：当前滚动位置。</li>
<li>maxScrollExtent：最大可滚动长度。</li>
<li>extentBefore：滑出ViewPort顶部的长度；此示例中相当于顶部滑出屏幕上方的列表长度。</li>
<li>extentInside：ViewPort内部长度；此示例中屏幕显示的列表部分的长度。</li>
<li>extentAfter：列表中未滑入ViewPort部分的长度；此示例中列表底部未显示到屏幕范围部分的长度。</li>
<li>atEdge：是否滑到了可滚动组件的边界（此示例中相当于列表顶或底部）</li>
</ul>
</li>
</ul>
<h3 id="header-41">NotificationListener</h3>
<ul>
<li>通知冒泡<ul>
<li>Flutter Widget 树中子 Widget可以通过发送通知（Notification）与父(包括祖先) Widget 进行通信，父级组件可以通过 NotificationListener 组件来监听自己关注的通知，这种通信方式类似于 Web 开发中浏览器的事件冒泡，在 Flutter 中就沿用了“冒泡”这个术语，称为通知冒泡</li>
</ul>
</li>
<li>滚动通知<ul>
<li>Flutter 中很多地方使用了通知，如可滚动组件（Scrollable Widget）滑动时就会分发滚动通知（ScrollNotification），而 Scrollbar 正是通过监听 ScrollNotification 来确定滚动条位置的<pre><code class="lang-js">switch (notification.runtimeType){
case ScrollStartNotification: print(&quot;开始滚动&quot;); break;
case ScrollUpdateNotification: print(&quot;正在滚动&quot;); break;
case ScrollEndNotification: print(&quot;滚动停止&quot;); break;
case OverscrollNotification: print(&quot;滚动到边界&quot;); break;
}
</code></pre>
</li>
</ul>
</li>
<li><code>onNotification</code> 回调为通知处理回调，他的返回值时布尔类型（bool），当返回值为 true 时，阻止冒泡，其父级 Widget 将再也收不到该通知；当返回值为 false 时继续向上冒泡通知。</li>
</ul>
<h3 id="header-42">ScrollController VS. NotificationListener</h3>
<ol>
<li>ScrollController 可以控制滚动控件的滚动，而 NotificationListener 是不可以的。</li>
<li>通过 NotificationListener 可以在从可滚动组件到widget树根之间任意位置都能监听，而ScrollController只能和具体的可滚动组件关联后才可以。</li>
<li>收到滚动事件后获得的信息不同；NotificationListener在收到滚动事件时，通知中会携带当前滚动位置和ViewPort的一些信息，而ScrollController只能获取当前滚动位置</li>
</ol>
<h3 id="header-43">ScrollPhysics</h3>
<p><a href="https://zhuanlan.zhihu.com/p/84716922">https://zhuanlan.zhihu.com/p/84716922</a></p>
<p>确定可滚动控件的物理特性</p>
<ul>
<li>BouncingScrollPhysics ：允许滚动超出边界，但之后内容会反弹回来。</li>
<li>ClampingScrollPhysics ： 防止滚动超出边界，夹住 。</li>
<li>AlwaysScrollableScrollPhysics ：始终响应用户的滚动。</li>
<li>NeverScrollableScrollPhysics ：不响应用户的滚动。</li>
</ul>
<p><strong> Sample: </strong></p>
<pre><code class="lang-js">CustomScrollView(
    // ... 
    physics: const BouncingScrollPhysics()
);

ListView.builder(
     // ... 
    physics: const AlwaysScrollableScrollPhysics()
);


GridView.count(
     // ... 
    physics: NeverScrollableScrollPhysics()
);
</code></pre>
<p>应用：两个滚动列表嵌套，设置NeverScrollableScrollPhysics让内部滚动失效，依赖外部的滚动</p>
<pre><code class="lang-java">_buildItems(value){
    return ListView.builder(
      itemCount: value.activityItems.length+1,
      shrinkWrap: true, // 父视图的大小跟随子组件的内容大小 for solve: Error: Flutter Horizontal viewport was given unbounded height.width. (或固定父容器高度. 或用Expanded/Flexible包裹，把剩余空间全部占掉)
      physics: new NeverScrollableScrollPhysics(),
      itemBuilder:  (ctx,index){
        if(index==value.activityItems.length){
          return _buildEndInfo(value);
        }
        return _buildActivity(value.activityItems[index]);
      }
    );
  }
</code></pre>
<h3 id="header-44">应用：ListView滑动到底部自动加载更多</h3>
<pre><code class="lang-python">ScrollController _scrollController = new ScrollController();

@override
void initState() {
    debugPrint(&quot;-- HomeMovie initState --&quot;);
    // TODO: implement initState
    super.initState();
    _scrollController.addListener(() {
      // debugPrint(&quot;_scrollController:${_scrollController.position.pixels}&quot;);
      if(_scrollController.position.pixels==_scrollController.position.maxScrollExtent){
        debugPrint(&quot;-- HomeMovie Trigger load --&quot;);
        widget.homeMovieState.load();
      }
    });
}

@override
void dispose() {
    debugPrint(&quot;-- HomeMovie dispose --&quot;);
    _scrollController.dispose();
    // TODO: implement dispose
    super.dispose();
}
/// ListView.builder( controller: _scrollController, itemBuilder: (ctx,index){...},...);
</code></pre>
<h3 id="header-45">应用：滚动到指定位置</h3>
<p>Flutter 滚动距离来设置TabBar的位置，点击TabBar滚动的到指定的位置
<a href="https://blog.csdn.net/yujunlong3919/article/details/105107195">https://blog.csdn.net/yujunlong3919/article/details/105107195</a></p>
<p>flutter滚动到列表指定元素
<a href="https://chentaoqian.com/?p=613">https://chentaoqian.com/?p=613</a></p>
<ul>
<li>方案一：使用第三方组件<a href="https://pub.dev/packages/scrollable_positioned_list"><code>scrollable_positioned_list</code></a></li>
<li>方案二：使用 <code>Scrollable.ensureVisible(context)</code> ，该方式不仅能达到效果，还适用于各种尺寸的widget。但这方案也有个问题，就是不能跳转到不可见的组件（non-visible）</li>
</ul>
<p><strong> Sample： </strong></p>
<ul>
<li>需要被跳转的组件，设置key为<code>GlobalKey()</code>，并在外部存储该key。</li>
<li>调用<code>Scrollable.ensureVisible(context)</code>，传入的context是上一步key的currentContext。</li>
</ul>
<pre><code class="lang-js">class ScrollView extends StatelessWidget {
  final dataKey = new GlobalKey();

  @override
  Widget build(BuildContext context) {
    return new Scaffold(
      primary: true,
      appBar: new AppBar(
        title: const Text(&#39;Home&#39;),
      ),
      body: new SingleChildScrollView(
        child: new Column(
          children: [
            new SizedBox(height: 160.0, width: double.infinity, child: new Card()),
            new SizedBox(height: 160.0, width: double.infinity, child: new Card()),
            new SizedBox(height: 160.0, width: double.infinity, child: new Card()),
            // destination
            new Card(
              key: dataKey,
              child: new Text(&quot;data\n\n\n\n\n\ndata&quot;),
            )
          ],
        ),
      ),
      bottomNavigationBar: new RaisedButton(
        onPressed: () =&gt; Scrollable.ensureVisible(dataKey.currentContext),
        child: new Text(&quot;Scroll to data&quot;),
      ),
    );
  }
}
</code></pre>
<h2 id="header-46">ScrollView</h2>
<p><a href="https://www.jianshu.com/p/cf8e92f76bdb">https://www.jianshu.com/p/cf8e92f76bdb</a>
<a href="https://blog.csdn.net/yechaoa/article/details/90701321">https://blog.csdn.net/yechaoa/article/details/90701321</a></p>
<h3 id="header-47">CustomScrollView</h3>
<pre><code class="lang-java">_buildSliverBody(context) {
    return CustomScrollView(
      slivers: [
        _buildSliverAppBar(),

        _buildSliverPanding(),
        _buildSliverFillRemaining(),
        _buildSliverFillViewport(),

         _buildSliverGrid(),
        _buildSliverList(),
      ],
    );
  }
</code></pre>
<h3 id="header-48">SliverAppBar</h3>
<pre><code class="lang-js">_buildSliverAppBar() {
    return SliverAppBar(
        title: Text(&quot;标题&quot;),
        expandedHeight: 180.0,
        floating: false,
        pinned: true,
        snap: false,
        flexibleSpace: new FlexibleSpaceBar(
          title: new Text(&quot;标题标题标题&quot;),
          centerTitle: true,
          collapseMode: CollapseMode.pin,
        ),
        onStretchTrigger:()async{ print(&quot;onStretchTrigger&quot;);return; }
    );

    return SliverAppBar(
      floating: false,
      pinned: true,
      expandedHeight: 180,
      flexibleSpace: FlexibleSpaceBar(
        title: Text(
          &quot;Silver Demo&quot;,
          style: TextStyle(letterSpacing: 3, fontWeight: FontWeight.w400),
        ),
        background: Image.network(
            &quot;https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1549239440,280119214&amp;fm=26&amp;gp=0.jpg&quot;,
            fit: BoxFit.cover),
      ),
    );
  }
</code></pre>
<h3 id="header-49">SliverList</h3>
<pre><code class="lang-js">_buildSliverList() {
    return SliverFixedExtentList(
      itemExtent: 40.0,
      delegate: SliverChildBuilderDelegate(
        (BuildContext context, int index) {
          return Card(
            child: Container(
              alignment: Alignment.center,
              color: Colors.primaries[(index % 18)],
              child: Text(&#39;&#39;),
            ),
          );
        },
      ),
    );
  }
</code></pre>
<h3 id="header-50">SliverGrid</h3>
<pre><code class="lang-js">_buildSliverGrid() {
    return SliverGrid(
      gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
        crossAxisCount: 3,
        childAspectRatio: 2.0,
        mainAxisSpacing: 10,
        crossAxisSpacing: 10,
      ),
      ///子Item构建器
      delegate: new SliverChildBuilderDelegate(
        (BuildContext context, num index) {
          ///每一个子Item的样式
          return Container(
            color: Colors.blue,
            child: Text(&quot;grid $index&quot;),
          );
        },
        ///子Item的个数
        childCount: 30,
      ),
    );
  }
</code></pre>
<h3 id="header-51">SliverToBoxAdapter</h3>
<p>在CustomScrollView 中是只能使用Sliver系的控件,如果在CustomScrollView 中想要嵌套其他非 Sliver 系就必须要使用SliverToBoxAdapter包装一下</p>
<pre><code class="lang-java">_buildSliverPanding() {
    return SliverPadding(
        padding: EdgeInsets.all(8),
        sliver: SliverToBoxAdapter(
          child: Container(
            height: 40,
            color: Colors.grey,
            child: Text(&quot;SliverPadding &amp; SliverToBoxAdapter&quot;),
          ),
        ));
  }
</code></pre>
<h3 id="header-52">SliverFillRemaining</h3>
<pre><code class="lang-java"> _buildSliverFillRemaining() {
    return SliverFillRemaining(
      child: Container(
        height: 40,
        color: Colors.lightBlue,
        child: Text(&quot;SliverFillRemaining&quot;),
      ),
    );
  }
</code></pre>
<h3 id="header-53">SliverFillViewport</h3>
<pre><code class="lang-java">_buildSliverFillViewport() {
    return SliverFillViewport(
        viewportFraction: 1.0,
        delegate: SliverChildBuilderDelegate(
            (_, index) =&gt; Container(
                margin: EdgeInsets.all(8),
                child: Text(&#39;Item $index&#39;),
                alignment: Alignment.center,
                color: Colors.indigoAccent),
            childCount: 10));
  }
</code></pre>
<h3 id="header-54">NestedScrollView</h3>
<p><a href="https://segmentfault.com/a/1190000022575678">https://segmentfault.com/a/1190000022575678</a></p>
<pre><code class="lang-java">_buidBody() {
    return NestedScrollView(
      headerSliverBuilder: (_,innerBoxIsScrolled){
        return [
          SliverToBoxAdapter(child: _buildPlayPanel(),),
          SliverAppBar(
            automaticallyImplyLeading: false,
            elevation: 0,
            floating: true,
            pinned: true,
            title: _buildTabBar()
          ),
        ];
      }, 
      body: _buildTabView()
    );
  }
</code></pre>
<h3 id="header-55">NestedScrollView 滚动问题</h3>
<p>Flutter 里 NestedScrollView body 嵌套滚动的问题
<a href="https://www.v2ex.com/t/655844">https://www.v2ex.com/t/655844</a>
<a href="http://codingdict.com/questions/97543">http://codingdict.com/questions/97543</a></p>
<p>在子组件里控制父级组件的滚动 =&gt;  但“会导致头部滚动折叠的很快”，不推荐！</p>
<pre><code class="lang-python">_scrollController = ScrollController();

_scrollController.addListener((){
  var innerPos      = _scrollController.position.pixels;
  var maxOuterPos   = widget.parentController.position.maxScrollExtent;
  var currentOutPos = widget.parentController.position.pixels;

  if(innerPos &gt;= 0 &amp;&amp; currentOutPos &lt; maxOuterPos) {
    //widget.parentController.position.jumpTo(innerPos+currentOutPos);
    widget.parentController.position.animateTo(innerPos+currentOuterPos, 
      duration: Duration(seconds:1), curve: Curves.easeOut);

  }else{
    var currenParentPos = innerPos + currentOutPos;
    widget.parentController.position.jumpTo(currenParentPos);
  }
});

widget.parentController.addListener((){
  var currentOutPos = widget.parentController.position.pixels;
  if(currentOutPos &lt;= 0) {
    _scrollController.position.jumpTo(0);
  }
});
</code></pre>
<h2 id="header-56">异常处理</h2>
<p>Flutter Exception降到万分之几的秘密
<a href="https://zhuanlan.zhihu.com/p/53443293">https://zhuanlan.zhihu.com/p/53443293</a></p>
<p><a href="https://blog.csdn.net/wangfeijn/article/details/90033008">https://blog.csdn.net/wangfeijn/article/details/90033008</a>
<a href="https://segmentfault.com/a/1190000022280728">https://segmentfault.com/a/1190000022280728</a>
<a href="https://ducafecat.tech/2020/06/05/flutter-project/flutter-project-news-12-error-sentry/">https://ducafecat.tech/2020/06/05/flutter-project/flutter-project-news-12-error-sentry/</a></p>
<p>捕捉异常</p>
<ul>
<li>同步异常捕捉 =&gt; 通过<code>try/catch/finally</code>即可</li>
<li>异步异常捕捉 =&gt; 通过<code>runZonedGuarded(...)</code>方法，指定一个代码执行的环境空间</li>
</ul>
<p>异常：</p>
<ul>
<li>Dart异常</li>
<li>Flutter异常</li>
</ul>
<p>异常处理：</p>
<ul>
<li><code>try/catch/finally</code>: catch sync dart error.</li>
<li><code>runZonedGuarded</code>: catch uncatched dart error.</li>
<li><code>FlutterError.onError = (FlutterErrorDetails details) async {};</code>: catch flutter error when working in release mode.</li>
<li><code>ErrorWidget.builder=(FlutterErrorDetails details){};</code> : a widget show flutter error when working in debug mode.</li>
</ul>
<p><strong> Sample: </strong></p>
<ol>
<li><p>main.dart:</p>
<pre><code class="lang-java"> import &#39;dart:async&#39;;

 import &#39;package:five_demo/pages/app/app_page.dart&#39;;
 import &#39;package:five_demo/utils/log_utils.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;
 import &#39;global/global.dart&#39;;

 // void main() {
 //   runApp(MyApp());
 // }

 void main() async {
   // catch uncatched dart error
   runZonedGuarded(() async {
     Global.init().then((value) {
       // runApp(Global.wrapGlobalProviders(MyApp()));
       runApp(AppPage());
     });
   }, (error,stack)=&gt;LogUtils.error(&quot;$error \n $stack&quot;));
 }
</code></pre>
</li>
<li><p>log_utils.dart:</p>
<pre><code class="lang-java"> import &#39;dart:async&#39;;

 import &#39;package:flutter/material.dart&#39;;

 class LogUtils{

   static info(Object object){
     print(&quot;=== INFO === : $object&quot;);
   }

   static error(Object object){
     print(&quot;=================== ERROR Begin&quot;);
     print(object);
     print(&quot;=================== ERROR End&quot;);
   }

   // 是否开发环境
   static bool get isInDebugMode {
     bool isRelease = bool.fromEnvironment(&quot;dart.vm.product&quot;);
     return !isRelease;
   }

   /// Note: debug mode doesn&#39;t work, work in release mode !
   static setFlutterErrorHandlerOnRelease(){
     FlutterError.onError = (FlutterErrorDetails details) async {
       print(&quot;=================== CAUGHT FLUTTER ERROR&quot;);
       if (isInDebugMode == true) {
         FlutterError.dumpErrorToConsole(details);
       } else {
         Zone.current.handleUncaughtError(details.exception, details.stack);
       }
     };
   }

   /// Note: only show in debug mode ,won&#39;t show in release mode !
   static setFlutterErrorWidgetOnDebug(){
     ErrorWidget.builder=(FlutterErrorDetails details){
       print(&quot;=================== BUILD ERROR WIDGET&quot;);
       print(details.toString());
       return SingleChildScrollView(
         // decoration: BoxDecoration(
         //   image: DecorationImage(
         //     image: new AssetImage(&quot;assets/images/default/empty.png&quot;),
         //   )
         // ),
         child: Column(
           mainAxisAlignment: MainAxisAlignment.spaceAround,
           children:[
             Text(&quot;Exception!&quot;,style: TextStyle(color: Colors.red,fontSize: 26),),
             // Image.network(
             //   &#39;https://dss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1671659209,570778771&amp;fm=26&amp;gp=0.jpg&#39;),
             Text(&quot;${details.exception}&quot;,style: TextStyle(color:Colors.red,fontSize: 18),textDirection: TextDirection.ltr,)  
           ]
         ),
       );
     };
   }
 }
</code></pre>
</li>
<li><p>global.dart</p>
<pre><code class="lang-java"> class Global{

   static Future init() async {

     LogUtils.info(&quot;[Global] init() start&quot;);

     WidgetsFlutterBinding.ensureInitialized();

     LogUtils.info(&quot;[Global] set FlutterErrorHander&quot;);
     LogUtils.setFlutterErrorWidgetOnDebug();
     LogUtils.setFlutterErrorHandlerOnRelease();

     // ...
   }
 }
</code></pre>
</li>
</ol>
<h3 id="header-57">Flutter项目IOS真机部署及问题</h3>
<p>flutter build ios --release
flutter run --release</p>
<p>Xcode:</p>
<p><a href="https://www.jianshu.com/p/69e1efc2fc55">https://www.jianshu.com/p/69e1efc2fc55</a>
<a href="http://www.cocoachina.com/articles/475845">http://www.cocoachina.com/articles/475845</a>
<a href="https://www.codingsky.com/doc/flutter/ios-release-build.html">https://www.codingsky.com/doc/flutter/ios-release-build.html</a></p>
<ol>
<li>在Xcode中, 在你的工程目录中的ios文件夹下打开Runner.xcworkspace.</li>
<li>要查看您的应用程序的设置，请在Xcode项目导航器中选择Runner项目。然后，在主视图边栏中，选择Runnertarget</li>
<li>选择 General 选项卡.</li>
</ol>
<p>在 Identity 部分:</p>
<ul>
<li>Display Name: 要在主屏幕和其他地方显示的应用程序的名称</li>
<li>Bundle Identifier: 您在iTunes Connect上注册的App ID.</li>
</ul>
<p>在 Signing 部分:</p>
<ul>
<li>Automatically manage signing: Xcode是否应该自动管理应用程序签名和生成。默认设置为true，对大多数应用程序来说应该足够了。对于更复杂的场景，请参阅Code Signing Guide。</li>
<li>Team: 选择与您注册的Apple Developer帐户关联的团队。如果需要，请选择Add Account...，然后更新此设置</li>
</ul>
<h2 id="header-58">TextField &amp; Keyboard</h2>
<h3 id="header-59">TextField</h3>
<p>Flutter 基础组件：输入框和表单
<a href="https://www.cnblogs.com/parzulpan/p/12066691.html">https://www.cnblogs.com/parzulpan/p/12066691.html</a></p>
<p>Flutter TextField详解
<a href="https://blog.csdn.net/yechaoa/article/details/90906689">https://blog.csdn.net/yechaoa/article/details/90906689</a></p>
<p>Flutter 实现一个登录界面
<a href="http://www.cocoachina.com/articles/29529?filter=rec">http://www.cocoachina.com/articles/29529?filter=rec</a></p>
<p>Flutter监听TextField焦点事件，点击与清除焦点
<a href="https://www.uedbox.com/post/65066/">https://www.uedbox.com/post/65066/</a></p>
<p>Flutter Form、TextFormField及表单验证、表单输入框聚焦
<a href="http://www.ptbird.cn/flutter-form-textformfield.html">http://www.ptbird.cn/flutter-form-textformfield.html</a></p>
<h3 id="header-60">键盘弹起/隐藏问题</h3>
<p>Flutter底部弹出TextField评论输入框并且自适应高度
<a href="https://www.jianshu.com/p/09ae2b6995e7?utm_campaign=haruki">https://www.jianshu.com/p/09ae2b6995e7?utm_campaign=haruki</a></p>
<p>flutter中关于软键盘弹起导致的问题
<a href="https://www.jianshu.com/p/4dab8a87f28b">https://www.jianshu.com/p/4dab8a87f28b</a></p>
<ol>
<li>当布局高度写死时，例如设置为屏幕高度，这时候键盘弹起页面上会出现布局overflow的提示</li>
<li>软键盘弹起后遮挡输入框
=&gt; 原因：在flutter中，键盘弹起时系统会缩小Scaffold的高度并重建</li>
</ol>
<p>解决问题1中overflow提示的两种办法：</p>
<ol>
<li>把Scaffold的<code>resizeToAvoidBottomInset</code>属性设置为<code>false</code>，这样在键盘弹出时将不会resize</li>
<li>把写死的高度改为 <code>原高度 - MediaQuery.of(context).viewInsets.bottom</code>，键盘弹出时布局将重建，而这个<code>MediaQuery.of(context).viewInsets.bottom</code>变量在键盘弹出前是0，键盘弹起后的就是键盘的高度</li>
</ol>
<p>解决问题2的办法：</p>
<ul>
<li>将输入框放进可滚动的Widget中即可，当输入框获取焦点后，系统会自动将它滑动到可视区域</li>
</ul>
<p>flutter TextField 输入框被软键盘挡住的解决方案
<a href="https://www.cnblogs.com/tianmiaogongzuoshi/p/11181782.html">https://www.cnblogs.com/tianmiaogongzuoshi/p/11181782.html</a></p>
<p>页面元素的最外层肯定得嵌套一层<code>SingleChildScrollView</code>（<code>SingleChildScrollView</code> 元素内部不能和 Expanded 的flex 直接填充，会冲突）</p>
<pre><code class="lang-java">body: Container(
         //SingleChildScrollView 的父级元素得有高度  最外层Container默认 填充全部
        child: SingleChildScrollView(
        ........
    )
</code></pre>
<p>flutter中如何监听键盘弹出关闭
<a href="https://segmentfault.com/a/1190000022495736">https://segmentfault.com/a/1190000022495736</a></p>
<p>Flutter showModalBottomSheet &amp; Textfield 制作底部评论框并解决bug
<a href="https://juejin.cn/post/6844903846645334023">https://juejin.cn/post/6844903846645334023</a></p>
<p>Flutter 弹出键盘认识
<a href="https://juejin.cn/post/6844903749362647048">https://juejin.cn/post/6844903749362647048</a></p>
<p>TextField, 全局点击空白处隐藏键盘
<a href="https://my.oschina.net/u/4082303/blog/4543122?utm_source=osc_group_android">https://my.oschina.net/u/4082303/blog/4543122?utm_source=osc_group_android</a>
为 TextField 添加 <code>focusNode</code>，点击空白处时使 TextField 失去焦点</p>
<p><code>FocusScope.of(context).requestFocus(new FocusNode());</code></p>
<pre><code class="lang-js">class DismissKeyboardDemo extends StatelessWidget {
  final FocusNode focusNode = FocusNode();

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(),
      body: GestureDetector(
        onTap: () {
          focusNode.unfocus();
        },
        child: Container(
          color: Colors.transparent,
          alignment: Alignment.center,
          child: TextField(
            focusNode: focusNode,
          ),
        ),
      ),
    );
  }
}
</code></pre>
<p>当 App 中有多个页面多个 TextField 时，此方式会增加大量重复的代码，因此全局添加点击空白处的监听：</p>
<pre><code class="lang-js">onTap: () {
    FocusScopeNode currentFocus = FocusScope.of(context);
    if (!currentFocus.hasPrimaryFocus &amp;&amp;
        currentFocus.focusedChild != null) {
      FocusManager.instance.primaryFocus.unfocus();
    }
},
</code></pre>
<p>也可以使用如下方式隐藏键盘：</p>
<p><code>SystemChannels.textInput.invokeMethod(&#39;TextInput.hide&#39;);</code></p>
<h2 id="header-61">状态管理</h2>
<p>MVC、MVP、BloC、Redux四种架构在Flutter上的尝试
<a href="https://www.jianshu.com/p/ba3414457419">https://www.jianshu.com/p/ba3414457419</a></p>
<p>Flutter State Management状态管理全面分析
<a href="https://www.jianshu.com/p/9334b8f68004">https://www.jianshu.com/p/9334b8f68004</a></p>
<ul>
<li>构建 <code>StatefulWidget</code>  -&gt; <code>setState</code> 自身组件动态维护</li>
<li>包裹 <code>Provider</code>（<code>InheritedWidget</code>）-&gt; 与其他组件交互</li>
<li>使用 <code>Bloc</code> (<code>Stream</code>) -&gt; 与多个监听组件同步信息</li>
</ul>
<h3 id="header-62">Bloc</h3>
<p><a href="https://www.jianshu.com/p/4d5e712594b4">https://www.jianshu.com/p/4d5e712594b4</a>
<a href="https://www.jianshu.com/p/e31e8268d2cd">https://www.jianshu.com/p/e31e8268d2cd</a></p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # bloc
  flutter_bloc: ^6.1.1
</code></pre>
<ol>
<li><p>counter_page.dart</p>
<pre><code class="lang-java"> import &#39;package:flutter/material.dart&#39;;
 import &#39;package:flutter_bloc/flutter_bloc.dart&#39;;
 import &#39;package:third_app/pages/counter/counter_event.dart&#39;;

 import &#39;counter_bloc.dart&#39;;

 class CounterPage extends StatelessWidget {
   CounterPage({Key key}) : super(key: key);
   @override
   Widget build(BuildContext context) {
     return Container(
         child: BlocProvider&lt;CounterBloc&gt;(
             create: (context) =&gt; CounterBloc(0),
             // child: BlocBuilder&lt;CounterBloc, int&gt;(
             //   builder: (context, state) =&gt;
             //       _buildContent(context.watch&lt;CounterBloc&gt;(), state),
             // )
             child: BlocListener&lt;CounterBloc,int&gt;(
               listener:(context,state)=&gt;print(&quot;state:$state&quot;),
               child:BlocBuilder&lt;CounterBloc, int&gt;(
                   builder: (context, state) =&gt;
                       _buildContent(context.watch&lt;CounterBloc&gt;(),state),
                 )
             ),
           )
         );
   }
   _buildContent(CounterBloc bloc, int state) {
     return Row(
       mainAxisAlignment: MainAxisAlignment.spaceEvenly,
       children: [
         Text(&quot;Count:$state&quot;),
         OutlineButton(
             onPressed: () =&gt; bloc.add(CounterEvent.increment),
             child: Text(&quot;Add&quot;)),
         OutlineButton(
             onPressed: () =&gt; bloc.add(CounterEvent.decrement),
             child: Text(&quot;Sub&quot;)),
       ],
     );
   }
 }
</code></pre>
</li>
<li><p>counter_bloc.dart</p>
<pre><code class="lang-java"> import &#39;package:flutter_bloc/flutter_bloc.dart&#39;;
 import &#39;package:third_app/pages/counter/counter_event.dart&#39;;

 class CounterBloc extends Bloc&lt;CounterEvent,int&gt;{

   CounterBloc(int initialState) : super(initialState);

   @override
   Stream&lt;int&gt; mapEventToState(CounterEvent event) async * {
     switch(event){
       case CounterEvent.decrement:
         yield state-1;
         break;
       case CounterEvent.increment:
         yield state+1;
         break;
       default:
         throw Exception(&#39;oops&#39;);
     }
   }
 }
</code></pre>
</li>
<li><p>counter_event.dart</p>
<pre><code class="lang-java"> enum CounterEvent { 
   increment, 
   decrement 
 }
</code></pre>
</li>
</ol>
<h3 id="header-63">Provider</h3>
<p>Provider组件</p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # 状态管理
  provider: ^4.3.2+2
</code></pre>
<p><a href="https://www.jianshu.com/p/a87ebd2d3296">https://www.jianshu.com/p/a87ebd2d3296</a>
<a href="http://www.cainiaoxueyuan.com/xcx/13599.html">http://www.cainiaoxueyuan.com/xcx/13599.html</a>
<a href="https://www.cnblogs.com/crazycode2/p/11407967.html">https://www.cnblogs.com/crazycode2/p/11407967.html</a>
<a href="https://www.jianshu.com/p/bf2f33b2b5ef">https://www.jianshu.com/p/bf2f33b2b5ef</a>
<a href="https://cloud.tencent.com/developer/article/1485323">https://cloud.tencent.com/developer/article/1485323</a></p>
<ul>
<li>注入/创建： <code>Provider.value</code> / <code>Provider.create</code> =&gt; 推荐create（在销毁时自动调用<code>ChangeNotifier</code>中的<code>dispose()</code>方法释放一些资源）</li>
<li>获取：<code>context.read</code> / <code>context.watch</code><ul>
<li>read 在Provider的build method / update callback 中使用，不会导致重构(等于 <code>Provider.of&lt;T&gt;(this, listen: false);</code>）</li>
<li>watch 会导致重构</li>
</ul>
</li>
<li>获取：<code>provider.of(context)</code> 所在子widget不管是否是const都被重建后刷新数据 =&gt; 将会把调用了该方法的<code>context</code>作为听众，并在 <code>notifyListeners</code> 的时候通知其刷新。</li>
<li>监听改变：组件被<code>Consumer</code>,<code>Select</code> 包裹，监听到T改变，会重新构建 =&gt; 极大地缩小你的控件刷新范围(可使用<code>Selector</code>达到更精细地控制,eg: 在list的长度发生改变时才会重新渲染，其内部元素改变时并不会触发重绘)<ul>
<li>Consumer做了什么: 从先祖获取Provider<T>然后传递给builder出的组件，本来代代相承的传家宝直接通过Consumer隔代传送</li>
<li>Consumer 使用了 Builder模式，收到更新通知就会通过 builder 重新构建</li>
<li>Consumer 的 builder 实际上就是一个 Function，它接收三个参数 <code>(BuildContext context, T model, Widget child)</code><ul>
<li>context： context 就是 build 方法传进来的 BuildContext</li>
<li>T: 就是获取到的最近一个祖先节点中的数据模型。</li>
<li>child：它用来构建那些与 Model 无关的部分，在多次运行 builder 中，child 不会进行重建。</li>
</ul>
</li>
<li>Consumer<T> 代表了它要获取哪一个祖先中的 Model</li>
<li>Consumer 的内部实现<pre><code class="lang-js">  @override
    Widget build(BuildContext context) {
      return builder(
        context,
        Provider.of&lt;T&gt;(context),
        child,
      );
    }
</code></pre>
</li>
</ul>
</li>
</ul>
<ul>
<li><code>Provider</code> 最基础的provider,它会获取一个值并将它暴露出来</li>
<li><code>ListenableProvider</code> 用来暴露可监听的对象，该provider将会监听对象的改变以便及时更新组件状态</li>
<li><code>ChangeNotifierProvider</code></li>
<li><code>ListerableProvider</code> 依托于ChangeNotifier的一个实现，它将会在需要的时候自动调用ChangeNotifier.dispose方法</li>
<li><code>ValueListenableProvider</code> 监听一个可被监听的值，并且只暴露ValueListenable.value方法</li>
<li><code>StreamProvider</code> 监听一个流，并且暴露出其最近发送的值</li>
<li><code>FutureProvider</code> 接受一个Future作为参数，在这个Future完成的时候更新依赖</li>
<li><code>ProxyProvider</code> 能够将不同provider中的多个值整合成一个对象，并将其发送给外层provider，当所依赖的多个provider中的任意一个发生变化时，这个新的对象都会更新</li>
</ul>
<h3 id="header-64">Consumer</h3>
<p>使用目的：</p>
<ol>
<li><p>当没有BuildContext时可以使用Consumer</p>
<pre><code class="lang-js"> @override // ERROR：ProviderNotFoundError 因为该context中并没有Provider
 Widget build(BuildContext context) {
   return ChangeNotifierProvider(
     builder: (_) =&gt; Foo(),
     child: Text(Provider.of&lt;Foo&gt;(context).value),
   );
 }

 @override // OK 
 Widget build(BuildContext context) {
   return ChangeNotifierProvider(
     builder: (_) =&gt; Foo(),
     child: Consumer&lt;Foo&gt;(
       builder: (_, foo, __) =&gt; Text(foo.value),
     },
   );
 }
</code></pre>
</li>
<li><p>它通过更细粒度的重构来帮助性能优化。</p>
<pre><code class="lang-js"> class RedBox extends StatelessWidget {
   @override
   Widget build(BuildContext context) {
     print(&quot;---------RedBox---------build---------&quot;);
     return Container(
       color: Colors.red,
       width: 150,
       height: 150,
       alignment: Alignment.center,
       child: Consumer&lt;CountState&gt;(builder: (ctx,state,child){
         print(&quot;---------RedBox----Consumer-----build---------&quot;);
         return Text(&quot;Red:${state.count}&quot;,
             style: TextStyle(fontSize: 20),);
       }),
     );
   }
 }
</code></pre>
</li>
</ol>
<p><strong> Consumer 源码 </strong></p>
<pre><code class="lang-js">class Consumer&lt;T&gt; extends SingleChildStatelessWidget {
  /// {@template provider.consumer.constructor}
  /// Consumes a [Provider&lt;T&gt;]
  /// {@endtemplate}
  Consumer({
    Key key,
    @required this.builder,
    Widget child,
  })  : assert(builder != null),
        super(key: key, child: child);

  /// {@template provider.consumer.builder}
  /// Build a widget tree based on the value from a [Provider&lt;T&gt;].
  ///
  /// Must not be `null`.
  /// {@endtemplate}
  final Widget Function(BuildContext context, T value, Widget child) builder;

  @override
  Widget buildWithChild(BuildContext context, Widget child) {
    return builder(
      context,
      Provider.of&lt;T&gt;(context),
      child,
    );
  }
}
</code></pre>
<p>注：传入的context是谁的BuildContext？ 
每个Widget都有属于自己的元素Element，在该Element进行mount的时候回将自身化作美丽的天使(Context)传入组件或State的build方法中来供你使用</p>
<h3 id="header-65">FutureBuilder &amp; StreamBuilder</h3>
<p><a href="https://book.flutterchina.club/chapter7/futurebuilder_and_streambuilder.html">https://book.flutterchina.club/chapter7/futurebuilder_and_streambuilder.html</a></p>
<pre><code class="lang-java">FutureBuilder({
  this.future,
  this.initialData,
  @required this.builder,       // Function (BuildContext context, AsyncSnapshot snapshot) snapshot 包含当前异步任务的状态信息及结果信息
})
</code></pre>
<pre><code class="lang-java">StreamBuilder({
  Key key,
  this.initialData,
  Stream&lt;T&gt; stream,
  @required this.builder,
})
</code></pre>
<p><code>snapshot.hasError</code>判断异步任务是否有错误
<code>snapshot.connectionState</code> 获取异步任务的状态信息</p>
<pre><code class="lang-java">enum ConnectionState {
  /// 当前没有异步任务，比如[FutureBuilder]的[future]为null时
  none,
  /// 异步任务处于等待状态
  waiting,
  /// Stream处于激活状态（流上已经有数据传递了），对于FutureBuilder没有该状态。
  active,
  /// 异步任务已经终止.
  done,
}
</code></pre>
<h3 id="header-66">MVVM</h3>
<p>Flutter 实践 MVVM
<a href="https://cloud.tencent.com/developer/article/1372224">https://cloud.tencent.com/developer/article/1372224</a></p>
<ul>
<li>Model: MovieItem</li>
<li>View: MovieView</li>
<li>ViewModel: MovieState</li>
</ul>
<h2 id="header-67">应用</h2>
<h3 id="header-68">获取某个控件的坐标</h3>
<p><a href="https://blog.csdn.net/baidu_34120295/article/details/86495861">https://blog.csdn.net/baidu_34120295/article/details/86495861</a></p>
<p>1.首先先需要对控件进行渲染</p>
<p>初始化GlobalKey ：<code>GlobalKey anchorKey = GlobalKey();</code></p>
<p>2.在需要测量的控件的下面添加key：</p>
<pre><code>child: Text(&quot;点击弹出悬浮窗&quot;,
  style: TextStyle(fontSize: 20),
  key: anchorKey
),
</code></pre><p>3.获取控件的坐标：</p>
<pre><code>RenderBox renderBox = anchorKey.currentContext.findRenderObject();
var offset =  renderBox.localToGlobal(Offset.zero);
</code></pre><p>控件的横坐标：<code>offset.dx</code></p>
<p>控件的纵坐标：<code>offset.dy</code></p>
<p>如果想获得控件正下方的坐标：</p>
<pre><code>RenderBox renderBox = anchorKey.currentContext.findRenderObject();
var offset =  renderBox.localToGlobal(Offset(0.0, renderBox.size.height));
</code></pre><p>控件下方的横坐标：<code>offset.dx</code></p>
<p>控件下方的纵坐标：<code>offset.dy</code></p>
<h3 id="header-69">隐藏和显示widget</h3>
<p><a href="https://www.cnblogs.com/pjl43/p/9615685.html">https://www.cnblogs.com/pjl43/p/9615685.html</a></p>
<p>通常情况下，显示有四种情况：</p>
<p>1.（visible)显示
2.（invisible)隐藏：这种隐藏是指在屏幕中占据空间，只是没有显示。这种情况出现场景如：用带有背景色的Container Widget去包含一个不可见的Image，当从网络中加载图片后才让它显示，这是为了避免图片显示后让页面布局改变发生跳动。
3.（Offscreen)超出屏幕，同样占据空间
4.（Gone)消失：这种是指Widget没有被rendered，不存在于wedget tree中</p>
<h3 id="header-70">透明渐变 AppBar</h3>
<p><a href="https://blog.csdn.net/u012109585/article/details/108127209">https://blog.csdn.net/u012109585/article/details/108127209</a></p>
<p>Flutter之自定义AppBar并实现滑动渐变
<a href="https://blog.csdn.net/u013600907/article/details/101456290">https://blog.csdn.net/u013600907/article/details/101456290</a>
<a href="https://www.jianshu.com/p/6fe2e74d35bf">https://www.jianshu.com/p/6fe2e74d35bf</a></p>
<p>用到了NotificationListener这个widget，借助这个widget可以监听滚动的高度。appBar则使用自定义widget实现，给外层嵌套一个opacity组件，通过滚动监听高度变化然后改变appBar透明度即可。</p>
<p>scrollNotification.depth 的值 0 表示其子组件(只监听子组件，不监听孙组件)；
scrollNotification is ScrollUpdateNotification 来判断组件是否已更新，ScrollUpdateNotification 是 notifications 的生命周期一种情况，分别有一下几种：</p>
<ul>
<li>ScrollStartNotification 组件开始滚动</li>
<li>ScrollUpdateNotification 组件位置已经发生改变</li>
<li>ScrollEndNotification 组件停止滚动</li>
<li>UserScrollNotification 不清楚</li>
</ul>
<pre><code class="lang-python">NotificationListener(
  onNotification: (scrollNotification) {
  if (scrollNotification is ScrollUpdateNotification &amp;&amp; scrollNotification.depth==0) {
       _onScroll(scrollNotification.metrics.pixels);
    }
}
</code></pre>
<p>判断条件里的ScrollUpdateNotification是指widget组件位置发生改变才会执行相应的逻辑</p>
<pre><code class="lang-js">_onScroll (offset) {
    double alpha = offset / APPBAE_SCROLL_OFFSET; // APPBAE_SCROLL_OFFSET为appBar高度
    if (alpha &lt; 0) {
      // alpha = 0;
      return ;
    } else if (alpha &gt; 1) {
      // alpha = 1;
      return ;
    }
    setState(() {
      alphaAppBar = alpha;
    })；
  }
</code></pre>
<p>ScrollController / NotificationListener
<a href="https://www.jianshu.com/p/b0b1c6308674">https://www.jianshu.com/p/b0b1c6308674</a></p>
<p>=&gt; 内容如果过多的话，你这种写法会造成页面的严重卡顿?</p>
<h3 id="header-71">LayoutBuilder</h3>
<p>通过LayoutBuilder组件可以获取父组件的约束尺寸
eg: 根据组件的大小确认组件的外观，比如竖屏的时候上下展示，横屏的时候左右展示，</p>
<p>Flutter如何检查Sliver AppBar是否展开或折叠？
<a href="https://www.javaroad.cn/questions/81420">https://www.javaroad.cn/questions/81420</a></p>
<pre><code class="lang-js">_buildSliverToBoxAdapter(){
    return SliverToBoxAdapter(
      child:Container(
        height: 30,         // 当设置父组件的宽高大于100时显示蓝色，小于100时显示红色。
        child: _buildLayoutBuilder()
      ),
    );
  }
</code></pre>
<pre><code class="lang-java">  _buildLayoutBuilder(){
    return LayoutBuilder(
      builder: (BuildContext context, BoxConstraints constraints) {
        var color = Colors.red;
        debugPrint(&quot;$constraints&quot;);
        if (constraints.maxHeight &gt; 100) {
          color = Colors.blue;
        }
        return Container(
          height: 30,
          width: 50,
          color: color,
        );
      },
    );
  }
</code></pre>
<h3 id="header-72">Json处理</h3>
<ol>
<li><code>json_serializable: ^3.5.0</code></li>
<li><p>person.dart</p>
<pre><code class="lang-js"> import &#39;package:json_annotation/json_annotation.dart&#39;;

 part &quot;person.g.dart&quot;;

 @JsonSerializable(nullable: false)
 class Person {
   final String firstName;
   final String lastName;
   final DateTime dateOfBirth;
   Person({this.firstName, this.lastName, this.dateOfBirth});
   factory Person.fromJson(Map&lt;String, dynamic&gt; json) =&gt; _$PersonFromJson(json);
   Map&lt;String, dynamic&gt; toJson() =&gt; _$PersonToJson(this);
 }
</code></pre>
</li>
<li><p>cmd: <code>flutter packages pub run build_runner build</code>  =&gt; generate <code>person.g.dart</code></p>
<pre><code class="lang-js"> import &#39;package:json_annotation/json_annotation.dart&#39;;
 part &quot;person.g.dart&quot;;

 @JsonSerializable(nullable: false)
 class Person {

   final String firstName;
   final String lastName;
   final DateTime dateOfBirth;

   Person({this.firstName, this.lastName, this.dateOfBirth});

   factory Person.fromJson(Map&lt;String, dynamic&gt; json) =&gt; _$PersonFromJson(json);

   Map&lt;String, dynamic&gt; toJson() =&gt; _$PersonToJson(this);
 }
</code></pre>
</li>
</ol>
<p>或使用 json to code 工具（根据json生成dart code）： <a href="https://app.quicktype.io/">https://app.quicktype.io/</a></p>
<p>或使用vscode 插件 Paste JSON as Code</p>
<h3 id="header-73">ios不受信任的应用开发者如何设置</h3>
<p><a href="https://jingyan.baidu.com/article/574c52196f55486c8d9dc106.html">https://jingyan.baidu.com/article/574c52196f55486c8d9dc106.html</a></p>
<ol>
<li>打开苹果手机,点击“设置”,进入设置页面;</li>
<li>进入设置页面后,滑动手机屏幕找到“通用”,点击进入“通用”页面;</li>
<li>进入通用页面后,滑动手机找到“描述文件与设备管理”,点击进入描述文件与设备管理页面;</li>
<li>进入描述文件与设备管理页面后,看到“企业级应用”,然后点击进入企业级应用下面的按钮;</li>
</ol>
<h2 id="header-74">综合Demo</h2>
<h3 id="header-75">启动初始化设置</h3>
<ol>
<li><p>lib/main.dart:</p>
<pre><code class="lang-java"> import &#39;dart:async&#39;;

 import &#39;package:five_demo/pages/app/app_page.dart&#39;;
 import &#39;package:five_demo/utils/log_utils.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;
 import &#39;global/global.dart&#39;;

 // void main() {
 //   runApp(MyApp());
 // }

 void main() async {
   // catch uncatched dart error
   runZonedGuarded(() async {
     Global.init().then((value) {
       // runApp(Global.wrapGlobalProviders(MyApp()));
       runApp(AppPage());
     });
   }, (error,stack)=&gt;LogUtils.error(&quot;$error \n $stack&quot;));
 }
</code></pre>
</li>
<li><p>lib/global/global.dart</p>
<pre><code class="lang-java"> import &#39;dart:io&#39;;
 import &#39;package:five_demo/entities/platform_info.dart&#39;;
 import &#39;package:five_demo/global/global_configs.dart&#39;;
 import &#39;package:five_demo/utils/log_utils.dart&#39;;
 import &#39;package:five_demo/utils/storage_utils.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;
 import &#39;package:flutter/services.dart&#39;;

 class Global{

   static bool isFirstOpen;
   static PlatformInfo platformInfo;

   // static LoginUserInfo loginUserInfo;
   // static CheckInInfo checkInInfo;

   static Future init() async {

     LogUtils.info(&quot;[Global] init() start&quot;);

     WidgetsFlutterBinding.ensureInitialized();

     LogUtils.info(&quot;[Global] set FlutterErrorHander&quot;);
     LogUtils.setFlutterErrorWidgetOnDebug();
     LogUtils.setFlutterErrorHandlerOnRelease();

     LogUtils.info(&quot;[Global] storage.init() start&quot;);
     var storage = StorageUtils();
     await storage.init();
     LogUtils.info(&quot;[Global] storage.init() end&quot;);

     /// isFirstOpen?
     isFirstOpen = storage.getBool(GlobalConfigs.Storage_App_First_Open,defalutValue:true);
     LogUtils.info(&quot;[Global] isFirstOpen: $isFirstOpen&quot;);
     /// do after Welcome Page Loaded: 
     // if(isFirstOpen){    
     //   storage.setBool(GlobalConfigs.Storage_App_First_Open, false);
     // }

     // /// loginUser? =&gt; autoLogin
     // Map&lt;String,dynamic&gt; loginUserMap = storage.getMap(GlobalConfigs.Storage_App_Login_User,defalutValue: null);
     // if(loginUserMap!=null){
     //   loginUserInfo=LoginUserInfo.fromMap(loginUserMap);
     //   /// Do auto login and update storage
     //   LogUtils.info(&quot;[Global] Trigger autoLogin&quot;);
     //   // ...
     // }
     // LogUtils.info(&quot;[Global] LoginUserInfo: $loginUserInfo&quot;);

     /// platformInfo
     platformInfo = PlatformInfo(
       operatingSystem: Platform.operatingSystem,
       operatingSystemVersion: Platform.operatingSystemVersion,
       version: Platform.version
     );
     // android 状态栏为透明的沉浸
     if (Platform.isAndroid) {
       SystemUiOverlayStyle systemUiOverlayStyle =
           SystemUiOverlayStyle(statusBarColor: Colors.transparent);
       SystemChrome.setSystemUIOverlayStyle(systemUiOverlayStyle);
     }
     LogUtils.info(&quot;[Global] PlatformInfo: $platformInfo&quot;);

     // ...
     // await Future.delayed(Duration(seconds: 1));

     LogUtils.info(&quot;[Global] init() end&quot;);
   }

 }
</code></pre>
</li>
</ol>
<h3 id="header-76">SharedPreferences本地存储</h3>
<ol>
<li><p>pubspec.yaml:</p>
<pre><code class="lang-yaml"> dependencies:
     # 本地存储
     shared_preferences: ^0.5.12+4
</code></pre>
</li>
<li><p>storage_utils.dart:</p>
<pre><code class="lang-java"> import &#39;dart:convert&#39;;

 import &#39;package:shared_preferences/shared_preferences.dart&#39;;

 class StorageUtils{

   static final StorageUtils _instance = new StorageUtils._internal();
   factory StorageUtils() =&gt; _instance;    // 工厂构造
   StorageUtils._internal();               // 命名构造
   static SharedPreferences _prefs;

   Future&lt;void&gt; init() async {
     if (_prefs == null) {
       _prefs = await SharedPreferences.getInstance();
     }
   }

   Future&lt;bool&gt; setMap(String key, Map&lt;String,dynamic&gt; map) async {
     String jsonStr = jsonEncode(map);
     return _prefs.setString(key, jsonStr);
   }

   Map&lt;String,dynamic&gt; getMap(String key,{Map&lt;String,dynamic&gt; defalutValue}) {
     String jsonStr = _prefs.getString(key);
     return jsonStr == null ? defalutValue : jsonDecode(jsonStr);
   }

   Future&lt;bool&gt; setBool(String key, bool val) {
     return _prefs.setBool(key, val);
   }

   bool getBool(String key,{bool defalutValue=false}) {
     bool val = _prefs.getBool(key);
     return val == null ? defalutValue : val;
   }

   Future&lt;bool&gt; remove(String key) {
     return _prefs.remove(key);
   }
 }
</code></pre>
</li>
<li><p>使用（global.dart)</p>
<pre><code class="lang-java"> import &#39;dart:io&#39;;
 import &#39;package:five_demo/utils/storage_utils.dart&#39;;

 class Global{

   static bool isFirstOpen;
   // static LoginUserInfo loginUserInfo;

   static Future init() async {

     LogUtils.info(&quot;[Global] init() start&quot;);
     WidgetsFlutterBinding.ensureInitialized();

     var storage = StorageUtils();
     await storage.init();
     LogUtils.info(&quot;[Global] storage.init() end&quot;);

     /// isFirstOpen?
     isFirstOpen = storage.getBool(GlobalConfigs.Storage_App_First_Open,defalutValue:true);
     LogUtils.info(&quot;[Global] isFirstOpen: $isFirstOpen&quot;);
     /// do after Welcome Page Loaded: 
     // if(isFirstOpen){    
     //   storage.setBool(GlobalConfigs.Storage_App_First_Open, false);
     // }

     // /// loginUser? =&gt; autoLogin
     // Map&lt;String,dynamic&gt; loginUserMap = storage.getMap(GlobalConfigs.Storage_App_Login_User,defalutValue: null);
     // if(loginUserMap!=null){
     //   loginUserInfo=LoginUserInfo.fromMap(loginUserMap);
     //   /// Do auto login and update storage
     //   LogUtils.info(&quot;[Global] Trigger autoLogin&quot;);
     //   // ...
     // }
     // LogUtils.info(&quot;[Global] LoginUserInfo: $loginUserInfo&quot;);

     // ...
     LogUtils.info(&quot;[Global] init() end&quot;);
   }
 }
</code></pre>
</li>
</ol>
<h3 id="header-77">全局状态控制</h3>
<ul>
<li>是否第一次使用此app: <code>Global.isFirstOpen?WelcomePage():IndexPage()</code></li>
<li>是否全局黑灰蒙布: <code>isGreyFilter</code> 使用Provider状态管理 （MVVM模式）</li>
</ul>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
    # 状态管理
    provider: ^4.3.2+2
</code></pre>
<ol>
<li><p>app_page.dart</p>
<pre><code class="lang-js"> import &#39;package:five_demo/global/global.dart&#39;;
 import &#39;package:five_demo/global/global_routes.dart&#39;;
 import &#39;package:five_demo/global/global_themes.dart&#39;;
 import &#39;package:five_demo/pages/pages.dart&#39;;
 import &#39;package:five_demo/utils/log_utils.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;
 import &#39;package:provider/provider.dart&#39;;

 import &#39;app_state.dart&#39;;

 class AppPage extends StatefulWidget {

   final AppState appState = AppState.getInstance();

   final Map args;

   AppPage({Key key,this.args}) : super(key: key);
   @override
   _AppPageState createState() =&gt; _AppPageState();
 }

 class _AppPageState extends State&lt;AppPage&gt; {

   @override
   void initState() {
     debugPrint(&quot;+++ AppPage.initState() +++&quot;);
     super.initState();
   }

   @override
   void dispose() {
     debugPrint(&quot;+++ AppPage.dispose() +++&quot;);
     super.dispose();
   }

   @override
   Widget build(BuildContext context) {

     return MultiProvider(
       providers: [
         ChangeNotifierProvider&lt;AppState&gt;.value(
           value: widget.appState,
          ),
       ],
       child: _selectIsGrey(),
     );
   }

   _selectIsGrey(){
     return Selector&lt;AppState,bool&gt;(
       selector: (_,appState)=&gt;appState.isGreyFilter,
       builder: (_,value,child){
         return value? ColorFiltered(
           colorFilter: ColorFilter.mode(Colors.white, BlendMode.color),
           child: _buildMaterialApp()
         ):_buildMaterialApp();
       }
     );
   }

   _buildMaterialApp(){
     return MaterialApp(
       title: &#39;Hey,Dear!&#39;,
       theme: GlobalThemes.mainThemeData,
       debugShowCheckedModeBanner:LogUtils.isInDebugMode,
       onGenerateRoute: GlobalRoutes.router.generator,
       home: Global.isFirstOpen?WelcomePage():IndexPage(),
     );
   }

 }
</code></pre>
</li>
<li><p>app_state.dart</p>
<pre><code class="lang-java"> import &#39;package:flutter/material.dart&#39;;
 import &#39;package:provider/provider.dart&#39;;

 class AppState with ChangeNotifier{

   static final AppState _instance = AppState._internal();

   factory AppState.getInstance(){
     debugPrint(&quot;++++ 1. AppState.getInstance() +++&quot;);
     return _instance;
   }

   AppState._internal(){
     debugPrint(&quot;++++ 2. AppState._internal() +++&quot;);
   }

   @override
   dispose(){
     debugPrint(&quot;++++ 3. AppState.dispose() +++&quot;);
     super.dispose();
   }

   bool _isGreyFilter=false;

   /// isGreyFilter 灰色滤镜
   get isGreyFilter {
     return  _isGreyFilter;
   }
   set isGreyFilter(String value) {
     isGreyFilter = value;
     notifyListeners();
   }
   switchGrayFilter(){
     _isGreyFilter=!_isGreyFilter;
     notifyListeners();
   }

 }
</code></pre>
</li>
<li><p>global_themes.dart</p>
<pre><code class="lang-js"> class GlobalThemes{

   static ThemeData mainThemeData= ThemeData(
     primaryColor: Colors.white,
     visualDensity: VisualDensity.adaptivePlatformDensity,
     // 去除水波纹
     highlightColor: Colors.transparent,
     splashColor:Colors.transparent,
   );
 }
</code></pre>
</li>
<li><p>welcome_page.dart</p>
<pre><code class="lang-js"> import &#39;package:five_demo/global/global_configs.dart&#39;;
 import &#39;package:five_demo/global/global_routes.dart&#39;;
 import &#39;package:five_demo/utils/storage_utils.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;

 class WelcomePage extends StatelessWidget {
   final Map args;
   WelcomePage({Key key,this.args}) : super(key: key);
   @override
   Widget build(BuildContext context) {
     return Scaffold(
       body: Container(
         width: double.infinity,
         decoration: BoxDecoration(
           image: DecorationImage(
             image: new AssetImage(&quot;assets/images/default/记录.png&quot;),
           )
         ),
         child: Column(
           mainAxisAlignment: MainAxisAlignment.spaceAround,
           children:[
             _buildTitle(context),
             // Image.network(&quot;https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3103964819,2015218737&amp;fm=26&amp;gp=0.jpg&quot;),
             // Image.asset(&quot;assets/images/default/记录.png&quot;),
             _buildNextBtn(context)
           ]
         )
       ),
     );
   }

   _buildTitle(context){
     return Text(&quot;Welcome&quot;,style: Theme.of(context).textTheme.headline4);
   }

   _buildNextBtn(context){
     return IconButton(
       icon: Icon(Icons.arrow_forward),
       onPressed: (){
         StorageUtils().setBool(GlobalConfigs.Storage_App_First_Open, false);
         // Navigator.of(context).pushNamed(GlobalRoutes.Route_Index);
         Navigator.of(context).pushNamedAndRemoveUntil(GlobalRoutes.Route_Index, (route) =&gt; false);
       }
     );
   }

 }
</code></pre>
</li>
</ol>
<h3 id="header-78">路由</h3>
<p>使用Fluro动态路由框架</p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
    # 动态路由 fluro
    fluro: 1.7.7
</code></pre>
<ol>
<li><p>global_routes.dart</p>
<pre><code class="lang-js"> import &#39;package:five_demo/pages/do/do_page.dart&#39;;
 import &#39;package:fluro/fluro.dart&#39;;
 import &#39;package:five_demo/pages/pages.dart&#39;;

 class GlobalRoutes{

   // Index,Welcome,Home,Do,My,Detail,Login,Error

   static const String Route_App = &quot;/&quot;;
   static const String Route_Index = &quot;/index&quot;;
   static const String Route_Welcome = &quot;/welcome&quot;;
   static const String Route_Home = &quot;/home&quot;;
   static const String Route_Do = &quot;/do&quot;;
   static const String Route_My=&quot;/my&quot;;
   static const String Route_Detail =&quot;/detail/:id&quot;;
   static const String Route_Login = &quot;/login&quot;;
   static const String Route_Mall=&quot;/mall&quot;;
   static const String Route_Error = &quot;/error&quot;;

   static const List&lt;String&gt; routePaths=[
     Route_App,
     Route_Index,
     Route_Welcome,
     Route_Home,
     Route_Do,
     Route_My,
     Route_Detail,
     Route_Login,
     Route_Error
   ];

   static FluroRouter router = init();

   static init(){
     FluroRouter router = FluroRouter();
     routePaths.forEach((element) {
       router.define(
         element, 
         handler: buildHandler(element),
         transitionType: TransitionType.native
       );
     });
     router.notFoundHandler=buildHandler(Route_Error);
     return router;
   }

   static buildHandler(String path){
     return Handler(
       handlerFunc: (context,params)=&gt;getRoutePageWidget(path, context.settings.arguments)
     );
   }

     static getRoutePageWidget(String path,Map args){
     // Index,Welcome,Home,Do,My,Detail,Login,Error
     switch(path){
       case Route_App:
         return AppPage(args:args);
       case Route_Index:
         return IndexPage(args: args);
       case Route_Welcome:
         return WelcomePage(args:args);
       case Route_Home:
         return HomePage(args: args);
       case Route_Do:
         return DoPage(args:args);
       case Route_My:
         return MyPage(args:args);
       case Route_Detail:
         return DetailPage(args:args);
       case Route_Login:
         return LoginPage(args:args);
       case Route_Mall:
         return MallPage(args:args);
       default:
         return ErrorPage(args:args);
     }
   }

 }
</code></pre>
</li>
<li><p>app_page.dart</p>
<pre><code class="lang-js"> class AppPage extends StatefulWidget {

   final AppState appState = AppState.getInstance();

   final Map args;
   AppPage({Key key,this.args}) : super(key: key);
   @override
   _AppPageState createState() =&gt; _AppPageState();
 }

 class _AppPageState extends State&lt;AppPage&gt; {

   @override
   void initState() {
     super.initState();
   }

   @override
   Widget build(BuildContext context) {
     // ...
     // _buildMaterialApp();
   }

   _buildMaterialApp(){
     return MaterialApp(
       title: &#39;Hey,Dear!&#39;,
       theme: GlobalThemes.mainThemeData,
       debugShowCheckedModeBanner:LogUtils.isInDebugMode,
       onGenerateRoute: GlobalRoutes.router.generator,           // route!
       home: Global.isFirstOpen?WelcomePage():IndexPage(),
     );
   }
 }
</code></pre>
</li>
<li><p>使用:</p>
<pre><code class="lang-java"> // welcome_page.dart:
 onPressed: (){
     StorageUtils().setBool(GlobalConfigs.Storage_App_First_Open, false);
     // Navigator.of(context).pushNamed(GlobalRoutes.Route_Index);
     Navigator.of(context).pushNamedAndRemoveUntil(GlobalRoutes.Route_Index, (route) =&gt; false);
 }

 // banner_view.dart
 onTap: (index){
   debugPrint(&quot;banner onTap:$index ${value.bannerItems[index].targetPath}&quot;);
   Navigator.pushNamed(
     ctx, 
     value.bannerItems[index].targetPath,
     arguments:{&#39;title&#39;:value.bannerItems[index].title}
   );
 }

 // channel_view.dart
 onTap: () =&gt; Navigator
             .of(context)
             .pushNamed(
               GlobalRoutes.Route_Detail,
               arguments: {&#39;item&#39;:e,&#39;targetType&#39;:e.targetType,&#39;targetPath&#39;:e.targetPath}
             )

 // channel_fm_index.dart
 onTap: (){
   Navigator.pushNamed(
     context,
     GlobalRoutes.Route_Detail,
     arguments: {&#39;item&#39;:item,&#39;targetPath&#39;:item[&#39;targetPath&#39;],&#39;targetType&#39;:item[&#39;targetType&#39;]} 
   );
 }

 // pop
 onPressed: () =&gt; Navigator.of(context).pop()
 onPressed: () =&gt; Navigator.pop(context);
 onPressed: () =&gt; Navigator.pop(context,controller.text);
</code></pre>
</li>
</ol>
<h3 id="header-79">底部导航</h3>
<p>使用 BottomAppBar &amp; IndexedStack &amp; Provider（MVVM）</p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # 状态管理
  provider: ^4.3.2+2
</code></pre>
<ol>
<li><p>index_page.dart</p>
<pre><code class="lang-js"> class IndexPage extends StatefulWidget {

   final IndexState indexState = IndexState.getInstance();
   final Map args;
   IndexPage({Key key,this.args}) : super(key: key);
   @override
   _IndexPageState createState() =&gt; _IndexPageState();
 }

 class _IndexPageState extends State&lt;IndexPage&gt; {

   @override
   void initState() {
     debugPrint(&quot;+++ IndexPage.initState() +++&quot;);
     super.initState();
   }

   @override
   void dispose() {
     debugPrint(&quot;+++ IndexPage.dispose() +++&quot;);
     super.dispose();
   }

   @override
   Widget build(BuildContext context) {

     ScreenUtil.init(
       context,
       designSize:GlobalConfigs.ScreenDesignSize,
       allowFontScaling:true);

     return MultiProvider(
       providers: [
         ChangeNotifierProvider&lt;IndexState&gt;.value(value: widget.indexState),
       ],
       child: Scaffold(
         /// header
         // appBar: wds.buildAppBar(&quot;Index&quot;),
         /// body
         body: _selectCurrentIndex(_bodyBuilder),
         /// bottom 
         bottomNavigationBar: BottomAppBar(
           child: Column(
             mainAxisSize: MainAxisSize.min,
             children: [
               _selectCurrentIndex(_bottomNavBuilder),
             ],
           ),
         ),
         /// end
       ),
     );
   }

   _selectCurrentIndex(builder){
    return Selector&lt;IndexState,int&gt;(
       selector: (_,indexState)=&gt;indexState.currentIndex,
       builder:builder
     );
   }

   Widget _bodyBuilder(BuildContext context,int value,Widget child){
     return IndexedStack(
       index: value,
       children: IndexState.items.map((e) =&gt; e.page).toList(),
     );
   }

   Widget _bottomNavBuilder(BuildContext context,int value,Widget child){
     return Container(
       padding: GlobalThemes.containerPadding,
       child: Row(
         mainAxisAlignment: MainAxisAlignment.spaceAround,
         crossAxisAlignment: CrossAxisAlignment.end,
         children: IndexState.items.map(
           (e) =&gt; InkWell(
             child:_buildBottomNavItem(e,value),
             onTap: ()=&gt;_onTapHandler(e.index),
           )
         ).toList()
       ),
     );
   }

   _onTapHandler(index){
     if (widget.indexState.currentIndex != index) {
       debugPrint(&quot;$index&quot;);
       widget.indexState.currentIndex = index;
     }
   }

   Widget _buildBottomNavItem(IndexPageItem item,int currentIndex) {
     // debugPrint(&quot;_buildBottomMenuItem $index active: $active &quot;);
     bool active = currentIndex==item.index;
     if (item.iconData == null) {
       return Container(
         padding: GlobalThemes.containerCirclePadding,
         decoration: IndexThemes.getBottomBarCircleDecoration(active),
         child: Text(
           item.label, 
           style: IndexThemes.getBottomBarCircleTextStyle(active)
         ),
       );
     } 
     return Theme(
       data: ThemeData(
         iconTheme: IndexThemes.getBottomBarIconThemeData(active)
       ),
       child:Column(
         mainAxisSize: MainAxisSize.min,
         children: [
           Icon(active?item.activeIconData:item.iconData),
           Text(
             item.label,
             style: IndexThemes.getBottomBarLabelTextStyle(active)
           )
         ],
       )
     );
   }
 }
</code></pre>
</li>
<li><p>index_state.dart</p>
<pre><code class="lang-java"> class IndexPageItem{
   int index;
   IconData iconData;
   IconData activeIconData;
   String label;
   Widget page;
   IndexPageItem({this.index,this.iconData,this.activeIconData,this.label,this.page});
 }

 class IndexState with ChangeNotifier{

   static List&lt;IndexPageItem&gt; items=[
     IndexPageItem(
       index: 0,
       iconData:Icons.home_outlined,
       activeIconData: Icons.home,
       label:&quot;首页&quot;,
       page:HomePage(args:{&#39;title&#39;:&#39;首页&#39;})
     ),
     IndexPageItem(
       index: 1,
       // iconData:Icons.list,
       label:&quot;Do&quot;,
       page:DoPage(args:{&#39;title&#39;:&#39;Do&#39;})
     ),
     IndexPageItem(
       index: 2,
       iconData:Icons.person_outline,
       activeIconData: Icons.person,
       label:&quot;我的&quot;,
       page:MyPage(args:{&#39;title&#39;:&#39;我的&#39;})
     ),
   ];

   int _currentIndex = 0;

   static final IndexState _instance = IndexState._internal();
   factory IndexState.getInstance() =&gt; _instance;

   // IndexState._internal() {
   //   _currentIndex = 0;
   // }
   IndexState._internal();

   /// currentIndex
   get currentIndex {
     return _currentIndex;
   }
   set currentIndex(int value) {
     _currentIndex = value;
     notifyListeners();
   }
 }
</code></pre>
</li>
</ol>
<h3 id="header-80">Login</h3>
<p>登录注册方式：</p>
<ul>
<li>用户名(手机号) &amp; 验证码（60s发送到手机）</li>
<li>第三方授权</li>
</ul>
<p>Flutter 中“倒计时”的那些事儿
<a href="https://blog.csdn.net/weixin_45189747/article/details/103370289">https://blog.csdn.net/weixin_45189747/article/details/103370289</a></p>
<p>Flutter倒计时/计时器的实现
<a href="https://zhuanlan.zhihu.com/p/61970955">https://zhuanlan.zhihu.com/p/61970955</a></p>
<p><img src="/2020/08/20/login.png" alt="Login"></p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # 提示框
  fluttertoast: ^7.1.6
</code></pre>
<ol>
<li><p>login_page.dart</p>
<pre><code class="lang-java"> import &#39;dart:async&#39;;

 import &#39;package:five_demo/global/global_values.dart&#39;;
 import &#39;package:five_demo/widgets/widgets.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;
 import &#39;package:flutter/services.dart&#39;;
 import &#39;package:fluttertoast/fluttertoast.dart&#39;;

 class LoginPage extends StatefulWidget {
   final Map args;
   LoginPage({Key key,this.args}) : super(key: key);
   @override
   _LoginPageState createState() =&gt; _LoginPageState();
 }

 class _LoginPageState extends State&lt;LoginPage&gt; {
   String phoneNo;
   String verificationCode;
   GlobalKey&lt;FormState&gt; formGlobalKey = GlobalKey&lt;FormState&gt;();
   final TextEditingController _phoneNoController = TextEditingController();
   final TextEditingController _codeController = TextEditingController();

   Timer _timer;
   int _timeCount = 60;

   startTimer(){
     _timeCount=60;
     _timer = Timer.periodic(Duration(seconds: 1), (Timer timer){
       if(_timeCount&lt;=0){
         debugPrint(&quot;倒计时结束&quot;);
         _timer.cancel();
         setState((){
           _timer=null;
         });
       }else{
         setState((){
           _timeCount-=1;
         });
       }
     });
   }

   getCodeText(){
     if(_timer!=null &amp;&amp; _timeCount&gt;=0)
       return &quot;${_timeCount}s&quot;;
     return &quot;获取验证码&quot;;
   }

   @override
   void dispose() {
     super.dispose();
     if (_timer != null) {
       debugPrint(&quot;销毁啦&quot;);
       _timer.cancel();
       _timer=null;
     }
   }

   @override
   Widget build(BuildContext context) {
     return Scaffold(
       resizeToAvoidBottomInset: false,
       appBar: _buildAppBar(),
       body: GestureDetector(
         onTap: (){
           debugPrint(&quot;gesture onTap&quot;);
           FocusScope.of(context).requestFocus(new FocusNode());
           // FocusScopeNode currentFocus = FocusScope.of(context);
           // if (!currentFocus.hasPrimaryFocus &amp;&amp;
           //     currentFocus.focusedChild != null) {
           //   FocusManager.instance.primaryFocus.unfocus();
           // }
         },
         child: Container(
           color: Colors.grey[50],
           child: Column(
             mainAxisAlignment: MainAxisAlignment.start,
             children: [
               _buildHeader(),
               _buildForm(),
               SizedBox(height: 100,),
               _buildThirdPart(),
             ],
           ),
         ),
       ),
       bottomNavigationBar: _buildPolicy(),
     );
   }

   _buildAppBar(){
     return AppBar(
       backgroundColor: Colors.grey[50],
       elevation: 0.0,
       toolbarHeight: 40,
     );
   }

   _buildHeader(){
     return Container(
       padding: EdgeInsets.only(top:10,bottom: 30),
       child: Text(&quot;Hey,Dear&quot;,style: TextStyle(fontSize: 22,fontWeight: FontWeight.w500,color: Colors.deepOrange)),
     );
   }

   _buildForm(){
     return Container(
       padding: EdgeInsets.symmetric(horizontal: 30),
       // height: 300,
       child: Form(
         key: formGlobalKey,
         child: Column(
           // padding: EdgeInsets.all(20),
           children: [
             _buildPhoneNoField(),
             _buildCodeField(),
             _buildSubmit(),

           ],
         ),
       ),
     );
   }

   _buildPhoneNoField(){
     return Container(
       height: 45,
       padding: EdgeInsets.symmetric(horizontal: 10),
       margin: EdgeInsets.only(top: 10),
       decoration: BoxDecoration(
         // borderRadius: BorderRadius.circular(10),
         // border: Border.all(color: Colors.grey,),
         border: Border(bottom: BorderSide(color: Colors.grey)),
       ),
       child: Row(
         crossAxisAlignment: CrossAxisAlignment.center,
         children: [
           Text(&quot; + 86  |&quot;,style: TextStyle(fontSize: 14),),
           Expanded(
             child:TextFormField(
               controller: _phoneNoController,
               decoration: InputDecoration(
                 hintText: &quot;手机号码&quot;,
                 hintStyle: TextStyle(fontSize: 14,color: Colors.grey),
                 isDense: true,
                 contentPadding: EdgeInsets.only(left: 10,top: 5,bottom: 0,right: 10),
                 border: const OutlineInputBorder(
                   gapPadding: 0,
                   borderSide: BorderSide(width: 0,style: BorderStyle.none,),
                 ),
                 suffix: InkWell(
                   onTap: (){
                     _phoneNoController.clear();
                   },
                   child: Icon(Icons.clear,size: 14,),
                 )
               ),
               keyboardType: TextInputType.phone,
               inputFormatters: [
                 FilteringTextInputFormatter.digitsOnly,
                 LengthLimitingTextInputFormatter(11)
               ],
               // onSaved: (value){
               //   debugPrint(&quot;phoneNo onSaved&quot;);
               //   this.phoneNo=value;
               // },
           )),
           // IconButton(icon: Icon(Icons.clear,size: 16,), onPressed: (){})
         ],
       ),
     );
   }

   _buildCodeField(){
     return Container(
       height: 45,
       padding: EdgeInsets.only(left: 10),
       margin: EdgeInsets.only(top: 10),
       decoration: BoxDecoration(
         // borderRadius: BorderRadius.circular(10),
         // border: Border.all(color: Colors.grey,),
         border: Border(bottom: BorderSide(color: Colors.grey)),
       ),
       child: Row(
         crossAxisAlignment: CrossAxisAlignment.center,
         children: [
           Expanded(
             child:TextFormField(
               controller: _codeController,
               decoration: InputDecoration(
                 hintText: &quot;验证码&quot;,
                 hintStyle: TextStyle(fontSize: 14,color: Colors.grey),
                 isDense: true,
                 contentPadding: EdgeInsets.only(left: 10,top: 5,bottom: 0,right: 10),
                 border: const OutlineInputBorder(
                   gapPadding: 0,
                   borderSide: BorderSide(width: 0,style: BorderStyle.none,),
                 ),
               ),
               keyboardType: TextInputType.phone,
               inputFormatters: [
                 FilteringTextInputFormatter.digitsOnly,
                 LengthLimitingTextInputFormatter(8),
               ],
               // onSaved: (value){
               //   debugPrint(&quot;verificationCode onSaved&quot;);
               //   this.verificationCode=value;
               // },
           )),
           _buildCodeBtn()
         ],
       ),
     );
   }

   _buildCodeBtn(){
     return Container(
       // height: 35,
       // decoration: BoxDecoration(
       //   borderRadius: BorderRadius.circular(20),
       //   color: Colors.grey[200],
       // ),
       child: FlatButton(
         onPressed: (){
           if(_phoneNoController.text==null || _phoneNoController.text.length!=11){
             Fluttertoast.showToast(
               msg:&quot;请先输入手机号！&quot;,
               toastLength: Toast.LENGTH_SHORT,
               gravity: ToastGravity.CENTER,
               timeInSecForIosWeb: 1,
               backgroundColor: Colors.grey[100],
               fontSize: 14,
               textColor: Colors.deepOrange[300]
             );
             return;
           }
           if(_timer==null)
             startTimer();
           else
             debugPrint(&quot;等等&quot;);
         },
         child: Text(getCodeText(),style: TextStyle(color: Colors.deepOrange[300],fontSize: 14),),
       ),
     );
   }

   _buildSubmit(){
     return Container(
       width: double.infinity,
       margin: EdgeInsets.only(top: 20),
       child: RaisedButton(
         child: Text(&quot;登 录&quot;, style: TextStyle(color: Colors.white,fontSize: 16)),
         color: Colors.deepOrange.withOpacity(0.8),
         elevation: 0,
         shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
         onPressed: () {
           debugPrint(&quot;Submit Clicked&quot;);
           // formGlobalKey.currentState.save();
           // debugPrint(&quot;Submit get username: $username | password: $password&quot;);
           bool result = formGlobalKey.currentState.validate();
           debugPrint(&quot;validate result: $result&quot;);
           if (result) {
             formGlobalKey.currentState.save();
             debugPrint(&quot;Submit get phoneNo: $phoneNo | verificationCode: $verificationCode&quot;);
             debugPrint(&quot;Submit controller phoneNo: ${_phoneNoController.text} | verificationCode: ${_codeController.text}&quot;);
           }
         },
       ),
     );
   }

   _buildPolicy(){
     return Container(
       padding: EdgeInsets.symmetric(vertical: 10),
       child: Text.rich(TextSpan(
         style: TextStyle(fontSize: 12,color: Colors.grey),
         children: [
           TextSpan(text:&quot;首次登录会自动创建账号，且代表同意&quot;),
           TextSpan(text: &quot;《用户服务协议》《隐私政策》&quot;,style: TextStyle(color: Colors.deepOrange)),
         ]
       ))
     );
   }

   /* --------------------- */

   _buildThirdPart(){
     return Container(
       padding: EdgeInsets.symmetric(horizontal: 15),
       child: Column(
         children: [
           Text(&quot;使用第三方账号登录&quot;,style: TextStyle(color: Colors.grey),),
           SizedBox(height: 15,),
           Row(
             mainAxisAlignment: MainAxisAlignment.spaceEvenly,
             children: [
               IconButton(icon: Icon(Iconfont.wechat,color: Colors.green,size:36), onPressed: (){}),
               IconButton(icon: Icon(Iconfont.qq, color: Colors.blue,size:36), onPressed: (){}),
               IconButton(icon: Icon(Iconfont.weibo, color: Colors.red,size:36), onPressed: (){}),
             ],
           )
         ],
       ),
     );
   }
 }
</code></pre>
</li>
</ol>
<h3 id="header-81">Banner</h3>
<ul>
<li>使用第三方库 flitter_swiper</li>
<li>MVVM: <ul>
<li>V(View): banner_view.dart</li>
<li>VM(ViewModel): banner_state.dart =&gt; HttpRequest(dio)</li>
<li>M(Model): banner_item.art</li>
</ul>
</li>
</ul>
<p><img src="/2020/08/20/home-1.png" alt="Banner"></p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # 轮播图
  flutter_swiper: ^1.1.6
  # 状态管理
  provider: ^4.3.2+2
  # http - dio
  dio: ^3.0.10
  dio_log : ^1.3.3
</code></pre>
<p>index_page -&gt; home_page: View(banner_view),VM(banner_state),M(banner_item)</p>
<ol>
<li><p>index_page.dart</p>
<pre><code class="lang-java"> class IndexPage extends StatefulWidget {
   final IndexState indexState = IndexState.getInstance();
   final BannerState bannerState = BannerState.getInstance();
   final ActivityState activityState = ActivityState.getInstance();
   // ...
 }

 class _IndexPageState extends State&lt;IndexPage&gt; {
     // ...
     @override
     Widget build(BuildContext context) {
         return MultiProvider(
           providers: [
             ChangeNotifierProvider&lt;IndexState&gt;.value(value: widget.indexState),
             ChangeNotifierProvider&lt;BannerState&gt;.value(value: widget.bannerState),
             ChangeNotifierProvider&lt;ActivityState&gt;.value(value: widget.activityState),
           ],
           child: Scaffold(
             body: _selectCurrentIndex(_bodyBuilder),
             // ...
           ),
         );
     }
 }
</code></pre>
</li>
<li><p>home_page.dart</p>
<pre><code class="lang-java"> class HomePage extends StatefulWidget {
   final Map args;
   HomePage({Key key, this.args}) : super(key: key);
   @override
   _HomePageState createState() =&gt; _HomePageState();
 }

 class _HomePageState extends State&lt;HomePage&gt; {
   @override
   Widget build(BuildContext context) {
     return Scaffold(
       appBar: wds.buildAppBar(widget.args != null ? widget.args[&#39;title&#39;] ?? &#39;&#39; : &#39;&#39;),
       // body: _buildBody(context),
       body: _buildWrapRefresh(context)
     );
   }

   _onRefresh(BuildContext context) {
     context.read&lt;CheckInState&gt;().doCheckIn();
     context.read&lt;BannerState&gt;().load();
     context.read&lt;ActivityState&gt;().reload();
     // ... 
   }

   _buildWrapRefresh(BuildContext ctx) {
     return RefreshIndicator(
         onRefresh: () async {
           debugPrint(&quot;+++ HomePage onRefresh! +++&quot;);
           _onRefresh(ctx);
         },
         child: _buildBody(ctx));
   }

   _buildBody(context) {
     return ListView(
       controller: Provider.of&lt;ActivityState&gt;(context).scrollController,
       children: [
         Consumer&lt;CheckInState&gt;(
           builder: (_, value, child) =&gt; CheckInView(checkInState: value),
         ),
         Consumer&lt;BannerState&gt;(builder: (_, value, child) =&gt; BannerView(bannerState: value,)),
         Consumer&lt;ActivityState&gt;(builder: (_, value, child) =&gt; ActivityView()),
         // ...
       ],
     );
   }
 }
</code></pre>
</li>
<li><p>banner_view.dart</p>
<pre><code class="lang-java"> import &#39;package:five_demo/pages/home/state/banner_state.dart&#39;;
 import &#39;package:five_demo/widgets/widgets.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;
 import &#39;package:flutter_swiper/flutter_swiper.dart&#39;;
 import &#39;package:provider/provider.dart&#39;;

 class BannerTheme{
   static Color activePaginationColor = Colors.lightBlue[100];
   static double bannerHeight=150;
 }

 class BannerView extends StatelessWidget {

   final BannerState bannerState;
   BannerView({Key key,this.bannerState}) : super(key: key);

   @override
   Widget build(BuildContext context) {
     debugPrint(&quot;--- BannerView Build ---&quot;);
     // var value = Provider.of&lt;BannerState&gt;(context);
     return _buildBody(context, bannerState);
   }

   _buildBody(ctx,value){
     if(value.isLoading){
       return buildLoading(height:BannerTheme.bannerHeight);
     }
     if(value.bannerItems==null || value.bannerItems.length==0){
       return buildEmpty();
     }
     return _buildContent(ctx,value);
   }

   _buildContent(ctx,value){
     return Container(
       height: BannerTheme.bannerHeight,
       child: Swiper(
         itemCount: value.bannerItems.length,
         itemBuilder: (context, index) {
           return Image.network(value.bannerItems[index].imageUrl, fit: BoxFit.cover);
         },
         pagination: SwiperPagination(
           builder: DotSwiperPaginationBuilder(activeColor: BannerTheme.activePaginationColor)
         ),
         autoplay: true,
         autoplayDelay:3000,
         onTap: (index){
           debugPrint(&quot;banner onTap:$index ${value.bannerItems[index].targetPath}&quot;);
           Navigator.pushNamed(
             ctx, 
             value.bannerItems[index].targetPath,
             arguments:{&#39;title&#39;:value.bannerItems[index].title}
           );
         }
       )
     );
   }

 }
</code></pre>
</li>
<li><p>banner_state.dart</p>
<pre><code class="lang-java"> import &#39;package:five_demo/entities/banner_item.dart&#39;;
 import &#39;package:five_demo/entities/response_entity.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;

 class BannerState with ChangeNotifier{
   List&lt;BannerItem&gt; bannerItems;
   bool isLoading;

   static final BannerState _instance = BannerState._internal();
   factory BannerState.getInstance() =&gt; _instance;

   BannerState._internal(){
     load();
   }

   @override
   dispose(){
     debugPrint(&quot;-- BannerState dispose --&quot;);
     bannerItems=null;
     super.dispose();
   }

     load() async {

     // HttpUtils.get(HttpConfig.HomeBannerRequestPath)
     // .then((response){
     //   if(response.statusCode==200){
     //     var data = ResponseEntity&lt;List&lt;Map&lt;String,dynamic&gt;&gt;&gt;.fromMap(response.data[&#39;data&#39;]);
     //     debugPrint(&quot;${data.toJson()}&quot;);

     //     bannerItems=data.result?.map((item) =&gt; BannerItem.fromMap(item));
     //     notifyListeners();
     //   }
     // });

     Map&lt;String,dynamic&gt; responseData={
       &#39;success&#39;:false,
       &#39;result&#39;:[
           {
           &#39;id&#39;:&#39;1&#39;,
           &#39;imageUrl&#39;:&#39;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=2386581431,1215568659&amp;fm=26&amp;gp=0.jpg&#39;,
           &#39;title&#39;:&#39;bannerPic1&#39;,
           &#39;subtitle&#39;:&#39;this is banner1 picture&#39;,
           &#39;targetPath&#39;:&#39;/detail/a&#39;,
           &#39;seqNo&#39;:&#39;1&#39;
         },
         {
           &#39;id&#39;:&#39;2&#39;,
           &#39;imageUrl&#39;:&#39;https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=35517157,3504012963&amp;fm=26&amp;gp=0.jpg&#39;,
           &#39;title&#39;:&#39;bannerPic2&#39;,
           &#39;subtitle&#39;:&#39;this is banner2 picture&#39;,
           &#39;targetPath&#39;:&#39;/detail/b&#39;,
           &#39;seqNo&#39;:&#39;2&#39;
         },
         {
           &#39;id&#39;:&#39;3&#39;,
           &#39;imageUrl&#39;:&#39;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1123133791,1776909836&amp;fm=26&amp;gp=0.jpg&#39;,
           &#39;title&#39;:&#39;bannerPic3&#39;,
           &#39;subtitle&#39;:&#39;this is banner3 picture&#39;,
           &#39;targetPath&#39;:&#39;/detail/c&#39;,
           &#39;seqNo&#39;:&#39;3&#39;
         },
       ]
     };

     isLoading=true;
     notifyListeners();

     await Future.delayed(Duration(seconds: 2));

     var data = ResponseEntity&lt;List&lt;Map&gt;&gt;.fromMap(responseData);
     bannerItems=data.result.map(
       (item){
         // debugPrint(&quot;$item&quot;);
         return BannerItem.fromMap(item);
       }
     ).toList();

     isLoading=false;
     notifyListeners();
   }

 }
</code></pre>
</li>
<li><p>banner_item.dart</p>
<pre><code class="lang-java"> class BannerItem{
   String id;
   String imageUrl;
   String title;
   String subtitle;
   String targetPath;
   Map&lt;String,dynamic&gt; args;
   int seqNo;

   BannerItem.fromMap(Map&lt;String, dynamic&gt; map){
     id=map[&#39;id&#39;];
     imageUrl=map[&#39;imageUrl&#39;];
     title=map[&#39;title&#39;];
     subtitle=map[&#39;subtitle&#39;];
     targetPath=map[&#39;targetPath&#39;];
     args=map[&#39;args&#39;];
     seqNo=int.parse(map[&#39;seqNo&#39;]??&quot;0&quot;);
   }
 }
</code></pre>
</li>
<li><p>http_utils.dart</p>
<pre><code class="lang-java"> import &#39;package:dio/dio.dart&#39;;
 import &#39;package:dio_log/interceptor/dio_log_interceptor.dart&#39;;

 class HttpUtils {
   Dio dio;
   static final HttpUtils _instance = new HttpUtils._internal();
   factory HttpUtils() =&gt; _instance; // 工厂构造

   HttpUtils._internal() {
     BaseOptions options = new BaseOptions(
         contentType: &#39;application/json; charset=utf-8&#39;,
         headers: {&#39;Authorization&#39;: null});
     dio = Dio(options);

     // Interceptor interceptor = InterceptorsWrapper(
     //   onRequest: (RequestOptions options) =&gt; options,
     //   onResponse: (Response response) =&gt; response,
     //   onError: (DioError error) =&gt; error,
     // );
     // _dio.interceptors.add(interceptor);
     dio.interceptors.add(DioLogInterceptor()); // showDebugBtn(context);
   }

   static String getPath(String path,Map&lt;String,dynamic&gt; args){
     // print(&quot;input path:$path&quot;);
     Pattern pattern = RegExp(r&#39;:([^/|?|:]+)|([*])&#39;);
     String result = path.replaceAllMapped(
       pattern, 
       (match){
         print(&quot;match group: ${match.group(0)}&quot;);
         print(&quot;match group: ${match.group(1)}&quot;);
         return &quot;${args[match.group(1)]??match.group(0)}&quot;;
       }
     );
     // print(result);
     return result;
   }

   Future get(
     String path, {
     Map&lt;String, dynamic&gt; queryParameters,
     Options options,
     CancelToken cancelToken,
     ProgressCallback onReceiveProgress,
   }) async {

   return dio.get(path, 
       queryParameters: queryParameters,
       options:options,
       cancelToken:cancelToken,
       onReceiveProgress:onReceiveProgress
     );
   }
   // get dio =&gt; _dio;
 }
</code></pre>
</li>
</ol>
<h3 id="header-82">ListView 下滑加载更多</h3>
<p>index_page -&gt; home_page : View(activity_view),VM(activity_state),M(activity_item &amp; link_item)</p>
<p><img src="/2020/08/20/home-4.png" alt="Activities"></p>
<ol>
<li><p>index_page.dart</p>
<pre><code class="lang-java"> class IndexPage extends StatefulWidget {
   final IndexState indexState = IndexState.getInstance();
   final BannerState bannerState = BannerState.getInstance();
   final ActivityState activityState = ActivityState.getInstance();
   // ...
 }

 class _IndexPageState extends State&lt;IndexPage&gt; {
     // ...
     @override
     Widget build(BuildContext context) {
         return MultiProvider(
           providers: [
             ChangeNotifierProvider&lt;IndexState&gt;.value(value: widget.indexState),
             ChangeNotifierProvider&lt;BannerState&gt;.value(value: widget.bannerState),
             ChangeNotifierProvider&lt;ActivityState&gt;.value(value: widget.activityState),
             // ...
           ],
           child: Scaffold(
             body: _selectCurrentIndex(_bodyBuilder),
             // ...
           ),
         );
     }
 }
</code></pre>
</li>
<li><p>home_page.dart</p>
<pre><code class="lang-js"> class HomePage extends StatefulWidget {
   final Map args;
   HomePage({Key key, this.args}) : super(key: key);
   @override
   _HomePageState createState() =&gt; _HomePageState();
 }

 class _HomePageState extends State&lt;HomePage&gt; {
   @override
   Widget build(BuildContext context) {
     return Scaffold(
       appBar: wds.buildAppBar(widget.args != null ? widget.args[&#39;title&#39;] ?? &#39;&#39; : &#39;&#39;),
       // body: _buildBody(context),
       body: _buildWrapRefresh(context)
     );
   }

   _onRefresh(BuildContext context) {
     context.read&lt;CheckInState&gt;().doCheckIn();
     context.read&lt;BannerState&gt;().load();
     context.read&lt;ActivityState&gt;().reload();
     // ... 
   }

   _buildWrapRefresh(BuildContext ctx) {
     return RefreshIndicator(
         onRefresh: () async {
           debugPrint(&quot;+++ HomePage onRefresh! +++&quot;);
           _onRefresh(ctx);
         },
         child: _buildBody(ctx));
   }

   _buildBody(context) {
     return ListView(
       controller: Provider.of&lt;ActivityState&gt;(context).scrollController,
       children: [
         Consumer&lt;CheckInState&gt;(
           builder: (_, value, child) =&gt; CheckInView(checkInState: value),
         ),
         Consumer&lt;BannerState&gt;(builder: (_, value, child) =&gt; BannerView(bannerState: value,)),
         Consumer&lt;ActivityState&gt;(builder: (_, value, child) =&gt; ActivityView()),
         // ...
       ],
     );
   }
 }
</code></pre>
</li>
<li><p>activity_view.dart</p>
<pre><code class="lang-java"> import &#39;package:five_demo/pages/home/state/activity_state.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;
 import &#39;package:provider/provider.dart&#39;;

 class ActivityTheme{
   // ...
 }

 class ActivityView extends StatelessWidget {
   ActivityView({Key key}) : super(key: key);
   @override
   Widget build(BuildContext context) {
     var value = Provider.of&lt;ActivityState&gt;(context);
     return _buildBody(context, value);
   }

   _buildBody(context,value){
     // if(value.isLoading){
     //   return buildMsg(&quot;Loading...&quot;);
     // }
     // if(value.activityItems==null || value.activityItems.length==0){
     //   return buildEmpty();
     // }
     return _buildContent(context,value);
   }

   _buildContent(context,value){
     return Container(
       margin: EdgeInsets.all(8),
       padding: EdgeInsets.all(8),
       // color: Colors.lightBlue[50],
       child: Column(
         children: [
           _buildHeader(),
           SizedBox(height: 10),
           _buildItems(value),
         ],
       )
     );
   }

   _buildHeader(){
     // ...
   }

   _buildItems(value){
     return ListView.builder(
       itemCount: value.activityItems.length+1,
       shrinkWrap: true,
       physics: new NeverScrollableScrollPhysics(),
       itemBuilder:  (ctx,index){
         if(index==value.activityItems.length){
           return _buildEndInfo(value);
         }
         return _buildActivity(value.activityItems[index]);
       }
     );
   }

   _buildActivity(item){
     // ...
   }

   _buildEndInfo(value){
     var msg=&quot;&quot;;
     if((value.activityItems==null || value.activityItems.length==0)){
       if(value.isLoading)
         msg=&quot;More Loading ... &quot;;
       else
         msg=&quot;No Data!&quot;;
     }else{
       if(value.isLoading)
         msg=&quot;More Loading ... &quot;;
       else{
         msg=&quot;End!&quot;;
       }
     }
     return Container(
       padding: EdgeInsets.all(10),
       alignment: Alignment.center,
       child: Text(msg,style: TextStyle(fontSize: 14,color: Colors.grey),)
     );
   } 
 }
</code></pre>
</li>
<li><p>activity_state.dart</p>
<pre><code class="lang-java"> import &#39;package:five_demo/entities/activity_item.dart&#39;;
 import &#39;package:five_demo/entities/response_entity.dart&#39;;
 import &#39;package:flutter/material.dart&#39;;

 class ActivityState with ChangeNotifier{
   List&lt;ActivityItem&gt; activityItems;
   bool isLoading;
   int start=0;
   int limit=10;

   ScrollController scrollController;

   static final ActivityState _instance = ActivityState._internal();
   factory ActivityState.getInstance() =&gt; _instance;

   ActivityState._internal(){
     scrollController=new ScrollController();
     scrollController.addListener(() {
       // debugPrint(&quot;_scrollController:${_scrollController.position.pixels}&quot;);
       if(scrollController.position.pixels==scrollController.position.maxScrollExtent){
         debugPrint(&quot;-- ActivityState ScrollController Trigger load --&quot;);
         load();
       }
     });
     activityItems=[];

     load();
   }

   @override
   dispose(){
     debugPrint(&quot;-- ActivityState dispose --&quot;);
     activityItems=null;
     super.dispose();
   }

   reload(){
     start=0;
     limit=10;
     activityItems.clear();
     load();
   }

   load() async {
     /**
       String id;
       String avatar;
       String postUser;
       String postTag;
       String postTime;
       String postFrom;
       String postContent;
       String postLink;
       int likes;
       int comments;
       String targetPath;
      */
     isLoading=true;
     notifyListeners();

      Map&lt;String,dynamic&gt; responseData={
       &#39;success&#39;:false,
       &#39;result&#39;:[
         {
           &#39;id&#39;:&#39;1&#39;,
           &#39;avatar&#39;:&#39;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=2102119556,3949762144&amp;fm=26&amp;gp=0.jpg&#39;,
           &#39;postUser&#39;:&#39;小甜甜&#39;,
           &#39;postTag&#39;:&#39;官方&#39;,
           &#39;postFrom&#39;:&#39;Hey!Dear&#39;,
           &#39;postTime&#39;:&#39;2020-12-17&#39;,
           &#39;postContent&#39;:&#39;喜洋洋与灰太狼的日常更新啦&#39;,
           &#39;postLink&#39;:{
             &#39;cover&#39;:&#39;https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1668316143,3125260297&amp;fm=26&amp;gp=0.jpg&#39;,
             &#39;title&#39;:&#39;我在这里，我在这里&#39;,
             &#39;subtitle&#39;:&#39;快来呀快来呀&#39;,
             &#39;targetPath&#39;:&#39;/detail/link/1&#39;,
             &#39;linkType&#39;:&#39;html&#39;
           },
           &#39;targetPath&#39;:&#39;/detail/activity/1&#39;,
           &#39;likes&#39;:93840,
           &#39;comments&#39;:3
         },
        {
           &#39;id&#39;:&#39;2&#39;,
           &#39;avatar&#39;:&#39;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3224388312,1750026865&amp;fm=26&amp;gp=0.jpg&#39;,
           &#39;postUser&#39;:&#39;肉嘟嘟&#39;,
           &#39;postTag&#39;:&#39;官方&#39;,
           &#39;postFrom&#39;:&#39;Hey!Dear&#39;,
           &#39;postTime&#39;:&#39;2020-12-18&#39;,
           &#39;postContent&#39;:&#39;健身啦健身啦&#39;,
           &#39;postLink&#39;:{
             &#39;cover&#39;:&#39;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1832065145,3723585217&amp;fm=26&amp;gp=0.jpg&#39;,
             &#39;title&#39;:&#39;全民运动节，礼品等你拿&#39;,
             &#39;targetPath&#39;:&#39;/detail/link/2&#39;,
             &#39;linkType&#39;:&#39;html&#39;
           },
           &#39;targetPath&#39;:&#39;/detail/activity/2&#39;,
           &#39;likes&#39;:938,
           &#39;comments&#39;:0
         },
         {
           &#39;id&#39;:&#39;3&#39;,
           &#39;avatar&#39;:&#39;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1715123681,2767202506&amp;fm=26&amp;gp=0.jpg&#39;,
           &#39;postUser&#39;:&#39;酷哥&#39;,
           &#39;postTag&#39;:&#39;官方&#39;,
           &#39;postFrom&#39;:&#39;Hey!Dear&#39;,
           &#39;postTime&#39;:&#39;2020-12-18&#39;,
           &#39;postContent&#39;:&#39;Rap! Rap! 跟着我的步伐&#39;,
           &#39;postLink&#39;:{
             &#39;cover&#39;:&#39;https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=1996869834,1902662910&amp;fm=26&amp;gp=0.jpg&#39;,
             &#39;title&#39;:&#39;嘿，你敢来么&#39;,
             &#39;targetPath&#39;:&#39;/detail/link/3&#39;,
             &#39;linkType&#39;:&#39;html&#39;
           },
           &#39;targetPath&#39;:&#39;/detail/activity/3&#39;,
           &#39;likes&#39;:99,
           &#39;comments&#39;:9
         },
       ],
     };

     isLoading=true;
     notifyListeners();

     await Future.delayed(Duration(seconds: 2));

     var data = ResponseEntity&lt;List&lt;Map&gt;&gt;.fromMap(responseData);

     activityItems.addAll(
       data.result.map(
         (item){
           // debugPrint(&quot;$item&quot;);
           return ActivityItem.fromMap(item);
         }
       ).toList()
     );

     start+=limit;

     isLoading=false;
     notifyListeners();

   }
 }
</code></pre>
</li>
<li><p>activity_item.dart</p>
<pre><code class="lang-java"> import &#39;package:five_demo/entities/link_item.dart&#39;;

 class ActivityItem{
   String id;
   String avatar;
   String postUser;
   String postTag;
   String postTime;
   String postFrom;
   String postContent;
   LinkItem postLink;
   int likes;
   int comments;
   String targetPath;

   ActivityItem.fromMap(Map map){
     id=map[&#39;id&#39;];
     avatar=map[&#39;avatar&#39;];
     postUser=map[&#39;postUser&#39;];
     postTag=map[&#39;postTag&#39;];
     postFrom=map[&#39;postFrom&#39;];
     postTime=map[&#39;postTime&#39;];
     postContent=map[&#39;postContent&#39;];
     postLink=map[&#39;postLink&#39;]!=null?LinkItem.fromMap(map[&#39;postLink&#39;]):null;
     likes=map[&#39;likes&#39;];
     comments=map[&#39;comments&#39;];
     targetPath=map[&#39;targetPath&#39;];
   }

   Map toJson()=&gt;{
     &#39;id&#39;:id,
     &#39;avatar&#39;:avatar,
     &#39;postUser&#39;:postUser,
     &#39;postTag&#39;:postTag,
     &#39;postFrom&#39;:postFrom,
     &#39;postTime&#39;:postTime,
     &#39;postContent&#39;:postContent,
     &#39;postLink&#39;:postLink,
     &#39;likes&#39;:likes,
     &#39;comments&#39;:comments,
     &#39;targetPath&#39;:targetPath
   };

   @override
   String toString() {
     return toJson().toString();
   }
 }
</code></pre>
</li>
<li><p>link_item.dart</p>
<pre><code class="lang-java"> class LinkItem{
   String cover;
   String title;
   String subtitle;
   String targetPath;
   String linkType;

   LinkItem.fromMap(Map map){
     cover=map[&#39;cover&#39;];
     title=map[&#39;title&#39;];
     subtitle=map[&#39;subtitle&#39;];
     targetPath=map[&#39;targetPath&#39;];
     linkType=map[&#39;linkType&#39;];
   }
 }
</code></pre>
</li>
</ol>
<h3 id="header-83">Provider</h3>
<p>do_page</p>
<ul>
<li>View: doModuleView<ul>
<li>VM: doModuleState ( Module: List<DoModule> doModules)</li>
<li>VM: doInfoState ( Module: Map<String,DoInfoItem> doInfoMap)</li>
</ul>
</li>
<li>View: doRecomendView</li>
</ul>
<p><img src="/2020/08/20/do.png" alt="Do Page"></p>
<ol>
<li><p>do_page.dart</p>
<pre><code class="lang-js"> class DoPage extends StatelessWidget {

   final Map args;
   DoPage({Key key,this.args}) : super(key: key);

   @override
   Widget build(BuildContext context) {
     return MultiProvider(
       providers: [
         ChangeNotifierProvider&lt;DoModuleState&gt;(create: (_)=&gt; DoModuleState.getInstance()),
         ChangeNotifierProvider&lt;DoInfoState&gt;(create:(_)=&gt;DoInfoState.getInstance()),
         ChangeNotifierProvider&lt;DoRecommendState&gt;(create:(_)=&gt;DoRecommendState.getInstance()),
       ],
       builder: (_,child){
         return RefreshIndicator(
           onRefresh: () async {
             debugPrint(&quot;+++ DoPage onRefresh! +++&quot;);
             _onRefresh(_);
           },
           child: child
         );
       },
      child: Scaffold(
       //  appBar: buildAppBar(&quot;Do&quot;),
        appBar: _buildDoBar(),
        body: ListView(
          children: [
             Consumer&lt;DoModuleState&gt;(builder: (_,value,child)=&gt;DoModuleView(),),
             Consumer&lt;DoRecommendState&gt;(builder: (_,value,child)=&gt;DoRecommendView(),),
          ],
        ),
      ),
     );
   }

   _onRefresh(BuildContext context) {
     Provider.of&lt;DoModuleState&gt;(context,listen: false).load();
     Provider.of&lt;DoInfoState&gt;(context,listen: false).load();
     Provider.of&lt;DoRecommendState&gt;(context,listen: false).load();
   }

   _buildDoBar(){
     // ...
   }
 }
</code></pre>
</li>
<li><p>do_module_view.dart</p>
<pre><code class="lang-java"> class DoModuleView extends StatelessWidget {
   DoModuleView({Key key}) : super(key: key);
   @override
   Widget build(BuildContext context) {
     var value = Provider.of&lt;DoModuleState&gt;(context);
     return _buildBody(context, value);
   }

   _buildBody(BuildContext context,DoModuleState value){
     if(value.isLoading){
       return buildMsg(&quot;Loading...&quot;);
     }
     if(value.doModules==null || value.doModules.length==0){
       return buildEmpty();
     }
     return _buildContent(context,value);
   }

   _buildContent(BuildContext context,DoModuleState value){
     return Container(
       child: Column(
         crossAxisAlignment: CrossAxisAlignment.start,
         children: value.doModules.map&lt;Widget&gt;(
           (e) =&gt;_buildModule(context,e)
         ).toList(),
       ),
     );
   }

   _buildModule(BuildContext context,DoModule module){
     return Container(
       child: Column(
         crossAxisAlignment: CrossAxisAlignment.start,
         children: [
           _buildModuleHeader(context,module),
           _buildModuleProjects(context,module.children)
         ],
       ),
     );
   }

   _buildModuleHeader(BuildContext context,DoModule module){
     // ...
   }

   _buildModuleProjects(BuildContext context,List&lt;DoProject&gt; items){
     return buildPanel(
       Column(
         crossAxisAlignment: CrossAxisAlignment.start,
         children: ListTile.divideTiles(
           context: context,
           tiles: items.map&lt;Widget&gt;((e){
             return Column(
               children: [
                 _buildProjectContent(e),
                 _buildProjectItems(context,e.children),
               ],
             );
           })
         ).toList(),
       )
     );
   }

   _buildProjectContent(DoProject project){
     return Selector&lt;DoInfoState,DoInfoItem&gt;(
       selector: (_,value){
         if(value.doInfoMap!=null)
           return value.doInfoMap[project.id];
         return null;
       },
       builder: (context, info, child) {
         // debugPrint(&quot;build project ${project.id} cause info change&quot;);
         return ListTile(
           dense: true,
           contentPadding: EdgeInsets.all(0),
           leading: _buildProjectLeading(project,info),
           title: Text(project.title,style: project.level==2?DoModuleViewTheme.level2Title:DoModuleViewTheme.level1Title),
           subtitle: _buildProjectSubtitle(info),
           trailing: _buildProjectTrailing(project,info),
           onTap: (){
             debugPrint(&quot;do Project onTap: ${project.id} ${project.title}&quot;);
             Navigator.pushNamed(
               context,
               GlobalRoutes.Route_Detail,arguments: {&#39;item&#39;:project,&#39;info&#39;:info,&#39;targetPath&#39;:project.targetPath,&#39;targetType&#39;:project.targetType} 
             );
             context.read&lt;DoInfoState&gt;()?.reset(project.id);
           },
         );
       },
     );
   }

   _buildProjectItems(BuildContext context,List&lt;DoProject&gt; items){
     if(items==null || items.length==0)
       return Container();
     return Container(
       child: Column(
         crossAxisAlignment: CrossAxisAlignment.start,
         mainAxisAlignment: MainAxisAlignment.start,
         children:  items.map&lt;Widget&gt;((e){
             return Container(
               child: _buildProjectContent(e)
             );
           }).toList(),
       ),
     );
   }

 }
</code></pre>
</li>
</ol>
<h3 id="header-84">Tab</h3>
<ul>
<li>TabController &amp; TabBar(Tab) &amp; TabBarView</li>
<li>AppBar (PreferredSize)</li>
<li>PopupMenuButton</li>
</ul>
<p><img src="/2020/08/20/channel-fm-tab1-1.png" alt="Channel FM Index"></p>
<p>channel_fm_index.dart:</p>
<pre><code class="lang-java">class ChannelFmIndex extends StatefulWidget {
  ChannelFmIndex({Key key}) : super(key: key);
  @override
  _ChannelFmIndexState createState() =&gt; _ChannelFmIndexState();
}

class _ChannelFmIndexState extends State&lt;ChannelFmIndex&gt;  with SingleTickerProviderStateMixin {

  TabController _tabController;

  @override
  void initState() { 
    super.initState();
    _tabController = TabController(length: 3, vsync: this);
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: _buildHeader(),
      body: _buildTabView(context),
      floatingActionButton: _buildPopupMenu(),
    );
  }

  _buildPopupMenu(){
    return PopupMenuButton(
      offset: Offset(0,-110),
      icon: Icon(Icons.menu,color: Colors.black,),
      itemBuilder: (BuildContext context) =&gt; &lt;PopupMenuEntry&gt;[
          const PopupMenuItem(
            child: FlatButton(onPressed: null, child: Text(&quot;@ 客服&quot;))
          ),
          PopupMenuItem(
            child: FlatButton.icon(
              onPressed: null, 
              icon: Icon(Icons.edit,size: 16,), 
              label: Text(&quot;投稿&quot;)
            )
          ),
        ]
    );
  }

  _buildHeader(){
    return AppBar(
      elevation: 0,
      automaticallyImplyLeading: false,
      titleSpacing: 0,
      toolbarHeight: 160,
      title: _buildHeadCard(),
      bottom: PreferredSize(
        preferredSize: Size.fromHeight(50),
        child: _buildHeadTabBar(),
      ),
    );
  }

  _buildHeadCard(){
    return Container(
      child: Row(
        children: [
          // ...
        ],
      ),
    );
  }

 /* ------------------------------------ */

  _buildHeadTabBar(){
    return Container(
      decoration: BoxDecoration(
        color: Colors.white,
        border: Border.symmetric(
          horizontal: BorderSide(color: Colors.grey[50],width: 8)
        )
      ),
      child: TabBar(
        controller: _tabController,
        indicatorColor: Colors.black87,
        indicatorSize: TabBarIndicatorSize.label,
        indicatorWeight: 1.0,
        tabs: [
          Tab(child: Text(&quot;最新&quot;),),
          Tab(child: Text(&quot;动态&quot;),),
          Tab(child: Text(&quot;简介&quot;),),
        ],
      ),
    );
  }

  _buildTabView(BuildContext context){
    return TabBarView(
      controller: _tabController,
      children: &lt;Widget&gt;[
        _buildRefreshIndicator(&quot;Latest&quot;,_buildTabOfLatest(context)),
        _buildRefreshIndicator(&quot;Activity&quot;,_buildTabOfActivity(context)),
        _buildRefreshIndicator(&quot;Intro&quot;,_buildTabOfIntro()),
      ],
    );
  }

  /* ------------------------------------ */

  _buildRefreshIndicator(String name,Widget child){
    return RefreshIndicator(
      onRefresh: () async {
        debugPrint(&quot;+++ $name onRefresh! +++&quot;);
      },
      child: child
    );
  }

  _buildTabOfLatest(BuildContext context){
    // ...
  }

  _buildTabOfActivity(context){
    // ...
  }

  _buildTabOfIntro(){
   // ... 
  }

}
</code></pre>
<h3 id="header-85">Radio Play</h3>
<p><a href="https://pub.dev/packages/audioplayers">https://pub.dev/packages/audioplayers</a>
<a href="https://dengxiaolong.com/article/2019/07/how-to-play-audioplaxyers-in-flutter.html">https://dengxiaolong.com/article/2019/07/how-to-play-audioplaxyers-in-flutter.html</a>
<a href="https://www.jianshu.com/p/288f869690f0">https://www.jianshu.com/p/288f869690f0</a>
音效库 <a href="https://www.tukuppt.com/yinxiao/m101/zonghe_0_0_0_0_0_0_3.html">https://www.tukuppt.com/yinxiao/m101/zonghe_0_0_0_0_0_0_3.html</a></p>
<p><img src="/2020/08/20/channel-media-tab1-1.png" alt="Channel FM Media"></p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # 音频播放
  audioplayers: ^0.17.2
</code></pre>
<p>channel_media_index.dart:</p>
<pre><code class="lang-java">class ChannelMediaIndex extends StatefulWidget {
  ChannelMediaIndex({Key key}) : super(key: key);
  @override
  _ChannelMediaIndexState createState() =&gt; _ChannelMediaIndexState();
}

class _ChannelMediaIndexState extends State&lt;ChannelMediaIndex&gt; with SingleTickerProviderStateMixin {
  TabController _tabController;
  AudioPlayer _audioPlayer;
  var _playingItem={};
  Duration maxDuration;
  Duration currentDuration;
  AudioPlayerState playerState;

  @override
  void initState() {
    super.initState();
    _tabController = TabController(length: 3, vsync: this);
    _initAudioPlayer();
  }

  _initAudioPlayer() {
    _audioPlayer = new AudioPlayer();

    _audioPlayer.onDurationChanged.listen((Duration d) {
      debugPrint(&#39;Max duration: $d&#39;);
      if(mounted)
        setState(() =&gt; maxDuration = d);
    });

    // 位置事件: 此事件更新音频的当前播放位置
    _audioPlayer.onAudioPositionChanged.listen((Duration p) {
      // debugPrint(&#39;Current position: ${p.inMinutes}:${p.inSeconds}&#39;);
      if(mounted)
        setState(() =&gt; currentDuration = p);
    });

    // 状态事件: 此事件返回当前播放器状态。你可以用它来显示播放器是否在播放，或停止，或暂停
    _audioPlayer.onPlayerStateChanged.listen((AudioPlayerState s) {
      debugPrint(&#39;Current player state: $s&#39;);
      if(mounted)
        setState(() =&gt; playerState = s);
    });

    // 完成状态: 当音频结束播放时调用此事件(当使用pause或者stop方法中断播放时不会产生该事件)
    _audioPlayer.onPlayerCompletion.listen((event) {
      debugPrint(&#39;Current player completed&#39;);
      // setState(() { position = duration;});
    });

    // 错误事件: 当在本地代码中抛出意外错误时
    _audioPlayer.onPlayerError.listen((msg) {
      print(&#39;audioPlayer error : $msg&#39;);
      // setState(() {
      //   playerState = PlayerState.stopped;
      //   duration = Duration(seconds: 0);
      //   position = Duration(seconds: 0);
      // });
    });
  }

  play(String resource, {bool isLocal = false}) async {
    int result = await _audioPlayer.play(resource, isLocal: isLocal);
    if (result == 1) {
      debugPrint(&#39;play success&#39;);
    } else {
      debugPrint(&#39;play failed&#39;);
    }
  }

  stop() async {
    int result = await _audioPlayer.stop();
    if (result == 1) {
      debugPrint(&#39;stop success&#39;);
    } else {
      debugPrint(&#39;stop failed&#39;);
    }
  }

  pause() async {
    int result = await _audioPlayer.pause();
    if (result == 1) {
      // success
      debugPrint(&#39;pause success&#39;);
    } else {
      debugPrint(&#39;pause failed&#39;);
    }
  }

  resume() async {
    int result = await _audioPlayer.resume();
    if (result == 1) {
      debugPrint(&#39;resume success&#39;);
    } else {
      debugPrint(&#39;resume failed&#39;);
    }
  }

  seek(startMilliseconds) async {
    int result =
        await _audioPlayer.seek(new Duration(milliseconds: startMilliseconds));
    if (result == 1) {
      debugPrint(&#39;seek: go to $startMilliseconds success&#39;);
      // await audioPlayer.resume();
    } else {
      debugPrint(&#39;seek: go to $startMilliseconds failed&#39;);
    }
  }

  @override
  void deactivate() async {
    debugPrint(&#39;channel_media_index deactivate!&#39;);
    int result = await _audioPlayer.release();
    if (result == 1) {
      debugPrint(&#39;audioPlayer release success&#39;);
    } else {
      debugPrint(&#39;audioPlayerrelease failed&#39;);
    }
    super.deactivate();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: _buildAppBar(&quot;FM:风姿物语 - 2020.08&quot;),
      body: _buidBody(),
    );
  }

  _buidBody() {
    return NestedScrollView(
      headerSliverBuilder: (_,innerBoxIsScrolled){
        return [
          SliverToBoxAdapter(child: _buildPlayPanel(),),
          SliverAppBar(
            automaticallyImplyLeading: false,
            elevation: 0,
            floating: true,
            pinned: true,
            title: _buildTabBar()
          ),
        ];
      }, 
      body: _buildTabView()
    );
  }

  _buildPlayPanel() {
    return Container(
      height: 330,
      decoration: BoxDecoration(
        gradient: RadialGradient(
          radius: 1,
          colors: [Colors.brown,Colors.brown[300],Colors.brown[100]]
        ),
      ),
      child: Column(
        children: [
          SizedBox(height: 20,),
          Expanded(child:_buildPlayCovers()),
          SizedBox(height: 10,),
          Text(_playingItem[&#39;title&#39;]!=null?_playingItem[&#39;title&#39;]:&quot;&quot;,style: TextStyle(color: Colors.white.withOpacity(0.7),fontWeight: FontWeight.bold,fontSize: 16),),
          SizedBox(height: 10,),
          _buildPlayCtls()
        ],
      ),
    );
  }

  _buildPlayCovers(){
    var covers=[
      &quot;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2826031711,1618078016&amp;fm=26&amp;gp=0.jpg&quot;,
      &quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1822980246,1716056569&amp;fm=26&amp;gp=0.jpg&quot;,
      &quot;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=3155864268,1264666725&amp;fm=26&amp;gp=0.jpg&quot;,
      &quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1899644059,569818638&amp;fm=26&amp;gp=0.jpg&quot;
    ];
    return Swiper(
      itemCount: covers.length,
      itemBuilder: (_,index){
        return Container(
          decoration: BoxDecoration(
            borderRadius: BorderRadius.circular(8),
            image: DecorationImage(
              image: NetworkImage(covers[index]),
              fit: BoxFit.fill,
            ),
            // color: Colors.grey,
          ),
        );
      },
      autoplay: false,
      viewportFraction: 0.8,
      scale: 0.9,
    );
  }

  _buildPlayCtls(){
    return Container(
      child: Column(children: [
        Container(
          padding: EdgeInsets.symmetric(horizontal: 10),
          child: LinearProgressIndicator(
            value: (maxDuration!=null &amp;&amp; currentDuration!=null)? currentDuration.inSeconds/maxDuration.inSeconds : 0,
            backgroundColor: Colors.white.withOpacity(0.2),
            valueColor: AlwaysStoppedAnimation&lt;Color&gt;(Colors.white.withOpacity(0.7)),
            minHeight:2,
          ),
        ),
        Container(
          padding: EdgeInsets.only(left: 10,right: 10,top: 5),
          child: Row(
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: [
              Text(currentDuration!=null?&quot;${currentDuration.inMinutes}:${currentDuration.inSeconds.remainder(60)}&quot;:&quot;&quot;,style: TextStyle(fontSize: 12,color: Colors.white.withOpacity(0.5)),),
              Text(maxDuration!=null?&quot;${maxDuration.inMinutes}:${maxDuration.inSeconds.remainder(60)}&quot;:&quot;&quot;,style: TextStyle(fontSize: 12,color: Colors.white.withOpacity(0.5)),),
            ],
          ),
        ),
        Container(
          // color: Colors.grey,
          child: Row(
            mainAxisAlignment: MainAxisAlignment.spaceEvenly,
            children: [
              InkWell(
                child:Icon(Icons.fast_rewind,color: Colors.white.withOpacity(0.5)),
                onTap: (){},
              ),
              InkWell(
                child: Icon(AudioPlayerState.PLAYING==playerState?Icons.play_arrow:Icons.pause,size: 34,color: Colors.white),
                onTap: (){
                  if(AudioPlayerState.PLAYING==playerState)
                    pause();
                  else if(_playingItem!=null &amp;&amp; _playingItem[&#39;resource&#39;]!=null)
                    play(_playingItem[&#39;resource&#39;]);
                },
              ),
              Icon(Icons.fast_forward,color: Colors.white.withOpacity(0.5)),
            ],
          ),
        ),
        SizedBox(height: 8,)
      ],)
    );
  }

  /* ----------------- */

  _buildTabBar() {
    return Container(
      decoration: BoxDecoration(
          color: Colors.white,
          border: Border.symmetric(
              horizontal: BorderSide(color: Colors.grey[50], width: 8))),
      child: TabBar(
        controller: _tabController,
        indicatorColor: Colors.black87,
        indicatorSize: TabBarIndicatorSize.label,
        indicatorWeight: 1.0,
        tabs: [
          Tab(
            child: Text(&quot;播放列表&quot;),
          ), // 音频,点击 -&gt; 当前页切换播放内容 Rebuild (同一路由)
          Tab(
            child: Text(&quot;花絮周边&quot;),
          ), // 动态，图文/影片,评论留言 -&gt; 底部弹框，关闭
          Tab(
            child: Text(&quot;简介&quot;),
          )
        ],
      ),
    );
  }

  _buildTabView() {
    return TabBarView(
      controller: _tabController,
      children: &lt;Widget&gt;[
        _buildTab1(),
        _buildTab2(),
        _buildTab3(),
      ],
    );
  }

  /* --------------------- */

  getDataOfPlayList() {
    return [
      {
        &#39;id&#39;: &#39;01&#39;,
        &#39;title&#39;: &#39;风中有朵雨做的云&#39;,
        &#39;duration&#39;: &#39;2:30&#39;,
        &#39;subtitle&#39;: &#39;收录于专辑《听说》&#39;,
        &#39;resource&#39;:&#39;https://img.tukuppt.com/newpreview_music/08/98/97/5c88d1231eeb570304.mp3&#39;
      },
      {
        &#39;id&#39;: &#39;02&#39;,
        &#39;title&#39;: &#39;雨一直下&#39;,
        &#39;duration&#39;: &#39;5:30&#39;,
        &#39;subtitle&#39;: &#39;收录于专辑《听说》&#39;,
        &#39;resource&#39;: &#39;https://img.tukuppt.com/newpreview_music/09/00/75/5c894afe4de5f1618.mp3&#39;
      },
      {
        &#39;id&#39;: &#39;03&#39;,
        &#39;title&#39;: &#39;恶作剧幽默搞怪&#39;,
        &#39;duration&#39;: &#39;02:03&#39;,
        &#39;subtitle&#39;: &#39;猜猜是什么话题&#39;,
        // &#39;resource&#39;:&#39;https://img.tukuppt.com/newpreview_music/09/00/44/5c8926ae5fdb676071.mp3&#39;,
        &#39;resource&#39;:&#39;https://img.tukuppt.com/newpreview_music/09/00/75/5c894afdc4c1578647.mp3&#39;
      },
      {&#39;id&#39;: &#39;04&#39;, &#39;title&#39;: &#39;舒缓音乐&#39;, &#39;duration&#39;: &#39;12:30&#39;,&#39;resource&#39;:&#39;https://img.tukuppt.com/newpreview_music/09/00/76/5c894c2e6ad5854338.mp3&#39;},
      {&#39;id&#39;: &#39;05&#39;, &#39;title&#39;: &#39;海边悠扬的海浪拍打声和海鸥鸣叫声&#39;, &#39;duration&#39;: &#39;3:30&#39;, &#39;subtitle&#39;: &#39;amazing！&#39;,&#39;resource&#39;:&#39;https://img.tukuppt.com/newpreview_music/09/00/40/5c8921fb5b7a586734.mp3&#39;},
    ];
  }

  _buildTab1() {
    return Container(
      child: ListView(children: [
        _buildPlayList(getDataOfPlayList()),
        // ...
      ])
    );
  }

  _buildPlayList(playList) {
    return Container(
      color: Colors.white,
      padding: EdgeInsets.all(10),
      child: Column(
        children: ListTile.divideTiles(
            context: context,
            tiles: playList.map&lt;Widget&gt;((e) {
              bool isActive = (_playingItem!=null &amp;&amp; _playingItem[&#39;id&#39;]==e[&#39;id&#39;]);
              return InkWell(
                child: Container(
                  padding: EdgeInsets.all(8),
                  child: Row(
                    children: [
                      Icon(Icons.play_circle_outline,color: isActive?Colors.deepOrange:Colors.grey,),
                      SizedBox(width:10),
                      Expanded(
                        child: Column(
                          crossAxisAlignment: CrossAxisAlignment.start,
                          children: [
                            Text(&quot;${e[&#39;title&#39;]}&quot;),
                            e[&#39;subtitle&#39;] != null
                                ? Text(
                                    &quot;${e[&#39;subtitle&#39;]}&quot;,
                                    style: TextStyle(
                                        color: Colors.grey, fontSize: 12),
                                  )
                                : SizedBox()
                          ],
                        ),
                      ),
                      Text(
                        &quot;${e[&#39;duration&#39;]}&quot;,
                        style: TextStyle(color: Colors.grey, fontSize: 12),
                      )
                    ],
                  ),
                ),
                onTap: (){
                  if(e[&#39;resource&#39;]==null)
                    return;
                  if(mounted){
                    setState(() {
                      _playingItem=e;
                    });
                    play(e[&#39;resource&#39;]);
                  } 
                },
              );
            })).toList(),
      ),
    );
  }

}
</code></pre>
<h3 id="header-86">setState导致的内存泄漏</h3>
<p>Flutter中setState导致的内存泄漏——setState() called after dispose()</p>
<p><a href="https://blog.csdn.net/qq_26287435/article/details/89674247">https://blog.csdn.net/qq_26287435/article/details/89674247</a>
错误原因是异步消息未返回，所以在setState方法之前调用mouted属性进行判断即可。具体示例如下：</p>
<pre><code class="lang-js">if(mounted){
    setState(() {
      _listData.addAll(list);
    }
}
</code></pre>
<h3 id="header-87">Video Player</h3>
<p>视频库
<a href="http://www.cg002.com/">http://www.cg002.com/</a></p>
<p>Flutter 中使用 video_player 播放视频
<a href="http://www.ptbird.cn/flutter-video.html">http://www.ptbird.cn/flutter-video.html</a></p>
<p>Flutter视频播放、Flutter VideoPlayer 视频播放组件精要
<a href="https://blog.csdn.net/zl18603543572/article/details/111327310">https://blog.csdn.net/zl18603543572/article/details/111327310</a></p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # 视频播放
  video_player: ^1.0.1
</code></pre>
<ol>
<li><p>video_play_widget.dart:</p>
<pre><code class="lang-java"> import &#39;package:flutter/material.dart&#39;;
 import &#39;package:video_player/video_player.dart&#39;;

 class VideoPlayWidget extends StatefulWidget {

   final String url;
   VideoPlayWidget({Key key,this.url}) : super(key: key);
   @override
   _VideoPlayWidgetState createState() =&gt; _VideoPlayWidgetState();

 }

 class _VideoPlayWidgetState extends State&lt;VideoPlayWidget&gt; {

   VideoPlayerController  _playerController ;
   @override
   void initState() {
     super.initState();
     _playerController = VideoPlayerController.network(widget.url);
     _playerController.initialize()
      //异步执行完的回调
      ..whenComplete(() {
        //刷新页面
        setState(() {});
      });
   }

   @override
   void dispose() {
     _playerController.dispose();
     super.dispose();
   }

   @override
   Widget build(BuildContext context) {
     return GestureDetector(
       onTap: () {
         debugPrint(&quot;pop&quot;);
         Navigator.pop(context);
       },
       child: Container(
         color: Colors.black,
         alignment: Alignment.center,
         child: _buildPlayer(),
       ),
     );
   }

   _buildPlayer(){
     return AspectRatio(
       //设置视频的大小 宽高比。长宽比表示为宽高比。例如，16:9宽高比的值为16.0/9.0
       aspectRatio: _playerController.value.aspectRatio,
       //播放视频的组件
       child: VideoPlayer(_playerController),
     );
   }
 }
</code></pre>
</li>
<li><p>调用：</p>
<pre><code class="lang-java"> Navigator.push(context,
   PopupRouteWidget(child: VideoPlayWidget(
     url: entry.value[&#39;link&#39;]
   ))
 );
</code></pre>
</li>
</ol>
<h3 id="header-88">Photo Preview</h3>
<p><img src="/2020/08/20/channel-media-tab2-1.png" alt="Channel Media Photo"> <img src="/2020/08/20/channel-media-tab2-2.png" alt="Channel Media Photo"></p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # 弹出放大缩小图片
  photo_view: ^0.10.3
</code></pre>
<p>photo_preview_widget.dart:</p>
<pre><code class="lang-java">import &#39;package:flutter/material.dart&#39;;
import &#39;package:photo_view/photo_view.dart&#39;;
import &#39;package:photo_view/photo_view_gallery.dart&#39;;

class PhotoPreviewWidget extends StatefulWidget {

  final int initialIndex;
  final List photoList;
  final PageController pageController;

  PhotoPreviewWidget({Key key,this.initialIndex,this.photoList}) : pageController = PageController(initialPage: initialIndex),super(key: key);

  @override
  _PhotoPreviewWidgetState createState() =&gt; _PhotoPreviewWidgetState();
}

class _PhotoPreviewWidgetState extends State&lt;PhotoPreviewWidget&gt; {

  int _currentIndex;

  @override
  void initState() {
    _currentIndex = widget.initialIndex;
    super.initState();
  }

  void onPageChanged(int index) {
    setState(() {
      _currentIndex = index;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Container(
      color: Colors.black,
      child: Stack(
        children: [
          GestureDetector(
            onTap: () =&gt; Navigator.pop(context),
            child: _buildPhotoPreview(),
          ),
          Align(
            alignment: Alignment.bottomCenter,
            child: _buildPagination(),
          )
        ],
      ),
    );
  }

  _buildPhotoPreview(){
    return Container(
      child: PhotoViewGallery.builder(
        scrollPhysics: const BouncingScrollPhysics(),
        onPageChanged: onPageChanged,
        itemCount: widget.photoList.length,
        pageController: widget.pageController,
        loadingBuilder: (context, event) =&gt; Center(
          child: Container(
            width: 20.0,
            height: 20.0,
            child: CircularProgressIndicator(
              value: event == null
                  ? 0
                  : event.cumulativeBytesLoaded / event.expectedTotalBytes,
            ),
          ),
        ),
        builder: (BuildContext context, int index) {
          return PhotoViewGalleryPageOptions(
            imageProvider: NetworkImage(widget.photoList[index][&#39;cover&#39;]),
            minScale: PhotoViewComputedScale.contained * 0.6,
            maxScale: PhotoViewComputedScale.covered * 1.1,
            initialScale: PhotoViewComputedScale.contained,
          );
        },
      ),
    );
  }

  _buildPagination(){
    return Container(
      child: Row(
        mainAxisAlignment: MainAxisAlignment.center,
        children: List.generate(
          widget.photoList.length,
          (i) =&gt; Container(
            margin: EdgeInsets.all(5),
            child: CircleAvatar(
              radius: 4,
              backgroundColor: _currentIndex == i ? Colors.white.withOpacity(0.9) : Colors.white.withOpacity(0.5),
            ),
          ),
        ).toList(),
      ),
    );
  }

}
</code></pre>
<h3 id="header-89">底部评论</h3>
<p><img src="/2020/08/20/channel-media-tab2-comment1.png" alt="Channel Media Comment"> <img src="/2020/08/20/channel-media-tab2-comment2.png" alt="Channel Media Comment"></p>
<ol>
<li><p>点击触发展示底部评论框 (channel_media_index.dart / project_activity_view.dart)</p>
<pre><code class="lang-java"> FlatButton.icon(
   icon:Icon(Icons.comment,size:16,color:Colors.grey),
   label: Text(&quot;评论&quot;,style:TextStyle(fontSize:12,color:Colors.grey)),
   onPressed: (){
     Navigator.push(context,
       PopupRouteWidget(child: InputBottomWidget(
         onEditingCompleteText: (text){
             print(&#39;点击发送 ---$text&#39;);
         },
       ))
     );
   }),

 FlatButton(
   onPressed: (){
     Navigator.push(context,
         PopupRouteWidget(child: InputBottomWidget(
           draftText: activity[&#39;draftText&#39;],
           onEditingCompleteText: (text){
               print(&#39;点击发送 ---$text&#39;);
           },
         ))
     ).then((value){
       print(&quot;input draft: $value --&gt; cache local&quot;);
       activity[&#39;draftText&#39;]=value;
     });
   },
   child: Text(&quot;评论&quot;)
 );

 FlatButton(
   onPressed: (){
     Navigator.push(context,
         PopupRouteWidget(child: InputBottomWidget(
               hintText: &quot;回复 ${reply[&#39;from&#39;]}&quot;,
               onEditingCompleteText: (text){print(&#39;点击发送 ---$text&#39;);},
         ))
     );
   },
   child: Text(&quot;回复&quot;)
 );
</code></pre>
</li>
<li><p>底部评论框 input_bottom_widget.dart （点击其他处/输入框回车发送 =&gt; 关闭）:</p>
<pre><code class="lang-java"> import &#39;package:flutter/material.dart&#39;;

 class InputBottomWidget extends StatelessWidget {

   final String hintText;
   final String draftText;
   final ValueChanged onEditingCompleteText;   // typedef ValueChanged&lt;T&gt; = void Function(T value);

   final TextEditingController controller = TextEditingController();

   InputBottomWidget({
     Key key,
     this.onEditingCompleteText,
     this.hintText=&quot;评论&quot;,
     this.draftText
   }) : super(key: key) {
     controller.text=draftText;
   }

   @override
   Widget build(BuildContext context) {
     return Scaffold(
       backgroundColor: Colors.transparent,
       body: Column(
         children: &lt;Widget&gt;[
           Expanded(  // 蒙板
               child: GestureDetector(
                 child: Container(
                   color: Colors.transparent,  
                 ),
                 onTap: () {
                   Navigator.pop(context,controller.text);   // 关闭此页
                 },
               )
           ),
           Container(
               color: Colors.grey[100],
               padding: EdgeInsets.symmetric(vertical: 8,horizontal: 16),
               child:  _buildInputTextField(context)
           )
         ],
       ),
     );
   }

   _buildInputTextField(context){
     return Container(
       decoration: BoxDecoration(
           color: Colors.white
       ),
       child: TextField(
         decoration: InputDecoration(
           hintText: hintText,
           isDense: true,
           contentPadding: EdgeInsets.only(left: 10,top: 5,bottom: 5,right: 10),
           border: const OutlineInputBorder(
             gapPadding: 0,
             borderSide: BorderSide(width: 0,style: BorderStyle.none,),
           ),
         ),
         controller: controller,
         autofocus: true,
         style: TextStyle(fontSize: 16),
         //设置键盘按钮为发送
         textInputAction: TextInputAction.send,
         keyboardType: TextInputType.multiline,
         minLines: 1,
         maxLines: 5,
         onEditingComplete: (){
           //点击发送调用
           print(&#39;onEditingComplete&#39;);
           onEditingCompleteText(controller.text);
           Navigator.pop(context);
         },
       ),
     );
   }
 }
</code></pre>
</li>
<li><p>弹出消失动画 popup_route_widget.dart:</p>
<pre><code class="lang-java"> import &#39;package:flutter/material.dart&#39;;

 class PopupRouteWidget extends PopupRoute{
   final Duration _duration = Duration(milliseconds: 300);
   Widget child;

   PopupRouteWidget({@required this.child});

   @override
   Color get barrierColor =&gt; null;

   @override
   bool get barrierDismissible =&gt; true;

   @override
   String get barrierLabel =&gt; null;

   @override
   Widget buildPage(BuildContext context, Animation&lt;double&gt; animation, Animation&lt;double&gt; secondaryAnimation) {
     // return child;
     return FadeTransition(
       opacity: animation,
       child: child,
     );
   }

   @override
   Duration get transitionDuration =&gt; _duration;
 }
</code></pre>
</li>
</ol>
<h3 id="header-90">瀑布流</h3>
<p><img src="/2020/08/20/channel-daily-1.png" alt="Channel Daily Comment"></p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # 瀑布流
  flutter_staggered_grid_view: ^0.3.2
</code></pre>
<p>channel_daily_index.dart:</p>
<pre><code class="lang-java">_buildNoteItems(){

    var noteList=[
      {&#39;id&#39;:&#39;1&#39;,&#39;cover&#39;:&#39;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=2248624002,2108517552&amp;fm=26&amp;gp=0.jpg&#39;,&#39;title&#39;:&#39;采茶之旅&#39;,&#39;postBy&#39;:&#39;砍柴人&#39;,&#39;avatar&#39;:&#39;https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=3397053345,592981929&amp;fm=26&amp;gp=0.jpg&#39;,&#39;likes&#39;:5},
      {&#39;id&#39;:&#39;2&#39;,&#39;cover&#39;:&#39;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=3008435233,972423020&amp;fm=26&amp;gp=0.jpg&#39;,&#39;title&#39;:&#39;断桥边&#39;,&#39;postBy&#39;:&#39;砍柴人&#39;,&#39;avatar&#39;:&#39;https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=3397053345,592981929&amp;fm=26&amp;gp=0.jpg&#39;,&#39;likes&#39;:0},
      {&#39;id&#39;:&#39;3&#39;,&#39;cover&#39;:&#39;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2126854169,3585890470&amp;fm=26&amp;gp=0.jpg&#39;,&#39;title&#39;:&#39;亲子厨房&#39;,&#39;postBy&#39;:&#39;砍柴人&#39;,&#39;avatar&#39;:&#39;https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=3397053345,592981929&amp;fm=26&amp;gp=0.jpg&#39;,&#39;likes&#39;:15},
      {&#39;id&#39;:&#39;4&#39;,&#39;cover&#39;:&#39;https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2487663409,412721828&amp;fm=26&amp;gp=0.jpg&#39;,&#39;title&#39;:&#39;墙壁大作战&#39;,&#39;postBy&#39;:&#39;砍柴人&#39;,&#39;avatar&#39;:&#39;https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=3397053345,592981929&amp;fm=26&amp;gp=0.jpg&#39;,&#39;likes&#39;:35},
      {&#39;id&#39;:&#39;5&#39;,&#39;cover&#39;:&#39;https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=3647241271,3241631924&amp;fm=26&amp;gp=0.jpg&#39;,&#39;title&#39;:&#39;灰色灰色&#39;,&#39;postBy&#39;:&#39;砍柴人&#39;,&#39;avatar&#39;:&#39;https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=3397053345,592981929&amp;fm=26&amp;gp=0.jpg&#39;,&#39;likes&#39;:45},
    ];

    return Container(
      padding: EdgeInsets.symmetric(horizontal: 10),
      child: StaggeredGridView.countBuilder(
        shrinkWrap: true,
        physics: NeverScrollableScrollPhysics(),
        crossAxisCount: 4,
        itemCount: noteList.length,
        itemBuilder: (BuildContext context, int index) =&gt; _buildNoteContent(index, noteList[index]),
        staggeredTileBuilder: (int index) =&gt;
            new StaggeredTile.count(2, index.isEven ? 2:2.5),
        mainAxisSpacing: 8,
        crossAxisSpacing: 8,
      ),
    );
  }

  _buildNoteContent(index,item){
    // return Container(
    //   color: Colors.white,
    //   child: Center(
    //     child: CircleAvatar(
    //       backgroundColor: Colors.grey[100],
    //       child: Text(&#39;$index&#39;),
    //     ),
    //   )
    // );

    return Container(
      decoration: BoxDecoration(
        borderRadius: BorderRadius.circular(5),
        color: Colors.white,
      ),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Expanded(child: 
            ClipRRect(
              borderRadius: BorderRadius.circular(5),
              child: Image.network(item[&#39;cover&#39;],fit: BoxFit.cover,)
            )
          ),
          SizedBox(height: 5,),
          Text(item[&#39;title&#39;],style: TextStyle(fontWeight: FontWeight.w500),),
          SizedBox(height: 5,),
          Row(
            children: [
              CircleAvatar(radius: 10,backgroundImage: NetworkImage(item[&#39;avatar&#39;]),),
              SizedBox(width: 5,),
              Expanded(child:Text(item[&#39;postBy&#39;])),
              Icon(Icons.favorite_outline,size: 15,color: Colors.grey,),
              SizedBox(width:5,),
              Text(&quot;${item[&#39;likes&#39;]}&quot;)
            ],
          ),
          SizedBox(height: 5,),
        ],
      ),
    );
  }
</code></pre>
<h3 id="header-91">Chat 聊天框</h3>
<p>project_chat_view.dart:</p>
<pre><code class="lang-java">class ProjectChatView extends StatefulWidget {

  final FocusNode focusNode;

  ProjectChatView({Key key,this.focusNode}) : super(key: key);
  @override
  _ProjectChatViewState createState() =&gt; _ProjectChatViewState();
}

class _ProjectChatViewState extends State&lt;ProjectChatView&gt; with AutomaticKeepAliveClientMixin {

  @override
  bool get wantKeepAlive =&gt; true;

  ScrollController _scrollController = ScrollController() ;
  final TextEditingController _inputController = TextEditingController();

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: _buildChatList(getDataOfChatMsgs()),
      bottomNavigationBar:BottomAppBar(
        child:  _buildInputPanel(),
      )
    );
  }

  _buildInputPanel(){
    return Container(
      padding: EdgeInsets.all(8),
      decoration: BoxDecoration(
        color: Colors.grey[200],
      ),
      child: Row(children: [
        Expanded(child: _buildInputTextField()),
        SizedBox(width: 5,),
        Icon(Icons.insert_emoticon),
        SizedBox(width: 5,),
        InkWell(
          child:Icon(Icons.add_circle_outline),
          onTap: (){
            // _chatScrollController.jumpTo(_chatScrollController.position.maxScrollExtent);
            // Future.delayed(Duration(milliseconds: 100), (){
            //   _scrollController.jumpTo(_scrollController.position.maxScrollExtent);
            // });
          },
        ),
      ],)
      // child: TextField(),
    );
  }

  _buildInputTextField(){
    return TextField(
      decoration: InputDecoration(
        isDense: true,
        hintText: &#39;@ 管理员&#39;,
        hintStyle: TextStyle(color: Colors.grey),
        border: InputBorder.none,
        filled: true,
        fillColor: Colors.white,
      ),
      keyboardType: TextInputType.multiline,
      textInputAction: TextInputAction.send,
      minLines: 1,
      maxLines: 5,
      focusNode: widget.focusNode,
      controller: _inputController,
      onSubmitted: (value) {
        debugPrint(&#39;submit: $value&#39;);
        _inputController.clear();
      },
      onTap: (){
        debugPrint(&quot;tap&quot;);
        Future.delayed(Duration(milliseconds: 100), (){
          _scrollController.jumpTo(_scrollController.position.maxScrollExtent);
          // _scrollController.animateTo(
          //   _scrollController.position.maxScrollExtent,
          //   duration: Duration(milliseconds: 500), curve: Curves.ease);
        });
      },
    );
  }

}
</code></pre>
<h3 id="header-92">WebView</h3>
<p><a href="https://pub.flutter-io.cn/packages/webview_flutter/example">https://pub.flutter-io.cn/packages/webview_flutter/example</a></p>
<p>Flutter WebView与JS交互简易指南
<a href="https://blog.csdn.net/weixin_33739541/article/details/89571639">https://blog.csdn.net/weixin_33739541/article/details/89571639</a></p>
<p>Flutter使用JsBridge方式处理Webview与H5通信的方法
<a href="https://www.yht7.com/news/60783">https://www.yht7.com/news/60783</a></p>
<p>Flutter 采坑之旅--webview_flutter
<a href="https://www.jianshu.com/p/611840cc2797">https://www.jianshu.com/p/611840cc2797</a></p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  webview_flutter: ^1.0.7
</code></pre>
<pre><code class="lang-java">@override
Widget build(BuildContext context) {
    return Scaffold(
      appBar: _buildAppBar(),
      floatingActionButtonLocation: FloatingActionButtonLocation.miniEndFloat,
      body: SafeArea(
        child: _buildWebview(),
      ),
    );
}

_buildWebview(){
    return Container(
      height: _webViewHeight,
      child: WebView(
        initialUrl: widget.initialUrl,
        javascriptMode: JavascriptMode.unrestricted,
        onWebViewCreated: (WebViewController webViewController) {
          _controller.complete(webViewController);
        },
        onPageStarted: (String url) {
          debugPrint(&#39;Page started loading: $url&#39;);
        },
        onPageFinished: (String url) {
          debugPrint(&#39;Page finished loading: $url&#39;);
          _getWebViewHeight();
          // setState(() {
          //   // _isPageFinished = true;
          // });
        },
        gestureNavigationEnabled: true,
        javascriptChannels: &lt;JavascriptChannel&gt;[
          _invokeJavascriptChannel(context),
        ].toSet(),
        //拦截页面url
        navigationDelegate: (NavigationRequest request) {
          if (request.url.startsWith(&#39;alipays:&#39;) ||
              request.url.startsWith(&#39;weixin:&#39;)) {
            // _openPay(context, request.url);
            return NavigationDecision.prevent;
          }
          return NavigationDecision.navigate;
        },
      ),
    );
}

// 注册js回调
JavascriptChannel _invokeJavascriptChannel(BuildContext context) {
    return JavascriptChannel(
      name: &#39;Invoke&#39;,
      onMessageReceived: (JavascriptMessage message) {
        debugPrint(&quot;${message.message}&quot;);
        var webHeight = double.parse(message.message);
        if (webHeight != null) {
          setState(() {
            _webViewHeight = webHeight;
          });
        }
      }
    );
}

// 获取页面高度
_getWebViewHeight() async {
    WebViewController webviewController = await _controller.future;
    final String temp = await webviewController.getTitle();
    debugPrint(&#39;title:&#39; + temp);

    await webviewController.evaluateJavascript(&#39;Invoke.postMessage(document.documentElement.scrollHeight)&#39;);
}
</code></pre>
<p>调用 （channel_media_index.dart)</p>
<pre><code class="lang-java">WebviewWidget(initialUrl: &quot;https://juejin.cn/post/6844903908087693319&quot;,)
</code></pre>
<h3 id="header-93">Html</h3>
<p>html内容加载</p>
<p><a href="https://pub.flutter-io.cn/packages/flutter_html">https://pub.flutter-io.cn/packages/flutter_html</a>
<a href="https://cloud.tencent.com/developer/article/1502142">https://cloud.tencent.com/developer/article/1502142</a>
<a href="https://www.jianshu.com/p/8ea17b06e541">https://www.jianshu.com/p/8ea17b06e541</a></p>
<p>pubspec.yaml</p>
<pre><code class="lang-yaml">dependencies:
  # html
  flutter_html: ^1.0.0
</code></pre>
<pre><code class="lang-js">_buildRecommendContent(String targetPath){
    return Container(
      child: Html(
        data: &#39;&#39;&#39;
        &lt;ul&gt;
          &lt;li&gt;
            &lt;div&gt;
              &lt;img src=&quot;https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=30699094,3647522649&amp;fm=26&amp;gp=0.jpg&quot;/&gt;
            &lt;/div&gt;
            &lt;div style=&quot;color:green;border:5px solid red;&quot;&gt;
              Content
            &lt;/div&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
        &#39;&#39;&#39;,
        style: {
          &quot;img&quot;:Style(
            width: 100
          ),
          &quot;div&quot;:Style(
            display: Display.INLINE
          )
        },
      ),
    );
  }
</code></pre>
<h2 id="header-94">More Reference</h2>
<ul>
<li><a href="https://flutterchina.club/widgets/">Fluter中文网</a></li>
<li><a href="https://ducafecat.tech/categories/Flutter-%E5%AE%9E%E6%88%98%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B/">Flutter 实战从零开始</a></li>
<li><a href="http://laomengit.com/flutter/widgets/TextField.html#editabletext">老孟</a></li>
<li><a href="http://www.ptbird.cn/category/flutter/">Postbird</a></li>
<li><a href="https://yococoxc.github.io/flutter.html">木子才的博客</a></li>
<li><a href="https://segmentfault.com/a/1190000024454441">Flutter仿京东客户端</a></li>
<li><a href="https://juejin.cn/post/6874082988381241357">Flutter第三方插件汇总</a></li>
<li><a href="https://github.com/826327700/flutter_plugins_demo">flutter_plugins_demo flutter好用的轮子推荐</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1622941">【Flutter高级玩法-shape】Path在手，天下我有</a></li>
</ul>
  </section>
</article>

      <hr/>
      
<section class="post-comment">
	
		<div id="gitment_container"></div>

<link rel="stylesheet" href="/gitment/default.css">
<script src="/gitment/gitment.browser.js"></script>


<script type="text/javascript">
	var gitment = new Gitment({
	  id: document.location.pathname,
	  owner: 'chenjin-zero',
	  repo: 'blogComment',
	  oauth: {
	    client_id: '36a09bb7399efe69c6ce',
	    client_secret: 'ad9ad546b23b708c71d92e513dc36e0486179dea',
	  }
	})
      
	gitment.render('gitment_container')
</script>
	
</section>

    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>


	<script src="/highlight/highlight.pack.js"></script>
	<script type="text/javascript">
		hljs.initHighlightingOnLoad();
	</script>






<script type="text/javascript">

  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
