<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SQL查询</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="query,join,row_number,rank,pagination,aggregation">
  
  
    <meta name="description" content="Sql Query">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
    <link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">连接查询</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">rownum,rowid</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">row_number,dense_rank,rank</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">重复记录</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">行列转换</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-6"><span class="sidebar-nav nav-text">分页</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-7"><span class="sidebar-nav nav-text">合并多行记录</span></a></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">SQL查询</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2013-03-31T16:00:00.000Z">2013-04-01</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-SQL">SQL</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h3 id="header-1">连接查询</h3>
<ul>
<li><code>inner join</code> ：AB交集 （等同于<code>join</code>,<code>,</code>）<ul>
<li>显式：<code>select [cols_list] from a inner join b on [condition] where [condition]</code></li>
<li>隐式：<code>select [cols_list] from a,b where [condition]</code></li>
</ul>
</li>
<li><code>outer join</code><ul>
<li><code>left join</code>：A的完全集，而B表中匹配的则有值，没有匹配的则以null值取代 （等同于<code>left outer join</code>）</li>
<li><code>right join</code>：B的完全集，而A表中匹配的则有值，没有匹配的则以null值取代 （等同于<code>right outer join</code>）</li>
<li><code>full join</code>：A和B的并集。对于没有匹配的记录，则会以null做为值</li>
</ul>
</li>
<li><code>cross join</code>：表A和表B的数据进行一个N*M的组合，即笛卡尔积，不带ON子句<ul>
<li>显式：<code>select [cols_list] from a cross join b where [condition]</code></li>
<li>隐式：<code>select [cols_list] from a,b where [condition]</code></li>
</ul>
</li>
<li><strong>注意：</strong><ul>
<li><code>left Join</code> on后面的条件对Left的表没有作用，只对Right的表有过滤作用</li>
<li><code>inner join</code> on后面的限制条件将全部起作用，这与where的执行结果是一样的</li>
</ul>
</li>
</ul>
<p>示例：</p>
<p>table a</p>
<table class="table">
<thead>
<tr>
<th>id</th>
<th>type</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
</tr>
<tr>
<td>2</td>
<td>a</td>
</tr>
<tr>
<td>3</td>
<td>b</td>
</tr>
</tbody>
</table>
<p>table b</p>
<table class="table">
<thead>
<tr>
<th>id</th>
<th>class</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>aa</td>
</tr>
<tr>
<td>2</td>
<td>bb</td>
</tr>
</tbody>
</table>
<ol>
<li><p>使用<code>a left join b</code>+<code>and a</code></p>
<pre><code class="nullsql"> <span class="hljs-keyword">select</span> a.*,b.* <span class="hljs-keyword">from</span> a <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> b <span class="hljs-keyword">on</span> a.id=b.id <span class="hljs-keyword">and</span> a.type=<span class="hljs-string">'a'</span>;
</code></pre>
<table class="table">
<thead>
<tr>
<th>a.id</th>
<th>a.type</th>
<th>b.id</th>
<th>b.class</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
<td>1</td>
<td>aa</td>
</tr>
<tr>
<td>2</td>
<td>a</td>
<td>2</td>
<td>bb</td>
</tr>
<tr>
<td>3</td>
<td>b</td>
<td></td>
</tr>
</tbody>
</table>
</li>
<li><p>使用<code>a left join b</code>+<code>and b</code></p>
<pre><code class="nullsql"> <span class="hljs-keyword">select</span> a.*,b.* <span class="hljs-keyword">from</span> a <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> b <span class="hljs-keyword">on</span> a.id=b.id <span class="hljs-keyword">and</span> b.class=<span class="hljs-string">'aa'</span>
</code></pre>
<table class="table">
<thead>
<tr>
<th>a.id</th>
<th>a.type</th>
<th>b.id</th>
<th>b.class</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
<td>1</td>
<td>aa</td>
</tr>
<tr>
<td>2</td>
<td>a</td>
<td></td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>b</td>
<td></td>
</tr>
</tbody>
</table>
</li>
<li><p>使用<code>left join</code>+<code>where</code></p>
<pre><code class="nullsql"> <span class="hljs-keyword">select</span> a.*,b.* <span class="hljs-keyword">from</span> a <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> b <span class="hljs-keyword">on</span> a.id=b.id <span class="hljs-keyword">where</span> a.type=<span class="hljs-string">'a'</span>;
</code></pre>
<table class="table">
<thead>
<tr>
<th>a.id</th>
<th>a.type</th>
<th>b.id</th>
<th>b.class</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
<td>1</td>
<td>aa</td>
</tr>
<tr>
<td>2</td>
<td>a</td>
<td>2</td>
<td>bb</td>
</tr>
</tbody>
</table>
</li>
<li><p>使用<code>inner join</code></p>
<pre><code class="nullsql"> <span class="hljs-keyword">select</span> a.*, b.* <span class="hljs-keyword">from</span> a <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> b <span class="hljs-keyword">on</span> a.id = b.id <span class="hljs-keyword">and</span> a.type = <span class="hljs-string">'a'</span>;
 <span class="hljs-keyword">select</span> a.*, b.* <span class="hljs-keyword">from</span> a <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> b <span class="hljs-keyword">on</span> a.id = b.id <span class="hljs-keyword">where</span> a.type = <span class="hljs-string">'a'</span>;
 <span class="hljs-keyword">select</span> a.*, b.* <span class="hljs-keyword">from</span> a, b <span class="hljs-keyword">where</span> a.id = b.id <span class="hljs-keyword">and</span> a.type = <span class="hljs-string">'a'</span>;
</code></pre>
<table class="table">
<thead>
<tr>
<th>a.id</th>
<th>a.type</th>
<th>b.id</th>
<th>b.class</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
<td>1</td>
<td>aa</td>
</tr>
<tr>
<td>2</td>
<td>a</td>
<td>2</td>
<td>bb</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h3 id="header-2">rownum,rowid</h3>
<p>（MySQL无rownum和rowid）</p>
<table class="table">
<thead>
<tr>
<th>rownum</th>
<th>rowid</th>
</tr>
</thead>
<tbody>
<tr>
<td>行数/行号</td>
<td>编码/编号/唯一识别号 （类似“AAAR8g…K”16进制的地址）</td>
</tr>
<tr>
<td>根据sql查询后得到的结果自动加上去的</td>
<td>录入数据时有数据库自动为这条记录添加的唯一的18位编号</td>
</tr>
<tr>
<td>不受order by排序的影响</td>
<td>不会随着查询而改变的</td>
</tr>
</tbody>
</table>
<p>注意：</p>
<ul>
<li>都是伪列（可以理解成表中的一个列，但并不是你创建的）</li>
<li>如果想让<code>rownum</code> 和<code>order by</code>一样的顺序 那么可以使用子查询：<pre><code class="nullsql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">rownum</span>,t.* <span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> table1 <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> col1) t
</code></pre>
</li>
</ul>
<h3 id="header-3">row_number,dense_rank,rank</h3>
<ul>
<li><code>row_number() over</code> : 排名顺序递增（相同记录排名不同）</li>
<li><code>dense_rank()</code> : 排名顺序递增 （相同记录排名相同）</li>
<li><code>rank()</code>：排名跳跃递增（相同记录排名相同， 在下一条不同记录间空出排名）</li>
<li>注意：都是函数，返回一个值</li>
</ul>
<p><code>row_number() over</code> 使用示例：</p>
<table class="table">
<thead>
<tr>
<th>empid</th>
<th>deptid</th>
<th>salary</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>10</td>
<td>5500.00</td>
</tr>
<tr>
<td>2</td>
<td>10</td>
<td>4500.00</td>
</tr>
<tr>
<td>3</td>
<td>20</td>
<td>1900.00</td>
</tr>
<tr>
<td>4</td>
<td>20</td>
<td>4800.00</td>
</tr>
<tr>
<td>5</td>
<td>40</td>
<td>6500.00</td>
</tr>
<tr>
<td>6</td>
<td>40</td>
<td>14500.00</td>
</tr>
<tr>
<td>7</td>
<td>40</td>
<td>44500.00</td>
</tr>
<tr>
<td>8</td>
<td>50</td>
<td>6500.00</td>
</tr>
<tr>
<td>9</td>
<td>50</td>
<td>7500.00</td>
</tr>
</tbody>
</table>
<pre><code class="nullsql"><span class="hljs-keyword">SELECT</span> 
t.*, 
Row_Number() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> deptid <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">desc</span>) rownumber 
<span class="hljs-keyword">FROM</span> employee t
</code></pre>
<table class="table">
<thead>
<tr>
<th>empid</th>
<th>deptid</th>
<th>salary</th>
<th>rownumber</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>10</td>
<td>5500.00</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>10</td>
<td>4500.00</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>20</td>
<td>1900.00</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>20</td>
<td>4800.00</td>
<td>2</td>
</tr>
<tr>
<td>5</td>
<td>40</td>
<td>6500.00</td>
<td>1</td>
</tr>
<tr>
<td>6</td>
<td>40</td>
<td>14500.00</td>
<td>2</td>
</tr>
<tr>
<td>7</td>
<td>40</td>
<td>44500.00</td>
<td>3</td>
</tr>
<tr>
<td>9</td>
<td>50</td>
<td>7500.00</td>
<td>1</td>
</tr>
<tr>
<td>8</td>
<td>50</td>
<td>6500.00</td>
<td>2</td>
</tr>
</tbody>
</table>
<h3 id="header-4">重复记录</h3>
<ol>
<li><p>查找表中重复记录 （使用<code>count(?)&gt;1</code>）</p>
<pre><code class="nullsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> employee
<span class="hljs-keyword">where</span> deptid <span class="hljs-keyword">in</span> (
 <span class="hljs-keyword">select</span> deptid
 <span class="hljs-keyword">from</span> employee
 <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptid
 <span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(deptid) &gt; <span class="hljs-number">1</span>
)
</code></pre>
</li>
<li><p>找表中非重复记录（使用<code>count(?)=1</code>或<code>distinct</code>）</p>
<pre><code class="nullsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> employee
<span class="hljs-keyword">where</span> deptid <span class="hljs-keyword">in</span> (
 <span class="hljs-keyword">select</span> deptid
 <span class="hljs-keyword">from</span> employee
 <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptid
 <span class="hljs-keyword">having</span> <span class="hljs-keyword">count</span>(deptid) =<span class="hljs-number">1</span>
)
</code></pre>
<pre><code class="nullsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> employee
<span class="hljs-keyword">where</span> deptid <span class="hljs-keyword">in</span> (
 <span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> deptid
 <span class="hljs-keyword">from</span> employee
)
</code></pre>
</li>
<li>让表中存在的重复记录只留一条<ul>
<li>使用<code>group by</code><pre><code class="nullsql"><span class="hljs-keyword">SELECT</span> deptid,<span class="hljs-keyword">max</span>(salary) <span class="hljs-keyword">FROM</span> employee <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptid
</code></pre>
</li>
<li>使用<code>row_number() over</code><pre><code class="nullsql"><span class="hljs-keyword">select</span> * 
<span class="hljs-keyword">from</span> ( 
  <span class="hljs-keyword">select</span> 
  Row_Number() <span class="hljs-keyword">over</span>(<span class="hljs-keyword">partition</span> <span class="hljs-keyword">by</span> deptid <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> salary) <span class="hljs-keyword">rank</span>,
  t.*
  <span class="hljs-keyword">from</span> employee t
)
<span class="hljs-keyword">where</span> <span class="hljs-keyword">rank</span> = <span class="hljs-number">1</span>
</code></pre>
</li>
<li>使用<code>rownum</code> （效率低）<pre><code class="nullsql"><span class="hljs-keyword">select</span> * 
<span class="hljs-keyword">from</span> employee t
<span class="hljs-keyword">where</span> <span class="hljs-keyword">rownum</span> <span class="hljs-keyword">in</span>  (
  <span class="hljs-keyword">select</span> <span class="hljs-keyword">max</span>(<span class="hljs-keyword">rownum</span>) <span class="hljs-keyword">from</span> employee b <span class="hljs-keyword">where</span> t.id = b.id <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> deptid
)
</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="header-5">行列转换</h3>
<p>示例1：</p>
<table class="table">
<thead>
<tr>
<th>日期</th>
<th>结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>2005-5-9</td>
<td>胜</td>
</tr>
<tr>
<td>2005-5-9</td>
<td>胜</td>
</tr>
<tr>
<td>2005-5-9</td>
<td>负</td>
</tr>
<tr>
<td>2005-5-9</td>
<td>负</td>
</tr>
<tr>
<td>2005-5-10</td>
<td>胜</td>
</tr>
<tr>
<td>2005-5-10</td>
<td>负</td>
</tr>
<tr>
<td>2005-5-10</td>
<td>负</td>
</tr>
</tbody>
</table>
<p>=&gt; </p>
<table class="table">
<thead>
<tr>
<th>日期</th>
<th>胜</th>
<th>负</th>
</tr>
</thead>
<tbody>
<tr>
<td>2005-5-9</td>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>2005-5-10</td>
<td>1</td>
<td>2</td>
</tr>
</tbody>
</table>
<ol>
<li><p>使用<code>distinct</code> +<code>left join</code></p>
<pre><code class="nullsql"><span class="hljs-keyword">select</span> A.date0, B.win, C.lost <span class="hljs-keyword">from</span>
 (<span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">as</span> date0 <span class="hljs-keyword">from</span> Table1) A
 <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span>  
 (<span class="hljs-keyword">select</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">as</span> date0,<span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">as</span> win <span class="hljs-keyword">from</span> Table1 <span class="hljs-keyword">where</span> rst=<span class="hljs-string">'win'</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span>) B
 <span class="hljs-keyword">on</span> A.date0=B.date0
 <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span>  
 (<span class="hljs-keyword">select</span> <span class="hljs-built_in">date</span> <span class="hljs-keyword">as</span> date0,<span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">as</span> lost <span class="hljs-keyword">from</span> Table1 <span class="hljs-keyword">where</span> rst=<span class="hljs-string">'lost'</span> <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-built_in">date</span>) C
 <span class="hljs-keyword">on</span> A.date0=C.date0
</code></pre>
</li>
<li><p>使用<code>sum</code>+<code>case when</code>+<code>count</code></p>
<pre><code class="nullsql"><span class="hljs-keyword">select</span> 日期 ,<span class="hljs-keyword">sum</span>(结果<span class="hljs-number">1</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">'胜'</span>,<span class="hljs-keyword">sum</span>(结果<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">'负'</span>
<span class="hljs-keyword">from</span> (
 <span class="hljs-keyword">select</span> 日期,
  <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> 结果=<span class="hljs-string">'胜'</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">count</span>(结果) <span class="hljs-keyword">end</span> <span class="hljs-keyword">AS</span> 结果<span class="hljs-number">1</span>, 
  <span class="hljs-keyword">case</span> <span class="hljs-keyword">when</span> 结果=<span class="hljs-string">'负'</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">count</span>(结果)  <span class="hljs-keyword">end</span> <span class="hljs-keyword">AS</span> 结果<span class="hljs-number">2</span> 
  <span class="hljs-keyword">from</span> table_1 
  <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> 日期,结果
) a
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> 日期
<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> 日期 <span class="hljs-keyword">desc</span>
</code></pre>
</li>
<li><p>使用<code>sum</code>+<code>case when</code></p>
<pre><code class="nullsql"><span class="hljs-keyword">select</span> 日期,
<span class="hljs-keyword">sum</span>(<span class="hljs-keyword">case</span> 结果 <span class="hljs-keyword">when</span> <span class="hljs-string">'胜'</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">'胜'</span>,
<span class="hljs-keyword">sum</span>(<span class="hljs-keyword">case</span> 结果 <span class="hljs-keyword">when</span> <span class="hljs-string">'负'</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) <span class="hljs-keyword">as</span> <span class="hljs-string">'负'</span> 
<span class="hljs-keyword">from</span> t 
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> 日期
</code></pre>
</li>
</ol>
<p>示例2：</p>
<table class="table">
<thead>
<tr>
<th>Name</th>
<th>Subject</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>张三</td>
<td>语文　</td>
<td>　74</td>
</tr>
<tr>
<td>张三</td>
<td>数学　</td>
<td>　83</td>
</tr>
<tr>
<td>张三</td>
<td>物理　</td>
<td>　93</td>
</tr>
<tr>
<td>李四</td>
<td>语文　</td>
<td>　74</td>
</tr>
<tr>
<td>李四</td>
<td>数学　</td>
<td>　84</td>
</tr>
<tr>
<td>李四</td>
<td>物理　</td>
<td>　94</td>
</tr>
</tbody>
</table>
<p>=&gt;</p>
<table class="table">
<thead>
<tr>
<th>姓名</th>
<th>语文</th>
<th>数学</th>
<th>物理</th>
<th>平均分</th>
<th>总分</th>
</tr>
</thead>
<tbody>
<tr>
<td>李四</td>
<td>74</td>
<td>84</td>
<td>94</td>
<td>84.00</td>
<td>252</td>
</tr>
<tr>
<td>张三</td>
<td>74</td>
<td>83</td>
<td>93</td>
<td>83.33</td>
<td>250</td>
</tr>
</tbody>
</table>
<pre><code class="nullsql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">name</span> 姓名,
  <span class="hljs-keyword">max</span>(<span class="hljs-keyword">case</span> subject <span class="hljs-keyword">when</span> <span class="hljs-string">'语文'</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">result</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) 语文,
  <span class="hljs-keyword">max</span>(<span class="hljs-keyword">case</span> subject <span class="hljs-keyword">when</span> <span class="hljs-string">'数学'</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">result</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) 数学,
  <span class="hljs-keyword">max</span>(<span class="hljs-keyword">case</span> subject <span class="hljs-keyword">when</span> <span class="hljs-string">'物理'</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">result</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span> <span class="hljs-keyword">end</span>) 物理,
  <span class="hljs-keyword">cast</span>(<span class="hljs-keyword">avg</span>(<span class="hljs-keyword">result</span>*<span class="hljs-number">1.0</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">decimal</span>(<span class="hljs-number">18</span>,<span class="hljs-number">2</span>)) 平均分,
  <span class="hljs-keyword">sum</span>(<span class="hljs-keyword">result</span>) 总分
<span class="hljs-keyword">from</span> tb
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> <span class="hljs-keyword">name</span>
</code></pre>
<h3 id="header-6">分页</h3>
<ol>
<li><p>使用<code>top</code>+<code>not in</code> :</p>
<pre><code class="nullsql"><span class="hljs-keyword">SELECT</span> TOP 页大小 *
<span class="hljs-keyword">FROM</span> table1
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (
 <span class="hljs-keyword">SELECT</span> TOP 页大小*(页数<span class="hljs-number">-1</span>) <span class="hljs-keyword">id</span> <span class="hljs-keyword">FROM</span> table1 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span> 
)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span>
</code></pre>
</li>
<li><p>使用<code>top</code>+<code>&gt;</code>+<code>max(id)</code>：</p>
<pre><code class="nullsql"><span class="hljs-keyword">SELECT</span> TOP 页大小 *
<span class="hljs-keyword">FROM</span> table1
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">id</span> &gt; (
<span class="hljs-keyword">SELECT</span> 
<span class="hljs-keyword">ISNULL</span>(<span class="hljs-keyword">MAX</span>(<span class="hljs-keyword">id</span>),<span class="hljs-number">0</span>) 
<span class="hljs-keyword">FROM</span> ( <span class="hljs-keyword">SELECT</span> TOP 页大小*(页数<span class="hljs-number">-1</span>) <span class="hljs-keyword">id</span> <span class="hljs-keyword">FROM</span> table1 <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span> ) A
)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span>
</code></pre>
</li>
<li><p>使用<code>row_number() over</code>：</p>
<pre><code class="nullsql"><span class="hljs-keyword">SELECT</span> TOP 页大小 *
<span class="hljs-keyword">FROM</span> (  
 <span class="hljs-keyword">SELECT</span> ROW_NUMBER() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">id</span>) <span class="hljs-keyword">AS</span> rownumber,* <span class="hljs-keyword">FROM</span> table1) A
<span class="hljs-keyword">WHERE</span> rownumber &gt; 页大小*(页数<span class="hljs-number">-1</span>)
</code></pre>
</li>
<li><p>使用<code>rownum</code></p>
<pre><code class="nullsql"><span class="hljs-keyword">SELECT</span> * 
<span class="hljs-keyword">FROM</span> (
 <span class="hljs-keyword">SELECT</span> a.*, <span class="hljs-keyword">ROWNUM</span> rn
 <span class="hljs-keyword">FROM</span> (
     <span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> t_employees <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_name) a
 <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">ROWNUM</span> &lt;= <span class="hljs-number">500</span>
)
<span class="hljs-keyword">WHERE</span> rn &gt; <span class="hljs-number">480</span>
</code></pre>
</li>
</ol>
<p><strong>PS：</strong> Mysql分页</p>
<pre><code class="nullsql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> tableName <span class="hljs-keyword">where</span> 条件 <span class="hljs-keyword">limit</span> (当前页码<span class="hljs-number">-1</span>)*页面容量 , 页面容量
</code></pre>
<h3 id="header-7">合并多行记录</h3>
<table class="table">
<thead>
<tr>
<th>a</th>
<th>b</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>2</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>=&gt;</p>
<table class="table">
<thead>
<tr>
<th>a</th>
<th>b</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1,2,3</td>
</tr>
<tr>
<td>2</td>
<td>1,2</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
</tr>
</tbody>
</table>
<ol>
<li><p>创建一个合并的函数:</p>
<pre><code class="nullsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> f_hb(@a <span class="hljs-built_in">int</span>)
<span class="hljs-keyword">returns</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">8000</span>)
<span class="hljs-keyword">as</span>
<span class="hljs-keyword">begin</span>
<span class="hljs-keyword">declare</span> @<span class="hljs-keyword">str</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">8000</span>)
<span class="hljs-keyword">set</span> @<span class="hljs-keyword">str</span> = <span class="hljs-string">''</span>
<span class="hljs-keyword">select</span> @<span class="hljs-keyword">str</span> = @<span class="hljs-keyword">str</span> + <span class="hljs-string">','</span> + <span class="hljs-keyword">cast</span>(b <span class="hljs-keyword">as</span> <span class="hljs-built_in">varchar</span>) <span class="hljs-keyword">from</span> tb <span class="hljs-keyword">where</span> a = @a 
<span class="hljs-keyword">set</span> @<span class="hljs-keyword">str</span> = <span class="hljs-keyword">right</span>(@<span class="hljs-keyword">str</span> , <span class="hljs-keyword">len</span>(@<span class="hljs-keyword">str</span>) - <span class="hljs-number">1</span>)
<span class="hljs-keyword">return</span>(@<span class="hljs-keyword">str</span>)
<span class="hljs-keyword">End</span>
<span class="hljs-keyword">go</span>
</code></pre>
</li>
<li><p>调用自定义函数:</p>
<pre><code class="nullsql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> a ,f_hb(a) <span class="hljs-keyword">as</span> b <span class="hljs-keyword">from</span> tb
</code></pre>
</li>
</ol>
<p><strong>扩展：</strong></p>
<ul>
<li>Oracle <code>wmsys.wm_concat</code>函数 （10g引入）</li>
<li>SQL Server <code>pivot</code>行转列函数，<code>unpivot</code>列转行函数，<code>xml</code>方式（2005引入）</li>
</ul>
  </section>
</article>

      <hr/>
      
<section class="post-comment">
	
		<div id="gitment_container"></div>

<link rel="stylesheet" href="/gitment/default.css">
<script src="/gitment/gitment.browser.js"></script>


<script type="text/javascript">
	var gitment = new Gitment({
	  id: document.location.pathname,
	  owner: 'sixDegree',
	  repo: 'blogComment',
	  oauth: {
	    client_id: '36a09bb7399efe69c6ce',
	    client_secret: 'ad9ad546b23b708c71d92e513dc36e0486179dea',
	  }
	})
	gitment.render('gitment_container')
</script>
	
</section>

    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/highlight/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  
  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
