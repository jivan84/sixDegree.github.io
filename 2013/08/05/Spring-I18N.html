<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spring应用之I18N</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="spring,i18n,local,internationalization">
  
  
    <meta name="description" content="Spring Basic Introduce">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
    <link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">Resource文件</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">Locale解析器</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">Local拦截器</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">前端静态文字国际化</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">后端动态信息国际化</span></a></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">Spring应用之I18N</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2013-08-04T16:00:00.000Z">2013-08-05</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-Java">Java</a>
          
            <a href="/tags.html#tag-Spring">Spring</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h3 id="header-1">Resource文件</h3>
<ol>
<li><p>Register MessageSource</p>
<pre><code class="nullxml"> <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"messageSource"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.context.support.ResourceBundleMessageSource"</span> &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"basename"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"message"</span> /&gt;</span>  <span class="hljs-comment">&lt;!-- messages是配置文件的前缀 --&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span> &gt;</span>
</code></pre>
</li>
<li><p>定义国际化需要的资源文件（置于classpath下），例如：</p>
<ul>
<li>message.properties文件 （默认）<pre><code>  language.cn=English
  menu.title=Menu
  ctrl.req.fail=Operate[{0}] request[ {1}] fail
</code></pre></li>
<li>message_zh_CN.properties文件<pre><code>  language.en=英文
  menu.title=菜单
  ctrl.req.fail=操作{0}需求 {1}失败
</code></pre></li>
</ul>
</li>
</ol>
<p><strong>PS</strong><br>因为ApplicationContext也是MessageSource接口的实现，故可以直接调用getMessage()方法</p>
<h3 id="header-2">Locale解析器</h3>
<p><code>LocaleResolver</code>（本地化解析器），会自动解析用户的本地化信息（即Locale），实现类：</p>
<ul>
<li><code>AcceptHeaderLocaleResolver</code> ：检查请求中客户端浏览器发送的<code>accept-language</code>头信息,包含客户端操作系统的本地化信息</li>
<li><code>CookieLocaleResolver</code> ：检查客户端中的cookie是否包含本地化信息 ,若有就使用</li>
<li><code>SessionLocaleResolver</code> ：检查客户端中的session是否包含本地化信息,若有就使用</li>
<li><code>FixedLocaleResolver</code> ：返回一个固定的本地化信息,默认值为当前JVM的locale</li>
</ul>
<p>例如：</p>
<pre><code class="nullxml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span> =<span class="hljs-string">"localeResolver"</span> <span class="hljs-attr">class</span>= <span class="hljs-string">"org.springframework.web.servlet.i18n.SessionLocaleResolver"</span> &gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span> =<span class="hljs-string">"defaultLocale"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"zh_CN"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span> &gt;</span>
</code></pre>
<h3 id="header-3">Local拦截器</h3>
<p>Local拦截器（可使用已有的，也可自定义处理）</p>
<p>例如：LocaleChangeInterceptor（拦截URL，获取Local参数值并进行本地化设置）</p>
<p>LocaleChangeInterceptor源码：</p>
<pre><code class="nulljava"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LocaleChangeInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HandlerInterceptorAdapter</span> </span>{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String DEFAULT_PARAM_NAME = <span class="hljs-string">"locale"</span>;
    <span class="hljs-keyword">private</span> String paramName = DEFAULT_PARAM_NAME;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setParamName</span><span class="hljs-params">(String paramName)</span> </span>{
        <span class="hljs-keyword">this</span>.paramName = paramName;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getParamName</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.paramName;
    }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span>
            <span class="hljs-keyword">throws</span> ServletException </span>{
        String newLocale = request.getParameter(<span class="hljs-keyword">this</span>.paramName);
        <span class="hljs-keyword">if</span> (newLocale != <span class="hljs-keyword">null</span>) {
            LocaleResolver localeResolver = RequestContextUtils.getLocaleResolver(request);
            <span class="hljs-keyword">if</span> (localeResolver == <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(<span class="hljs-string">"No LocaleResolver found: not in a DispatcherServlet request?"</span>);
            }
            localeResolver.setLocale(request, response, StringUtils.parseLocaleString(newLocale));
        }
        <span class="hljs-comment">// Proceed in any case.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }
}
</code></pre>
<p>配置使用：</p>
<pre><code class="nullxml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span> =<span class="hljs-string">"localeChangeInterceptor"</span> <span class="hljs-attr">class</span>= <span class="hljs-string">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span> &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span> =<span class="hljs-string">"paramName"</span> <span class="hljs-attr">value</span>= <span class="hljs-string">"language"</span> /&gt;</span> <span class="hljs-comment">&lt;!-- 对URL中paramName为language的进行处理（默认paramName为local） --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span> &gt;</span>

<span class="hljs-comment">&lt;!-- 加入Local拦截器 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptors</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"localeChangeInterceptor"</span>&gt;</span> <span class="hljs-comment">&lt;!-- 拦截所有的URL请求 --&gt;</span>
    <span class="hljs-comment">&lt;!--
    &lt;mvc:interceptor&gt;
      &lt;mvc:mapping path="/**" /&gt;
      &lt;mvc:exclude-mapping path="/resources/**"/&gt;
      &lt;bean ref="localeChangeInterceptor"/&gt;
    &lt;/mvc:interceptor&gt; --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptors</span>&gt;</span>
</code></pre>
<h3 id="header-4">前端静态文字国际化</h3>
<p>使用<code>&lt;spring:message&gt;</code></p>
<pre><code class="nullhtml"><span class="hljs-tag">&lt;<span class="hljs-name">%@taglib</span> <span class="hljs-attr">prefix</span>= <span class="hljs-string">"spring"</span> <span class="hljs-attr">uri</span> =<span class="hljs-string">"http://www.springframework.org/tags"</span> %&gt;</span>     

<span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span> =<span class="hljs-string">"?language=en"</span>&gt;</span><span class="hljs-tag">&lt; <span class="hljs-attr">spring:message</span> <span class="hljs-attr">code</span> =<span class="hljs-string">"language.en"</span> <span class="hljs-attr">text</span> =<span class="hljs-string">"English"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span> =<span class="hljs-string">"?language=zh_CN"</span>&gt;</span><span class="hljs-tag">&lt; <span class="hljs-attr">spring:message</span> <span class="hljs-attr">code</span> =<span class="hljs-string">"language.cn"</span> <span class="hljs-attr">text</span>= <span class="hljs-string">"Chinese"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>

MenuText : <span class="hljs-tag">&lt;<span class="hljs-name">spring:message</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"menu.title"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"default text"</span> /&gt;</span>
CurrentLocale : ${pageContext.response.locale}
</code></pre>
<h3 id="header-5">后端动态信息国际化</h3>
<pre><code class="nulljava">RequestContext requestContext = <span class="hljs-keyword">new</span> RequestContext(request);
Locale myLocale = requestContext.getLocale();
System.out.println(<span class="hljs-string">"-------------------------------------"</span>);
System.out.println(myLocale);
System.out.println(requestContext.getMessage(<span class="hljs-string">"menu.title"</span>));
System.out.println(requestContext.getMessage(<span class="hljs-string">"ctrl.auth.fail"</span>,<span class="hljs-keyword">new</span> Object[]{<span class="hljs-string">"Add"</span>,<span class="hljs-string">"R028394"</span>},<span class="hljs-string">"Operate Fail"</span>));
</code></pre>
  </section>
</article>

      <hr/>
      
<section class="post-comment">
	
		<div id="gitment_container"></div>

<link rel="stylesheet" href="/gitment/default.css">
<script src="/gitment/gitment.browser.js"></script>


<script type="text/javascript">
	var gitment = new Gitment({
	  id: 'Test',
	  owner: 'chenjin-zero',
	  repo: 'blogComment',
	  oauth: {
	    client_id: '36a09bb7399efe69c6ce',
	    client_secret: 'ad9ad546b23b708c71d92e513dc36e0486179dea',
	  }
	})

    // var gitment = new Gitment({
    //   id: 'gitment-introduction',
    //   title: 'Gitment：使用 GitHub Issues 搭建评论系统',
    //   owner: 'imsun',
    //   repo: 'imsun.net',
    //   oauth: {
    //     client_id: '4ce2737289ce197769a1',
    //     client_secret: '3731a9d6ff407355af912ea7a86dd0dd772ca84d',
    //   },
    // })
      
	gitment.render('gitment_container')
</script>
	
</section>

    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/highlight/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  
  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
