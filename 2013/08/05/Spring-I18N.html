<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spring应用之I18N</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="spring,i18n,local,internationalization">
  
  
    <meta name="description" content="Spring Basic Introduce">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
    <link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">Resource文件</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">Locale解析器</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">Local拦截器</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">前端静态文字国际化</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">后端动态信息国际化</span></a></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">Spring应用之I18N</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2013-08-04T16:00:00.000Z">2013-08-05</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-Java">Java</a>
          
            <a href="/tags.html#tag-Spring">Spring</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h3 id="header-1">Resource文件</h3>
<ol>
<li><p>Register MessageSource</p>
<pre><code class="nullxml"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"messageSource"</span> <span class="attr">class</span>=<span class="string">"org.springframework.context.support.ResourceBundleMessageSource"</span> &gt;</span>
      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basename"</span> <span class="attr">value</span>=<span class="string">"message"</span> /&gt;</span>  <span class="comment">&lt;!-- messages是配置文件的前缀 --&gt;</span>
 <span class="tag">&lt;/<span class="name">bean</span> &gt;</span>
</code></pre>
</li>
<li><p>定义国际化需要的资源文件（置于classpath下），例如：</p>
<ul>
<li>message.properties文件 （默认）<pre><code>  language.cn=English
  menu.title=Menu
  ctrl.req.fail=Operate[{0}] request[ {1}] fail
</code></pre></li>
<li>message_zh_CN.properties文件<pre><code>  language.en=英文
  menu.title=菜单
  ctrl.req.fail=操作{0}需求 {1}失败
</code></pre></li>
</ul>
</li>
</ol>
<p><strong>PS</strong><br>因为ApplicationContext也是MessageSource接口的实现，故可以直接调用getMessage()方法</p>
<h3 id="header-2">Locale解析器</h3>
<p><code>LocaleResolver</code>（本地化解析器），会自动解析用户的本地化信息（即Locale），实现类：</p>
<ul>
<li><code>AcceptHeaderLocaleResolver</code> ：检查请求中客户端浏览器发送的<code>accept-language</code>头信息,包含客户端操作系统的本地化信息</li>
<li><code>CookieLocaleResolver</code> ：检查客户端中的cookie是否包含本地化信息 ,若有就使用</li>
<li><code>SessionLocaleResolver</code> ：检查客户端中的session是否包含本地化信息,若有就使用</li>
<li><code>FixedLocaleResolver</code> ：返回一个固定的本地化信息,默认值为当前JVM的locale</li>
</ul>
<p>例如：</p>
<pre><code class="nullxml"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> =<span class="string">"localeResolver"</span> <span class="attr">class</span>= <span class="string">"org.springframework.web.servlet.i18n.SessionLocaleResolver"</span> &gt;</span>
     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span> =<span class="string">"defaultLocale"</span> <span class="attr">value</span>=<span class="string">"zh_CN"</span> /&gt;</span>
<span class="tag">&lt;/<span class="name">bean</span> &gt;</span>
</code></pre>
<h3 id="header-3">Local拦截器</h3>
<p>Local拦截器（可使用已有的，也可自定义处理）</p>
<p>例如：LocaleChangeInterceptor（拦截URL，获取Local参数值并进行本地化设置）</p>
<p>LocaleChangeInterceptor源码：</p>
<pre><code class="nulljava"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocaleChangeInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>{
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PARAM_NAME = <span class="string">"locale"</span>;
    <span class="keyword">private</span> String paramName = DEFAULT_PARAM_NAME;
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParamName</span><span class="params">(String paramName)</span> </span>{
        <span class="keyword">this</span>.paramName = paramName;
    }
    <span class="function"><span class="keyword">public</span> String <span class="title">getParamName</span><span class="params">()</span> </span>{
        <span class="keyword">return</span> <span class="keyword">this</span>.paramName;
    }
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span>
            <span class="keyword">throws</span> ServletException </span>{
        String newLocale = request.getParameter(<span class="keyword">this</span>.paramName);
        <span class="keyword">if</span> (newLocale != <span class="keyword">null</span>) {
            LocaleResolver localeResolver = RequestContextUtils.getLocaleResolver(request);
            <span class="keyword">if</span> (localeResolver == <span class="keyword">null</span>) {
                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"No LocaleResolver found: not in a DispatcherServlet request?"</span>);
            }
            localeResolver.setLocale(request, response, StringUtils.parseLocaleString(newLocale));
        }
        <span class="comment">// Proceed in any case.</span>
        <span class="keyword">return</span> <span class="keyword">true</span>;
    }
}
</code></pre>
<p>配置使用：</p>
<pre><code class="nullxml"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span> =<span class="string">"localeChangeInterceptor"</span> <span class="attr">class</span>= <span class="string">"org.springframework.web.servlet.i18n.LocaleChangeInterceptor"</span> &gt;</span>
    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span> =<span class="string">"paramName"</span> <span class="attr">value</span>= <span class="string">"language"</span> /&gt;</span> <span class="comment">&lt;!-- 对URL中paramName为language的进行处理（默认paramName为local） --&gt;</span>
<span class="tag">&lt;/<span class="name">bean</span> &gt;</span>

<span class="comment">&lt;!-- 加入Local拦截器 --&gt;</span>
<span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">ref</span>=<span class="string">"localeChangeInterceptor"</span>&gt;</span> <span class="comment">&lt;!-- 拦截所有的URL请求 --&gt;</span>
    <span class="comment">&lt;!--
    &lt;mvc:interceptor&gt;
      &lt;mvc:mapping path="/**" /&gt;
      &lt;mvc:exclude-mapping path="/resources/**"/&gt;
      &lt;bean ref="localeChangeInterceptor"/&gt;
    &lt;/mvc:interceptor&gt; --&gt;</span>
<span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span>
</code></pre>
<h3 id="header-4">前端静态文字国际化</h3>
<p>使用<code>&lt;spring:message&gt;</code></p>
<pre><code class="nullhtml"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">prefix</span>= <span class="string">"spring"</span> <span class="attr">uri</span> =<span class="string">"http://www.springframework.org/tags"</span> %&gt;</span>     

<span class="tag">&lt;<span class="name">li</span>&gt;</span>
     <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> =<span class="string">"?language=en"</span>&gt;</span><span class="tag">&lt; <span class="attr">spring:message</span> <span class="attr">code</span> =<span class="string">"language.en"</span> <span class="attr">text</span> =<span class="string">"English"</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>
<span class="tag">&lt;/<span class="name">li</span>&gt;</span>
<span class="tag">&lt;<span class="name">li</span>&gt;</span>
     <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> =<span class="string">"?language=zh_CN"</span>&gt;</span><span class="tag">&lt; <span class="attr">spring:message</span> <span class="attr">code</span> =<span class="string">"language.cn"</span> <span class="attr">text</span>= <span class="string">"Chinese"</span> /&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span>
<span class="tag">&lt;/<span class="name">li</span>&gt;</span>

MenuText : <span class="tag">&lt;<span class="name">spring:message</span> <span class="attr">code</span>=<span class="string">"menu.title"</span> <span class="attr">text</span>=<span class="string">"default text"</span> /&gt;</span>
CurrentLocale : ${pageContext.response.locale}
</code></pre>
<h3 id="header-5">后端动态信息国际化</h3>
<pre><code class="nulljava">RequestContext requestContext = <span class="keyword">new</span> RequestContext(request);
Locale myLocale = requestContext.getLocale();
System.out.println(<span class="string">"-------------------------------------"</span>);
System.out.println(myLocale);
System.out.println(requestContext.getMessage(<span class="string">"menu.title"</span>));
System.out.println(requestContext.getMessage(<span class="string">"ctrl.auth.fail"</span>,<span class="keyword">new</span> Object[]{<span class="string">"Add"</span>,<span class="string">"R028394"</span>},<span class="string">"Operate Fail"</span>));
</code></pre>
  </section>
</article>

      <hr/>
      <section class="post-comment">
	<!-- disqus默认将数据加载到id为'disqus_thread'的容器中，可配置disqus_container_id改变-->
<div id="disqus_thread"> 
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

	<script type="text/javascript">
		var disqus_shortname = 'sixdegreespace'; 
		var disqus_identifier = '2013/08/05/Spring-I18N.html';	
		var disqus_title = 'Spring应用之I18N';
		var disqus_url = 'http://sixdegree.github.io/2013/08/05/Spring-I18N.html' ;
		//var disqus_category_id = '4262241'; 

		(function() {
		    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>


 
</section>
    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/highlight/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  
  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
