<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spring应用之整合(Security,MVC,Hibernate)</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="spring,security,mvc,hibernate">
  
  
    <meta name="description" content="Spring Integration Configuration">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
    <link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  

</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">Spring与Hibernate整合</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">事务的播特性</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">事务的隔离级别</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">声明式事务配置</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">综合示例(Security,MVC，Hibernate)</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-6"><span class="sidebar-nav nav-text">web.xml</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-7"><span class="sidebar-nav nav-text">beans.xml</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-8"><span class="sidebar-nav nav-text">xxx-servlet.xml</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-9"><span class="sidebar-nav nav-text">xxx-security.xml</span></a></li></ol></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">Spring应用之整合(Security,MVC,Hibernate)</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2013-07-31T16:00:00.000Z">2013-08-01</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-Java">Java</a>
          
            <a href="/tags.html#tag-Spring">Spring</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h2 id="header-1">Spring与Hibernate整合</h2>
<h3 id="header-2">事务的播特性</h3>
<ol>
<li><code>propagation_required</code>:使用当前事务，无则创建开启</li>
<li><code>propagation_supports</code>:使用当前事务，无则非事务执行</li>
<li><code>propagation_mandatory</code>:使用当前事务，无则抛出异常</li>
<li><code>propagation_requires_new</code>:当前事务挂起，开启一个新事务</li>
<li><code>propagation_not_supported</code>:挂起当前事务，非事务执行</li>
<li><code>propagation_never</code>:非事务执行，若存在一个活动事务，则抛出异常</li>
<li><code>propagation_nested</code>：Spring特有，运行在当前事务的嵌套事务中，无则同<code>propagation_required</code></li>
</ol>
<h3 id="header-3">事务的隔离级别</h3>
<ol>
<li><code>isolation_default</code>:Spring特有,使用后端数据库默认的隔离级别,另外四个与JDBC的隔离级别相对应</li>
<li><code>isolation_read_uncommitted</code>:允许其他事务看到当前事务未提交的数据，可能产生脏读，不可重复读和幻读（事务最低的隔离级别）</li>
<li><code>isolation_read_commited</code>:保证一个事务修改的数据提交后才能被另外一个事务读取</li>
<li><code>isolation_repeatable_read</code>:提交数据只读，防止脏读，不可重复读，但可能出现幻像读<br>5.<code>isolation_serializable</code>:事务被处理为顺序执行，防止脏读，不可重复读，幻读（花费代价最高，最可靠的事务隔离级别）</li>
</ol>
<h3 id="header-4">声明式事务配置</h3>
<ol>
<li>配置SessionFactory</li>
<li>配置事务管理器</li>
<li>事务的传播特性</li>
<li>那些类那些方法使用事务</li>
</ol>
<p>注意加入连接池依赖包：</p>
<pre><code class="nullxml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>
    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>
    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>
<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>
</code></pre>
<p>配置示例：</p>
<pre><code class="nullxml"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span>
<span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>
        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span>
        <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span>
        <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>
        <span class="attr">xsi:schemaLocation</span>=<span class="string">"
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
            http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd"</span>&gt;</span>

    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.golf"</span> /&gt;</span>
    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc-prod.properties"</span>/&gt;</span>

    <span class="comment">&lt;!-- dataSource --&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driverClassName}"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialSize"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"200"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"30"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWait"</span> <span class="attr">value</span>=<span class="string">"1000"</span>/&gt;</span>  
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"removeAbandoned"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>
        <span class="comment">&lt;!-- &lt;property name="logAbandoned" value="true"/&gt;   --&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"validationQuery"</span> <span class="attr">value</span>=<span class="string">"select 1 from dual"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>

    <span class="comment">&lt;!-- 配置sessionFactory  --&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.LocalSessionFactoryBean"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernateProperties"</span>&gt;</span>
            <span class="tag">&lt;<span class="name">props</span>&gt;</span>
                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>${hibernate.dialect}<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>
                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.id.new_generator_mappings"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>
                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>${hibernate.show.sql}<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>
                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>${hibernate.format.sql}<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>
                <span class="comment">&lt;!-- &lt;prop key="javax.persistence.validation.mode"&gt;none&lt;/prop&gt; --&gt;</span>
            <span class="tag">&lt;/<span class="name">props</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"packagesToScan"</span>&gt;</span>
            <span class="tag">&lt;<span class="name">list</span>&gt;</span>
                <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.golf.entity<span class="tag">&lt;/<span class="name">value</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">list</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>

    <span class="comment">&lt;!-- 声明式事务 --&gt;</span>
    <span class="comment">&lt;!-- 事务管理器 --&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"txManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.HibernateTransactionManager"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
    <span class="comment">&lt;!-- 事务的传播特性 --&gt;</span>
    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"txManager"</span> &gt;</span>
        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"list*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"detail*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span> /&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"test*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>  /&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"sendMail"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span> <span class="attr">no-rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"getGrantedAuthorities"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span>
    <span class="comment">&lt;!-- 参与事务的方法 --&gt;</span>
      <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>
        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.golf.service.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"mySearchService"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mySearchService"</span> <span class="attr">order</span>=<span class="string">"2"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span> 

    <span class="comment">&lt;!-- 声明式日志 --&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"loggerHandler"</span> <span class="attr">class</span>=<span class="string">"com.cj.support.aop.LoggerHandler"</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>
        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"loggerHandler"</span> <span class="attr">order</span>=<span class="string">"1"</span>&gt;</span> 
            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(public * com.golf.service.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"method"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"logAround"</span> <span class="attr">pointcut-ref</span>=<span class="string">"method"</span> /&gt;</span>
        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span>
<span class="tag">&lt;/<span class="name">beans</span>&gt;</span>
</code></pre>
<h2 id="header-5">综合示例(Security,MVC，Hibernate)</h2>
<p>这里项目名为<code>golf</code></p>
<p>注意加入这些框架的依赖包：</p>
<ul>
<li>Spring</li>
<li>SpringMVC</li>
<li>SpringSecurity</li>
<li>Hibernate</li>
</ul>
<h3 id="header-6">web.xml</h3>
<p>加载Spring&amp;SpringSecurity&amp;SpringMVC</p>
<pre><code class="nullxml"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span>
<span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xmlns:web</span>=<span class="string">"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span>

   <span class="tag">&lt;<span class="name">context-param</span>&gt;</span>
        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>
        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:beans.xml,classpath*:golf-security.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span>

    <span class="comment">&lt;!-- Spring --&gt;</span>
    <span class="tag">&lt;<span class="name">listener</span>&gt;</span>
        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span>
    <span class="comment">&lt;!-- Spring刷新Interceptor防止内存泄漏  --&gt;</span>
    <span class="tag">&lt;<span class="name">listener</span>&gt;</span>
        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.util.IntrospectorCleanupListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span>
    <span class="comment">&lt;!-- 设置session 超时时间为20分钟  --&gt;</span>
    <span class="tag">&lt;<span class="name">session-config</span>&gt;</span>
        <span class="tag">&lt;<span class="name">session-timeout</span>&gt;</span>60<span class="tag">&lt;/<span class="name">session-timeout</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">session-config</span>&gt;</span>
    <span class="comment">&lt;!--通过HttpSessionEventPublisher,让servelt容器通知Spring Security session生命周期的事--&gt;</span>
    <span class="tag">&lt;<span class="name">listener</span>&gt;</span>
        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.security.web.session.HttpSessionEventPublisher<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span>

  <span class="comment">&lt;!-- 使用Spring中的过滤器解决在请求和应答中的中文乱码问题 --&gt;</span>
    <span class="tag">&lt;<span class="name">filter</span>&gt;</span>
        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>
        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>
        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span>
            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span>
            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span>
    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>
        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>
        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>

   <span class="comment">&lt;!-- Spring Secutiry 过滤器链配置  --&gt;</span>
    <span class="tag">&lt;<span class="name">filter</span>&gt;</span>
        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>
        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span>
    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span>
        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>springSecurityFilterChain<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span>
        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span>

  <span class="comment">&lt;!-- Spring MVC --&gt;</span>
   <span class="tag">&lt;<span class="name">servlet</span>&gt;</span>
        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>golf<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>
        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span>
        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span>
    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span>
        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>golf<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span>
        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span>
<span class="tag">&lt;/<span class="name">web-app</span>&gt;</span>
</code></pre>
<h3 id="header-7">beans.xml</h3>
<p>配置Spring（加入Hibernate配置）</p>
<pre><code class="nullxml"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span>
<span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>
        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span>
        <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span>
        <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>
        <span class="attr">xmlns:jaxws</span>=<span class="string">"http://cxf.apache.org/jaxws"</span>
        <span class="attr">xmlns:cxf</span>=<span class="string">"http://cxf.apache.org/core"</span>
        <span class="attr">xmlns:task</span>=<span class="string">"http://www.springframework.org/schema/task"</span>
        <span class="attr">xsi:schemaLocation</span>=<span class="string">"
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
            http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
            http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
            http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd
            http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd"</span>&gt;</span>

    <span class="tag">&lt;<span class="name">task:annotation-driven</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>/&gt;</span>

    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span>
    <span class="comment">&lt;!-- scan排除Controller--&gt;</span>
    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.golf"</span> &gt;</span>
        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">"regex"</span> <span class="attr">expression</span>=<span class="string">"com.golf.controller.*"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span>
    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc-prod.properties"</span>/&gt;</span>

    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"${jdbc.driverClassName}"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"${jdbc.url}"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"${jdbc.username}"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"${jdbc.password}"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialSize"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span> <span class="attr">value</span>=<span class="string">"2"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"200"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"30"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWait"</span> <span class="attr">value</span>=<span class="string">"1000"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"removeAbandoned"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>
        <span class="comment">&lt;!-- &lt;property name="logAbandoned" value="true"/&gt;   --&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"validationQuery"</span> <span class="attr">value</span>=<span class="string">"select 1 from dual"</span>/&gt;</span> 
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"testOnBorrow"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>

    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.LocalSessionFactoryBean"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernateProperties"</span>&gt;</span>
            <span class="tag">&lt;<span class="name">props</span>&gt;</span>
                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>${hibernate.dialect}<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>
                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.id.new_generator_mappings"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>
                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>${hibernate.show.sql}<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>
                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>${hibernate.format.sql}<span class="tag">&lt;/<span class="name">prop</span>&gt;</span>
                <span class="comment">&lt;!-- &lt;prop key="javax.persistence.validation.mode"&gt;none&lt;/prop&gt; --&gt;</span>
            <span class="tag">&lt;/<span class="name">props</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"packagesToScan"</span>&gt;</span>
            <span class="tag">&lt;<span class="name">list</span>&gt;</span>
                <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.golf.entity<span class="tag">&lt;/<span class="name">value</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">list</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>

    <span class="comment">&lt;!-- 声明式事务 --&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"txManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate4.HibernateTransactionManager"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"txManager"</span> &gt;</span>
        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"list*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"get*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"detail*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span> /&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"test*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>  /&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"sendMail"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"true"</span> <span class="attr">no-rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"getGrantedAuthorities"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">read-only</span>=<span class="string">"false"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span>
     <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>
        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.golf.service.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"mySearchService"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"mySearchService"</span> <span class="attr">order</span>=<span class="string">"2"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span>

    <span class="comment">&lt;!-- 声明式日志 --&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"loggerHandler"</span> <span class="attr">class</span>=<span class="string">"com.cj.support.aop.LoggerHandler"</span>/&gt;</span>
    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>
        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"loggerHandler"</span> <span class="attr">order</span>=<span class="string">"1"</span>&gt;</span> 
            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(public * com.golf.service.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"method"</span>/&gt;</span>
            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"logAround"</span> <span class="attr">pointcut-ref</span>=<span class="string">"method"</span> /&gt;</span>
        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span>

    <span class="comment">&lt;!-- Jackson ObjectMapper --&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myObjectMapper"</span> <span class="attr">class</span>=<span class="string">"com.fasterxml.jackson.databind.ObjectMapper"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"serializationInclusion"</span>&gt;</span>
             <span class="tag">&lt;<span class="name">value</span> <span class="attr">type</span>=<span class="string">"com.fasterxml.jackson.annotation.JsonInclude.Include"</span>&gt;</span>NON_NULL<span class="tag">&lt;/<span class="name">value</span>&gt;</span>
         <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
<span class="tag">&lt;/<span class="name">beans</span>&gt;</span>
</code></pre>
<h3 id="header-8">xxx-servlet.xml</h3>
<p>配置SpringMVC</p>
<pre><code class="nullxml"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span>
<span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>
    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span>
    <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span>
    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>
    <span class="attr">xmlns:sec</span>=<span class="string">"http://www.springframework.org/schema/security"</span> 
    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd"</span>&gt;</span>

    <span class="comment">&lt;!-- 在Controlller中使用SpringSecurity SpEL注解，需配置：--&gt;</span>
    <span class="tag">&lt;<span class="name">sec:global-method-security</span> <span class="attr">pre-post-annotations</span>=<span class="string">"enabled"</span>/&gt;</span>

    <span class="comment">&lt;!-- 使用Spring MVC所提供的注解驱动特性 --&gt;</span>
    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span>
      <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span>
            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"</span>&gt;</span>
                 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"objectMapper"</span> <span class="attr">ref</span>=<span class="string">"myObjectMapper"</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span>

    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.golf.controller"</span> <span class="attr">use-default-filters</span>=<span class="string">"false"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.stereotype.Controller"</span>  /&gt;</span>
        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">"annotation"</span> <span class="attr">expression</span>=<span class="string">"org.springframework.web.bind.annotation.ControllerAdvice"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span>

    <span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span>
        <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span>
            <span class="comment">&lt;!-- &lt;mvc:mapping path="/**" /&gt;
            &lt;mvc:exclude-mapping path="/resources/**"/&gt; --&gt;</span>
            <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/api/**"</span> /&gt;</span>
            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.cj.support.interceptor.MyHandlerPaginationInterceptor"</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span>

    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/resources/"</span> <span class="attr">mapping</span>=<span class="string">"/resources/**"</span>/&gt;</span> <span class="comment">&lt;!-- 会建立一个服务于静态资源的处理器 --&gt;</span>
    <span class="comment">&lt;!-- Handler Static Resources: Order Last --&gt;</span>
    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span>

    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.ContentNegotiatingViewResolver"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mediaTypes"</span>&gt;</span>
            <span class="tag">&lt;<span class="name">map</span>&gt;</span>
                <span class="comment">&lt;!-- &lt;entry key="html" value="text/html"/&gt; --&gt;</span>
                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"json"</span> <span class="attr">value</span>=<span class="string">"application/json"</span>/&gt;</span>
            <span class="tag">&lt;/<span class="name">map</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
        <span class="comment">&lt;!-- &lt;property name="defaultContentType" value="text/html"/&gt; --&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"viewResolvers"</span>&gt;</span>
            <span class="tag">&lt;<span class="name">list</span>&gt;</span>
                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span>
                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"viewClass"</span> <span class="attr">value</span>=<span class="string">"org.springframework.web.servlet.view.JstlView"</span>/&gt;</span>
                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/"</span>/&gt;</span>
                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span>
                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> 
            <span class="tag">&lt;/<span class="name">list</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultViews"</span>&gt;</span>
            <span class="tag">&lt;<span class="name">list</span>&gt;</span>
                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.json.MappingJackson2JsonView"</span> &gt;</span>
                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"objectMapper"</span> <span class="attr">ref</span>=<span class="string">"myObjectMapper"</span> /&gt;</span>
                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
            <span class="tag">&lt;/<span class="name">list</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>

    <span class="comment">&lt;!-- Upload --&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"multipartResolver"</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxUploadSize"</span> <span class="attr">value</span>=<span class="string">"1000000"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
<span class="tag">&lt;/<span class="name">beans</span>&gt;</span>
</code></pre>
<h3 id="header-9">xxx-security.xml</h3>
<p>配置SpringSecurity: 这里使用UsernamePassword认证和ldap认证</p>
<pre><code class="nullxml"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span>
<span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span>
        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span>
        <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span>
        <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span>
        <span class="attr">xmlns:sec</span>=<span class="string">"http://www.springframework.org/schema/security"</span>
        <span class="attr">xsi:schemaLocation</span>=<span class="string">"
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
            http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
            http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd"</span>&gt;</span>

    <span class="tag">&lt;<span class="name">sec:http</span> <span class="attr">pattern</span>=<span class="string">"/resources/**"</span>  <span class="attr">security</span>=<span class="string">"none"</span>/&gt;</span>

    <span class="comment">&lt;!-- Golf Web Security --&gt;</span>
    <span class="tag">&lt;<span class="name">sec:http</span>  <span class="attr">auto-config</span>=<span class="string">"false"</span> <span class="attr">use-expressions</span>=<span class="string">"true"</span> <span class="attr">entry-point-authentication-manager-ref</span>=<span class="string">"myAuthenticationManager"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">sec:anonymous</span> <span class="attr">key</span>=<span class="string">"test"</span> <span class="attr">granted-authority</span>=<span class="string">"Guest"</span> <span class="attr">username</span>=<span class="string">"guest"</span>/&gt;</span>

        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/page-**/**"</span> <span class="attr">access</span>=<span class="string">"authenticated"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/admin-**/**"</span> <span class="attr">access</span>=<span class="string">"hasRole('Admin')"</span>/&gt;</span>

        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/api/payments"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">access</span>=<span class="string">"hasRole('RequestUser')"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/api/payments/*/payed"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">access</span>=<span class="string">"hasRole('Payment')"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/api/receivers"</span> <span class="attr">method</span>=<span class="string">"GET"</span> <span class="attr">access</span>=<span class="string">"hasAnyRole('RequestUser','Admin')"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/api/receipts"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">access</span>=<span class="string">"authenticated and authentication.extra.orgType=='LingShan'"</span>/&gt;</span>

        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/api/users/**"</span> <span class="attr">access</span>=<span class="string">"hasRole('Admin')"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/api/roles"</span> <span class="attr">access</span>=<span class="string">"hasRole('Admin')"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/api/receivers"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">access</span>=<span class="string">"hasRole('Admin')"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/api/receivers/*/*"</span> <span class="attr">method</span>=<span class="string">"GET"</span> <span class="attr">access</span>=<span class="string">"hasRole('Admin')"</span>/&gt;</span>

        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/api/**"</span> <span class="attr">access</span>=<span class="string">"authenticated"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/"</span> <span class="attr">access</span>=<span class="string">"permitAll"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/login"</span> <span class="attr">access</span>=<span class="string">"permitAll"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/auth"</span> <span class="attr">access</span>=<span class="string">"permitAll"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/**"</span> <span class="attr">access</span>=<span class="string">"hasRole('Admin')"</span>/&gt;</span>

        <span class="tag">&lt;<span class="name">sec:form-login</span> <span class="attr">login-processing-url</span>=<span class="string">"/api/j_spring_security_check"</span> <span class="attr">username-parameter</span>=<span class="string">"username"</span> <span class="attr">password-parameter</span>=<span class="string">"password"</span>
            <span class="attr">login-page</span>=<span class="string">"/login"</span> <span class="attr">authentication-failure-url</span>=<span class="string">"/auth?error=UnAuthenticated"</span> <span class="attr">default-target-url</span>=<span class="string">"/auth"</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">sec:logout</span> <span class="attr">logout-success-url</span>=<span class="string">"/auth"</span> <span class="attr">logout-url</span>=<span class="string">"/api/j_spring_security_logout"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">sec:session-management</span>&gt;</span>
            <span class="tag">&lt;<span class="name">sec:concurrency-control</span> <span class="attr">max-sessions</span>=<span class="string">"1"</span> <span class="attr">expired-url</span>= <span class="string">"/login?error=This session has been expired"</span>/&gt;</span>
        <span class="tag">&lt;/<span class="name">sec:session-management</span>&gt;</span>
        <span class="tag">&lt;<span class="name">sec:request-cache</span> <span class="attr">ref</span>=<span class="string">"nullRequestCache"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">sec:http</span>&gt;</span>

    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"nullRequestCache"</span> <span class="attr">class</span>=<span class="string">"org.springframework.security.web.savedrequest.NullRequestCache"</span>/&gt;</span>

    <span class="tag">&lt;<span class="name">sec:authentication-manager</span> <span class="attr">id</span>=<span class="string">"myAuthenticationManager"</span> &gt;</span>
        <span class="tag">&lt;<span class="name">sec:authentication-provider</span> <span class="attr">user-service-ref</span>=<span class="string">"myUserDetailsService"</span> /&gt;</span>
        <span class="tag">&lt;<span class="name">sec:authentication-provider</span> <span class="attr">ref</span>=<span class="string">"ldapAuthenticationProvider"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">sec:authentication-manager</span>&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myUserDetailsService"</span> <span class="attr">class</span>=<span class="string">"com.golf.service.MyUserDetailsService"</span>/&gt;</span>

     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ldapAuthenticationProvider"</span> <span class="attr">class</span>=<span class="string">"org.springframework.security.ldap.authentication.LdapAuthenticationProvider"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"authenticator"</span> <span class="attr">ref</span>=<span class="string">"bindAuthenticator"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"authoritiesPopulator"</span> <span class="attr">ref</span>=<span class="string">"ldapAuthoritiesPopulator"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bindAuthenticator"</span> <span class="attr">class</span>=<span class="string">"org.springframework.security.ldap.authentication.BindAuthenticator"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"contextSource"</span> <span class="attr">ref</span>=<span class="string">"ldapServer"</span>/&gt;</span>
        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userSearch"</span> <span class="attr">ref</span>=<span class="string">"ldapSearch"</span>&gt;</span>
        <span class="tag">&lt;/<span class="name">property</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ldapAuthoritiesPopulator"</span> <span class="attr">class</span>=<span class="string">"com.cj.support.security.ldap.MyLdapAuthoritiesPopulator"</span>/&gt;</span>

    <span class="comment">&lt;!-- Ldap Server &amp; Search Config --&gt;</span>
     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ldapSearch"</span> <span class="attr">class</span>=<span class="string">"org.springframework.security.ldap.search.FilterBasedLdapUserSearch"</span> &gt;</span>
      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"searchBase"</span> <span class="attr">value</span>=<span class="string">"ou=people"</span>/&gt;</span>   <span class="comment">&lt;!-- user-search-base --&gt;</span>
      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"searchFilter"</span> <span class="attr">value</span>=<span class="string">"(uid={0})"</span>/&gt;</span> <span class="comment">&lt;!-- user-search-filter --&gt;</span>
      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"contextSource"</span> <span class="attr">ref</span>=<span class="string">"ldapServer"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span>
    <span class="tag">&lt;<span class="name">sec:ldap-server</span> <span class="attr">id</span>=<span class="string">"ldapServer"</span> <span class="attr">url</span>=<span class="string">"ldap://xxxx/o=xxxx"</span>  /&gt;</span>
<span class="tag">&lt;/<span class="name">beans</span>&gt;</span>
</code></pre>
<pre><code class="nulljava"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUserDetailsService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span>
</span>{
    <span class="keyword">static</span> Logger logger = Logger.getLogger(GolfUserDetailsService.class);  
    <span class="keyword">private</span> ISecurityService securityService;
    <span class="function"><span class="keyword">public</span> ISecurityService <span class="title">getSecurityService</span><span class="params">()</span></span>{
        <span class="keyword">return</span> securityService;
    }
    <span class="meta">@Inject</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSecurityService</span><span class="params">(ISecurityService securityService)</span></span>{
        <span class="keyword">this</span>.securityService = securityService;
    }

    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String account)</span>
            <span class="keyword">throws</span> UsernameNotFoundException
    </span>{
        List&lt;GrantedAuthority&gt; glist=securityService.getGrantedAuthorities(account);
        <span class="keyword">if</span>(glist==<span class="keyword">null</span> || glist.size()==<span class="number">0</span>)
            <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">"No GrantedAuthority"</span>);
        SysUser user=(SysUser)securityService.getUser(account);
        <span class="keyword">if</span>(user!=<span class="keyword">null</span> )
            <span class="keyword">return</span> <span class="keyword">new</span> MyUser(account,user.getPwd(),glist); <span class="comment">//MyUser implements UserDetails</span>
        <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">"Not Found"</span>);
    }
}
</code></pre>
  </section>
</article>

      <hr/>
      <section class="post-comment">
	<!-- disqus默认将数据加载到id为'disqus_thread'的容器中，可配置disqus_container_id改变-->
<div id="disqus_thread"> 
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

	<script type="text/javascript">
		var disqus_shortname = 'sixdegreespace'; 
		var disqus_identifier = '2013/08/01/Spring-Security-MVC-Hibernate.html';	
		var disqus_title = 'Spring应用之整合(Security,MVC,Hibernate)';
		var disqus_url = 'http://sixdegree.github.io/2013/08/01/Spring-Security-MVC-Hibernate.html' ;
		//var disqus_category_id = '4262241'; 

		(function() {
		    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>


 
</section>
    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/highlight/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  
  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
