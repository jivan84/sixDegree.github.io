<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spring应用之ScheduleTask</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="spring,schedule,task,cronExpression">
  
  
    <meta name="description" content="Spring Schedule Task Introduce">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
    <link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">cronExpression</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">Sample</span></a></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">Spring应用之ScheduleTask</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2013-08-01T16:00:00.000Z">2013-08-02</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-Java">Java</a>
          
            <a href="/tags.html#tag-Spring">Spring</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h3 id="header-1">cronExpression</h3>
<table class="table">
<thead>
<tr>
<th>字段</th>
<th>允许值</th>
<th>允许的特殊字符</th>
</tr>
</thead>
<tbody>
<tr>
<td>秒</td>
<td>0-59</td>
<td>- * /</td>
</tr>
<tr>
<td>分</td>
<td>0-59</td>
<td>- * /</td>
</tr>
<tr>
<td>小时</td>
<td>0-23</td>
<td>- * /</td>
</tr>
<tr>
<td>日期</td>
<td>1-31</td>
<td>- * ? / L W C</td>
</tr>
<tr>
<td>月份</td>
<td>1-12 或者 JAN-DEC</td>
<td>- * /</td>
</tr>
<tr>
<td>星期</td>
<td>1-7 或者 SUN-SAT</td>
<td>- * ? / L C #</td>
</tr>
<tr>
<td>年（可选）</td>
<td>留空, 1970-2099</td>
<td>- * /</td>
</tr>
</tbody>
</table>
<p>说明：</p>
<table class="table">
<thead>
<tr>
<th>字符</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>用来指定所有的值</td>
<td>“*”在分钟的字段域里表示“每分钟”</td>
</tr>
<tr>
<td>?</td>
<td>通过设置一个问号来表明不想设置那个字段 （只在日期域和星期域中使用）</td>
<td>月份中的日期和星期中的日期这两个元素互斥时设置“？”</td>
</tr>
<tr>
<td>-</td>
<td>用来指定一个范围</td>
<td>10-12”在小时域意味着“10点、11点、12点”</td>
</tr>
<tr>
<td>,</td>
<td>指定多个值</td>
<td>“MON,WED,FRI”在星期域里表示”星期一、星期三、星期五”</td>
</tr>
<tr>
<td>/</td>
<td>指定增量（起始值/增量值）</td>
<td>“0/15”在秒域：每分钟的0，15，30和45秒  <br>  “5/15”在分钟域：每小时的5，20，35和50</td>
</tr>
<tr>
<td>#</td>
<td>指定本月的某某天（只在星期域中出现）</td>
<td>“6#3”：本月第三周的星期五（6表示星期五，3表示第三周）</td>
</tr>
<tr>
<td>L</td>
<td>Last (在日期或星期域中)</td>
<td>L在日期域： 一个月的最后一天 <br>L在星期域：‘7’或者‘SAT’<br> 6L在星期域：一个月的最后一个星期五</td>
</tr>
<tr>
<td>W</td>
<td>Workday: 指定日期的最近工作日（只在日期域出现，且最近工作日是不能够跨月份的）</td>
<td>15W：这个月15号最近的工作日<br> 如果15号是周六，则任务会在14号触发。如果15好是周日，则任务会在周一也就是16号触发 <br>LW: 这个月最后一周的工作日</td>
</tr>
<tr>
<td>C</td>
<td>Calendar: 某域的几天 （只在日期域和星期域中使用）</td>
</tr>
</tbody>
</table>
<p>表达式举例：</p>
<ul>
<li><code>0 0 12 * * ?</code> 每天中午12点触发</li>
<li><code>0 15 10 ? * *</code> 每天上午10:15触发</li>
<li><code>0 15 10 * * ?</code> 每天上午10:15触发</li>
<li><code>0 15 10 * * ? *</code> 每天上午10:15触发</li>
<li><code>0 15 10 * * ? 2005</code> 2005年的每天上午10:15触发</li>
<li><code>0 * 14 * * ?</code> 在每天下午2点到下午2:59期间的每1分钟触发</li>
<li><code>0 0/5 14 * * ?</code> 在每天下午2点到下午2:55期间的每5分钟触发</li>
<li><code>0 0/5 14,18 * * ?</code> 在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发</li>
<li><code>0 0-5 14 * * ?</code> 在每天下午2点到下午2:05期间的每1分钟触发</li>
<li><code>0 10,44 14 ? 3 WED</code> 每年三月的星期三的下午2:10和2:44触发</li>
<li><code>0 15 10 ? * MON-FRI</code> 周一至周五的上午10:15触发</li>
<li><code>0 15 10 15 * ?</code> 每月15日上午10:15触发</li>
<li><code>0 15 10 L * ?</code> 每月最后一日的上午10:15触发</li>
<li><code>0 15 10 ? * 6L</code> 每月的最后一个星期五上午10:15触发 </li>
<li><code>0 15 10 ? * 6L 2002-2005</code> 2002年至2005年的每月的最后一个星期五上午10:15触发</li>
<li><code>0 15 10 ? * 6#3</code> 每月的第三个星期五上午10:15触发</li>
</ul>
<h3 id="header-2">Sample</h3>
<pre><code class="nullxml"><span class="hljs-comment">&lt;!-- 加入task命名空间--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
        <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">"http://www.springframework.org/schema/aop"</span>
        <span class="hljs-attr">xmlns:tx</span>=<span class="hljs-string">"http://www.springframework.org/schema/tx"</span>
        <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">"http://www.springframework.org/schema/context"</span>
        <span class="hljs-attr">xmlns:jaxws</span>=<span class="hljs-string">"http://cxf.apache.org/jaxws"</span>
        <span class="hljs-attr">xmlns:cxf</span>=<span class="hljs-string">"http://cxf.apache.org/core"</span>
        <span class="hljs-attr">xmlns:task</span>=<span class="hljs-string">"http://www.springframework.org/schema/task"</span>
        <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd
            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.2.xsd
            http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.2.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd
            http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd
            http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd
            http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">task:annotation-driven</span>/&gt;</span>

<span class="hljs-comment">&lt;!-- Schedule Task  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"smsDailyMessageTask"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.cj.sms.task.SmsDailyMessageTask"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"smsBackTask"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.cj.sms.task.SmsBackTask"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">task:scheduled-tasks</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">task:scheduled</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"smsDailyMessageTask"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"insertDailyMessage"</span> <span class="hljs-attr">cron</span>=<span class="hljs-string">"0 35 14 * * ?"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">task:scheduled</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"smsBackTask"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"alarmWarning"</span> <span class="hljs-attr">cron</span>=<span class="hljs-string">"0 0/30 * * * ?"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">task:scheduled</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"smsBackTask"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"alarmThreadState"</span> <span class="hljs-attr">cron</span>=<span class="hljs-string">"0 0/20 * * * ?"</span>  /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">task:scheduled-tasks</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 通过AOP，可为task加入一些处理 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myScheduleTaskHandler"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.cj.common.MyScheduleTaskHandler"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"key"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${deploy.hostname}"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"isCheck"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"${deploy.hostname.check}"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"myScheduleTaskHandler"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">"execution(public void com.cj.sms.task.*.start*())"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myTaskInterceptor"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aop:around</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"aroundAdvice"</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">"myTaskInterceptor"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span>
</code></pre>
<pre><code class="nulljava"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SmsDailyMessageTask</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertDailyMessage</span><span class="hljs-params">()</span>
    </span>{...}
}
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SmsBackTask</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">alarmWarning</span><span class="hljs-params">()</span>
    </span>{...}
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">alarmThreadState</span><span class="hljs-params">()</span>
    </span>{...}
}
</code></pre>
<pre><code class="nulljava"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyScheduleTaskHandler</span>
</span>{
    <span class="hljs-keyword">static</span> Logger logger = Logger.getLogger(MyScheduleTaskHandler.class);

    <span class="hljs-keyword">private</span> String key;
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getKey</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> key;}
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setKey</span><span class="hljs-params">(String key)</span></span>{<span class="hljs-keyword">this</span>.key = key;}

    <span class="hljs-keyword">private</span> Boolean isCheck;
    <span class="hljs-function"><span class="hljs-keyword">public</span> Boolean <span class="hljs-title">getIsCheck</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> isCheck;}
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setIsCheck</span><span class="hljs-params">(Boolean isCheck)</span></span>{<span class="hljs-keyword">this</span>.isCheck = isCheck;}

    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">aroundAdvice</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable </span>{
        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.isCheck)
            <span class="hljs-keyword">return</span> pjp.proceed();
        <span class="hljs-keyword">try</span>{
            InetAddress netAddress= InetAddress.getLocalHost();
            String hostName=netAddress.getHostName();
            <span class="hljs-keyword">if</span>(hostName!=<span class="hljs-keyword">null</span> &amp;&amp; hostName.equals(key)){
                System.out.println(<span class="hljs-string">"Do Schedule Task---"</span>);
                <span class="hljs-keyword">return</span> pjp.proceed();
            }
        }<span class="hljs-keyword">catch</span>(UnknownHostException ex){
            logger.error(<span class="hljs-string">"Get HostName Error:"</span>+ex.getMessage());
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
}
</code></pre>
  </section>
</article>

      <hr/>
      
<section class="post-comment">
	
		<!-- disqus默认将数据加载到id为'disqus_thread'的容器中，可配置disqus_container_id改变-->
<div id="disqus_thread"> 
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

	<script type="text/javascript">
		var disqus_shortname = 'sixdegreespace'; 
		var disqus_identifier = '2013/08/02/Spring-ScheduleTask.html';	
		var disqus_title = 'Spring应用之ScheduleTask';
		var disqus_url = 'http://sixdegree.github.io/2013/08/02/Spring-ScheduleTask.html' ;
		//var disqus_category_id = '4262241'; 

		(function() {
		    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>


 
	
</section>

    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/highlight/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  
  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
