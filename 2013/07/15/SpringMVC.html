<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SpringMVC</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="spring,mvc,restful">
  
  
    <meta name="description" content="Spring MVC Introduce">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
	
		<link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
	
    
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">Starter</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">依赖包</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">使用</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">处理流程</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">Restful</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-6"><span class="sidebar-nav nav-text">使用示例</span></a></li></ol></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">SpringMVC</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2013-07-14T16:00:00.000Z">2013-07-15</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-Java">Java</a>
          
            <a href="/tags.html#tag-Spring">Spring</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h2 id="header-1">Starter</h2>
<h3 id="header-2">依赖包</h3>
<p>在加入Spring依赖包的基础上，加入：</p>
<pre><code class="lang-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
    &lt;version&gt;${spring.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>额外包：</p>
<pre><code class="lang-xml">&lt;!-- FileUpload --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
    &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;commons-io&lt;/groupId&gt;
    &lt;artifactId&gt;commons-io&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- JSTL,Taglib --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;jstl&lt;/groupId&gt;
    &lt;artifactId&gt;jstl&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;taglibs&lt;/groupId&gt;
    &lt;artifactId&gt;standard&lt;/artifactId&gt;
&lt;/dependency&gt; 

&lt;!-- Test--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;junit&lt;/groupId&gt;
    &lt;artifactId&gt;junit&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;xmlunit&lt;/groupId&gt;
    &lt;artifactId&gt;xmlunit&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.mockito&lt;/groupId&gt;
    &lt;artifactId&gt;mockito-all&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mockito&lt;/groupId&gt;
    &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="header-3">使用</h3>
<ol>
<li>配置web.xml (在配置了Spring的基础上)<pre><code class="lang-xml"> &lt;!-- 配置加载DispatchServlet 拦截请求--&gt;
 &lt;servlet&gt;
     &lt;servlet-name&gt;xxx&lt;/servlet-name&gt;
     &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
     &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
 &lt;/servlet&gt;
 &lt;servlet-mapping&gt;
     &lt;servlet-name&gt;xxx&lt;/servlet-name&gt;
     &lt;url-pattern&gt;/&lt;/url-pattern&gt;
 &lt;/servlet-mapping&gt;
</code></pre>
</li>
<li><p>配置xxx-servlet.xml</p>
<pre><code class="lang-xml"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
 &lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
     xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
     xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
     xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
     xsi:schemaLocation=&quot;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
         http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd&quot;&gt;

     &lt;mvc:annotation-driven/&gt;
     &lt;!-- find controller and registered as beans--&gt;
     &lt;context:component-scan base-package=&quot;com.mytest.controller&quot;/&gt;

     &lt;!-- PS: 若使用@ControllerAdvice，需如下配置
     &lt;context:component-scan base-package=&quot;com.mytest.controller&quot; use-default-filters=&quot;false&quot;&gt;
         &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;  /&gt;
         &lt;context:include-filter type=&quot;annotation&quot; expression=&quot;org.springframework.web.bind.annotation.ControllerAdvice&quot;/&gt;
     &lt;/context:component-scan&gt;
     --&gt;

     &lt;!-- Handle requests for static resources --&gt;
     &lt;mvc:resources location=&quot;/resources/&quot; mapping=&quot;/resources/**&quot;/&gt;

     &lt;!-- use InternalResourceViewResolver to resolve internal view:
         prefix + logical view name + suffix
     --&gt;
     &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
         &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/user/&quot;/&gt;
         &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
     &lt;/bean&gt;

     &lt;!-- for file uploads --&gt;
     &lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;
         &lt;property name=&quot;maxUploadSize&quot; value=&quot;1000000&quot;/&gt;
     &lt;/bean&gt;

 &lt;/beans&gt;
</code></pre>
</li>
<li><p>在Spring配置文件（<code>beans.xml</code>）中去除加载Controller（避免重复）</p>
<pre><code class="lang-xml"> &lt;context:component-scan base-package=&quot;com.mytest&quot; &gt;
     &lt;context:exclude-filter type=&quot;regex&quot; expression=&quot;com.mytest.controller.*&quot;/&gt;
 &lt;/context:component-scan&gt;
</code></pre>
</li>
<li><p>Controller</p>
<pre><code class="lang-java"> @Controller
 @RequestMapping(value={&quot;/users&quot;})
 @SessionAttributes(&quot;loginUser&quot;)
 public class UserController
 {
     private UserService userService;
     public UserService getUserService(){return this.userService;}
     @Inject
     public void setUserService(UserService userService){this.userService=userService;}

     // List Users
     @RequestMapping(value={&quot;/&quot;})
     public String list(Model model)
     {
         model.addAttribute(&quot;users&quot;,userService.list());
         return &quot;list&quot;;
     }

     // get user details by id
     @RequestMapping(value={&quot;/{id}&quot;},method=RequestMethod.GET)
     public String details(@PathVariable int id,Model model)
     {
         User user=userService.get(id);
         if(user!=null)
             model.addAttribute(user);
         return &quot;create&quot;;
     }

     //create user &amp; file upload
     @RequestMapping(value={&quot;/&quot;},method=RequestMethod.POST)
     public String create(@Valid User user,BindingResult binding, @RequestParam(value=&quot;photos&quot;,required=false) MultipartFile[] photos,HttpServletRequest req)
             throws IOException
     {
         if(binding.hasErrors())
             return &quot;create&quot;;

         //file upload
         String realpath = req.getSession().getServletContext().getRealPath(&quot;/resources/upload/&quot;);
         for(MultipartFile photo : photos)
         {
             if(photo.isEmpty())
                 continue;
             FileUtils.copyInputStreamToFile(photo.getInputStream(), new File(realpath+&quot;/&quot;+photo.getOriginalFilename()));
         }

         //save user
         userService.save(user)
         return &quot;redirect:list&quot;;
     }

     // login
     @RequestMapping(value={&quot;/login&quot;},method=RequestMethod.POST)
     public String login(String username,String password,Model model)
     {
         User user=userService.check(username,password);
         if(user!=null){
             model.addAttribute(&quot;loginUser&quot;,user);
             //return InternalResourceViewResolver.REDIRECT_URL_PREFIX+&quot;/users&quot;
             return &quot;redirect:list&quot;;
         }
         throw new UserException(&quot;Login Fail&quot;);
         //return &quot;login&quot;;
     }

     @ExceptionHandler(value={UserException.class})
     public String handlerUserException(Exception ex,HttpServletRequest req)
     {
         req.setAttribute(&quot;ex&quot;,ex.getMessage());
         return &quot;error&quot;;
     }
 }
</code></pre>
</li>
<li><p>JSP</p>
<ul>
<li><p><code>WEB_INF/user/list.jsp</code> 部分代码：</p>
<pre><code class="lang-html">&lt;!-- 在页面中引入：--&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;

&lt;!-- 显示登录用户--&gt;
&lt;h2&gt;Welcome : ${loginUser.username}&lt;h2&gt;

&lt;!-- Menu Link --&gt;
&lt;a href=&quot;create&quot;&gt;Create User&lt;/a&gt; | &lt;a href=&quot;login&quot;&gt;Login User&lt;/a&gt;

&lt;!-- 循环遍历 model：users--&gt;
&lt;h2&gt;User List&lt;/h2&gt;
&lt;table&gt;
&lt;tr&gt;
&lt;td&gt;Id&lt;/td&gt;
&lt;td&gt;userName&lt;/td&gt;
&lt;td&gt;nickName&lt;/td&gt;
&lt;td&gt;password&lt;/td&gt;
&lt;td&gt;email&lt;/td&gt;
&lt;td&gt;Opera&lt;/td&gt;
&lt;/tr&gt;
&lt;c:forEach items=&quot;${users}&quot;  var=&quot;u&quot;&gt;
&lt;tr&gt;
  &lt;td&gt;${u.value.id}&lt;/td&gt;
  &lt;td&gt;${u.value.username }&lt;/td&gt;
  &lt;td&gt;${u.value.nickname }&lt;/td&gt;
  &lt;td&gt;${u.value.password }&lt;/td&gt;
  &lt;td&gt;${u.value.email }&lt;/td&gt;
  &lt;td&gt;&lt;a href=&quot;${u.key}&quot;&gt;Details&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/c:forEach&gt;
&lt;/table&gt;
</code></pre>
</li>
<li><p><code>WEB-INF/user/create.jsp</code> 部分代码：</p>
<pre><code class="lang-html">&lt;!-- 页面中引入spring form：--&gt;
&lt;%@ taglib prefix=&quot;sf&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;

&lt;h2&gt;Create User&lt;/h2&gt;
&lt;sf:form method=&quot;post&quot; modelAttribute=&quot;user&quot; enctype=&quot;multipart/form-data&quot;&gt;
  UserName:&lt;sf:input path=&quot;username&quot;/&gt;&lt;sf:errors path=&quot;username&quot;/&gt;
  NickName:&lt;sf:input path=&quot;nickname&quot;/&gt;&lt;sf:errors path=&quot;nickname&quot;/&gt;
  Password:&lt;sf:password path=&quot;password&quot;/&gt;&lt;sf:errors path=&quot;password&quot;/&gt;
  Email:&lt;/td&gt;&lt;td&gt;&lt;sf:input path=&quot;email&quot;/&gt;&lt;sf:errors path=&quot;email&quot;/&gt;
  photo1:&lt;input type=&quot;file&quot; name=&quot;photos&quot;/&gt;
  photo2:&lt;input type=&quot;file&quot; name=&quot;photos&quot;/&gt;
  &lt;sf:button type=&quot;reset&quot;&gt;Reset&lt;/sf:button&gt;
  &lt;sf:button type=&quot;submit&quot; &gt;Submit&lt;/sf:button&gt;
&lt;/sf:form&gt;
</code></pre>
</li>
<li><p><code>WEB-INF/user/login.jsp</code>部分代码：</p>
<pre><code class="lang-html">&lt;h2&gt;User Login&lt;/h2&gt;
&lt;form method=&quot;post&quot; &gt;
  UserName:&lt;input name=&quot;username&quot; type=&quot;text&quot;/&gt;
  Password:&lt;input type=&quot;password&quot; name=&quot;password&quot;/&gt;
  &lt;button type=&quot;reset&quot;&gt;Reset&lt;/button&gt;
  &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
&lt;/form&gt;
</code></pre>
</li>
<li><p><code>WEB-INF/user/error.jsp</code>部分代码：</p>
<pre><code class="lang-html">&lt;body&gt;${ex}&lt;/body&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>测试</p>
<pre><code class="lang-java"> @RunWith(SpringJUnit4ClassRunner.class)
 @WebAppConfiguration
 @ContextConfiguration({&quot;classpath:beans.xml&quot;,&quot;file:src/main/webapp/WEB-INF/mytest-servlet.xml&quot;})
 public class MyControllerTest
 {
     private MockMvc mockMvc;
     protected MockHttpSession mockSession;
     @Inject
     private WebApplicationContext wac;

     @Before
     public void setup()
     {
         MockitoAnnotations.initMocks(this);
         mockMvc =MockMvcBuilders.webAppContextSetup(wac).build();
         mockSession=new MockHttpSession();
     }

     @Test
     public void testList() throws Exception{
         MvcResult result = mockMvc.perform(MockMvcRequestBuilders.get(&quot;/users&quot;))
             .andExpect(MockMvcResultMatchers.view().name(&quot;list&quot;))
             .andExpect(MockMvcResultMatchers.model().attributeExists(&quot;users&quot;))
             .andDo(MockMvcResultHandlers.print())
             .andReturn();
         printMvcResult(result);
         Assert.assertNotNull(result.getModelAndView().getModel().get(&quot;users&quot;));
     }

     private void printMvcResult(MvcResult result) throws IOException
     {
         MockHttpServletRequest request= result.getRequest();
         MockHttpServletResponse response= result.getResponse();
         //ModelAndView  mv=getModelAndView() //得到执行后的ModelAndView

         System.out.println(&quot;Request:&quot;);
         System.out.println(&quot;URI:&quot;+request.getRequestURI());
         System.out.println(&quot;URL:&quot;+request.getRequestURL());
         System.out.println(&quot;Method:&quot;+request.getMethod()+&quot;,ContentType:&quot;+request.getContentType());
 //System.out.println(&quot;InputStream:&quot;+IOUtils.toString(request.getInputStream()));
         System.out.println(&quot;Response:&quot;);
         System.out.println(&quot;Status:&quot;+response.getStatus()+&quot; ErrorMessage:&quot;+response.getErrorMessage());
         System.out.println(&quot;content:&quot;+response.getContentAsString());
         System.out.println(&quot;contentType:&quot;+response.getContentType());
     }
 }
</code></pre>
</li>
</ol>
<h2 id="header-4">处理流程</h2>
<p><img src="/2013/07/15/mvc.png" alt="Spring MVC"></p>
<p><code>Request</code>会由<code>DispatcherServlet</code>分配给具体<code>Controller</code>（由<code>HandlerMapping</code>根据RequestURL来确定）。<code>Controller</code>完成处理后，<code>Request</code>会被发送给一个<code>View</code>（由<code>ViewResolver</code>确定）来呈现输出结果</p>
<p>具体过程：</p>
<ol>
<li>Request发送，由DispatcherServlet拦截</li>
<li>将Request交给HandlerMapping，HandlerMapping根据URL决策使用哪个Controller来处理</li>
<li>将Request发送给选定的Controller完成逻辑处理</li>
<li>将需要Client显示的信息打包成Model，并标志出处用于渲染输出的视图名称（即逻辑逻辑视图名）发送回DispatcherServlet</li>
<li>ViewResolver根据逻辑视图名确定真正的视图实现（View）</li>
<li>视图将Model渲染输出，通过Response传递回Client</li>
</ol>
<p>当要为用户展现信息时，SpringMVC可以使用视图解析器选择合适的视图：</p>
<table class="table">
<thead>
<tr>
<th>View resolver</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>BeanNameViewResolver</td>
<td>Finds an implementation of View that’s registered as a <bean> whose ID is the same as the logical view name.</td>
</tr>
<tr>
<td>ContentNegotiatingViewResolver</td>
<td>Delegates to one or more other view resolvers, the choice of which is based on the content type being requested.</td>
</tr>
<tr>
<td>FreeMarkerViewResolver</td>
<td>Finds a FreeMarker-based template whose path is determined by prefixing and suffixing the logical view name.</td>
</tr>
<tr>
<td>InternalResourceViewResolver</td>
<td>Finds a view template contained within the web application’s WAR file. The path to the view template is derived by prefixing and suffixing the logical view name.</td>
</tr>
<tr>
<td>JasperReportsViewResolver</td>
<td>Finds a view defined as a Jasper Reports report file whose path is derived by prefixing and suffixing the logical view name.</td>
</tr>
<tr>
<td>ResourceBundleViewResolver</td>
<td>Looks up View implementations from a properties file.</td>
</tr>
<tr>
<td>TilesViewResolver</td>
<td>Looks up a view that is defined as a Tiles template. The name of the template is the same as the logical view name.</td>
</tr>
<tr>
<td>UrlBasedViewResolver</td>
<td>This is the base class for some of the other view resolvers, such as InternalResourceViewResolver. It can be used on its own, but it’s not as powerful as its sub-classes. For example, UrlBasedViewResolver is unable to resolve views based on the current locale.</td>
</tr>
<tr>
<td>VelocityLayoutViewResolver</td>
<td>This is a subclass of VelocityViewResolver that supports page composition via Spring’s VelocityLayoutView (a view implementation that emulates Velocity’s VelocityLayoutServlet).</td>
</tr>
<tr>
<td>VelocityViewResolver</td>
<td>Resolves a Velocity-based view where the path of a Velocity template is derived by prefixing and suffixing the logical view name.</td>
</tr>
<tr>
<td>XmlViewResolver</td>
<td>Finds an implementation of View that’s declared as a <bean> in an XML file (/WEB-INF/views.xml). This view resolver is a lot like BeanNameViewResolver except that the view <bean>s are declared separately from those for the application’s Spring context.</td>
</tr>
<tr>
<td>XsltViewResolver</td>
<td>Resolves an XSLT-based view where the path of the XSLT stylesheet is derived by prefixing and suffixing the logical view name.</td>
</tr>
</tbody>
</table>
<h2 id="header-5">Restful</h2>
<p><strong>URI</strong>: 统一资源定位符,每种&quot;资源&quot;对应一个特定的URI（<strong>无状态</strong>）；
所以要获取这个资源，访问它的URI就可以，URI为每一个资源的地址或独一无二的识别符</p>
<p><strong>REST=Representational State Transfer</strong>（表现层状态转化）</p>
<ul>
<li>Representional：客户端和服务器之间，通过HTTP请求的头信息（Accept，Content-Type）指定&quot;资源&quot;的表现形式，例如：xml,json,html</li>
<li>State Transfer：客户端通过HTTP动词（GET,POST,PUT,PUT,DELETE），对服务器端&quot;资源&quot;进行操作，实现&quot;表现层状态转化&quot;</li>
<li>transferring the state of resources</li>
</ul>
<p>REST 中最重要的概念是资源（resources），使用全球 ID（通常使用 URI）标识。
客户端应用程序使用 HTTP 方法（GET/ POST/ PUT/ DELETE）操作资源或资源集。
通常，RESTful Web 服务应该定义以下方面：</p>
<ul>
<li>Web 服务的基/根 URI，比如 <code>http://host/&lt;appcontext&gt;/resources</code></li>
<li>支持 MIME 类型的响应数据，包括 JSON/XML/ATOM 等等</li>
<li>服务支持的操作集合（例如 POST、GET、PUT 或 DELETE）</li>
</ul>
<p>Restful</p>
<ul>
<li>面向资源的设计</li>
<li>是一种风格，而不是标准</li>
<li>其目标是“使延迟和网络交互最小化，同时使组件实现的独立性和扩展性最大化”</li>
<li>最主要驱动是分布性和扩展性</li>
</ul>
<p>Restless &amp; Restful URL示例:</p>
<p><img src="/2013/07/15/restless.png" alt="Restless">
(Restless)</p>
<p><img src="/2013/07/15/restful.png" alt="Restfull">
(Restful)</p>
<p>HTTP动词：</p>
<ul>
<li>GET（SELECT）：从服务器取出资源（一项或多项）。</li>
<li>POST（CREATE）：在服务器新建一个资源。</li>
<li>PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。</li>
<li>PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。</li>
<li>DELETE（DELETE）：从服务器删除资源。</li>
<li>HEAD：获取资源的元数据。</li>
<li>OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的</li>
</ul>
<p>HTTP状态码</p>
<table class="table">
<thead>
<tr>
<th>Status Codes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>200 OK - [GET]</td>
<td>服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）</td>
</tr>
<tr>
<td>201 CREATED - [POST/PUT/PATCH]</td>
<td>用户新建或修改数据成功</td>
</tr>
<tr>
<td>202 Accepted - [*]</td>
<td>表示一个请求已经进入后台排队（异步任务）</td>
</tr>
<tr>
<td>204 NO CONTENT - [DELETE]</td>
<td>用户删除数据成功</td>
</tr>
<tr>
<td>400 INVALID REQUEST - [POST/PUT/PATCH]</td>
<td>用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的</td>
</tr>
<tr>
<td>401 Unauthorized - [*]</td>
<td>表示用户没有权限（令牌、用户名、密码错误）</td>
</tr>
<tr>
<td>403 Forbidden - [*]</td>
<td>表示用户得到授权（与401错误相对），但是访问是被禁止的</td>
</tr>
<tr>
<td>404 NOT FOUND - [*]</td>
<td>用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的</td>
</tr>
<tr>
<td>406 Not Acceptable - [GET]</td>
<td>用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）</td>
</tr>
<tr>
<td>410 Gone -[GET]</td>
<td>用户请求的资源被永久删除，且不会再得到的</td>
</tr>
<tr>
<td>422 Unprocesable entity - [POST/PUT/PATCH]</td>
<td>当创建一个对象时，发生一个验证错误</td>
</tr>
<tr>
<td>500 INTERNAL SERVER ERROR - [*]</td>
<td>服务器发生错误，用户将无法判断发出的请求是否成功</td>
</tr>
</tbody>
</table>
<p>Restful 设计示例：</p>
<ul>
<li>GET /users：列出所有用户</li>
<li>POST /users：新建一个用户</li>
<li>GET /users/{id}：获取某个指定用户的信息</li>
<li>PUT /users/{id}：更新某个指定用户的信息（提供该用户的全部信息）</li>
<li>PATCH /users/{id}：更新某个指定用户的信息（提供该用户的部分信息）</li>
<li>DELETE /users/{id}：删除某个用户</li>
<li>GET /users/{id}/roles：列出某个指定用户的所有角色</li>
<li>DELETE /users/{id}/roles/{roleId}：删除某个指定用户的指定角色</li>
</ul>
<h3 id="header-6">使用示例</h3>
<ol>
<li><p>SpringMVC配置加入Restful (<code>xxx-servlet.xml</code>)</p>
<pre><code class="lang-xml"> &lt;bean class=&quot;org.springframework.web.servlet.view.ContentNegotiatingViewResolver&quot;&gt;
     &lt;property name=&quot;mediaTypes&quot;&gt;
         &lt;map&gt;
             &lt;!-- &lt;entry key=&quot;html&quot; value=&quot;text/html&quot;/&gt; --&gt;
             &lt;entry key=&quot;json&quot; value=&quot;application/json&quot;/&gt;
         &lt;/map&gt;
     &lt;/property&gt;
     &lt;!-- &lt;property name=&quot;defaultContentType&quot; value=&quot;text/html&quot;/&gt; --&gt;
     &lt;property name=&quot;viewResolvers&quot;&gt;
         &lt;list&gt;
             &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
                 &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot;/&gt;
                 &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/&quot;/&gt;
                 &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
             &lt;/bean&gt; 
         &lt;/list&gt;
     &lt;/property&gt;
     &lt;property name=&quot;defaultViews&quot;&gt;
         &lt;list&gt;
             &lt;bean class=&quot;org.springframework.web.servlet.view.json.MappingJacksonJsonView&quot; &gt;
                 &lt;property name=&quot;objectMapper&quot;&gt;
                     &lt;bean class=&quot;org.codehaus.jackson.map.ObjectMapper&quot;&gt;
                         &lt;property name=&quot;serializationConfig.serializationInclusion&quot;&gt;
                             &lt;value type=&quot;org.codehaus.jackson.map.annotate.JsonSerialize.Inclusion&quot;&gt;NON_NULL&lt;/value&gt;
                         &lt;/property&gt; 
                     &lt;/bean&gt;
                 &lt;/property&gt; 
             &lt;/bean&gt;
         &lt;/list&gt;
     &lt;/property&gt;
 &lt;/bean&gt;
</code></pre>
</li>
<li><p>Controller</p>
<pre><code class="lang-java"> @Controller
 @RequestMapping(&quot;/users&quot;)
 public class UserController{
     private SysUserService userService;
     public SysUserService getUserService() {return userService;}
     @Inject
     public void setUserService(SysUserService userService) {this.userService = userService;}

     @RequestMapping(method=RequestMethod.GET)
     @ResponseBody
     public Object list(){
         List&lt;User&gt; users=this.userService.list();
         return users;
     }

     @RequestMapping(value={&quot;/{id}&quot;},method=RequestMethod.GET)
     @ResponseBody
     public Object getUser(@PathVariable(&quot;id&quot;) String id){
             return this.userService.get(id);
     }

     @RequestMapping(method=RequestMethod.POST)
     @ResponseBody
     public Object create(@RequestBody User user,HttpServletRequest request){
         return this.userService.save(user);
     }

     @RequestMapping(method=RequestMethod.POST)
     @ResponseBody
     public Object upload(@RequestParam(value=&quot;file&quot;,required=true) MultipartFile file,
             @RequestParam(value=&quot;remark&quot;,required=false) String remark) 
                     throws IOException, InvalidFormatException
     {
         System.out.println(&quot;ContentType:&quot;+file.getContentType());
         System.out.println(&quot;Name:&quot;+file.getName());
         System.out.println(&quot;OriginalFilename:&quot;+file.getOriginalFilename());
         System.out.println(&quot;Size:&quot;+file.getSize());
         System.out.println(&quot;remark:&quot;+remark);

         String filename=file.getOriginalFilename();
         int pos=filename.lastIndexOf(&quot;.&quot;);
         String fileExtesion=(pos!=-1?filename.substring(pos+1):&quot;UnKnow&quot;);

         String realpath = req.getSession().getServletContext().getRealPath(&quot;/resources/uploads/&quot;);
         FileUtils.copyInputStreamToFile(file.getInputStream(), new File(realpath+File.separatorChar+fileName));
         return ResponseUtils.sendSuccess(fileName);
     }
 }
</code></pre>
</li>
<li><p>测试</p>
<pre><code class="lang-java"> //GET
 MvcResult result=this.mockMvc.perform(MockMvcRequestBuilders.get(url)
             .session(this.mockSession)
             .contentType(MediaType.APPLICATION_JSON))
             .andDo(MockMvcResultHandlers.print())
             .andExpect(status().isOk())
             .andExpect(jsonPath(&quot;$.success&quot;,Matchers.equalTo(true)))
             .andReturn();

 //POST
 User user=new User();
 user.setName(&quot;xxx&quot;);
 user.setAge(xxx);

 ObjectMapper mapper = new ObjectMapper();
 mapper.setSerializationInclusion(Include.NON_NULL);
 byte[] reqBytes=mapper.writeValueAsString(user);

 MvcResult result=this.mockMvc.perform(post(url)
             .contentType(MediaType.APPLICATION_JSON)
             .content(reqBytes))
             .andDo(MockMvcResultHandlers.print())
             .andExpect(status().isOk())
             //.andExpect(jsonPath(&quot;$.success&quot;,Matchers.equalTo(true)))
             .andExpect(jsonPath(&quot;$.name&quot;,Matchers.equalTo(&quot;xxx&quot;)))
             .andReturn();
</code></pre>
<p> 或使用<code>RestTemplate</code></p>
<pre><code class="lang-java"> RestTemplate restTemplate = new RestTemplate();
 User[] users = restTemplate.getForObject(SERVER_URI+&quot;/users&quot;, User[].class);
 User user = restTemplate.getForObject(SERVER_URI+&quot;/users/{id}&quot;, User.class,id);
 User response = restTemplate.postForObject(SERVER_URI+&quot;/users&quot;, user, User.class);
</code></pre>
</li>
</ol>
  </section>
</article>

      <hr/>
      
<section class="post-comment">
	
		<div id="gitment_container"></div>

<link rel="stylesheet" href="/gitment/default.css">
<script src="/gitment/gitment.browser.js"></script>


<script type="text/javascript">
	var gitment = new Gitment({
	  id: document.location.pathname,
	  owner: 'chenjin-zero',
	  repo: 'blogComment',
	  oauth: {
	    client_id: '36a09bb7399efe69c6ce',
	    client_secret: 'ad9ad546b23b708c71d92e513dc36e0486179dea',
	  }
	})
      
	gitment.render('gitment_container')
</script>
	
</section>

    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>


	<script src="/highlight/highlight.pack.js"></script>
	<script type="text/javascript">
		hljs.initHighlightingOnLoad();
	</script>






<script type="text/javascript">

  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
