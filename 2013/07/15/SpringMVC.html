<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SpringMVC</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="spring,mvc,restful">
  
  
    <meta name="description" content="Spring MVC Introduce">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
    <link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">Starter</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">依赖包</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">使用</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">处理流程</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">Restful</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-6"><span class="sidebar-nav nav-text">使用示例</span></a></li></ol></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">SpringMVC</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2013-07-14T16:00:00.000Z">2013-07-15</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-Java">Java</a>
          
            <a href="/tags.html#tag-Spring">Spring</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h2 id="header-1">Starter</h2>
<h3 id="header-2">依赖包</h3>
<p>在加入Spring依赖包的基础上，加入：</p>
<pre><code class="nullxml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>额外包：</p>
<pre><code class="nullxml"><span class="hljs-comment">&lt;!-- FileUpload --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!-- JSTL,Taglib --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jstl<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>taglibs<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>standard<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> 

<span class="hljs-comment">&lt;!-- Test--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>xmlunit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xmlunit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mockito<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mockito-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mockito<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mockito-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 id="header-3">使用</h3>
<ol>
<li>配置web.xml (在配置了Spring的基础上)<pre><code class="nullxml"> <span class="hljs-comment">&lt;!-- 配置加载DispatchServlet 拦截请求--&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>xxx<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span>
</code></pre>
</li>
<li><p>配置xxx-servlet.xml</p>
<pre><code class="nullxml"> <span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span><span class="hljs-meta">?&gt;</span></span>
 <span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.springframework.org/schema/beans"</span>
     <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
     <span class="hljs-attr">xmlns:mvc</span>=<span class="hljs-string">"http://www.springframework.org/schema/mvc"</span>
     <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">"http://www.springframework.org/schema/context"</span>
     <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
         http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
         http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd"</span>&gt;</span>

     <span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>/&gt;</span>
     <span class="hljs-comment">&lt;!-- find controller and registered as beans--&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.mytest.controller"</span>/&gt;</span>

     <span class="hljs-comment">&lt;!-- PS: 若使用@ControllerAdvice，需如下配置
     &lt;context:component-scan base-package="com.mytest.controller" use-default-filters="false"&gt;
         &lt;context:include-filter type="annotation" expression="org.springframework.stereotype.Controller"  /&gt;
         &lt;context:include-filter type="annotation" expression="org.springframework.web.bind.annotation.ControllerAdvice"/&gt;
     &lt;/context:component-scan&gt;
     --&gt;</span>

     <span class="hljs-comment">&lt;!-- Handle requests for static resources --&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">location</span>=<span class="hljs-string">"/resources/"</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">"/resources/**"</span>/&gt;</span>

     <span class="hljs-comment">&lt;!-- use InternalResourceViewResolver to resolve internal view:
         prefix + logical view name + suffix
     --&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prefix"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/WEB-INF/user/"</span>/&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"suffix"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">".jsp"</span>/&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

     <span class="hljs-comment">&lt;!-- for file uploads --&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"multipartResolver"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.multipart.commons.CommonsMultipartResolver"</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maxUploadSize"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"1000000"</span>/&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>

 <span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span>
</code></pre>
</li>
<li><p>在Spring配置文件（<code>beans.xml</code>）中去除加载Controller（避免重复）</p>
<pre><code class="nullxml"> <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">"com.mytest"</span> &gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"regex"</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">"com.mytest.controller.*"</span>/&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span>
</code></pre>
</li>
<li><p>Controller</p>
<pre><code class="nulljava"> <span class="hljs-meta">@Controller</span>
 <span class="hljs-meta">@RequestMapping</span>(value={<span class="hljs-string">"/users"</span>})
 <span class="hljs-meta">@SessionAttributes</span>(<span class="hljs-string">"loginUser"</span>)
 <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span>
 </span>{
     <span class="hljs-keyword">private</span> UserService userService;
     <span class="hljs-function"><span class="hljs-keyword">public</span> UserService <span class="hljs-title">getUserService</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userService;}
     <span class="hljs-meta">@Inject</span>
     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserService</span><span class="hljs-params">(UserService userService)</span></span>{<span class="hljs-keyword">this</span>.userService=userService;}

     <span class="hljs-comment">// List Users</span>
     <span class="hljs-meta">@RequestMapping</span>(value={<span class="hljs-string">"/"</span>})
     <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">list</span><span class="hljs-params">(Model model)</span>
     </span>{
         model.addAttribute(<span class="hljs-string">"users"</span>,userService.list());
         <span class="hljs-keyword">return</span> <span class="hljs-string">"list"</span>;
     }

     <span class="hljs-comment">// get user details by id</span>
     <span class="hljs-meta">@RequestMapping</span>(value={<span class="hljs-string">"/{id}"</span>},method=RequestMethod.GET)
     <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">details</span><span class="hljs-params">(@PathVariable <span class="hljs-keyword">int</span> id,Model model)</span>
     </span>{
         User user=userService.get(id);
         <span class="hljs-keyword">if</span>(user!=<span class="hljs-keyword">null</span>)
             model.addAttribute(user);
         <span class="hljs-keyword">return</span> <span class="hljs-string">"create"</span>;
     }

     <span class="hljs-comment">//create user &amp; file upload</span>
     <span class="hljs-meta">@RequestMapping</span>(value={<span class="hljs-string">"/"</span>},method=RequestMethod.POST)
     <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">create</span><span class="hljs-params">(@Valid User user,BindingResult binding, @RequestParam(value=<span class="hljs-string">"photos"</span>,required=<span class="hljs-keyword">false</span>)</span> MultipartFile[] photos,HttpServletRequest req)
             <span class="hljs-keyword">throws</span> IOException
     </span>{
         <span class="hljs-keyword">if</span>(binding.hasErrors())
             <span class="hljs-keyword">return</span> <span class="hljs-string">"create"</span>;

         <span class="hljs-comment">//file upload</span>
         String realpath = req.getSession().getServletContext().getRealPath(<span class="hljs-string">"/resources/upload/"</span>);
         <span class="hljs-keyword">for</span>(MultipartFile photo : photos)
         {
             <span class="hljs-keyword">if</span>(photo.isEmpty())
                 <span class="hljs-keyword">continue</span>;
             FileUtils.copyInputStreamToFile(photo.getInputStream(), <span class="hljs-keyword">new</span> File(realpath+<span class="hljs-string">"/"</span>+photo.getOriginalFilename()));
         }

         <span class="hljs-comment">//save user</span>
         userService.save(user)
         <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:list"</span>;
     }

     <span class="hljs-comment">// login</span>
     <span class="hljs-meta">@RequestMapping</span>(value={<span class="hljs-string">"/login"</span>},method=RequestMethod.POST)
     <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(String username,String password,Model model)</span>
     </span>{
         User user=userService.check(username,password);
         <span class="hljs-keyword">if</span>(user!=<span class="hljs-keyword">null</span>){
             model.addAttribute(<span class="hljs-string">"loginUser"</span>,user);
             <span class="hljs-comment">//return InternalResourceViewResolver.REDIRECT_URL_PREFIX+"/users"</span>
             <span class="hljs-keyword">return</span> <span class="hljs-string">"redirect:list"</span>;
         }
         <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UserException(<span class="hljs-string">"Login Fail"</span>);
         <span class="hljs-comment">//return "login";</span>
     }

     <span class="hljs-meta">@ExceptionHandler</span>(value={UserException.class})
     <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">handlerUserException</span><span class="hljs-params">(Exception ex,HttpServletRequest req)</span>
     </span>{
         req.setAttribute(<span class="hljs-string">"ex"</span>,ex.getMessage());
         <span class="hljs-keyword">return</span> <span class="hljs-string">"error"</span>;
     }
 }
</code></pre>
</li>
<li><p>JSP</p>
<ul>
<li><p><code>WEB_INF/user/list.jsp</code> 部分代码：</p>
<pre><code class="nullhtml"><span class="hljs-comment">&lt;!-- 在页面中引入：--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">taglib</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"c"</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span>

<span class="hljs-comment">&lt;!-- 显示登录用户--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Welcome : ${loginUser.username}<span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>

<span class="hljs-comment">&lt;!-- Menu Link --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"create"</span>&gt;</span>Create User<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> | <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"login"</span>&gt;</span>Login User<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 循环遍历 model：users--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>User List<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Id<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>userName<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>nickName<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>password<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>email<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>Opera<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">c:forEach</span> <span class="hljs-attr">items</span>=<span class="hljs-string">"${users}"</span>  <span class="hljs-attr">var</span>=<span class="hljs-string">"u"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>${u.value.id}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>${u.value.username }<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>${u.value.nickname }<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>${u.value.password }<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>${u.value.email }<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"${u.key}"</span>&gt;</span>Details<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">c:forEach</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
</code></pre>
</li>
<li><p><code>WEB-INF/user/create.jsp</code> 部分代码：</p>
<pre><code class="nullhtml"><span class="hljs-comment">&lt;!-- 页面中引入spring form：--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">taglib</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"sf"</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://www.springframework.org/tags/form"</span> %&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Create User<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">sf:form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> <span class="hljs-attr">modelAttribute</span>=<span class="hljs-string">"user"</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">"multipart/form-data"</span>&gt;</span>
  UserName:<span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"username"</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"username"</span>/&gt;</span>
  NickName:<span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"nickname"</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"nickname"</span>/&gt;</span>
  Password:<span class="hljs-tag">&lt;<span class="hljs-name">sf:password</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"password"</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"password"</span>/&gt;</span>
  Email:<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:input</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"email"</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">sf:errors</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"email"</span>/&gt;</span>
  photo1:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"photos"</span>/&gt;</span>
  photo2:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"photos"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">sf:button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"reset"</span>&gt;</span>Reset<span class="hljs-tag">&lt;/<span class="hljs-name">sf:button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">sf:button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> &gt;</span>Submit<span class="hljs-tag">&lt;/<span class="hljs-name">sf:button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">sf:form</span>&gt;</span>
</code></pre>
</li>
<li><p><code>WEB-INF/user/login.jsp</code>部分代码：</p>
<pre><code class="nullhtml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>User Login<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> &gt;</span>
  UserName:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>/&gt;</span>
  Password:<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"reset"</span>&gt;</span>Reset<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>Submit<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
</li>
<li><p><code>WEB-INF/user/error.jsp</code>部分代码：</p>
<pre><code class="nullhtml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>${ex}<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
</li>
</ul>
</li>
<li><p>测试</p>
<pre><code class="nulljava"> <span class="hljs-meta">@RunWith</span>(SpringJUnit4ClassRunner.class)
 <span class="hljs-meta">@WebAppConfiguration</span>
 <span class="hljs-meta">@ContextConfiguration</span>({<span class="hljs-string">"classpath:beans.xml"</span>,<span class="hljs-string">"file:src/main/webapp/WEB-INF/mytest-servlet.xml"</span>})
 <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyControllerTest</span>
 </span>{
     <span class="hljs-keyword">private</span> MockMvc mockMvc;
     <span class="hljs-keyword">protected</span> MockHttpSession mockSession;
     <span class="hljs-meta">@Inject</span>
     <span class="hljs-keyword">private</span> WebApplicationContext wac;

     <span class="hljs-meta">@Before</span>
     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span>
     </span>{
         MockitoAnnotations.initMocks(<span class="hljs-keyword">this</span>);
         mockMvc =MockMvcBuilders.webAppContextSetup(wac).build();
         mockSession=<span class="hljs-keyword">new</span> MockHttpSession();
     }

     <span class="hljs-meta">@Test</span>
     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testList</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>{
         MvcResult result = mockMvc.perform(MockMvcRequestBuilders.get(<span class="hljs-string">"/users"</span>))
             .andExpect(MockMvcResultMatchers.view().name(<span class="hljs-string">"list"</span>))
             .andExpect(MockMvcResultMatchers.model().attributeExists(<span class="hljs-string">"users"</span>))
             .andDo(MockMvcResultHandlers.print())
             .andReturn();
         printMvcResult(result);
         Assert.assertNotNull(result.getModelAndView().getModel().get(<span class="hljs-string">"users"</span>));
     }

     <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">printMvcResult</span><span class="hljs-params">(MvcResult result)</span> <span class="hljs-keyword">throws</span> IOException
     </span>{
         MockHttpServletRequest request= result.getRequest();
         MockHttpServletResponse response= result.getResponse();
         <span class="hljs-comment">//ModelAndView  mv=getModelAndView() //得到执行后的ModelAndView</span>

         System.out.println(<span class="hljs-string">"Request:"</span>);
         System.out.println(<span class="hljs-string">"URI:"</span>+request.getRequestURI());
         System.out.println(<span class="hljs-string">"URL:"</span>+request.getRequestURL());
         System.out.println(<span class="hljs-string">"Method:"</span>+request.getMethod()+<span class="hljs-string">",ContentType:"</span>+request.getContentType());
 <span class="hljs-comment">//System.out.println("InputStream:"+IOUtils.toString(request.getInputStream()));</span>
         System.out.println(<span class="hljs-string">"Response:"</span>);
         System.out.println(<span class="hljs-string">"Status:"</span>+response.getStatus()+<span class="hljs-string">" ErrorMessage:"</span>+response.getErrorMessage());
         System.out.println(<span class="hljs-string">"content:"</span>+response.getContentAsString());
         System.out.println(<span class="hljs-string">"contentType:"</span>+response.getContentType());
     }
 }
</code></pre>
</li>
</ol>
<h2 id="header-4">处理流程</h2>
<p><img src="/2013/07/15/mvc.png" alt="Spring MVC"></p>
<p><code>Request</code>会由<code>DispatcherServlet</code>分配给具体<code>Controller</code>（由<code>HandlerMapping</code>根据RequestURL来确定）。<code>Controller</code>完成处理后，<code>Request</code>会被发送给一个<code>View</code>（由<code>ViewResolver</code>确定）来呈现输出结果</p>
<p>具体过程：</p>
<ol>
<li>Request发送，由DispatcherServlet拦截</li>
<li>将Request交给HandlerMapping，HandlerMapping根据URL决策使用哪个Controller来处理</li>
<li>将Request发送给选定的Controller完成逻辑处理</li>
<li>将需要Client显示的信息打包成Model，并标志出处用于渲染输出的视图名称（即逻辑逻辑视图名）发送回DispatcherServlet</li>
<li>ViewResolver根据逻辑视图名确定真正的视图实现（View）</li>
<li>视图将Model渲染输出，通过Response传递回Client</li>
</ol>
<p>当要为用户展现信息时，SpringMVC可以使用视图解析器选择合适的视图：</p>
<table class="table">
<thead>
<tr>
<th>View resolver</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>BeanNameViewResolver</td>
<td>Finds an implementation of View that’s registered as a <bean> whose ID is the same as the logical view name.</bean></td>
</tr>
<tr>
<td>ContentNegotiatingViewResolver</td>
<td>Delegates to one or more other view resolvers, the choice of which is based on the content type being requested.</td>
</tr>
<tr>
<td>FreeMarkerViewResolver</td>
<td>Finds a FreeMarker-based template whose path is determined by prefixing and suffixing the logical view name.</td>
</tr>
<tr>
<td>InternalResourceViewResolver</td>
<td>Finds a view template contained within the web application’s WAR file. The path to the view template is derived by prefixing and suffixing the logical view name.</td>
</tr>
<tr>
<td>JasperReportsViewResolver</td>
<td>Finds a view defined as a Jasper Reports report file whose path is derived by prefixing and suffixing the logical view name.</td>
</tr>
<tr>
<td>ResourceBundleViewResolver</td>
<td>Looks up View implementations from a properties file.</td>
</tr>
<tr>
<td>TilesViewResolver</td>
<td>Looks up a view that is defined as a Tiles template. The name of the template is the same as the logical view name.</td>
</tr>
<tr>
<td>UrlBasedViewResolver</td>
<td>This is the base class for some of the other view resolvers, such as InternalResourceViewResolver. It can be used on its own, but it’s not as powerful as its sub-classes. For example, UrlBasedViewResolver is unable to resolve views based on the current locale.</td>
</tr>
<tr>
<td>VelocityLayoutViewResolver</td>
<td>This is a subclass of VelocityViewResolver that supports page composition via Spring’s VelocityLayoutView (a view implementation that emulates Velocity’s VelocityLayoutServlet).</td>
</tr>
<tr>
<td>VelocityViewResolver</td>
<td>Resolves a Velocity-based view where the path of a Velocity template is derived by prefixing and suffixing the logical view name.</td>
</tr>
<tr>
<td>XmlViewResolver</td>
<td>Finds an implementation of View that’s declared as a <bean> in an XML file (/WEB-INF/views.xml). This view resolver is a lot like BeanNameViewResolver except that the view <bean>s are declared separately from those for the application’s Spring context.</bean></bean></td>
</tr>
<tr>
<td>XsltViewResolver</td>
<td>Resolves an XSLT-based view where the path of the XSLT stylesheet is derived by prefixing and suffixing the logical view name.</td>
</tr>
</tbody>
</table>
<h2 id="header-5">Restful</h2>
<p><strong>URI</strong>: 统一资源定位符,每种”资源”对应一个特定的URI（<strong>无状态</strong>）；<br>所以要获取这个资源，访问它的URI就可以，URI为每一个资源的地址或独一无二的识别符</p>
<p><strong>REST=Representational State Transfer</strong>（表现层状态转化）</p>
<ul>
<li>Representional：客户端和服务器之间，通过HTTP请求的头信息（Accept，Content-Type）指定”资源”的表现形式，例如：xml,json,html</li>
<li>State Transfer：客户端通过HTTP动词（GET,POST,PUT,PUT,DELETE），对服务器端”资源”进行操作，实现”表现层状态转化”</li>
<li>transferring the state of resources</li>
</ul>
<p>REST 中最重要的概念是资源（resources），使用全球 ID（通常使用 URI）标识。<br>客户端应用程序使用 HTTP 方法（GET/ POST/ PUT/ DELETE）操作资源或资源集。<br>通常，RESTful Web 服务应该定义以下方面：</p>
<ul>
<li>Web 服务的基/根 URI，比如 <code>http://host/&lt;appcontext&gt;/resources</code></li>
<li>支持 MIME 类型的响应数据，包括 JSON/XML/ATOM 等等</li>
<li>服务支持的操作集合（例如 POST、GET、PUT 或 DELETE）</li>
</ul>
<p>Restful</p>
<ul>
<li>面向资源的设计</li>
<li>是一种风格，而不是标准</li>
<li>其目标是“使延迟和网络交互最小化，同时使组件实现的独立性和扩展性最大化”</li>
<li>最主要驱动是分布性和扩展性</li>
</ul>
<p>Restless &amp; Restful URL示例:</p>
<p><img src="/2013/07/15/restless.png" alt="Restless"><br>(Restless)</p>
<p><img src="/2013/07/15/restful.png" alt="Restfull"><br>(Restful)</p>
<p>HTTP动词：</p>
<ul>
<li>GET（SELECT）：从服务器取出资源（一项或多项）。</li>
<li>POST（CREATE）：在服务器新建一个资源。</li>
<li>PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。</li>
<li>PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。</li>
<li>DELETE（DELETE）：从服务器删除资源。</li>
<li>HEAD：获取资源的元数据。</li>
<li>OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的</li>
</ul>
<p>HTTP状态码</p>
<table class="table">
<thead>
<tr>
<th>Status Codes</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>200 OK - [GET]</td>
<td>服务器成功返回用户请求的数据，该操作是幂等的（Idempotent）</td>
</tr>
<tr>
<td>201 CREATED - [POST/PUT/PATCH]</td>
<td>用户新建或修改数据成功</td>
</tr>
<tr>
<td>202 Accepted - [*]</td>
<td>表示一个请求已经进入后台排队（异步任务）</td>
</tr>
<tr>
<td>204 NO CONTENT - [DELETE]</td>
<td>用户删除数据成功</td>
</tr>
<tr>
<td>400 INVALID REQUEST - [POST/PUT/PATCH]</td>
<td>用户发出的请求有错误，服务器没有进行新建或修改数据的操作，该操作是幂等的</td>
</tr>
<tr>
<td>401 Unauthorized - [*]</td>
<td>表示用户没有权限（令牌、用户名、密码错误）</td>
</tr>
<tr>
<td>403 Forbidden - [*]</td>
<td>表示用户得到授权（与401错误相对），但是访问是被禁止的</td>
</tr>
<tr>
<td>404 NOT FOUND - [*]</td>
<td>用户发出的请求针对的是不存在的记录，服务器没有进行操作，该操作是幂等的</td>
</tr>
<tr>
<td>406 Not Acceptable - [GET]</td>
<td>用户请求的格式不可得（比如用户请求JSON格式，但是只有XML格式）</td>
</tr>
<tr>
<td>410 Gone -[GET]</td>
<td>用户请求的资源被永久删除，且不会再得到的</td>
</tr>
<tr>
<td>422 Unprocesable entity - [POST/PUT/PATCH]</td>
<td>当创建一个对象时，发生一个验证错误</td>
</tr>
<tr>
<td>500 INTERNAL SERVER ERROR - [*]</td>
<td>服务器发生错误，用户将无法判断发出的请求是否成功</td>
</tr>
</tbody>
</table>
<p>Restful 设计示例：</p>
<ul>
<li>GET /users：列出所有用户</li>
<li>POST /users：新建一个用户</li>
<li>GET /users/{id}：获取某个指定用户的信息</li>
<li>PUT /users/{id}：更新某个指定用户的信息（提供该用户的全部信息）</li>
<li>PATCH /users/{id}：更新某个指定用户的信息（提供该用户的部分信息）</li>
<li>DELETE /users/{id}：删除某个用户</li>
<li>GET /users/{id}/roles：列出某个指定用户的所有角色</li>
<li>DELETE /users/{id}/roles/{roleId}：删除某个指定用户的指定角色</li>
</ul>
<h3 id="header-6">使用示例</h3>
<ol>
<li><p>SpringMVC配置加入Restful (<code>xxx-servlet.xml</code>)</p>
<pre><code class="nullxml"> <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.servlet.view.ContentNegotiatingViewResolver"</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"mediaTypes"</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span>
             <span class="hljs-comment">&lt;!-- &lt;entry key="html" value="text/html"/&gt; --&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"json"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"application/json"</span>/&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
     <span class="hljs-comment">&lt;!-- &lt;property name="defaultContentType" value="text/html"/&gt; --&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewResolvers"</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span>
                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewClass"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"org.springframework.web.servlet.view.JstlView"</span>/&gt;</span>
                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prefix"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"/WEB-INF/"</span>/&gt;</span>
                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"suffix"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">".jsp"</span>/&gt;</span>
             <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span> 
         <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"defaultViews"</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span>
             <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.web.servlet.view.json.MappingJacksonJsonView"</span> &gt;</span>
                 <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"objectMapper"</span>&gt;</span>
                     <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.codehaus.jackson.map.ObjectMapper"</span>&gt;</span>
                         <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"serializationConfig.serializationInclusion"</span>&gt;</span>
                             <span class="hljs-tag">&lt;<span class="hljs-name">value</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"org.codehaus.jackson.map.annotate.JsonSerialize.Inclusion"</span>&gt;</span>NON_NULL<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
                         <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> 
                     <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
                 <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span> 
             <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
         <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>
</code></pre>
</li>
<li><p>Controller</p>
<pre><code class="nulljava"> <span class="hljs-meta">@Controller</span>
 <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/users"</span>)
 <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span></span>{
     <span class="hljs-keyword">private</span> SysUserService userService;
     <span class="hljs-function"><span class="hljs-keyword">public</span> SysUserService <span class="hljs-title">getUserService</span><span class="hljs-params">()</span> </span>{<span class="hljs-keyword">return</span> userService;}
     <span class="hljs-meta">@Inject</span>
     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserService</span><span class="hljs-params">(SysUserService userService)</span> </span>{<span class="hljs-keyword">this</span>.userService = userService;}

     <span class="hljs-meta">@RequestMapping</span>(method=RequestMethod.GET)
     <span class="hljs-meta">@ResponseBody</span>
     <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">list</span><span class="hljs-params">()</span></span>{
         List&lt;User&gt; users=<span class="hljs-keyword">this</span>.userService.list();
         <span class="hljs-keyword">return</span> users;
     }

     <span class="hljs-meta">@RequestMapping</span>(value={<span class="hljs-string">"/{id}"</span>},method=RequestMethod.GET)
     <span class="hljs-meta">@ResponseBody</span>
     <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getUser</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id)</span>{
             <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userService.get(id);
     }

     <span class="hljs-meta">@RequestMapping</span>(method=RequestMethod.POST)
     <span class="hljs-meta">@ResponseBody</span>
     <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">create</span><span class="hljs-params">(@RequestBody User user,HttpServletRequest request)</span></span>{
         <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userService.save(user);
     }

     <span class="hljs-meta">@RequestMapping</span>(method=RequestMethod.POST)
     <span class="hljs-meta">@ResponseBody</span>
     <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">upload</span><span class="hljs-params">(@RequestParam(value=<span class="hljs-string">"file"</span>,required=<span class="hljs-keyword">true</span>)</span> MultipartFile file,
             @<span class="hljs-title">RequestParam</span><span class="hljs-params">(value=<span class="hljs-string">"remark"</span>,required=<span class="hljs-keyword">false</span>)</span> String remark) 
                     <span class="hljs-keyword">throws</span> IOException, InvalidFormatException
     </span>{
         System.out.println(<span class="hljs-string">"ContentType:"</span>+file.getContentType());
         System.out.println(<span class="hljs-string">"Name:"</span>+file.getName());
         System.out.println(<span class="hljs-string">"OriginalFilename:"</span>+file.getOriginalFilename());
         System.out.println(<span class="hljs-string">"Size:"</span>+file.getSize());
         System.out.println(<span class="hljs-string">"remark:"</span>+remark);

         String filename=file.getOriginalFilename();
         <span class="hljs-keyword">int</span> pos=filename.lastIndexOf(<span class="hljs-string">"."</span>);
         String fileExtesion=(pos!=-<span class="hljs-number">1</span>?filename.substring(pos+<span class="hljs-number">1</span>):<span class="hljs-string">"UnKnow"</span>);

         String realpath = req.getSession().getServletContext().getRealPath(<span class="hljs-string">"/resources/uploads/"</span>);
         FileUtils.copyInputStreamToFile(file.getInputStream(), <span class="hljs-keyword">new</span> File(realpath+File.separatorChar+fileName));
         <span class="hljs-keyword">return</span> ResponseUtils.sendSuccess(fileName);
     }
 }
</code></pre>
</li>
<li><p>测试</p>
<pre><code class="nulljava"> <span class="hljs-comment">//GET</span>
 MvcResult result=<span class="hljs-keyword">this</span>.mockMvc.perform(MockMvcRequestBuilders.get(url)
             .session(<span class="hljs-keyword">this</span>.mockSession)
             .contentType(MediaType.APPLICATION_JSON))
             .andDo(MockMvcResultHandlers.print())
             .andExpect(status().isOk())
             .andExpect(jsonPath(<span class="hljs-string">"$.success"</span>,Matchers.equalTo(<span class="hljs-keyword">true</span>)))
             .andReturn();

 <span class="hljs-comment">//POST</span>
 User user=<span class="hljs-keyword">new</span> User();
 user.setName(<span class="hljs-string">"xxx"</span>);
 user.setAge(xxx);

 ObjectMapper mapper = <span class="hljs-keyword">new</span> ObjectMapper();
 mapper.setSerializationInclusion(Include.NON_NULL);
 <span class="hljs-keyword">byte</span>[] reqBytes=mapper.writeValueAsString(user);

 MvcResult result=<span class="hljs-keyword">this</span>.mockMvc.perform(post(url)
             .contentType(MediaType.APPLICATION_JSON)
             .content(reqBytes))
             .andDo(MockMvcResultHandlers.print())
             .andExpect(status().isOk())
             <span class="hljs-comment">//.andExpect(jsonPath("$.success",Matchers.equalTo(true)))</span>
             .andExpect(jsonPath(<span class="hljs-string">"$.name"</span>,Matchers.equalTo(<span class="hljs-string">"xxx"</span>)))
             .andReturn();
</code></pre>
<p> 或使用<code>RestTemplate</code></p>
<pre><code class="nulljava"> RestTemplate restTemplate = <span class="hljs-keyword">new</span> RestTemplate();
 User[] users = restTemplate.getForObject(SERVER_URI+<span class="hljs-string">"/users"</span>, User[].class);
 User user = restTemplate.getForObject(SERVER_URI+<span class="hljs-string">"/users/{id}"</span>, User.class,id);
 User response = restTemplate.postForObject(SERVER_URI+<span class="hljs-string">"/users"</span>, user, User.class);
</code></pre>
</li>
</ol>
  </section>
</article>

      <hr/>
      
<section class="post-comment">
	
		<!-- disqus默认将数据加载到id为'disqus_thread'的容器中，可配置disqus_container_id改变-->
<div id="disqus_thread"> 
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

	<script type="text/javascript">
		var disqus_shortname = 'sixdegreespace'; 
		var disqus_identifier = '2013/07/15/SpringMVC.html';	
		var disqus_title = 'SpringMVC';
		var disqus_url = 'http://sixdegree.github.io/2013/07/15/SpringMVC.html' ;
		//var disqus_category_id = '4262241'; 

		(function() {
		    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>


 
	
</section>

    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/highlight/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  
  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
