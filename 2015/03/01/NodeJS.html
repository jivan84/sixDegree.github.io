<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>NodeJS</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="npm,stream,event,module,express,middleware,route,socket.io">
  
  
    <meta name="description" content="NodeJS Introduce">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
    <link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#Starter"><span class="sidebar-nav nav-text">Starter</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#npm"><span class="sidebar-nav nav-text">npm</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#HelloWorld"><span class="sidebar-nav nav-text">HelloWorld</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#Events"><span class="sidebar-nav nav-text">Events</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#Streams"><span class="sidebar-nav nav-text">Streams</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#Modules"><span class="sidebar-nav nav-text">Modules</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#Express"><span class="sidebar-nav nav-text">Express</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#Middleware"><span class="sidebar-nav nav-text">Middleware</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#Route-Instances"><span class="sidebar-nav nav-text">Route Instances</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#Request-Params"><span class="sidebar-nav nav-text">Request Params</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#常用module"><span class="sidebar-nav nav-text">常用module</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#body-parser"><span class="sidebar-nav nav-text">body parser</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#formidable"><span class="sidebar-nav nav-text">formidable</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#session"><span class="sidebar-nav nav-text">session</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#view-engine"><span class="sidebar-nav nav-text">view engine</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#Socket-io"><span class="sidebar-nav nav-text">Socket.io</span></a></li></ol></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">NodeJS</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2015-02-28T16:00:00.000Z">2015-03-01</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-NodeJs">NodeJs</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h2 id="Starter"><a href="#Starter" class="headerlink" title="Starter"></a>Starter</h2><blockquote>
<p>Allows you to build scalable network applications using JavaScript on the server-side.</p>
</blockquote>
<p>Node.js：</p>
<ul>
<li>用JavaScript编写服务端程序</li>
<li><code>V8</code>引擎</li>
<li>采用<code>单线程</code>+<code>非阻塞IO</code>的方式（以<code>事件</code>的方式通知<code>回调函数</code>）达到并行的目的（高吞吐量，充分利用CPU资源）</li>
<li>适合场景：<ul>
<li>数据密集型（大量读取数据文件）</li>
<li>实时交互系统</li>
</ul>
</li>
<li>不适合场景：<ul>
<li>计算量大</li>
<li>逻辑太复杂</li>
</ul>
</li>
</ul>
<p>nodeJS 本身并没有根目录的概念，并不能读取某个文件夹的静态文件，只能一个文件一个文件的运行<br>nodeJS 自身封装了一些模块，使用require(moduleName)引用<br>nodeJS 本身不具备路由功能，服务跑起来后，不管地址栏添加任何path，结果都不变</p>
<h3 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h3><p>npm （Node Package Manager）</p>
<ul>
<li>node包管理和分发工具，node自动安装</li>
<li>能很快找到特定服务需要的包，下载安装管理</li>
</ul>
<pre><code>-g 表示全局，不加-g，则安装在当前目录的node_modules下
&gt; npm install -g xxx

下载包并记录在package.json文件中的devDependencies下
&gt; npm install xxx --save-dev

下载包并记录在package.json文件中的dependencies下
&gt; npm install xxx --save

下载指定version    
&gt; npm install xxx@version

卸载node模块
&gt; npm uninstall moudleName

更新node模块
&gt; npm update moduleName
</code></pre><pre><code>根据当前目录下的package.json文件中声明的内容安装（dependencies的内容）
&gt; npm install

初始化（会引导你创建一个package.json文件）
&gt; npm init
</code></pre><pre><code>查看当前目录下已安装的node包
&gt; npm list

查看当前包的安装路径
&gt; npm root

查看全局的包的安装路径
&gt; npm root -g

查看npm安装的版本
&gt; npm -v
</code></pre><h3 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h3><p>nodeTest/01.js:</p>
<pre><code class="nulljs">var http=require(&#39;http&#39;);
http.createServer(function(request,response){
    console.log(request.url);
    res.writeHead(200,{&#39;Content-Type&#39;:&#39;text/plain&#39;});
    res.end(&#39;Hello world&#39;);
}).listen(1337);
console.log(&#39;Listening on port 1337&#39; );
</code></pre>
<p>执行：</p>
<pre><code>&gt; node nodeTest/01.js
</code></pre><p>浏览器中访问：<code>http://localhost:1337</code>,<code>http://localhost:1337/123</code>查看效果</p>
<h3 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h3><pre><code class="nulljs">var EventEmitter=require(&#39;events&#39;).EventEmitter;
var logger=new EventEmitter();

//绑定事件
logger.on(&#39;error&#39;,function(msg){
    console.log(&#39;Err:&#39;+msg);
});

//触发事件
logger.emit(&#39;error&#39;,&#39;Wrong number&#39;);
logger.emit(&#39;error&#39;,&#39;Unknow cmd&#39;);
</code></pre>
<p>Node里面的许多对象都会emit事件<br>例如：<br><code>class http.Server</code>是一个<code>EventEmitter</code>，当有一个<code>request</code>时，就会通知绑定的<code>function(request,response){...}</code>执行</p>
<pre><code class="nulljs">http.createServer(function(request,response){...});

//等价于：
var server=http.createServer();
server.on(&#39;request&#39;,function(request,response){...});
</code></pre>
<h3 id="Streams"><a href="#Streams" class="headerlink" title="Streams"></a>Streams</h3><p>Stream可分为：</p>
<ul>
<li>readable<ul>
<li>事件<ul>
<li>readable</li>
<li>data</li>
<li>end</li>
<li>close</li>
<li>error</li>
</ul>
</li>
<li>方法<ul>
<li>read</li>
<li>pause</li>
<li>resume</li>
<li>pipe</li>
<li>unpipe</li>
</ul>
</li>
</ul>
</li>
<li>writeable<ul>
<li>事件<ul>
<li>drain</li>
<li>finish</li>
<li>pipe</li>
<li>unpipe</li>
</ul>
</li>
<li>方法<ul>
<li>write</li>
<li>end</li>
</ul>
</li>
</ul>
</li>
<li>readable &amp; writeable</li>
</ul>
<p>例如1：</p>
<pre><code class="nulljs">http.createServer(function(request,response){
    response.writeHead(200);
    request.on(&#39;data&#39;,function(chunk){
        response.write(chunk);
    });
    request.on(&#39;end&#39;,function(){
        response.end();
    })
}).listen(8080)
</code></pre>
<p>等同于：</p>
<pre><code class="nulljs">http.createServer(function(request,response){
    response.writeHead(200);
    request.pipe(response)
}).listen(8080)
</code></pre>
<ul>
<li><code>request</code>为readable stream</li>
<li><code>response</code>为writable stream</li>
<li>测试：<pre><code>  &gt; curl -d &#39;hello&#39; http://localhost:8080`
  &gt; curl --upload-file readme.md http://localhost:8080`
</code></pre></li>
</ul>
<p>例如2：</p>
<pre><code class="nulljs">readStream.on(&#39;data&#39;,function(chunk){
    var buffer_good =writeStream.write(chunk);    //返回true/false，表明数据是否被写入目标了
    if (!buffer_good)                //为false，表示数据临时放在了缓存，而未写入目标
        readStream.pause();        //暂停读取
});
writeStream.on(&#39;drain&#39;,function(){
    readStream.resume();            //恢复读取
})
</code></pre>
<p>等同于：</p>
<pre><code class="nulljs">//pipe可以解决当延迟非常大时导致的读写不平衡问题
readStream.pipe(writeStream);
</code></pre>
<h3 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h3><ul>
<li>定义一个Module：<code>module.exports=xxx</code></li>
<li>调用自定义Module：<code>require(path)</code> 使用相对路径或绝对路径</li>
<li>调用外部的Module：<code>require(moduleName)</code> 会从当前目录逐层往上搜索<code>node_modules</code>目录</li>
</ul>
<p>示例：</p>
<p>makeRequest.js</p>
<pre><code class="nulljs">var http=require(&#39;http&#39;);
module.exports=function(opts,message){
    var request=http.request(opts,function(response){
        response.on(&#39;data&#39;,function(data){
            console.log(data);
        });
        request.write(message);
        request.end();
    })
}
</code></pre>
<p>调用</p>
<pre><code class="nulljs">var makeRequest=require(&#39;./makeRequest&#39;);
markeRequest({host:&#39;localhost&#39;,&#39;port&#39;:8080,path:&#39;/&#39;,method:&#39;POST&#39;},&quot;Hello world!&quot;);
</code></pre>
<h2 id="Express"><a href="#Express" class="headerlink" title="Express"></a>Express</h2><p><a href="http://www.expressjs.com.cn/4x/api.html">Express.js框架</a>: 极大的简化了nodeJS开发</p>
<pre><code>&gt; npm install express
</code></pre><pre><code class="nulljs">var express=require(&#39;express&#39;);
var app=express();

...

app.listen(1337,function(){
    console.log(&quot;Listen on port 1337&quot;);
});
</code></pre>
<h3 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h3><p>一个Express应用，从本质上来说，就是一系列中间件的调用</p>
<p><img src="2015-03-01-NodeJS/middleware.png" alt="Middleware"></p>
<ul>
<li><p>中间件就是一函数，形式如下：</p>
<pre><code class="nulljs">function(request,response,next){
  ...
  //next(); or next(xxx); or response.xxx
}
</code></pre>
<pre><code class="nulljs">//错误处理的中间件
function(err, req, res, next){
  ...
  //err.status,err.message
}
</code></pre>
<ul>
<li>request<ul>
<li>query string：<code>request.query.xxx</code></li>
<li>placeholder in url：<code>request.params.xxx</code></li>
</ul>
</li>
<li>response<ul>
<li>response.send(xxx),response.json(xxx),response.sendFile(xxx)</li>
<li>response.status(xxx), response.status(xxx).json(xxx)</li>
<li>response.render(xxx)</li>
<li>response.redirect(xxx)</li>
</ul>
</li>
<li>next<ul>
<li>next()表示传递给下一个中间件进行处理</li>
<li>如果带参数，则代表抛出一个错误</li>
</ul>
</li>
</ul>
</li>
<li><p>注册中间件</p>
<ul>
<li><code>app.use([path], [function, ...] function)</code></li>
<li><code>app.METHOD([path], [function, ...] function)</code> （METHOD可为get,post,put,delete,all,param等）</li>
</ul>
</li>
</ul>
<p>使用举例1：Express的static middleware</p>
<ul>
<li>项目目录结构：<pre><code>  nodeTest
  - app.js
  - public/
      - blocks.jpg
      - index.html
</code></pre></li>
<li>使用static middleware<pre><code class="nulljs">  app.use(express.static(&#39;public&#39;));
</code></pre>
</li>
<li>访问静态资源：<ul>
<li>GET <code>http://localhost:1337/blocks.jpg</code></li>
<li>GET <code>http://localhost:1337/index.html</code></li>
</ul>
</li>
</ul>
<p>使用举例2：自定义Middleware</p>
<ul>
<li>logger.js<pre><code class="nulljs">  module.exports=function(request,response,next){
      ...
      next();
  }
</code></pre>
</li>
<li>使用自定义的logger middleware<pre><code class="nulljs">  var logger=require(&#39;./logger&#39;);
  app.use(logger);
</code></pre>
</li>
</ul>
<h3 id="Route-Instances"><a href="#Route-Instances" class="headerlink" title="Route Instances"></a>Route Instances</h3><pre><code class="nulljs">app.route(&#39;/blocks&#39;)
    .get(function(request,response,next){
        ...
    })
    .post(parseUrlencoded, function(request, response) {
    ...
    });

app.route(&#39;/blocks/:name&#39;)
    .all(function(request,response,next){
        ...
        next();
    })
    .get(function(request,response,next){
        ...
    })
    .delete(function(request,response,next){
        ...
    });
</code></pre>
<p>从Express 4.0开始，路由器功能成了一个单独的组件<code>Express.Router</code></p>
<ul>
<li>router.use(…)</li>
<li>router.METHOD(…)</li>
<li>router.route(…)</li>
<li><code>...</code>为<code>[path], [function, ...] function</code></li>
</ul>
<pre><code class="nulljs">var express = require(&#39;express&#39;);
var router=express.Router();
router.route(&#39;/&#39;)
    .get(function(request,response,next){
        ...
    })
    .post(parseUrlencoded, function(request, response) {
    ...
    });
router.route(&#39;/:name&#39;)
    .all(function(request,response,next){
        ...
        next();
    })
    .get(function(request,response,next){
        ...
    })
    .delete(function(request,response,next){
        ...
    });
module.exports = router;
</code></pre>
<pre><code class="nulljs">var blocks=require(&#39;./routes/blocks&#39;);
app.use(&#39;/blocks&#39;,blocks);
</code></pre>
<h3 id="Request-Params"><a href="#Request-Params" class="headerlink" title="Request Params"></a>Request Params</h3><p>示例1：<code>request.params.xxx</code>,<code>request.query.xxx</code></p>
<pre><code class="nulljs">app.get(&#39;/blocks/:name&#39;, function(request, response) {
    console.log(request.params.name);
    console.log(request.query.limit);
    response.send(request.query.limit+&quot;,&quot;+request.params.name);
});
</code></pre>
<pre><code>&gt; curl -i http://localhost:1337/blocks/test?limit=5

HTTP/1.1 200 OK
&quot;5,test&quot;
</code></pre><p>示例2：<code>app.param(...)</code></p>
<pre><code class="nulljs">app.param(&#39;name&#39;, function(request, response, next) {
    request.name=request.params.name;
    next();
});

app.get(&#39;/blocks/:name&#39;, function(request, response,next) {
    console.log(request.name);
    console.log(request.params.name);
    ...
});
</code></pre>
<p>示例3：<code>app.all(...)</code></p>
<pre><code class="nulljs">app.all(&#39;/blocks/:name&#39;,function(request,response,next){
    request.name=request.params.name;
    next();
})
app.get(&#39;/blocks/:name&#39;, function(request, response,next) {
    console.log(request.name);
    console.log(request.params.name);
    ...
});
</code></pre>
<h2 id="常用module"><a href="#常用module" class="headerlink" title="常用module"></a>常用module</h2><h3 id="body-parser"><a href="#body-parser" class="headerlink" title="body parser"></a>body parser</h3><p>Node.js body parsing middleware.provides the following parsers: (<a href="https://www.npmjs.com/package/body-parser">官网</a>)</p>
<ul>
<li>JSON body parser <code>bodyParser.json(options)</code> (parse <code>application/json</code>)</li>
<li>Raw body parser    <code>bodyParser.raw(options)</code></li>
<li>Text body parser    <code>bodyParser.text(options)</code></li>
<li>URL-encoded form body parser <code>bodyParser.urlencoded(options)</code> （parse <code>application/x-www-form-urlencoded</code> ）</li>
</ul>
<p>注意：body-parser does not handle multipart bodies （无法解析<code>multipart/form-data</code>）</p>
<p>使用示例：</p>
<p>安装<code>body-parser</code>包（parse form elements to object properties）</p>
<pre><code>&gt; npm install body-parser
</code></pre><p>后台使用：（ <code>request.body</code> ：get form data）</p>
<pre><code class="nulljs">var bodyParser=require(&#39;body-parser&#39;);
var parseUrlencoded=bodyParser.urlencoded({extended:false});

app.post(&#39;/blocks&#39;,parseUrlencoded,function(request,response,next){
    //request.body.xxx
    ...
})
</code></pre>
<p>前台触发：</p>
<pre><code class="nullhtml">$.ajax({
    type:&#39;POST&#39;,url:&#39;/blocks&#39;,data:$(&quot;#blockForm&quot;).serialize()
}).done(function(data){
    console.log(data);
});
</code></pre>
<h3 id="formidable"><a href="#formidable" class="headerlink" title="formidable"></a>formidable</h3><pre><code>&gt; npm install formidable
</code></pre><p>后端：</p>
<pre><code class="nulljs">var formidable=require(&#39;formidable&#39;);
app.post(&#39;/blocks&#39;,function(req,res){
    var form=formidable.IncomingForm();
    form.on(&#39;field&#39;,function(name,value){
        console.log(name+&quot;:&quot;+value);
    });
    form.on(&#39;file&#39;,function(name,file){
        console.log(name+&quot;+&quot;+file.size);
    });
    form.on(&#39;end&#39;,function(){
        console.log(&#39;end&#39;);
        ...
    });
});
</code></pre>
<pre><code class="nulljs">var formidable=require(&#39;formidable&#39;);
app.post(&#39;/blocks&#39;,function(req,res){
    var form=formidable.IncomingForm();
    form.parse(req, function(err, fields, files) {
        console.log(fields);
        console.log(files);
    });
});
</code></pre>
<pre><code class="nulljs">var formidable=require(&#39;formidable&#39;);
app.post(&#39;/blocks&#39;,function(req,res){
    var form=formidable.IncomingForm();

    //all fields and files are collected and passed to the callback
    form.parse(req, function(err, fields, files) {
        console.log(arguments);
        //end
         res.json({success:false,data:JSON.stringify(block)});
    });
    //overwrite onPart to filter
    form.onPart = function(part) {
      if(part.filename){
          //在这里处理file，不再交给formidable继续处理（不会再触发file事件）
        part.pipe(fs.createWriteStream(part.filename));
      }else{
          form.handlePart(part);    //交给formidable继续处理
      }
    };
    // 处理POST 普通数据（ 不包含文件 ）
    form.on(&#39;field&#39;,function(name,value){
         block[name]=value;
    });
});
</code></pre>
<p>前端：</p>
<pre><code class="nulljs"> var formData = new FormData($(&quot;form&quot;)[0]);
 $.ajax({
    url: &#39;/blocks&#39;,
    type: &#39;POST&#39;,
    data: formData,
    processData: false
}).done(function(data){
    console.log(data);
});
</code></pre>
<h3 id="session"><a href="#session" class="headerlink" title="session"></a>session</h3><pre><code>&gt; npm install cookie-parser
&gt; npm install express-session
</code></pre><p>示例1：</p>
<pre><code class="nulljs">var cookieParser = require(&#39;cookie-parser&#39;);
var session=require(&quot;express-session&quot;);
app.use(cookieParser)
    .use(session({
        resave:false,
        saveUninitialized:true,
        secret:&quot;xxxx&quot;
    }));

app.post(&quot;/j_spring_security_check&quot;,function(request,response,next){
    request.session.loginUser=request.body.username;
    ...
});

app.get(&#39;/j_spring_security_logout&#39;,function(request,response){
    console.log(request.session);
    request.session.destroy(function(err){
        if(err)
            throw err;
        console.log(&quot;destroy session!&quot;);
    });
    ...
});
</code></pre>
<p>示例2：使用Redis存储session</p>
<pre><code>&gt; npm install connect-redis
</code></pre><pre><code class="nulljs">var RedisStore = require(&#39;connect-redis&#39;)(session);
app.use(session({
store: new RedisStore({
    host: &quot;127.0.0.1&quot;,
    port: 6379,
    db: &quot;test_session&quot;
  }),
  resave:false,
  saveUninitialized:false,
  secret: &#39;xxx&#39;
}))；
</code></pre>
<p>示例3：使用MongoDB存储session</p>
<pre><code>&gt; npm install connect-mongo
</code></pre><pre><code class="nulljs">var MongoStore = require(&#39;connect-mongo&#39;)(session);
app.use(session({
     store: new MongoStore({
         host: &#39;localhost&#39;,
         port: 27017,
         db: &#39;test-app&#39;
     })
     secret: &#39;xxx&#39;,
     resave: false,
     saveUninitialized: true,
 }));
</code></pre>
<h3 id="view-engine"><a href="#view-engine" class="headerlink" title="view engine"></a>view engine</h3><p>示例：使用ejs</p>
<pre><code>&gt; npm install ejs
</code></pre><pre><code class="nulljs">var ejs=require(&quot;ejs&quot;);
app.set(&#39;views&#39;, path.join(__dirname, &#39;views&#39;));
app.set(&#39;view engine&#39;, &#39;html&#39;);
app.engine(&#39;html&#39;,ejs.__express) ;

app.get(&#39;/test&#39;,function(request,response,next){
    request.render(&#39;test&#39;, {title: &#39;Test Message&#39;});
});
</code></pre>
<h3 id="Socket-io"><a href="#Socket-io" class="headerlink" title="Socket.io"></a>Socket.io</h3><blockquote>
<p>Using duplexed websocket connection</p>
</blockquote>
<p>安装</p>
<pre><code>&gt; npm install socket.io
</code></pre><p>使用示例：</p>
<p>app.js</p>
<pre><code class="nulljs">var socket=require(&#39;socket.io&#39;);
var express=require(&#39;express&#39;);
var path = require(&#39;path&#39;);

var app=express();
var server = require(&#39;http&#39;).Server(app);
var io=socket.listen(server);
server.listen(1337);

app.get(&#39;/&#39;, function(req, res){
  //res.send(&#39;&lt;h1&gt;Hello world&lt;/h1&gt;&#39;);
  res.sendFile(path.join(__dirname,&#39;/01.html&#39;));
});

io.set(&#39;log level&#39;, 2);        // 0:error，1:warn，2:info，3:debug
io.sockets.on(&#39;connection&#39;,function(client){
    client.on(&#39;join&#39;,function(name){
        client.set(&#39;nickname&#39;,name);
        client.broadcast.emit(&quot;status&quot;,name+&quot; joined!&quot;);
    });
    client.on(&#39;message&#39;,function(data){
        client.get(&#39;nickname&#39;,function(err,name){
            io.sockets.emit(&quot;chat&quot;,name+&quot; : &quot;+data);
        });
    });
    client.on(&#39;disconnect&#39;,function(name){
        client.get(&#39;nickname&#39;,function(err,name){
            client.broadcast.emit(&quot;status&quot;,name+&quot; leaved!&quot;);
        });
    });
});
</code></pre>
<p>01.html</p>
<pre><code class="nullhtml">...
&lt;script type=&quot;text/javascript&quot; src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;vender/jquery/jquery.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
    var server=io.connect(&#39;http://localhost:8080&#39;);
    var content=$(&quot;#content&quot;);
    server.on(&quot;connect&quot;,function(){
        content.html(&#39;Connected&#39;);
        var nickname=prompt(&quot;What is your nickname?&quot;);
        server.emit(&quot;join&quot;,nickname);
        $(&quot;#clientName&quot;).text(&quot;--&quot;+nickname);
    });
    server.on(&quot;chat&quot;,function(data){
        content.append(&quot;&lt;p&gt;&quot;+data+&quot;&lt;/p&gt;&quot;);
    });
    server.on(&quot;status&quot;,function(data){
        content.append(&quot;&lt;div&gt;&lt;small&gt;&quot;+data+&quot;&lt;/small&gt;&lt;/div&gt;&quot;);
    });
    $(&quot;#chatForm&quot;).on(&quot;submit&quot;,function(event){
        event.preventDefault();
        server.emit(&quot;message&quot;,$(&quot;#chatInput&quot;).val());
        $(&quot;#chatInput&quot;).val(&quot;&quot;);
    });
&lt;/script&gt;
</code></pre>
<p>测试</p>
<pre><code>&gt; node nodeTest/app.js
</code></pre>
  </section>
</article>

      <hr/>
      <section class="post-comment">
	<!-- disqus默认将数据加载到id为'disqus_thread'的容器中，可配置disqus_container_id改变-->
<div id="disqus_thread"> 
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

	<script type="text/javascript">
		var disqus_shortname = 'sixdegreespace'; 
		var disqus_identifier = '2015/03/01/NodeJS.html';	
		var disqus_title = 'NodeJS';
		var disqus_url = 'http://sixdegree.github.io/2015/03/01/NodeJS.html' ;
		//var disqus_category_id = '4262241'; 

		(function() {
		    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>


 
</section>
    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/highlight/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  
  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
