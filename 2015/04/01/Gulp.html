<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Gulp</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="gulp,build,vinyl,stream,buffer">
  
  
    <meta name="description" content="Gulp Introduce">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
    <link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">Starter</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">安装</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">API</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">SyncTask</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">Vinyl</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-6"><span class="sidebar-nav nav-text">Doc</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-7"><span class="sidebar-nav nav-text">常用插件</span></a></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">Gulp</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2015-03-31T16:00:00.000Z">2015-04-01</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-NodeJs">NodeJs</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h2 id="header-1">Starter</h2>
<p>Gulp 基于流的自动化构建工具 （功能同Grunt）</p>
<h3 id="header-2">安装</h3>
<p>安装全局gulp</p>
<pre><code>&gt; npm install gulp -g
&gt; gulp help
</code></pre><p>在项目中使用gulp</p>
<pre><code># 安装gulp
&gt; npm install gulp --save-dev

# 编写gulpfile.js文件
&gt; vim gulpfile.js
...

# 执行task
&gt; gulp xxx
</code></pre><h3 id="header-3">API</h3>
<ul>
<li><p><code>gulp.src(globs[, options])</code></p>
<ul>
<li><code>options.buffer</code>：true（默认），false表示stream方式读取文件内容</li>
<li><code>options.read</code>：true（默认）, false表示不读取文件内容</li>
<li><p><code>options.base</code>：everything before a glob starts（默认）</p>
<ul>
<li><p>eg: <code>&#39;client/js/**/*.js&#39;</code>，则base默认为<code>client/js</code>；<code>client/js/test.js</code>, base默认为<code>client/js</code></p>
<pre><code class="nulljs">gulp.src(<span class="hljs-string">'client/js/**/*.js'</span>) <span class="hljs-comment">// Matches 'client/js/somedir/somefile.js' and resolves `base` to `client/js/`</span>
.pipe(minify())
.pipe(gulp.dest(<span class="hljs-string">'build'</span>));  <span class="hljs-comment">// Writes 'build/somedir/somefile.js'</span>

gulp.src(<span class="hljs-string">'client/js/**/*.js'</span>, { <span class="hljs-attr">base</span>: <span class="hljs-string">'client'</span> })
.pipe(minify())
.pipe(gulp.dest(<span class="hljs-string">'build'</span>));  <span class="hljs-comment">// Writes 'build/js/somedir/somefile.js'</span>
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>gulp.dest(path[, options])</code></p>
<ul>
<li>options.cwd：process.cwd() 前脚本的工作目录的路径，当文件输出路径为相对路径将会用到</li>
<li>options.mode：0777 （默认），指定被创建文件夹的权限</li>
</ul>
</li>
<li><p><code>gulp.task(name[, deps], fn)</code></p>
<ul>
<li>name：任务名</li>
<li>deps ：为一个数组，是当前定义的任务需要依赖的其他任务（可不设置），默认依赖任务会并行执行</li>
<li>fn：任务函数（deps中的任务先执行）<pre><code class="nulljs">gulp.task(<span class="hljs-string">'mytask'</span>, [<span class="hljs-string">'array'</span>, <span class="hljs-string">'of'</span>, <span class="hljs-string">'task'</span>, <span class="hljs-string">'names'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-comment">// Do stuff</span>
});
</code></pre>
</li>
</ul>
</li>
<li><code>gulp.watch(glob [, opts], tasks)</code><pre><code class="nulljs">  gulp.watch(<span class="hljs-string">'js/**/*.js'</span>, [<span class="hljs-string">'uglify'</span>,<span class="hljs-string">'reload'</span>]);
</code></pre>
</li>
<li><code>gulp.watch(glob [, opts, cb])</code><pre><code class="nulljs">  gulp.watch(<span class="hljs-string">'js/**/*.js'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)</span>{
      <span class="hljs-built_in">console</span>.log(event.type); <span class="hljs-comment">//变化类型 added为新增,deleted为删除，changed为改变 </span>
      <span class="hljs-built_in">console</span>.log(event.path); <span class="hljs-comment">//变化的文件的路径</span>
  });
</code></pre>
</li>
</ul>
<p>说明：</p>
<ul>
<li><code>globs</code> : String  or  Array<ul>
<li>文件匹配模式(类似正则表达式)，Gulp内部使用了<code>node-glob</code>模块来实现其文件匹配功能</li>
<li><code>**</code>，<code>*</code>,<code>?</code>,<code>!</code>,<code>[...]</code>,<code>[^...]</code>,<code>{...}</code></li>
</ul>
</li>
</ul>
<h3 id="header-4">SyncTask</h3>
<p>想等待异步任务中的异步操作完成后再执行后续的任务，有三种方法可以实现：</p>
<ol>
<li>Passing in a callback<pre><code class="nulljs"> gulp.task(<span class="hljs-string">'sync'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cb</span>) </span>{
     <span class="hljs-comment">// setTimeout could be any async task</span>
     setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
         cb();
     }, <span class="hljs-number">1000</span>);
 });
</code></pre>
</li>
<li>Returning a stream （适用于任务就是操作gulp.src获取到的流的情况）<pre><code class="nulljs"> gulp.task(<span class="hljs-string">'sync'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
     <span class="hljs-keyword">return</span> gulp.src(<span class="hljs-string">'js/*.js'</span>)
         .pipe(concat(<span class="hljs-string">'script.min.js'</span>)
         .pipe(uglify())
         .pipe(gulp.dest(<span class="hljs-string">'../dist/js'</span>);
 });
</code></pre>
</li>
<li>Returning a Promise<pre><code class="nulljs"> <span class="hljs-keyword">var</span> Q = <span class="hljs-built_in">require</span>(<span class="hljs-string">'q'</span>);
 gulp.task(<span class="hljs-string">'one'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
   <span class="hljs-keyword">var</span> deferred = Q.defer();
   setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      deferred.resolve();
   }, <span class="hljs-number">5000</span>);
   <span class="hljs-keyword">return</span> deferred.promise;
 });
</code></pre>
</li>
</ol>
<p>测试：</p>
<pre><code class="nulljs">gulp.task(<span class="hljs-string">'secondTask'</span>, [<span class="hljs-string">'sync'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// this task will not start until the sync task is all done!</span>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'secondTask is done'</span>);
});
</code></pre>
<p>注意： 默认情况下，依赖任务们会并行执行<br>例如：</p>
<pre><code class="nulljs">gulp.task(<span class="hljs-string">'otherTask'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-comment">//no dependent tasks</span>
    ...
});

<span class="hljs-comment">//sync,otherTask会同时执行，然后执行default的fn</span>
gulp.task(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sync'</span>,<span class="hljs-string">'otherTask'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
   <span class="hljs-comment">// do stuff</span>
});
</code></pre>
<p>解决方案：</p>
<pre><code class="nulljs">gulp.task(<span class="hljs-string">'otherTask'</span>,[<span class="hljs-string">"sync"</span>],<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-comment">//depends on sync</span>
    ...
});
<span class="hljs-comment">//先执行sync，然后执行otherTask，最后执行default的fn</span>
gulp.task(<span class="hljs-string">'default'</span>, [<span class="hljs-string">'sync'</span>,<span class="hljs-string">'otherTask'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
   <span class="hljs-comment">// do stuff</span>
});
</code></pre>
<p>书写太麻烦，推荐插件<code>run-sequence</code></p>
<pre><code class="nulljs"><span class="hljs-keyword">var</span> runSequence = <span class="hljs-built_in">require</span>(<span class="hljs-string">'run-sequence'</span>);
gulp.task(<span class="hljs-string">'some-task'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    runSequence(
            [<span class="hljs-string">'task-1'</span>, <span class="hljs-string">'task-2'</span>, <span class="hljs-string">'task-3'</span>], <span class="hljs-comment">// These 3 can be done in parallel</span>
            <span class="hljs-string">'task-4'</span>, <span class="hljs-comment">// ...then just do this</span>
            [<span class="hljs-string">'task-5'</span>, <span class="hljs-string">'task-5'</span>], <span class="hljs-comment">// ...then do these things in parallel</span>
            <span class="hljs-string">'task-6'</span>, <span class="hljs-comment">// ...then do this</span>
            <span class="hljs-comment">// ....</span>
    );
});
</code></pre>
<h3 id="header-5">Vinyl</h3>
<p>vinyl 文件对象 （一种虚拟文件格式）</p>
<ul>
<li>有一个 <code>contents</code> 属性来存放文件内容</li>
<li>内容可以是以下三种形式：<ul>
<li><code>Stream</code></li>
<li><code>Buffer</code></li>
<li><code>null</code></li>
</ul>
</li>
<li>判断 contents 属性存放内容的类型：<ul>
<li><code>isBuffer()</code>: Returns true if file.contents is a Buffer.</li>
<li><code>isStream()</code>: Returns true if file.contents is a Stream.</li>
<li><code>isNull()</code>: Returns true if file.contents is null.</li>
</ul>
</li>
</ul>
<p>Gulp：</p>
<ul>
<li>gulp 中的流，预期操作的是 vinyl 文件对象</li>
<li>不兼容：<ul>
<li>常规流与vinyl文件对象流是不同的</li>
<li>gulp api ,plugin 中操作vinyl对象内容类型（stream，buffer）可能会不同</li>
</ul>
</li>
<li><p>示例</p>
<ul>
<li><code>fs.createReadStream(...)</code> 常规读取流，得到的是数据块（chunk）</li>
<li><p><code>gulp.src(...)</code> 默认得到的是把内容转换成 buffer 的 vinyl 文件对象，而不是数据块（chunk），可以通过设置 <code>buffer: false</code> 选项，可以让 gulp 禁用 buffer</p>
<pre><code class="nulljs">fs.createReadStream(<span class="hljs-string">'/usr/share/dict/words'</span>).on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunk</span>) </span>{  
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Read %d bytes of data'</span>, chunk.length);
});

输出结果：
&gt; Read <span class="hljs-number">65536</span> bytes <span class="hljs-keyword">of</span> data
&gt; Read <span class="hljs-number">65536</span> bytes <span class="hljs-keyword">of</span> data
&gt; Read <span class="hljs-number">65536</span> bytes <span class="hljs-keyword">of</span> data
&gt; Read <span class="hljs-number">65536</span> bytes <span class="hljs-keyword">of</span> data
...
</code></pre>
<pre><code class="nulljs">gulp.src(<span class="hljs-string">'/usr/share/dict/words'</span>).on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{  
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Read %d bytes of data'</span>, file.contents.length);
});

输出结果：
&gt; Read <span class="hljs-number">2493109</span> bytes <span class="hljs-keyword">of</span> data
</code></pre>
<pre><code class="nulljs">gulp.src(<span class="hljs-string">'/usr/share/dict/words'</span>, {<span class="hljs-attr">buffer</span>: <span class="hljs-literal">false</span>}).on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file</span>) </span>{  
<span class="hljs-keyword">var</span> stream = file.contents;
stream.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunk</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Read %d bytes of data'</span>, chunk.length);
});
});

输出结果：
&gt; Read <span class="hljs-number">65536</span> bytes <span class="hljs-keyword">of</span> data
&gt; Read <span class="hljs-number">65536</span> bytes <span class="hljs-keyword">of</span> data
&gt; Read <span class="hljs-number">65536</span> bytes <span class="hljs-keyword">of</span> data
&gt; Read <span class="hljs-number">65536</span> bytes <span class="hljs-keyword">of</span> data
&gt; ...
</code></pre>
</li>
</ul>
</li>
</ul>
<p>解决流不兼容问题：</p>
<ul>
<li><p>使用第三方插件：</p>
<ul>
<li>vinyl-source-stream：常规流 =&gt; vinyl文件对象(Stream)</li>
<li><p>vinyl-buffer：vinyl文件对象(Stream)  =&gt; vinyl文件对象(Buffer)</p>
<pre><code class="nulljs"><span class="hljs-keyword">var</span> fs=<span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">var</span> source = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vinyl-source-stream'</span>);
<span class="hljs-keyword">var</span> buffer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vinyl-buffer'</span>);
<span class="hljs-keyword">var</span> uglify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-uglify'</span>);

fs.createReadStream(<span class="hljs-string">'./src/app.js'</span>)
    .pipe(source(<span class="hljs-string">'app.min.js'</span>)) <span class="hljs-comment">// 常规流 =&gt; vinyl 对象(stream)</span>
    .pipe(buffer())             <span class="hljs-comment">// vinyl 对象(stream) =&gt; vinyl文件对象(Buffer)</span>
    .pipe(uglify())             <span class="hljs-comment">// gulp-uglify 只支持处理vinyl文件对象(Buffer)</span>
    .pipe(gulp.dest(<span class="hljs-string">'dist/'</span>));

gulp.src(<span class="hljs-string">'app.js'</span>, {<span class="hljs-attr">buffer</span>: <span class="hljs-literal">false</span>})
    .pipe(buffer())         <span class="hljs-comment">// vinyl 对象(Stream) =&gt; vinyl文件对象(Buffer)</span>
    .pipe(uglify())
    .pipe(gulp.dest(<span class="hljs-string">'dist/'</span>));

gulp.src(<span class="hljs-string">'app.js'</span>)
    .pipe(uglify())
    .pipe(gulp.dest(<span class="hljs-string">'dist/'</span>));
</code></pre>
</li>
</ul>
</li>
<li><p>使用gulp插件：</p>
<ul>
<li>gulp-buffer：vinyl文件对象(Stream)  =&gt; vinyl文件对象(Buffer)</li>
<li>gulp-streamify：vinyl文件对象(Stream)  =&gt; vinyl文件对象(Buffer) =&gt; 其他处理 =&gt; vinyl文件对象(Stream) </li>
</ul>
</li>
<li><p>使用<code>through2</code>自定义处理</p>
<pre><code class="nulljs">  <span class="hljs-keyword">var</span> modify=modify(opts){
      <span class="hljs-keyword">return</span> through2.obj(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file,encoding,next</span>)</span>{
          <span class="hljs-comment">//file为上游读流产生的文件数据</span>
          <span class="hljs-comment">//next用于向下游传递处理后的数据</span>

          <span class="hljs-built_in">console</span>.log(file.path);
          <span class="hljs-built_in">console</span>.log(file.isNull());
          <span class="hljs-built_in">console</span>.log(file.isStream());

          <span class="hljs-keyword">var</span> contents=<span class="hljs-built_in">String</span>(file.contents);
          file.contents=<span class="hljs-keyword">new</span> Buffer(contents);
          next(<span class="hljs-literal">null</span>,file);     <span class="hljs-comment">// this.push(file); next();</span>
      });
  }

  fs.createReadStream(<span class="hljs-string">'/tmp/important.dat'</span>)
      .pipe(modify())
      .pipe(fs.createWriteStream(<span class="hljs-string">'/tmp/out.txt'</span>));

  gulp.src(<span class="hljs-string">'/tmp/important.dat'</span>)
          .pipe(modify())
          .pipe(gulp.dest(<span class="hljs-string">'dist/'</span>));
</code></pre>
</li>
</ul>
<p>综合测试：</p>
<pre><code class="nulljs">fs.createReadStream(<span class="hljs-string">"./posts/articles/"</span>+filename)
    .pipe(source(<span class="hljs-string">"2013-11-13-a1.md"</span>))
    .pipe(gulp.dest(<span class="hljs-string">"./dist/articles"</span>))
    .pipe(through2.obj(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file,enc,next</span>)</span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Now is "</span>+(file.isStream()?<span class="hljs-string">"Stream"</span>:<span class="hljs-string">"Buffer"</span>));
        next(<span class="hljs-literal">null</span>,file);
    }))
    .pipe(buffer())
    .pipe(through2.obj(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file,enc,next</span>)</span>{
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Now is "</span>+(file.isStream()?<span class="hljs-string">"Stream"</span>:<span class="hljs-string">"Buffer"</span>));
        next(<span class="hljs-literal">null</span>,file);
    }))
    ;
</code></pre>
<pre><code class="nulljs">gulp.src(<span class="hljs-string">"./posts/articles/????-??-??-*.md"</span>)
    .pipe(through2.obj(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file,enc,next</span>)</span>{
        <span class="hljs-built_in">console</span>.log(file.path);
        <span class="hljs-built_in">console</span>.log(path.basename(file.path,<span class="hljs-string">".md"</span>));
        <span class="hljs-comment">//console.log(path.basename(file.path));</span>
        <span class="hljs-keyword">if</span>(file.isNull()) {
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"This file is Empty!"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(file.isStream()){
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"This function is not support Stream!"</span>);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (file.isBuffer()){
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Do Marked!"</span>);
            <span class="hljs-keyword">var</span> result=marked(<span class="hljs-built_in">String</span>(file.contents));
            <span class="hljs-built_in">console</span>.log(result.props);
            file.contents = Buffer(result.content);
        }
        next(<span class="hljs-literal">null</span>, file);
    }))
    .pipe(gulp.dest(<span class="hljs-string">"./dist/articles"</span>));
</code></pre>
<p><strong>PS:</strong> <code>though2</code>还可以用于自定义gulp插件中</p>
<h3 id="header-6">Doc</h3>
<p><img src="/2015/04/01/gulp-1.png" alt="Gulp"></p>
<p><img src="/2015/04/01/gulp-2.png" alt="Gulp"></p>
<h2 id="header-7">常用插件</h2>
<ul>
<li>css编译器： gulp-sass，gulp-less</li>
<li>file合并：gulp-concat</li>
<li>file最小化：gulp-uglify 压缩js，gulp-minifycss 压缩css，gulp-imagemin 压缩图像</li>
<li>file重命名：gulp-rename</li>
<li>file删除：gulp-clean</li>
<li>静态服务器：gulp-server-livereload</li>
</ul>
<p>使用举例：</p>
<p>重命名，压缩文件：</p>
<pre><code class="nulljs"><span class="hljs-keyword">var</span> rename=<span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-rename"</span>);
<span class="hljs-keyword">var</span> uglify=<span class="hljs-built_in">require</span>(<span class="hljs-string">"gulp-uglify"</span>);
gulp.task(<span class="hljs-string">'mini'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    gulp.src(Config.react.dest+<span class="hljs-string">"/app.js"</span>)
        .pipe(rename(<span class="hljs-string">"app.min.js"</span>))
        .pipe(uglify())
        .pipe(gulp.dest(Config.react.prodDest));
});
</code></pre>
<p>实时编译sass文件：</p>
<pre><code class="nulljs"><span class="hljs-keyword">var</span> sass = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-sass'</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sassBuild</span>(<span class="hljs-params">opts,filename</span>)</span>{
    <span class="hljs-keyword">if</span>(!filename)
        filename=opts.default;
    <span class="hljs-keyword">var</span> sassOptions = {
      <span class="hljs-attr">errLogToConsole</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">outputStyle</span>: <span class="hljs-string">'expanded'</span>,
      <span class="hljs-attr">loadPath</span>:opts.loadPath
    };
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">build</span>(<span class="hljs-params">event</span>)</span>{
        <span class="hljs-keyword">if</span>(event)
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'File '</span> + event.path + <span class="hljs-string">' was '</span> + event.type);
        gulp.src(opts.src+filename+<span class="hljs-string">".scss"</span>)
            .pipe(sass(sassOptions).on(<span class="hljs-string">'error'</span>, sass.logError))
            <span class="hljs-comment">//.pipe(concat('style.css'))</span>
            .pipe(gulp.dest(opts.dest));
    }
    build();
    gulp.watch(Config.sass.src+<span class="hljs-string">"**/*.scss"</span>,build)
        <span class="hljs-comment">/*.on("change",function(event){
            console.log('File ' + event.path + ' was ' + event.type);
        })*/</span>
        ;
}
gulp.task(<span class="hljs-string">'sass'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
 sassBuild(Config.sass,argv.n);
});
</code></pre>
<p>架起静态服务器，实时预览：</p>
<pre><code class="nulljs"><span class="hljs-keyword">var</span> server = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-server-livereload'</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">server</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> filterFun=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filePath,cb</span>)</span>{
       Config.server.filterReg.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">reg</span>)</span>{
            <span class="hljs-keyword">if</span>((<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(reg)).test(filePath))
                cb(<span class="hljs-literal">true</span>);
        })
      <span class="hljs-comment">/*if(/app.js/.test(filePath) || /style.css/.test(filePath)) {
        cb(true)
      } */</span>
    }
    <span class="hljs-keyword">var</span> serverOpts={
        <span class="hljs-attr">livereload</span>: {
            <span class="hljs-attr">enable</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">filter</span>:filterFun
          },
          <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>
    };
    gulp.src(Config.dist)
        .pipe(server(serverOpts));
}
gulp.task(<span class="hljs-string">'server'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    server();
});
</code></pre>
  </section>
</article>

      <hr/>
      
<section class="post-comment">
	
		<div id="gitment_container"></div>

<link rel="stylesheet" href="/gitment/default.css">
<script src="/gitment/gitment.browser.js"></script>


<script type="text/javascript">
	var gitment = new Gitment({
	  id: 'Test',
	  owner: 'chenjin-zero',
	  repo: 'blogComment',
	  oauth: {
	    client_id: '36a09bb7399efe69c6ce',
	    client_secret: 'ad9ad546b23b708c71d92e513dc36e0486179dea',
	  }
	})

    // var gitment = new Gitment({
    //   id: 'gitment-introduction',
    //   title: 'Gitment：使用 GitHub Issues 搭建评论系统',
    //   owner: 'imsun',
    //   repo: 'imsun.net',
    //   oauth: {
    //     client_id: '4ce2737289ce197769a1',
    //     client_secret: '3731a9d6ff407355af912ea7a86dd0dd772ca84d',
    //   },
    // })
      
	gitment.render('gitment_container')
</script>
	
</section>

    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/highlight/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  
  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
