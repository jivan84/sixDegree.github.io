<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Python 爬虫基础</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="python,Re,BeautifulSoup,CSS Selector,XPath,JSONPath">
  
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
	
		<link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
	
    
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">基础概念</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">HTTP协议</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">深度抓取与广度抓取</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">不重复抓取策略</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">网络爬虫的限制</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-6"><span class="sidebar-nav nav-text">网站结构分析</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-7"><span class="sidebar-nav nav-text">文档解析之Re</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-8"><span class="sidebar-nav nav-text">正则表达式</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-9"><span class="sidebar-nav nav-text">Re库</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-10"><span class="sidebar-nav nav-text">文档解析之BeautifulSoup</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-11"><span class="sidebar-nav nav-text">Demo: 访问节点</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-12"><span class="sidebar-nav nav-text">Demo: Navigating the Tree</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-13"><span class="sidebar-nav nav-text">Demo: Searching the Tree</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-14"><span class="sidebar-nav nav-text">Demo: CSS Selectors</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-15"><span class="sidebar-nav nav-text">文档解析之XPath</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-16"><span class="sidebar-nav nav-text">路径表达式</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-17"><span class="sidebar-nav nav-text">Demo: 解析HTML</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-18"><span class="sidebar-nav nav-text">Demo: 解析XML</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-19"><span class="sidebar-nav nav-text">文档解析之JSonPath</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-20"><span class="sidebar-nav nav-text">Jsonpath 操作符</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-21"><span class="sidebar-nav nav-text">Json转换</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-22"><span class="sidebar-nav nav-text">Demo：使用Jsonpath解析JSON</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-23"><span class="sidebar-nav nav-text">Reference</span></a></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">Python 爬虫基础</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2019-03-14T16:00:00.000Z">2019-03-15</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-Python">Python</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h2 id="header-1">基础概念</h2>
<h3 id="header-2">HTTP协议</h3>
<blockquote>
<p>wikipedia:<br>The Hypertext transfer Protocal(HTTP) is a stateless(无状态) application-level protocol for distributed(分布式),collaborative(协作式),hypertext information systems.</p>
</blockquote>
<p>HyperText Transfer Protocol 超文本传输协议</p>
<ul>
<li><p>是一个基于“请求与响应”模式的、无状态的应用层协议</p>
</li>
<li><p>采用URL作为定位网络资源的标识,格式如下: <code>http://host[:port][path]</code></p>
<ul>
<li><code>host</code>: 合法的Internet主机域名或IP地址 </li>
<li><code>port</code>: 端口号,缺省端口为80</li>
<li><code>path</code>: 请求资源的路径</li>
</ul>
</li>
<li><p>对资源的操作：</p>
<ul>
<li><code>GET</code> 请求获取URL位置的资源</li>
<li><code>HEAD</code> 请求获取URL位置资源的响应消息报告,即获得该资源的头部信息 </li>
<li><code>POST</code> 请求向URL位置的资源后附加新的数据</li>
<li><code>PUT</code> 请求向URL位置存储一个资源,覆盖原URL位置的资源</li>
<li><code>PATCH</code> 请求局部更新URL位置的资源,即改变该处资源的部分内容</li>
<li><code>DELETE</code> 请求删除URL位置存储的资源</li>
<li><code>PATCH</code> vs. <code>PUT</code>: <ul>
<li>假设URL位置有一组数据UserInfo,包括UserID、UserName等20个字段, 需求:用户修改了UserName,其他不变</li>
<li><code>PATCH</code>: 仅向URL提交UserName的局部更新请求</li>
<li><code>PUT</code> 须将所有20个字段一并提交到URL,未提交字段被删除 </li>
<li><code>PATCH</code>的最主要好处:节省网络带宽</li>
</ul>
</li>
</ul>
</li>
<li><p>响应状态码</p>
<ul>
<li><code>2xx</code> 成功</li>
<li><code>3xx</code> 跳转<ul>
<li>300 Multiple Choices 存在多个可用资源，可处理可丢弃</li>
<li>301 Moved Permanetly 重定向</li>
<li>302 Found 重定向</li>
<li>304 Not Modified 请求资源未更新，丢弃</li>
<li>注：一些python库（urllib2,requests,…）已经对重定向做了处理，会自动跳转</li>
</ul>
</li>
<li><code>4xx</code> 客户端错误<ul>
<li>400 Bad Request 客户端请求有语法错误，不能被服务器所理解（请求参数或者路径错误）</li>
<li>401 Unauthorized 请求未经授权，这个状态吗需和www-Authenticate报头域一起使用（无权限访问）</li>
<li>403 Forbidden 服务器收到请求，但拒绝提供服务（未登录/IP被封/…）</li>
<li>404 Not Found 请求资源部存在</li>
</ul>
</li>
<li><code>5xx</code> 服务端错误<ul>
<li>500 Internal Server Error 服务器发生了不可预期的错误</li>
<li>503 Server Unavailable 服务器当前不能处理客户端请求，一段时间后可能恢复正常</li>
</ul>
</li>
</ul>
</li>
<li><p>Http Header</p>
<ul>
<li>Request Http Header<pre><code>  Accept: text/plain
  Accept-Charset: utf-8
  Accept-Encoding: gzip,deflate
  Accept-Language: en-US
  Connection: keep-alive
  Content-Length: 348
  Content-Type: application/x-www-form-urlencoded
  User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:60.0) Gecko/20100101 Firefox/60.0
  Cookie: $version=1; Skin=new;
  Date: ...
  Host: ...
  ....
</code></pre></li>
<li>Response Http Header<pre><code>  Status: 200 OK
  Accept: text/plain;charset=utf-8
  Content-Eoncoding: gzip
  Content_Language: en-US
  Content-Length: 348
  Set-Cookie: UserID=xxx,Max-Age=3600;Version=1;...
  Location: ...
  Last-Modified: ...
  ...
</code></pre></li>
</ul>
</li>
</ul>
<h3 id="header-3">深度抓取与广度抓取</h3>
<pre><code>        A
     /     \
    B       C
    /       \ 
D,E,F,G     X,Y,Z
|
H,I,J,K
</code></pre><ul>
<li>深度抓取(垂直)<ul>
<li>堆栈（递归，先进后出）</li>
<li>A -&gt; B -&gt; D -&gt; H -&gt; I,J,K -&gt; E,F,G -&gt; C -&gt; X,Y,Z</li>
</ul>
</li>
<li>广度抓取(水平)<ul>
<li>队列（先进先出）</li>
<li>A -&gt; B,C -&gt; D,E,F,G ; X,Y,Z -&gt; H,I,J,K</li>
</ul>
</li>
<li>策略：<ul>
<li>重要的网页距离种子站点比较近</li>
<li>一个网页可能有很多路径可以到达（图）</li>
<li>广度优先有利于多爬虫并行抓取</li>
<li>深度与广度结合</li>
</ul>
</li>
</ul>
<h3 id="header-4">不重复抓取策略</h3>
<ul>
<li>记录抓取历史（URL）<ul>
<li>保存到数据库（效率低）</li>
<li>使用HashSet(内存限制)</li>
</ul>
</li>
<li>尽量压缩URL<ul>
<li>MD5／SHA-1编码成一段统一长度的数字／字符串，太长，一般会编码后再取模</li>
<li>BitMap方法：建立BitSet,将URL（可在MD5基础上）经过Hash函数映射到一个或多个Bit位来记录</li>
<li>BloomFilter: 在BitMap基础上，使用多个Hash函数</li>
<li>注：存在一定碰撞</li>
</ul>
</li>
<li>操作：<ul>
<li>评估网站的网页数量</li>
<li>选择合适的Hash算法和空间阈值，降低碰撞几率</li>
<li>选择合适的存储结构和算法</li>
</ul>
</li>
<li>注：<ul>
<li>网页数量少的情况下，不需要进行压缩（多数情况）</li>
<li>网页数量大的情况下，可使用BloomFilter压缩URL，重点是计算碰撞概率，以此确定存储空间的阈值</li>
<li>分布式系统，可将散列映射到多台主机</li>
</ul>
</li>
</ul>
<h3 id="header-5">网络爬虫的限制</h3>
<ul>
<li>来源审查: 检查来访HTTP协议头的<code>User‐Agent</code>域,只响应浏览器或友好爬虫的访问</li>
<li>发布公告: <code>Robots</code>协议,网站告知网络爬虫哪些页面可以抓取,哪些不行<ul>
<li>在网站根目录下的<code>robots.txt</code>文件 (Robots Exclusion Standard 网络爬虫排除标准)</li>
<li><code>Robots</code>协议是建议但非约束性,网络爬虫可以不遵守,但存在法律风险</li>
<li>基本语法<pre><code>  # `*`代表所有, `/`代表根目录 
  User‐agent: *
  Disallow: /
</code></pre></li>
<li>eg: <code>https://www.jd.com/robots.txt</code><pre><code>  User‐agent: *
  Disallow: /?*
  Disallow: /pop/*.html
  Disallow: /pinpai/*.html?*
  User‐agent: EtaoSpider
  Disallow: /
  User‐agent: HuihuiSpider
  Disallow: /
  User‐agent: GwdangSpider
  Disallow: /
  User‐agent: WochachaSpider
  Disallow: /
</code></pre></li>
</ul>
</li>
</ul>
<h3 id="header-6">网站结构分析</h3>
<ul>
<li>利用sitemap里的信息</li>
<li>对网站目录结构进行分析</li>
<li>网页解析器：<ul>
<li>模糊匹配：<ul>
<li>正则表达式</li>
</ul>
</li>
<li>结构化解析：<ul>
<li>htmp.parser</li>
<li>BeautifulSoup</li>
<li>lxml</li>
<li>。。。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="header-7">文档解析之Re</h2>
<h3 id="header-8">正则表达式</h3>
<p>Regular Expression(regex)</p>
<ul>
<li>一种通用的字符串表达框架,简洁表达一组字符串</li>
<li>特点: 简洁,一行胜千言（一行就是特征，即模式)</li>
<li>用途(主要应用在字符串匹配中)：<ul>
<li>表达文本类型的特征(病毒、入侵等)</li>
<li>匹配字符串的全部或部分</li>
<li>查找或替换一组字符串</li>
<li>…</li>
</ul>
</li>
<li><p>语法由字符和操作符构成, 常用操作符:</p>
<ul>
<li><p>匹配单个字符</p>
<table class="table">
<thead>
<tr>
<th style="text-align:left">操作符</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">实例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>.</code></td>
<td style="text-align:left">表示任何单个字符</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left"><code>[]</code></td>
<td style="text-align:left">匹配<code>[]</code>中列举的字符</td>
<td style="text-align:left"><code>[abc]</code>表示a、b、c,<code>[a‐z]</code>表示a到z单个字符</td>
</tr>
<tr>
<td style="text-align:left"><code>[^ ]</code></td>
<td style="text-align:left">非字符集,对单个字符给出排除范围</td>
<td style="text-align:left"><code>[^abc]</code>表示非a或b或c的单个字符</td>
</tr>
<tr>
<td style="text-align:left"><code>\d</code></td>
<td style="text-align:left">数字,等价于<code>[0‐9]</code></td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left"><code>\D</code></td>
<td style="text-align:left">匹配非数字</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left"><code>\w</code></td>
<td style="text-align:left">单词字符,等价于<code>[A‐Za‐z0‐9]</code></td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left"><code>\W</code></td>
<td style="text-align:left">匹配非单词字符</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left"><code>\s</code></td>
<td style="text-align:left">匹配空白，即 空格，tab键</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left"><code>\S</code></td>
<td style="text-align:left">匹配非空白</td>
<td style="text-align:left">/</td>
</tr>
</tbody>
</table>
</li>
<li><p>匹配数量</p>
<table class="table">
<thead>
<tr>
<th style="text-align:left">操作符</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">实例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>*</code></td>
<td style="text-align:left">前一个字符0次或无限次扩展,即可有可无</td>
<td style="text-align:left"><code>abc*</code> 表示 ab、abc、abcc、abccc等</td>
</tr>
<tr>
<td style="text-align:left"><code>+</code></td>
<td style="text-align:left">前一个字符1次或无限次扩展,即至少有1次</td>
<td style="text-align:left"><code>abc+</code> 表示 abc、abcc、abccc等</td>
</tr>
<tr>
<td style="text-align:left"><code>?</code></td>
<td style="text-align:left">前一个字符0次或1次扩展,即要么有1次，要么没有</td>
<td style="text-align:left"><code>abc?</code> 表示 ab、abc</td>
</tr>
<tr>
<td style="text-align:left"><code>{m}</code></td>
<td style="text-align:left">扩展前一个字符m次</td>
<td style="text-align:left"><code>ab{2}c</code>表示abbc</td>
</tr>
<tr>
<td style="text-align:left"><code>{m,}</code></td>
<td style="text-align:left">扩展前一个字符至少m次</td>
<td style="text-align:left"><code>ab{2}c</code>表示abbc,abbbc,abbbbc等</td>
</tr>
<tr>
<td style="text-align:left"><code>{m,n}</code></td>
<td style="text-align:left">扩展前一个字符m至n次(含n)</td>
<td style="text-align:left"><code>ab{1,2}c</code>表示abc、abbc</td>
</tr>
</tbody>
</table>
</li>
<li><p>匹配边界</p>
<table class="table">
<thead>
<tr>
<th style="text-align:left">操作符</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">实例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>^</code></td>
<td style="text-align:left">匹配字符串开头</td>
<td style="text-align:left"><code>^abc</code>表示abc且在一个字符串的开头</td>
</tr>
<tr>
<td style="text-align:left"><code>$</code></td>
<td style="text-align:left">匹配字符串结尾</td>
<td style="text-align:left"><code>abc$</code>表示abc且在一个字符串的结尾</td>
</tr>
<tr>
<td style="text-align:left"><code>\b</code></td>
<td style="text-align:left">匹配一个单词的边界，注意：并不是匹配分隔符，而是单词和符号之间的边界 <br>（单词可是中英文字符,数字；符号可是中英文符号,空格,制表符,换行）</td>
<td style="text-align:left">“a nice day”,”a niceday”: <code>\bnice\b</code>可匹配出”a nice day”的”nice”</td>
</tr>
<tr>
<td style="text-align:left"><code>\B</code></td>
<td style="text-align:left">匹配一个非单词的边界</td>
<td style="text-align:left">“a nice day”,”a niceday”: <code>\bnice\B</code>可匹配出”a niceday”的”nice”</td>
</tr>
</tbody>
</table>
</li>
<li><p>匹配分组</p>
<table class="table">
<thead>
<tr>
<th style="text-align:left">操作符</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">实例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>|</code></td>
<td style="text-align:left">左右表达式任意一个</td>
<td style="text-align:left"><code>abc|def</code> 表示 abc、def</td>
</tr>
<tr>
<td style="text-align:left"><code>( )</code></td>
<td style="text-align:left">分组标记,内部只能使用</td>
<td style="text-align:left"><code>(abc)</code>表示abc,<code>(abc|def)</code>表示abc、def</td>
</tr>
<tr>
<td style="text-align:left"><code>\num</code></td>
<td style="text-align:left">引用分组num匹配到的字符串</td>
<td style="text-align:left"><code>&lt;(\w*)&gt;&lt;(\w*)&gt;.*&lt;/\2&gt;&lt;/\1&gt;</code> =&gt; <code>&lt;html&gt;&lt;h1&gt;hh&lt;h1&gt;&lt;/html&gt;</code>正确，<code>&lt;html&gt;&lt;h1&gt;hh&lt;/h1&gt;&lt;/abc&gt;</code> 错误</td>
</tr>
<tr>
<td style="text-align:left"><code>(?P&lt;name&gt;)</code></td>
<td style="text-align:left">分组起别名</td>
<td style="text-align:left"><code>&lt;(?P&lt;name1&gt;\w*)&gt;&lt;(?P&lt;name2&gt;\w*)&gt;.*&lt;/(?P=name2)&gt;&lt;/(?P=name1)&gt;</code> =&gt; <code>&lt;html&gt;&lt;h1&gt;hh&lt;h1&gt;&lt;/html&gt;</code>正确,<code>&lt;html&gt;&lt;h1&gt;hh&lt;/h1&gt;&lt;/abc&gt;</code> 错误</td>
</tr>
<tr>
<td style="text-align:left"><code>(?P=name)</code></td>
<td style="text-align:left">引用别名为name分组匹配到的字符串</td>
<td style="text-align:left">/</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li><p>eg1:</p>
<ul>
<li>一组字符串(无穷个): ‘PY’, ‘PYY’, ‘PYYY’, ‘PYYYY’, ……, ‘PYYYY……’</li>
<li>正则表达式(无穷字符串组的简洁表达): <code>PY+</code></li>
</ul>
</li>
<li>eg2: <ul>
<li>一组字符串:  ‘PN’, ‘PYN’, ‘PYTN’, ‘PYTHN’, ‘PYTHON’</li>
<li>正则表达式(简洁表达):<code>P(Y|YT|YTH|YTHO)?N</code></li>
</ul>
</li>
<li>eg3:<ul>
<li>表示一组’PY’开头，后续存在不多于10个字符，且不能是’P’或’Y’的字符串(如：’PYABC’ 正确;’PYKXYZ’ 不正确)</li>
<li>正则表达式（特征字符串组的简洁表达）：<code>PY[^PY]{0,10}</code></li>
</ul>
</li>
<li><p>eg4:</p>
<ul>
<li>‘PN’、’PYN’、’PYYN’、’PYYYN’…</li>
<li><code>PY{:3}N</code></li>
</ul>
</li>
<li><p>经典正则表达式实例：</p>
<ul>
<li><code>^[A‐Za‐z]+$</code> 由26个字母组成的字符串</li>
<li><code>^[A‐Za‐z0‐9]+$</code> 由26个字母和数字组成的字符串</li>
<li><code>[1‐9]\d{5}</code> 中国境内6位邮政编码</li>
<li><code>[\u4e00‐\u9fa5]</code> 匹配中文字符</li>
<li><code>\d{3}‐\d{8}|\d{4}‐\d{7}</code> 国内电话号码(eg: 010‐68913536)</li>
<li><code>(([1‐9]?\d|1\d{2}|2[0‐4]\d|25[0‐5]).){3}([1‐9]?\d|1\d{2}|2[0‐4]\d|25[0‐5])</code> IP地址(4段)<ul>
<li>0‐99: <code>[1‐9]?\d</code></li>
<li>100‐199: <code>1\d{2}</code></li>
<li>200‐249: <code>2[0‐4]\d</code> </li>
<li>250‐255: <code>25[0‐5]</code></li>
<li>简化表达：<code>\d+.\d+.\d+.\d+</code> 或 <code>\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="header-9">Re库</h3>
<ul>
<li>Python的标准库(用于字符串匹配)</li>
<li>导入<code>import re</code></li>
<li>正则表达式的表示类型：<ul>
<li>raw string(原生字符串类型)：<code>r&#39;text&#39;</code>, eg: <code>r&#39;[1‐9]\d{5}&#39;</code>, <code>r&#39;\d{3}‐\d{8}|\d{4}‐\d{7}&#39;</code></li>
<li>string(更繁琐), eg: <code>&#39;[1‐9]\\d{5}&#39;</code>,<code>&#39;\\d{3}‐\\d{8}|\\d{4}‐\\d{7}&#39;</code></li>
<li>注：raw string不包含对转义符再次转义的字符串,所以建议当正则表达式包含转义符时,使用raw string</li>
</ul>
</li>
<li><p>函数式用法: 一次性操作</p>
<ul>
<li><code>re.search(pattern, string, flags=0)</code>: 搜索第一个匹配的,返回<code>match</code>对象<ul>
<li><code>pattern</code> : 正则表达式(string/raw string)</li>
<li><code>string</code> : 待匹配字符串</li>
<li><code>flags</code>: 控制标记<ul>
<li><code>re.I</code>,<code>re.IGNORECASE</code> : 忽略大小写</li>
<li><code>re.M</code>,<code>re.MULTILINE</code> : <code>^</code>操作符能将给定字符串的每行当作匹配开始</li>
<li><code>re.S</code>,<code>re.DOTALL</code> : <code>.</code>操作符能匹配所有字符(默认是匹配除换行外的所有字符）</li>
</ul>
</li>
<li>eg: <pre><code class="lang-python">  import re
  match=re.search(r&#39;[1-9]\d{5}&#39;,&#39;BIT100081 TSU100084&#39;)
  if match:
      print(match.group(0))   # 100081
</code></pre>
</li>
</ul>
</li>
<li><p><code>re.match(pattern, string, flags=0)</code>: 从头开始匹配，返回<code>match</code>对象</p>
<ul>
<li>参数同上</li>
<li><p>eg:</p>
<pre><code class="lang-python">  match=re.match(r&#39;[1-9]\d{5}&#39;,&#39;BIT100081 TSU100084&#39;)
  if match:
      print(match.group(0))   # AttributeError: &#39;NoneType&#39; object has no attribute &#39;group&#39;

  match=re.match(r&#39;[1-9]\d{5}&#39;,&#39;100081BIT TSU100084&#39;)
  if match:
      print(match.group(0))   # 100081
</code></pre>
</li>
</ul>
</li>
<li><code>re.findall(pattern, string, flags=0)</code>: 搜索,返回匹配字串列表<ul>
<li>参数同上</li>
<li>eg:<pre><code class="lang-python">  ls=re.findall(r&#39;[1-9]\d{5}&#39;,&#39;BIT100081 TSU100084&#39;) # [&#39;100081&#39;,&#39;100084&#39;]
</code></pre>
</li>
</ul>
</li>
<li><code>re.finditer(pattern, string, flags=0)</code>: 搜索,返回匹配结果的迭代类型,每个迭代元素是<code>match</code>对象<ul>
<li>参数同上</li>
<li>eg:<pre><code class="lang-python">  for match in re.finditer(r&#39;[1-9]\d{5}&#39;,&#39;BIT100081 TSU100084&#39;):
      if match:
          print(match.group(0))
  # 100081
  # 100084
</code></pre>
</li>
</ul>
</li>
<li><code>re.split(pattern, string, maxsplit=0, flags=0)</code>: 分割, 返回列表<ul>
<li><code>maxsplit</code>: 最大分割数,剩余部分作为最后一个元素输出</li>
<li>eg:<pre><code class="lang-python">  re.split(r&#39;[1-9]\d{5}&#39;,&#39;BIT100081 TSU100084&#39;)   # [&#39;BIT&#39;,&#39; TSU&#39;,&#39;&#39;] 
  re.split(r&#39;[1-9]\d{3}&#39;,&#39;BIT100081 TSU100084&#39;)   # [&#39;BIT&#39;, &#39;81 TSU&#39;, &#39;84&#39;]
  re.split(r&#39;[1-9]\d{5}&#39;,&#39;BIT100081 TSU100084&#39;,maxsplit=1) # [&#39;BIT&#39;,&#39; TSU100084&#39;]
</code></pre>
</li>
</ul>
</li>
<li><code>re.sub(pattern, repl, string, count=0, flags=0)</code>: 替换所有匹配的子串,返回替换后的字符串<ul>
<li><code>repl</code> 替换字符串</li>
<li><code>string</code> : 待匹配字符串</li>
<li><code>count</code> 最大替换次数</li>
<li>eg: <pre><code class="lang-python">  re.sub(r&#39;[1-9]\d{5}&#39;,&#39;:zipcode&#39;,&#39;BIT100081 TSU100084&#39;) # &#39;BIT:zipcode TSU:zipcode&#39;
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
<li><p>面向对象用法:编译后的多次操作</p>
<ul>
<li>Step1: <code>regex = re.compile(pattern, flags=0)</code> 将正则表达式的字符串形式<code>编译</code>成正则表达式对象</li>
<li>Step2:<ul>
<li><code>regex.search(string, flags=0)</code></li>
<li><code>regex.match(string, flags=0)</code></li>
<li><code>regex.findall(string, flags=0)</code></li>
<li><code>regex.finditer(string, flags=0)</code></li>
<li><code>regex.split(string, maxsplit=0, flags=0)</code></li>
<li><code>regex.sub(repl, string, count=0, flags=0)</code></li>
</ul>
</li>
</ul>
</li>
<li><p>Match对象：</p>
<ul>
<li>一次匹配的结果,包含匹配的很多信息</li>
<li>属性：<ul>
<li><code>.string</code>: 待匹配的文本</li>
<li><code>.re</code>: 匹配时使用的pattern对象(正则表达式)</li>
<li><code>.pos</code>: 搜索文本的开始位置</li>
<li><code>.endpos</code>: 搜索文本的结束位置</li>
</ul>
</li>
<li>方法：<ul>
<li><code>.group(0)</code>: 获得匹配后的字符串 </li>
<li><code>.start()</code>: 匹配字符串在原始字符串的开始位置 </li>
<li><code>.end()</code>: 匹配字符串在原始字符串的结束位置 </li>
<li><code>.span()</code>: 返回<code>(.start(), .end())</code></li>
</ul>
</li>
<li>eg:<pre><code class="lang-python">  match=re.search(r&#39;[1-9]\d{5}&#39;,&#39;BIT100081 TSU100084&#39;)
  # 属性：
  match.string    # &#39;BIT100081 TSU100084&#39;
  match.re        # re.compile(&#39;[1-9]\\d{5}&#39;)
  match.pos       # 0
  match.endpos    # 19
  # 方法：
  match.group(0)  # 100081
  match.start()   # 3
  match.end()     # 9
  match.span()    # (3,9)
</code></pre>
</li>
</ul>
</li>
<li><p>贪婪匹配（默认）：输出匹配最长的子串</p>
<pre><code class="lang-python">  match = re.search(r&#39;PY.*N&#39;, &#39;PYANBNCNDN&#39;)
  match.group(0)  # &#39;PYANBNCNDN&#39;
</code></pre>
</li>
<li><p>最小匹配: 输出最短匹配子串，操作符后增加<code>?</code>操作符</p>
<pre><code class="lang-python">  &#39;&#39;&#39;
  只要长度输出可能不同的,都可以通过在操作符后增加?变成最小匹配
  `*?`: 前一个字符0次或无限次扩展,最小匹配
  `+?`: 前一个字符1次或无限次扩展,最小匹配
  `??`: 前一个字符0次或1次扩展,最小匹配
  `{m,n}?`: 扩展前一个字符m至n次(含n),最小匹配
  &#39;&#39;&#39;
  match = re.search(r&#39;PY.*?N&#39;, &#39;PYANBNCNDN&#39;)
  match.group(0)  # &#39;PYAN&#39;
</code></pre>
</li>
</ul>
<h2 id="header-10">文档解析之BeautifulSoup</h2>
<blockquote>
<p>一个网页解析库，处理高效，目前可支持<code>html</code>, <code>xml</code>,<code>html5</code>文档解析，可配置使用不同解析器</p>
</blockquote>
<p>常见解析器：</p>
<table class="table">
<thead>
<tr>
<th style="text-align:left">解析器</th>
<th style="text-align:left">使用</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">html.parser</td>
<td style="text-align:left">BeautifulSoup(content,’html.parser’)</td>
<td style="text-align:left">Python内置标准库,速度适中，容错能力适中，不依赖扩展</td>
</tr>
<tr>
<td style="text-align:left">lxml</td>
<td style="text-align:left">BeautifulSoup(content,’lxml’),BeautifulSoup(content,’xml’)</td>
<td style="text-align:left">第三方库（<code>pip install lxml</code>），速度快(局部遍历），支持XML解析，容错能力强，依赖C扩展</td>
</tr>
<tr>
<td style="text-align:left">html5hib</td>
<td style="text-align:left">BeautifulSoup(content,’html5hib’)</td>
<td style="text-align:left">第三方库（<code>pip install html5hib</code>）,速度慢，以浏览器的方式解析生成HTML5格式的文档，容错能力最好，不依赖外部扩展</td>
</tr>
</tbody>
</table>
<ol>
<li><p>安装 （BeautifulSoup 包含在一个名为 bs4 的文件包中，需要另外安装）</p>
<pre><code class="lang-bash"> pip install bs4
</code></pre>
</li>
<li><p>创建BeautifulSoup对象，结构化解析Dom树（<code>HTML/XML</code> &lt;=&gt; <code>文档树</code> &lt;=&gt; <code>BeautifulSoup对象</code>）</p>
<pre><code class="lang-python"> from bs4 import BeautifulSoup

 # soup = BeautifulSoup(&quot;&lt;html&gt;&lt;body&gt;&lt;p&gt;data&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;,&#39;html.parser&#39;)
 soup = BeautifulSoup(&quot;&lt;html&gt;&lt;body&gt;&lt;p&gt;data&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;)
 print(soup.p)

 # 格式化输出（为HTML文本及其内容增加添加`\n`），也可用于标签:`&lt;tag&gt;.prettify()`
 print(soup.prettify())
</code></pre>
</li>
<li><p>访问节点</p>
<table class="table">
<thead>
<tr>
<th style="text-align:left">BeautifulSoup基本元素</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">使用</th>
<th style="text-align:left">示例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Tag</td>
<td style="text-align:left">标签</td>
<td style="text-align:left"><code>&lt;tag&gt;</code></td>
<td style="text-align:left"><code>soup.p</code></td>
</tr>
<tr>
<td style="text-align:left">Name</td>
<td style="text-align:left">标签名字，字符串类型</td>
<td style="text-align:left"><code>&lt;tag&gt;.name</code></td>
<td style="text-align:left"><code>soup.p.name</code></td>
</tr>
<tr>
<td style="text-align:left">Attributes</td>
<td style="text-align:left">标签的属性，字典形式组织</td>
<td style="text-align:left"><code>&lt;tag&gt;.attrs</code></td>
<td style="text-align:left"><code>soup.p.attrs</code>,<code>soup.p[&#39;attrname&#39;]</code></td>
</tr>
<tr>
<td style="text-align:left">NavigableString</td>
<td style="text-align:left">标签内非属性字符串(<code>&lt;&gt;⋯&lt;/&gt;</code>中字符串)</td>
<td style="text-align:left"><code>&lt;tag&gt;.string</code></td>
<td style="text-align:left"><code>soup.p.string</code></td>
</tr>
<tr>
<td style="text-align:left">Comment</td>
<td style="text-align:left">标签内字符串的注释部分, 特殊类型的 NavigableString 对象</td>
<td style="text-align:left">/</td>
<td style="text-align:left">/</td>
</tr>
</tbody>
</table>
<ul>
<li>是否有设置属性<ul>
<li><code>has_attr(&quot;attrname&quot;)</code></li>
</ul>
</li>
<li>获取属性<ul>
<li><code>.attrs[&quot;attrname&quot;]</code></li>
<li><code>[&quot;attrname&quot;]</code></li>
</ul>
</li>
<li>获取内容<ul>
<li><code>.text</code></li>
<li><code>.get_text()</code></li>
</ul>
</li>
<li><p><code>.string</code> vs <code>.text</code></p>
<ul>
<li><code>.string</code> on a Tag type object returns a <code>NavigableString</code> type object.</li>
<li><code>.text</code> gets all the child strings and return concatenated using the given separator. </li>
<li><p>sample:</p>
<table class="table">
<thead>
<tr>
<th style="text-align:left">Html</th>
<th style="text-align:left">string</th>
<th style="text-align:left">text</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>&lt;td&gt;some text&lt;/td&gt;</code></td>
<td style="text-align:left"><code>some text</code></td>
<td style="text-align:left"><code>some text</code></td>
</tr>
<tr>
<td style="text-align:left"><code>&lt;td&gt;&lt;/td&gt;</code></td>
<td style="text-align:left"><code>None</code></td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left"><code>&lt;td&gt;&lt;p&gt;more text&lt;/p&gt;&lt;/td&gt;</code></td>
<td style="text-align:left"><code>more text</code></td>
<td style="text-align:left"><code>more text</code></td>
</tr>
<tr>
<td style="text-align:left"><code>&lt;td&gt;even &lt;p&gt;more text&lt;/p&gt;&lt;/td&gt;</code></td>
<td style="text-align:left"><code>None</code> (因为文本数<code>&gt;=2</code>，<code>.string</code>不知道获取哪一个)</td>
<td style="text-align:left"><code>even more text</code> (<code>.text</code>返回的是，两段文本的拼接)</td>
</tr>
<tr>
<td style="text-align:left"><code>&lt;td&gt;&lt;!--This is comment--&gt;&lt;/td&gt;</code></td>
<td style="text-align:left"><code>This is comment</code></td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left"><code>&lt;td&gt;even &lt;!--This is comment--&gt;&lt;/td&gt;</code></td>
<td style="text-align:left"><code>None</code></td>
<td style="text-align:left"><code>even</code></td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Navigating the Tree</p>
<ul>
<li>Going Down: 下行遍历(子节点和子孙节点)<ul>
<li><code>.contents</code> 返回儿子节点列表<code>list</code></li>
<li><code>.children</code> 返回儿子节点迭代类型<code>list_iterator</code></li>
<li><code>.descendants</code> 返回子孙节点迭代类型<code>generator</code> (包含所有子孙节点)</li>
</ul>
</li>
<li>Going up: 上行遍历(父节点和祖先节点)<ul>
<li><code>.parent</code> 返回节点的父亲节点</li>
<li><code>.parents</code> 返回所有先辈节点的迭代类型<code>generator</code> (包括soup本身)</li>
</ul>
</li>
<li>Going sideways: 平行遍历(兄弟节点)<ul>
<li><code>.next_sibling</code> / <code>.previous_sibling</code> 返回HTML文本顺序的下/上一个平行节点</li>
<li><code>.next_siblings</code> / <code>.previous_siblings</code> 返回HTML文本顺序的后/前续所有平行节点的迭代类型<code>generator</code></li>
</ul>
</li>
<li>Going back and forth: 前后遍历（不分层次） <ul>
<li><code>.next_element</code> / <code>.next_elements</code></li>
<li><code>.previous_element</code> / <code>.previous_elements</code></li>
</ul>
</li>
</ul>
</li>
<li><p>Searching the Tree</p>
<ul>
<li>Searching Down: 下行搜索（子孙）<ul>
<li><code>find</code>/<code>find_all</code></li>
</ul>
</li>
<li>Searching up: 上行搜索（父祖）<ul>
<li><code>find_parent</code> / <code>find_parents</code> </li>
</ul>
</li>
<li>Searching sideway: 平行搜索（兄弟）：<ul>
<li><code>find_next_sibling</code> / <code>find_previous_sibling</code></li>
<li><code>find_next_siblings</code> / <code>find_previous_siblings</code></li>
</ul>
</li>
<li>Searching back and forth: 前后搜索（不分层次的前/后节点）：<ul>
<li><code>find_next</code> / <code>find_all_next</code></li>
<li><code>find_previous</code> / <code>find_all_previous</code></li>
</ul>
</li>
<li>注： <ul>
<li>方法参数<code>(name=None,attrs={},recursive=True,text=None,limit=None,**kwargs)</code>，可以使用正则表达式<ul>
<li><code>name</code>: 标签名称</li>
<li><code>attrs</code>: 标签属性</li>
<li><code>recursive</code>: 是否对子孙全部检索,默认True</li>
<li><code>text</code>: 内容字符串</li>
<li><code>limit</code>: 限制条数</li>
</ul>
</li>
<li><code>&lt;tag&gt;(..)</code> 等价于 <code>&lt;tag&gt;.find_all(..)</code> </li>
<li><code>soup(..)</code> 等价于 <code>soup.find_all(..)</code></li>
<li>每个元素是一个 <code>bs4.element.Tag</code> 对象</li>
</ul>
</li>
</ul>
</li>
<li><p>可使用CSS Selectors选择节点: <code>.select(&#39;...&#39;)</code> </p>
<ul>
<li>基础选择：<ul>
<li><code>#id</code></li>
<li><code>tagName</code></li>
<li><code>.styleClass</code></li>
</ul>
</li>
<li>属性过滤:<ul>
<li><code>[attribute]</code></li>
<li><code>[attribute=value]</code></li>
<li><code>[attribute!=value]</code></li>
<li><code>[attribute^=value]</code></li>
<li><code>[attribute$=value]</code></li>
<li><code>[attribute*=value]</code></li>
</ul>
</li>
<li>层级选择:<ul>
<li><code>ancestor descendent</code></li>
<li><code>parent &gt; child</code></li>
<li><code>prev + next</code> (next sibling tag)</li>
<li><code>prev ~ siblings</code> (next all sibling tags)</li>
</ul>
</li>
<li>元素过滤:<ul>
<li><code>:not(selector)</code></li>
<li><code>:nth-of-type(index)</code></li>
<li><code>:nth-child(index)</code></li>
<li><code>:first-child</code></li>
<li><code>:last-child</code></li>
<li><code>:only-child</code></li>
</ul>
</li>
<li>内容过滤:<ul>
<li><code>:contains(text)</code></li>
<li><code>:empty</code></li>
<li><code>:has(selector)</code></li>
</ul>
</li>
<li>表单属性过滤:<ul>
<li><code>:enabled</code></li>
<li><code>:checked</code></li>
<li><code>:disabled</code></li>
</ul>
</li>
<li>混合:<ul>
<li><code>selector1, selector2, selectorN</code>：获取多个选择符的合集</li>
<li><code>[selector1][selector2][selectorN]</code>：匹配同时符合多个属性选择符的对象</li>
</ul>
</li>
</ul>
</li>
<li><p>注： </p>
<ul>
<li>BeautifulSoup用编码自动检测子库来识别当前文档编码并转换成<code>Unicode</code>编码，输出使用<code>utf-8</code>编码</li>
<li>获取属性值<code>.attrs</code>,<code>.attrs[&#39;xxx&#39;]</code></li>
<li>获取内容<code>.text</code>,<code>.get_text()</code>,<code>.string</code>,<code>.strings</code></li>
</ul>
</li>
</ol>
<h3 id="header-11">Demo: 访问节点</h3>
<pre><code class="lang-python">from bs4 import BeautifulSoup

content=&#39;&#39;&#39;
&lt;b&gt;Chat with sb&lt;/b&gt;
&lt;a&gt; This is title  &lt;!-- Guess --&gt; &lt;/a&gt;
&lt;i&gt;&lt;!--This is comment--&gt;&lt;/i&gt;
&lt;div id=&quot;div1&quot;&gt;
    &lt;div id=&quot;div2&quot;&gt;
        &lt;p id=&quot;test&quot; class=&quot;highlight&quot;&gt;
            Hello &lt;a&gt;Tom&lt;/a&gt;
            Nice to meet you &lt;!-- This is a comment --&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;
&#39;&#39;&#39;
soup=BeautifulSoup(content,&#39;html.parser&#39;)
</code></pre>
<ol>
<li><p>Tag <code>name</code>,<code>attrs</code></p>
<pre><code class="lang-python"> print(&quot;soup.p:&quot;,soup.p)
 # &lt;p class=&quot;highlight&quot; id=&quot;test1&quot;&gt;
 #                 Hello &lt;a&gt;Tom&lt;/a&gt;
 #                 Nice to meet you &lt;!-- This is a comment --&gt;
 # &lt;/p&gt;

 print(&quot;soup.p.name:&quot;,soup.p.name)
 # p

 print(&quot;soup.p.attrs:&quot;,soup.p.attrs)
 # {&#39;id&#39;: &#39;test1&#39;, &#39;class&#39;: [&#39;highlight&#39;]}

 print(&quot;soup.p.attr[&#39;class&#39;]:&quot;,soup.p.attrs[&quot;class&quot;])
 # [&#39;highlight&#39;]

 print(&quot;soup.p.attrs[&#39;id&#39;]:&quot;,soup.p.attrs[&quot;id&quot;])
 #  test1

 print(&quot;soup.p[&#39;class&#39;]:&quot;,soup.p[&quot;class&quot;])
 #[&#39;highlight&#39;]
</code></pre>
</li>
<li><p>Tag <code>text</code>/<code>string</code></p>
<pre><code class="lang-python"> print(&quot;soup.p.text:&quot;,soup.p.text)
 #
 #                Hello Tom
 #                Nice to meet you
 #

 print(&quot;soup.p.get_text():&quot;,soup.p.get_text())
 #
 #                Hello Tom
 #                Nice to meet you
 #

 print(&quot;type(soup.p.get_text()):&quot;,type(soup.p.get_text()))   # &lt;class &#39;str&#39;&gt;
 print(&quot;-----------------------------------&quot;)

 print(&#39;--- Demo: Tag &lt;p&gt; string ---&#39;)
 print(&quot;soup.p.string:&quot;,soup.p.string)               # None
 print(&quot;type(soup.p.string)&quot;,type(soup.p.string))    # &lt;class &#39;NoneType&#39;&gt;
 print(&quot;soup.p.strings:&quot;,soup.p.strings)             # &lt;generator object Tag._all_strings at 0x00000000028FDD68&gt;
 for i,s in enumerate(soup.p.strings):
     print(i,&quot;:&quot;,s)
 print(&quot;-----------------------------------&quot;)    
 # 0 :
 #                 Hello
 # 1 : Tom
 # 2 :
 #                 Nice to meet you
 # 3 :

 print(&#39;--- Demo: Tag &lt;a&gt; text/string ---&#39;)
 print(&quot;soup.a.text:&quot;,soup.a.text)                       # Chat with sb
 print(&quot;soup.a.string:&quot;,soup.a.string)                   # Chat with sb
 print(&quot;type(soup.a.string):&quot;,type(soup.a.string))       # &lt;class &#39;bs4.element.NavigableString&#39;&gt;
 print(&quot;-----------------------------------&quot;)

 print(&#39;--- Demo: Tag &lt;b&gt; text/string ---&#39;)
 print(&quot;soup.b.text:&quot;,soup.b.text)                       # This is title
 print(&quot;soup.b.string:&quot;,soup.b.string)                   # None
 print(&quot;type(soup.b.string):&quot;,type(soup.b.string))       # &lt;class &#39;NoneType&#39;&gt;
 print(&quot;-----------------------------------&quot;)

 print(&#39;--- Demo: Tag &lt;i&gt; text/string ---&#39;)
 print(&quot;soup.i.text:&quot;,soup.i.text)                       #
 print(&quot;soup.i.string:&quot;,soup.i.string)                   # This is comment
 print(&quot;type(soup.i.string):&quot;,type(soup.i.string))       # &lt;class &#39;bs4.element.Comment&#39;&gt;
</code></pre>
</li>
</ol>
<h3 id="header-12">Demo: Navigating the Tree</h3>
<pre><code class="lang-python">from bs4 import BeautifulSoup

content=&#39;&#39;&#39;
&lt;b&gt;Chat with sb&lt;/b&gt;
&lt;a&gt; This is title  &lt;!-- Guess --&gt; &lt;/a&gt;
&lt;i&gt;&lt;!--This is comment--&gt;&lt;/i&gt;
&lt;div id=&quot;div1&quot;&gt;
    &lt;div id=&quot;div2&quot;&gt;
        &lt;p id=&quot;test&quot; class=&quot;highlight&quot;&gt;
            Hello &lt;a&gt;Tom&lt;/a&gt;
            Nice to meet you &lt;!-- This is a comment --&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;
&#39;&#39;&#39;

soup=BeautifulSoup(content,&#39;html.parser&#39;)
def print_result(result):
    if type(result)==element.Tag or (type(result)== list and len(result)==0):
        print(result)
        return
    for i,r in enumerate(result):
        print(i,&quot;:&quot;,r)
    print(&#39;-------------------------&#39;)

def print_result_name(result):
    if type(result)==element.Tag or type(result)==element.NavigableString or (type(result)== list and len(result)==0):
        print(result)
        return
    for i,r in enumerate(result):
        print(i,&quot;:&quot;,r.name)
    print(&#39;-------------------------&#39;)
</code></pre>
<ol>
<li><p>Going down:</p>
<ul>
<li><p><code>.contents</code></p>
<pre><code class="lang-python">  print(soup.p.contents)
  # &lt;class &#39;list&#39;&gt;

  print_result(soup.p.contents)
  # 0 :
  #                 Hello
  # 1 : &lt;a&gt;Tom&lt;/a&gt;
  # 2 :
  #                 Nice to meet you
  # 3 :  This is a comment
  # 4 :
</code></pre>
</li>
<li><p><code>.children</code>   </p>
<pre><code class="lang-python">  print(soup.p.children)          
  # &lt;list_iterator object at 0x0000000001E742E8&gt;

  print_result(soup.p.children)
  # 0 :
  #                 Hello
  # 1 : &lt;a&gt;Tom&lt;/a&gt;
  # 2 :
  #                 Nice to meet you
  # 3 :  This is a comment
  # 4 :
</code></pre>
</li>
<li><p><code>.descendants</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: Tag &lt;p&gt; descendants ---&#39;)
  print(soup.p.descendants)
  # &lt;generator object Tag.descendants at 0x00000000028ADD68&gt;

  print_result(soup.p.descendants)
  # 0 :
  #                 Hello
  # 1 : &lt;a&gt;Tom&lt;/a&gt;
  # 2 : Tom
  # 3 :
  #                 Nice to meet you
  # 4 :  This is a comment
  # 5 :
</code></pre>
</li>
</ul>
</li>
<li><p>Going up:</p>
<ul>
<li><p><code>.parent</code></p>
<pre><code class="lang-python">  print(type(soup.p.parent))      
  # &lt;class &#39;bs4.element.Tag&#39;&gt;

  print_result(soup.p.parent)
  # &lt;div id=&quot;div2&quot;&gt;
  # &lt;p class=&quot;highlight&quot; id=&quot;test1&quot;&gt;
  #                 Hello &lt;a&gt;Tom&lt;/a&gt;
  #                 Nice to meet you &lt;!-- This is a comment --&gt;
  # &lt;/p&gt;
  # &lt;p class=&quot;story&quot; id=&quot;test2&quot;&gt;Story1&lt;/p&gt;
  # &lt;p class=&quot;story&quot; id=&quot;test3&quot;&gt;Story2&lt;/p&gt;
  # &lt;/div&gt;
</code></pre>
</li>
<li><p><code>.parents</code></p>
<pre><code class="lang-python">  print(soup.p.parents)           
  # &lt;generator object PageElement.parents at 0x00000000028FDD68&gt;

  print_result_name(soup.p.parents)
  # 0 : div
  # 1 : div
  # 2 : [document]
</code></pre>
</li>
</ul>
</li>
<li><p>Going sideway:</p>
<ul>
<li><code>next_sibling</code><pre><code class="lang-python">  print_result(soup.p.next_sibling)
  # 0 :
</code></pre>
</li>
<li><p><code>next_siblings</code></p>
<pre><code class="lang-python">  print(soup.p.next_siblings)     
  # &lt;generator object PageElement.next_siblings at 0x00000000028FDD68&gt;

  print_result(soup.p.next_siblings)
  # 0 :
  # 
  # 1 : &lt;p class=&quot;story&quot; id=&quot;test2&quot;&gt;Story1&lt;/p&gt;
  # 2 :
  # 
  # 3 : &lt;p class=&quot;story&quot; id=&quot;test3&quot;&gt;Story2&lt;/p&gt;
  # 4 :
</code></pre>
</li>
<li>vs. <code>find_next_silbings</code><pre><code class="lang-python">  print(&#39;--- Demo: `find_next_siblings()` ---&#39;)
  result=soup.p.find_next_siblings()
  print_result(result)
  # 0 : &lt;p class=&quot;story&quot; id=&quot;test2&quot;&gt;Story1&lt;/p&gt;
  # 1 : &lt;p class=&quot;story&quot; id=&quot;test3&quot;&gt;Story2&lt;/p&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>Going forth and back:</p>
<ul>
<li><code>next_element</code><pre><code class="lang-python">  print(soup.p.next_element)
  #
  # Hello
  print(type(soup.p.next_element))
  # &lt;class &#39;bs4.element.NavigableString&#39;&gt;
</code></pre>
</li>
<li><p><code>next_elements</code></p>
<pre><code class="lang-python">  print(soup.p.next_elements)     
  # &lt;generator object PageElement.next_elements at 0x00000000028FDD68&gt;

  print_result(soup.p.next_elements)
  # 0 :
  #                 Hello
  # 1 : &lt;a&gt;Tom&lt;/a&gt;
  # 2 : Tom
  # 3 :
  #                 Nice to meet you
  # 4 :  This is a comment
  # 5 :
  # 
  # 6 :
  # 
  # 7 : &lt;p class=&quot;story&quot; id=&quot;test2&quot;&gt;Story1&lt;/p&gt;
  # 8 : Story1
  # 9 :
  # 
  # 10 : &lt;p class=&quot;story&quot; id=&quot;test3&quot;&gt;Story2&lt;/p&gt;
  # 11 : Story2
  # 12 :
  # 
  # 13 :
  # 
  # 14 :
</code></pre>
</li>
<li>vs. <code>find_all_next()</code><pre><code class="lang-python">  result=soup.p.find_all_next()
  print_result(result)
  # 0 : &lt;a&gt;Tom&lt;/a&gt;
  # 1 : &lt;p class=&quot;story&quot; id=&quot;test2&quot;&gt;Story1&lt;/p&gt;
  # 2 : &lt;p class=&quot;story&quot; id=&quot;test3&quot;&gt;Story2&lt;/p&gt;
</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="header-13">Demo: Searching the Tree</h3>
<pre><code class="lang-python">from bs4 import BeautifulSoup
from bs4 import element
import re

content=&#39;&#39;&#39;
&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;&lt;/head&gt; &lt;body&gt;
&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
&lt;p class=&quot;story&quot;&gt;
Once upon a time there were three little sisters; and their names were
&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and &lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
&lt;/p&gt;
&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
&#39;&#39;&#39;

soup=BeautifulSoup(content,&#39;html.parser&#39;)
print(soup.prettify())

def print_result(result):
    if type(result)==element.Tag or (type(result)== list and len(result)==0):
        print(result)
        return
    for i,r in enumerate(result):
        print(i,&quot;:&quot;,r)
    print(&#39;-------------------------&#39;)

def print_result_name(result):
    if type(result)==element.Tag or (type(result)== list and len(result)==0):
        print(result)
        return
    for i,r in enumerate(result):
        print(i,&quot;:&quot;,r.name)
    print(&#39;-------------------------&#39;)
</code></pre>
<ol>
<li><p>Searching down</p>
<ul>
<li><p>by <code>name</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: `find_all(&quot;a&quot;)` ---&#39;)
  result=soup.find_all(&#39;a&#39;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;

  print(&#39;--- Demo: `find_all([&quot;a&quot;,&quot;title&quot;])` ---&#39;)
  result=soup.find_all([&#39;a&#39;,&#39;title&#39;])
  print_result(result)
  # 0 : &lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 3 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;

  print(&#39;--- Demo: `find_all(True)` ---&#39;)
  result=soup.find_all(True)
  print_result(result)
  # 0 : &lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;&lt;/head&gt; &lt;body&gt;
  # &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
  # &lt;p class=&quot;story&quot;&gt;
  # Once upon a time there were three little sisters; and their names were
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
  # &lt;/p&gt;
  # &lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;
  # &lt;/body&gt;
  # &lt;/html&gt;
  # 1 : &lt;head&gt;&lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;&lt;/head&gt;
  # 2 : &lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;
  # 3 : &lt;body&gt;
  # &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
  # &lt;p class=&quot;story&quot;&gt;
  # Once upon a time there were three little sisters; and their names were
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
  # &lt;/p&gt;
  # &lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;
  # &lt;/body&gt;
  # 4 : &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
  # 5 : &lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;
  # 6 : &lt;p class=&quot;story&quot;&gt;
  # Once upon a time there were three little sisters; and their names were
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
  # &lt;/p&gt;
  # 7 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 8 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 9 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
  # 10 : &lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;

  print(&#39;--- Demo: `find_all(re.compile(&quot;b&quot;)` ---&#39;)
  result=soup.find_all(re.compile(&#39;b&#39;))
  print_result(result)
  # 0 : &lt;body&gt;
  # &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
  # &lt;p class=&quot;story&quot;&gt;
  # Once upon a time there were three little sisters; and their names were
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
  # &lt;/p&gt;
  # &lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;
  # &lt;/body&gt;
  # 1 : &lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;
</code></pre>
</li>
<li><p>by <code>attrs</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: find_all(&quot;p&quot;,&quot;story&quot;) ---&#39;)
  result=soup.find_all(&#39;p&#39;,&#39;story&#39;)
  print_result(result)
  # 0 : &lt;p class=&quot;story&quot;&gt;
  # Once upon a time there were three little sisters; and their names were
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
  # &lt;/p&gt;
  # 1 : &lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;

  print(&#39;--- Demo: find_all(id=&quot;link1&quot;) ---&#39;)
  result=soup.find_all(id=&#39;link1&#39;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;

  print(&#39;--- Demo: find_all(class_=&quot;sister&quot;) ---&#39;)
  result=soup.find_all(class_=&#39;sister&#39;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;

  print(&#39;--- Demo: find_all(re.compile(&quot;link&quot;)) ---&#39;)
  result=soup.find_all(id=re.compile(&#39;link&#39;))
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;

  print(&#39;--- Demo: find_all(attrs={&quot;class&quot;:&quot;story&quot;}) ---&#39;)
  result=soup.find_all(attrs={&#39;class&#39;:&#39;story&#39;})
  print_result(result)
  # 0 : &lt;p class=&quot;story&quot;&gt;
  # Once upon a time there were three little sisters; and their names were
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
  # &lt;/p&gt;
  # 1 : &lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;
</code></pre>
</li>
<li><p>by <code>recursive</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: find_all(&quot;a&quot;) ---&#39;)
  result=soup.find_all(&#39;a&#39;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;

  print(&#39;--- Demo: find_all(&quot;a&quot;,recursive=False) ---&#39;)
  result=soup.find_all(&#39;a&#39;,recursive=False)
  print_result(result)
  # []
</code></pre>
</li>
<li><p>by <code>string/text</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: find_all(string=&quot;three&quot;) ---&#39;)
  result=soup.find_all(string=&#39;three&#39;)
  print_result(result)
  # []

  print(&#39;--- Demo: find_all(string=re.compile(&quot;e&quot;)) ---&#39;)
  result=soup.find_all(string=re.compile(&#39;e&#39;))
  print_result(result)
  # 0 : The Dormouse&#39;s story
  # 1 : The Dormouse&#39;s story
  # 2 :
  # Once upon a time there were three little sisters; and their names were
  #
  # 3 : Elsie
  # 4 : Lacie
  # 5 : Tillie
  # 6 : ; and they lived at the bottom of a well.
</code></pre>
</li>
<li>by <code>limit</code> : <code>find()</code>也就是当<code>limit=1</code>时的<code>find_all()</code><pre><code class="lang-python">  print(&#39;--- Demo: find_all(&quot;a&quot;,limit-2) ---&#39;)
  result=soup.find_all(&#39;a&#39;,limit=2)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
</code></pre>
</li>
<li><p>by <code>self def function</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: using `self def function` ---&#39;)
  def my_filter(tag):
      return tag.has_attr(&#39;id&#39;) and re.match(&#39;link&#39;,tag.get(&quot;id&quot;))

  result=soup.find_all(my_filter)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>Searching up: <code>find_parents</code></p>
<pre><code class="lang-python"> print(&#39;--- Demo: link2.`find_parents()` ---&#39;)
 result=soup.find(id=&quot;link2&quot;).find_parents()
 print_result_name(result)
 # 0 : p
 # 1 : body
 # 2 : html
 # 3 : [document]

 print(&#39;--- Demo: link2.`find_parents(&quot;p&quot;)` ---&#39;)
 result=soup.find(id=&quot;link2&quot;).find_parents(&#39;p&#39;)
 print_result(result)
 # 0 : &lt;p class=&quot;story&quot;&gt;
 # Once upon a time there were three little sisters; and their names were
 # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
 # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
 # &lt;/p&gt;
</code></pre>
</li>
<li><p>Searching sideway: <code>find_next_siblings</code></p>
<pre><code class="lang-python"> print(&#39;--- Demo: `find_next_siblings()` ---&#39;)
 result=soup.find(id=&quot;link1&quot;).find_next_siblings()
 print_result(result)
 # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
 # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
</code></pre>
</li>
<li><p>Searching forth and back: <code>find_all_next</code></p>
<pre><code class="lang-python"> print(&#39;--- Demo: `find_all_next()` ---&#39;)
 result=soup.find(id=&quot;link1&quot;).find_all_next()
 print_result(result)
 # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
 # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
 # 2 : &lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;
</code></pre>
</li>
</ol>
<h3 id="header-14">Demo: CSS Selectors</h3>
<pre><code class="lang-html">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;&lt;/head&gt; &lt;body&gt;
&lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
&lt;p class=&quot;story&quot;&gt;
Once upon a time there were three little sisters; and their names were
&lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
&lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; and &lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
&lt;/p&gt;
&lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;
&lt;input type=&quot;text&quot; disabled value=&quot;input something&quot;&gt;&lt;/input&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<ol>
<li><p>基础选择</p>
<ul>
<li><p><code>#id</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;#link1&quot;)` ---&#39;)
  result=soup.select(&quot;#link1&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;

  print(&#39;--- Demo: `select(&quot;a#link1&quot;)` ---&#39;)
  result=soup.select(&quot;a#link2&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
</code></pre>
</li>
<li><code>tagName</code><pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;title&quot;)` ---&#39;)
  result=soup.select(&quot;title&quot;)
  print_result(result)
  # 0 : &lt;title&gt;The Dormouse&#39;s story&lt;/title&gt;
</code></pre>
</li>
<li><code>.styleClass</code><pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;.sister&quot;)` ---&#39;)
  result=soup.select(&quot;.sister&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>属性过滤</p>
<ul>
<li><p><code>[attribute]</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;a[href]&quot;)` ---&#39;)
  result=soup.select(&#39;a[href]&#39;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
</code></pre>
</li>
<li><p><code>[attribute=value]</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;[class=sister]&quot;)` ---&#39;)
  result=soup.select(&quot;[class=sister]&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
</code></pre>
</li>
<li><code>[attribute^=value]</code><pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;a[href^=&quot;http://example.com/&quot;]&quot;)` ---&#39;)
  result=soup.select(&#39;a[href^=&quot;http://example.com/&quot;]&#39;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
</code></pre>
</li>
<li><code>[attribute$=value]</code><pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;a[href$=&quot;tillie&quot;])` ---&#39;)
  result=soup.select(&#39;a[href$=&quot;tillie&quot;]&#39;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
</code></pre>
-<code>[attribute*=value]</code><pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;a[href*=&quot;.com/el&quot;]&quot;)` ---&#39;)
  result=soup.select(&#39;a[href*=&quot;.com/el&quot;]&#39;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
</code></pre>
</li>
<li><code>[selector1][selector2][selectorN]</code><pre><code class="lang-python">  print(&quot;--- Demo: `[class=&#39;sister&#39;][id=link2]` --- &quot;)
  print_result(soup.select(&quot;[class=sister][id=link2]&quot;))
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>层级选择</p>
<ul>
<li><code>ancestor descendent</code><pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;body a&quot;)` ---&#39;)
  result=soup.select(&quot;body a&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
</code></pre>
</li>
<li><p><code>parent &gt; child</code></p>
<pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;body &gt; a&quot;) ---&#39;)
  result=soup.select(&quot;body &gt; a&quot;)
  print_result(result)
  # []

  print(&#39;--- Demo: `select(&quot;p &gt; a&quot;) ---&#39;)
  result=soup.select(&quot;p &gt; a&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;

  print(&#39;--- Demo: `select(&quot;p &gt; a:nth-of-type(2)&quot;)` ---&#39;)
  result=soup.select(&quot;p &gt; a:nth-of-type(2)&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;

  print(&#39;--- Demo: `select(&quot;p &gt; #link1&quot;)` ---&#39;)
  result=soup.select(&quot;p &gt; #link1&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
</code></pre>
</li>
<li><code>prev + next</code> ：next sibling tag<pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;#link1 ~ .sister&quot;)` ---&#39;)
  result=soup.select(&quot;#link1 ~ .sister&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
</code></pre>
</li>
<li><code>prev ~ siblings</code> ：next all sibling tags<pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;#link1 + .sister&quot;)` ---&#39;)
  result=soup.select(&quot;#link1 + .sister&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>元素过滤</p>
<ul>
<li><code>:not(selector)</code><pre><code class="lang-python">  print(&quot;--- Demo: `:not(.story)` --- &quot;)
  print_result(soup.select(&quot;p:not(.story)&quot;))
  # 0 : &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
</code></pre>
</li>
<li><code>:nth-of-type(index)</code><pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;p:nth-of-type(3)&quot;)` ---&#39;)
  result=soup.select(&quot;p:nth-of-type(3)&quot;)
  print_result(result)
  # 0 : &lt;p class=&quot;story&quot;&gt;...&lt;/p&gt;
</code></pre>
</li>
<li><code>:nth-child(index)</code><pre><code class="lang-python">  print(&quot;--- Demo: `p &gt; :nth-child(1)` --- &quot;)
  print_result(soup.select(&quot;p &gt; :nth-child(1)&quot;))
  # 0 : &lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
</code></pre>
</li>
<li><code>:first-child</code><pre><code class="lang-python">  print(&quot;--- Demo: `p &gt; :first-child` --- &quot;)
  print_result(soup.select(&quot;p &gt; :first-child&quot;))
  # 0 : &lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
</code></pre>
</li>
<li><code>:last-child</code><pre><code class="lang-python">  print(&quot;--- Demo: `p &gt; :last-child` --- &quot;)
  print_result(soup.select(&quot;p &gt; :last-child&quot;))
  # 0 : &lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
</code></pre>
</li>
<li><code>:only-child</code><pre><code class="lang-python">  print(&quot;--- Demo: `p &gt; :only-child` --- &quot;)
  print_result(soup.select(&quot;p &gt; :only-child&quot;))
  # 0 : &lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>内容过滤</p>
<ul>
<li><code>:contains(text)</code><pre><code class="lang-python">  print(&quot;--- Demo: `p:contains(story)` --- &quot;)
  print_result(soup.select(&quot;p:contains(story)&quot;))
  # 0 : &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
</code></pre>
</li>
<li><code>:empty</code><pre><code class="lang-python">  print(&quot;--- Demo: `p:empty` --- &quot;)
  print_result(soup.select(&quot;p:empty&quot;))
  # []
</code></pre>
</li>
<li><code>:has(selector)</code><pre><code class="lang-python">  print(&quot;--- Demo: `p:has(b)` --- &quot;)
  print_result(soup.select(&quot;p:has(b)&quot;))
  # 0 : &lt;p class=&quot;title&quot;&gt;&lt;b&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>表单属性过滤</p>
<ul>
<li><code>:enabled</code>,<code>:disabled</code>,<code>:checked</code><pre><code class="lang-python">  print(&quot;--- Demo: `:disabled`` --- &quot;)
  print_result(soup.select(&quot;:disabled&quot;))
  # 0 : &lt;input disabled=&quot;&quot; type=&quot;text&quot; value=&quot;input something&quot;/&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>其他：</p>
<ul>
<li><code>selector1, selector2, selectorN</code><pre><code class="lang-python">  print(&#39;--- Demo: `select(&quot;#link1,#link2&quot;)` ---&#39;)
  result=soup.select(&quot;#link1,#link2&quot;)
  print_result(result)
  # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
  # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
</code></pre>
</li>
<li><code>select_one()</code><pre><code class="lang-python">  print(&#39;--- Demo: `select_one(&quot;.sister&quot;)` ---&#39;)
  result=soup.select_one(&quot;.sister&quot;)
  print_result(result)
  # &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
</code></pre>
</li>
</ul>
</li>
<li><p>get attribute value:</p>
<pre><code class="lang-python"> print(&#39;--- Demo: `get attribute value` ---&#39;)
 result=soup.select(&quot;.sister&quot;)

 print_result(result)
 # 0 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/elsie&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;
 # 1 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/lacie&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
 # 2 : &lt;a class=&quot;sister&quot; href=&quot;http://example.com/tillie&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;

 print(result[0].get_text())
 #Elsie

 print(result[0].attrs)
 #{&#39;href&#39;: &#39;http://example.com/elsie&#39;, &#39;class&#39;: [&#39;sister&#39;], &#39;id&#39;: &#39;link1&#39;}

 print(result[0].attrs[&#39;id&#39;])
 #link1
</code></pre>
</li>
</ol>
<h2 id="header-15">文档解析之XPath</h2>
<ul>
<li>使用路径表达式来选取<code>XML/HTML</code>文档中的节点或节点集</li>
<li>安装: <code>pip install lxml</code></li>
<li>导入：<code>from lxml import etree</code></li>
<li>注意：<code>lxml</code>和正则一样用<code>C</code>实现，是一款高性能的Python<code>HTML/XML</code>解析器，可以利用<code>XPath</code>语法来快速的定位特定元素以及节点信息</li>
<li>Tools: Chrome的插件<code>XPath Helper</code>，快速得到页面元素的匹配规则</li>
</ul>
<h3 id="header-16">路径表达式</h3>
<ul>
<li><p><code>//</code> : 选取所有的当前节点，不考虑他们的位置</p>
<ul>
<li><code>//p</code> (<code>.//p</code>)</li>
<li><code>/p//a</code></li>
<li><code>//p/a</code></li>
</ul>
</li>
<li><p><code>/</code> : 从根节点选取</p>
<ul>
<li><code>/p</code> (<code>./p</code>)</li>
<li><code>/p/a</code></li>
</ul>
</li>
<li><p><code>.</code> 当前节点,<code>..</code> : 当前节点的父节点</p>
<ul>
<li><code>./p</code> </li>
<li><code>../p</code></li>
<li><code>//p/b/../a</code></li>
<li><code>root.xpath(&#39;//p/b&#39;).xpath(&#39;./a&#39;)</code></li>
<li><code>root.xpath(&#39;//p/b&#39;).xpath(&#39;../text()&#39;)</code></li>
<li><code>root.xpath(&#39;//p/b/..//a&#39;)[0].text</code></li>
</ul>
</li>
<li><p><code>@</code> : 选取属性</p>
<ul>
<li><code>//@class</code></li>
<li><code>//p/@class</code></li>
<li><code>//p//@class</code></li>
<li><code>//p[@class]</code></li>
<li><code>//p[@class=&#39;s1&#39;]</code></li>
<li><code>//p[@class=&#39;s1&#39;]/@class</code></li>
</ul>
</li>
<li><p><code>/text()</code>,<code>string(.)</code> 选择内容</p>
<ul>
<li><code>&quot;//b/text()&quot;</code></li>
<li><code>//b//text()</code></li>
<li><code>string(.)</code></li>
<li><code>string(./description)</code></li>
</ul>
</li>
<li><p><code>[]</code>: Predicates</p>
<ul>
<li><code>//p[1]</code>,<code>//p[last()]</code>,<code>//p[last()-1]</code></li>
<li><code>//p[position()&lt;=2]</code></li>
<li><code>//p[@class]</code>,<code>//p[@class=&#39;s1&#39;]</code></li>
<li><code>//p[b]</code>,<code>//p[b/@class]</code>,<code>//p[b[@class=&#39;s1&#39;]]</code></li>
</ul>
</li>
<li><p><code>*</code> : 通配符，匹配任何 </p>
<ul>
<li><code>//p/*</code></li>
<li><code>//p//*</code></li>
<li><code>//p/*/a</code></li>
<li><code>//p[@*]</code></li>
<li><code>//*[@class=&#39;s1&#39;]</code></li>
</ul>
</li>
<li><p><code>|</code> : 选取多个路径</p>
<ul>
<li><code>/p | //b</code></li>
<li><code>//p/a | //p/b[@class]</code></li>
</ul>
</li>
<li><p><code>and</code>,<code>or</code>,<code>not</code>:</p>
<ul>
<li><code>//a[@class=&#39;sister&#39; and @id=&#39;link2&#39;]</code>,<code>//a[@class=&#39;sister&#39;][@id=&#39;link2&#39;]</code></li>
<li><code>//a[@id=&#39;link1&#39; or @class=&#39;outAstyle&#39;]</code></li>
<li><code>//a[not(@class=&#39;sister&#39;)]</code></li>
<li><code>//a[not(@class=&#39;sister&#39;) and @class or @id=&#39;link1&#39;]</code></li>
</ul>
</li>
<li><p><code>xxx()</code>: </p>
<ul>
<li><code>starts-with()</code>: <code>//a[starts-with(@href,&#39;http://example.com/&#39;)]</code></li>
<li><code>contains()</code>: <code>//a[contains(text(),&#39;ie&#39;) and contains(@id,&#39;link&#39;)]</code></li>
<li><code>text()</code>: <code>//b/text()</code>,<code>//b//text()</code></li>
<li><code>string(.)</code>: <code>data.xpath(&#39;//div[@class=&quot;name&quot;]&#39;)[0].xpath(&#39;string(.)&#39;)</code></li>
</ul>
</li>
<li><p><code>::</code></p>
<ul>
<li>go self: <code>self::</code>,eg: <code>//self::b</code></li>
<li>go up: <code>ancestor::</code> , <code>ancestor-or-self::</code>,<code>parent::</code>,eg: <code>//a/ancestor::p</code></li>
<li>go down: <code>descendant::</code>,<code>child::</code>,eg: <code>//p/descendant::a[not(@class)]</code></li>
<li>go forward: <code>following::</code>,<code>following-sibling::</code>, eg: <code>p[last()-1]/following::*</code></li>
<li>go back: <code>preceding::</code>,<code>preceding-sibling::</code> , eg: <code>p[2]/preceding::*</code></li>
<li>get attributes: <code>attribute::</code>,eg: <code>//a/attribute::*</code>,<code>//a/attribute::class</code></li>
</ul>
</li>
<li><p><code>lxml.etree._Element</code>:</p>
<ul>
<li><code>tag</code></li>
<li><code>attrib</code></li>
<li><code>text</code></li>
<li><code>.xpath(&#39;string(.)&#39;)</code></li>
<li><code>.get(&#39;attribute&#39;)</code></li>
</ul>
</li>
</ul>
<h3 id="header-17">Demo: 解析HTML</h3>
<pre><code class="lang-python">#!/usr/bin/env python
# -*- coding:utf-8 -*-
from lxml import etree

content=&#39;&#39;&#39;
&lt;div&gt;
    &lt;p class=&quot;title&quot;&gt;&lt;b class=&#39;bstyle&#39;&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
    &lt;p class=&quot;story&quot;&gt;
        Once upon a time there were three little sisters; and their names were
        &lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
        &lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt; 
        and &lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
        ; and they lived at the bottom of a well.
        &lt;p&gt; hello ...&lt;b&gt;&lt;a&gt; World &lt;/a&gt;&lt;/b&gt; &lt;/p&gt;
    &lt;/p&gt;
    &lt;p class=&quot;story&quot;&gt;...&lt;a class=&quot;outAstyle&quot;&gt;Miss&lt;/a&gt; &lt;/p&gt;
&lt;/div&gt;
&#39;&#39;&#39;

# html = etree.parse(&#39;./test.html&#39;,etree.HTMLParser())
html = etree.HTML(content)
print(html)
# &lt;Element html at 0x1019312c8&gt;

# result = etree.tostring(html)     # 会补全缺胳膊少腿的标签
# print(result.decode(&quot;utf-8&quot;))
print(etree.tounicode(html))        # 会补全缺胳膊少腿的标签
# &lt;html&gt;&lt;body&gt;&lt;div&gt;
#   &lt;p class=&quot;title&quot;&gt;&lt;b class=&quot;bstyle&quot;&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
#   &lt;p class=&quot;story&quot;&gt;
#       Once upon a time there were three little sisters; and their names were
#       &lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
#       &lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;
#       and &lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;
#       ; and they lived at the bottom of a well.
#       &lt;/p&gt;&lt;p&gt; hello ...&lt;b&gt;&lt;a&gt; World &lt;/a&gt;&lt;/b&gt; &lt;/p&gt;
#   &lt;p class=&quot;story&quot;&gt;...&lt;a class=&quot;outAstyle&quot;&gt;Miss&lt;/a&gt; &lt;/p&gt;
# &lt;/div&gt;
# &lt;/body&gt;&lt;/html&gt;

result=html.xpath(&quot;//p/b&quot;)
for i,r in enumerate(result):
    print(i,type(r),&quot;:&quot;,r.tag,r.attrib,r.get(&#39;class&#39;),r.text,r.xpath(&#39;string(.)&#39;))
# 0 &lt;class &#39;lxml.etree._Element&#39;&gt; : b {&#39;class&#39;: &#39;bstyle&#39;} bstyle The Dormouse&#39;s story The Dormouse&#39;s story
# 1 &lt;class &#39;lxml.etree._Element&#39;&gt; : b {} None None  World

###########################
# More test:
test_path_any(html)
test_path_attr(html)
test_path_predicates(html)


def test_path_any(root):
    print(&quot;--- `//` ----&quot;)
    do_xpath(root,&#39;p&#39;)
    # []
    do_xpath(root,&#39;//p&#39;)
    # [&lt;Element p at 0x109f34148&gt;, &lt;Element p at 0x109f34188&gt;, &lt;Element p at 0x109f34248&gt;, &lt;Element p at 0x109f34288&gt;]
    do_xpath(root,&#39;//p/a/text()&#39;)
    # [&#39;Elsie&#39;, &#39;Lacie&#39;, &#39;Tillie&#39;, &#39;Miss&#39;]
    do_xpath(root,&#39;//p//a/text()&#39;)
    # [&#39;Elsie&#39;, &#39;Lacie&#39;, &#39;Tillie&#39;, &#39; World &#39;, &#39;Miss&#39;]
    do_xpath(root,&#39;.//a/text()&#39;)
    # [&#39;Elsie&#39;, &#39;Lacie&#39;, &#39;Tillie&#39;, &#39; World &#39;, &#39;Miss&#39;]

    print(&#39;--- `xpath` ---&#39;)
    print(root.xpath(&quot;//p/b//a&quot;))
    # [&lt;Element a at 0x10b555f08&gt;]
    print(root.xpath(&quot;//p/b&quot;)[1].xpath(&quot;//a&quot;))
    # [&lt;Element a at 0x10b555f08&gt;, &lt;Element a at 0x10b5770c8&gt;, &lt;Element a at 0x10b577108&gt;, &lt;Element a at 0x10b577048&gt;, &lt;Element a at 0x10b577088&gt;]
    print(root.xpath(&quot;//p/b&quot;)[1].xpath(&quot;./a&quot;))
    # [&lt;Element a at 0x10c719f48&gt;]
    print(root.xpath(&quot;//p/b&quot;)[1].xpath(&quot;../text()&quot;))
    # [&#39; hello ...&#39;, &#39; &#39;]
    print(root.xpath(&#39;//p/b/..//a&#39;)[0].text)
    # World
    print(&#39;------------------------&#39;)

def test_path_attr(root):
    print(&quot;--- `@` ----&quot;)
    do_xpath(root,&#39;/@class&#39;)
    # []
    do_xpath(root,&#39;//@class&#39;)
    # [&#39;title&#39;, &#39;bstyle&#39;, &#39;story&#39;, &#39;sister&#39;, &#39;sister&#39;, &#39;sister&#39;, &#39;story&#39;, &#39;outAstyle&#39;]

    do_xpath(root,&#39;//p[@class]&#39;)
    # [&lt;Element p at 0x10e4c3888&gt;, &lt;Element p at 0x10e4c36c8&gt;, &lt;Element p at 0x10e4c3708&gt;]
    do_xpath(root,&quot;//p[@class=&#39;story&#39;]&quot;)
    # [&lt;Element p at 0x110ba8708&gt;, &lt;Element p at 0x110ba8548&gt;]

    do_xpath(root,&quot;//p/@class&quot;)
    # [&#39;title&#39;, &#39;story&#39;, &#39;story&#39;]
    do_xpath(root,&quot;//p[@class=&#39;story&#39;]/@class&quot;)
    # [&#39;story&#39;, &#39;story&#39;]
    do_xpath(root,&quot;//p[@class=&#39;story&#39;]//@class&quot;)
    # [&#39;story&#39;, &#39;sister&#39;, &#39;sister&#39;, &#39;sister&#39;, &#39;story&#39;, &#39;outAstyle&#39;]
    print(&#39;------------------------&#39;)

def test_path_predicates(root):
    print(&quot;--- `[]` ----&quot;)
    do_xpath_detail(root,&#39;//p[1]&#39;)
    # 0 : &lt;p class=&quot;title&quot;&gt;&lt;b class=&quot;bstyle&quot;&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
    do_xpath_detail(root,&#39;//p[last()]&#39;)
    # 0 : &lt;p class=&quot;story&quot;&gt;...&lt;a class=&quot;outAstyle&quot;&gt;Miss&lt;/a&gt; &lt;/p&gt;
    do_xpath_detail(root,&#39;//p[last()-1]&#39;)
    # 0 : &lt;p&gt; hello ...&lt;b&gt;&lt;a&gt; World &lt;/a&gt;&lt;/b&gt; &lt;/p&gt;

    do_xpath_detail(root,&#39;//a[1]&#39;)
    # 0 : &lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
    # 1 : &lt;a&gt; World &lt;/a&gt;
    # 2 : &lt;a class=&quot;outAstyle&quot;&gt;Miss&lt;/a&gt;
    do_xpath_detail(root,&#39;//p/a[1]&#39;)
    # 0 : &lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
    # 1 : &lt;a class=&quot;outAstyle&quot;&gt;Miss&lt;/a&gt;
    do_xpath_detail(root,&#39;//a[position()&lt;=2]&#39;)
    # 0 : &lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
    # 1 : &lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;and
    # 2 : &lt;a&gt; World &lt;/a&gt;
    # 3 : &lt;a class=&quot;outAstyle&quot;&gt;Miss&lt;/a&gt;

    do_xpath_detail(root,&#39;//a[@class]&#39;)
    # 0 : &lt;a href=&quot;http://example.com/elsie&quot; class=&quot;sister&quot; id=&quot;link1&quot;&gt;Elsie&lt;/a&gt;,
    # 1 : &lt;a href=&quot;http://example.com/lacie&quot; class=&quot;sister&quot; id=&quot;link2&quot;&gt;Lacie&lt;/a&gt;and
    # 2 : &lt;a href=&quot;http://example.com/tillie&quot; class=&quot;sister&quot; id=&quot;link3&quot;&gt;Tillie&lt;/a&gt;; and they lived at the bottom of a well.
    # 3 : &lt;a class=&quot;outAstyle&quot;&gt;Miss&lt;/a&gt;
    do_xpath_detail(root,&#39;//a[@class=&quot;outAstyle&quot;]&#39;)
    # 0 : &lt;a class=&quot;outAstyle&quot;&gt;Miss&lt;/a&gt;

    do_xpath_detail(root,&#39;//p[b]&#39;)
    # 0 : &lt;p class=&quot;title&quot;&gt;&lt;b class=&quot;bstyle&quot;&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
    # 1 : &lt;p&gt; hello ...&lt;b&gt;&lt;a&gt; World &lt;/a&gt;&lt;/b&gt; &lt;/p&gt;
    do_xpath_detail(root,&quot;//p[b/@class]&quot;)
    # 0 : &lt;p class=&quot;title&quot;&gt;&lt;b class=&quot;bstyle&quot;&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
    do_xpath_detail(root,&quot;//p[b[@class=&#39;bstyle&#39;]]&quot;)
    # 0 : &lt;p class=&quot;title&quot;&gt;&lt;b class=&quot;bstyle&quot;&gt;The Dormouse&#39;s story&lt;/b&gt;&lt;/p&gt;
    print(&#39;------------------------&#39;)

def do_xpath(root,path):
    result=root.xpath(path)
    print(&quot;%s : \n%s&quot; % (path,result))
    return result

def do_xpath_detail(root,path):
    result=root.xpath(path)
    print(path,&quot;:&quot;)
    if type(result)==list and len(result)&gt;0:
        for i,r in enumerate(result):
            if type(r)==etree._Element:
                print(i,&quot;:&quot;,etree.tounicode(r))
            else:
                print(i,&quot;:&quot;,r)
    else:
        print(result)
    return result
</code></pre>
<h3 id="header-18">Demo: 解析XML</h3>
<pre><code class="lang-python">from lxml import etree

content=&#39;&#39;&#39;
&lt;collection shelf=&quot;New Arrivals&quot;&gt;
    &lt;movie title=&quot;Enemy Behind&quot;&gt;
       &lt;type&gt;War, Thriller&lt;/type&gt;
       &lt;format&gt;DVD&lt;/format&gt;
       &lt;year&gt;2003&lt;/year&gt;
       &lt;rating&gt;PG&lt;/rating&gt;
       &lt;stars&gt;10&lt;/stars&gt;
       &lt;description&gt;Talk about a US-Japan war&lt;/description&gt;
    &lt;/movie&gt;
    &lt;movie title=&quot;Transformers&quot;&gt;
       &lt;type&gt;Anime, Science Fiction&lt;/type&gt;
       &lt;format&gt;DVD&lt;/format&gt;
       &lt;year&gt;1989&lt;/year&gt;
       &lt;rating&gt;R&lt;/rating&gt;
       &lt;stars&gt;8&lt;/stars&gt;
       &lt;description&gt;A schientific fiction&lt;/description&gt;
    &lt;/movie&gt;
&lt;/collection&gt;
&#39;&#39;&#39;
root=etree.XML(content)
print(root)
print(etree.tounicode(root))

result=root.xpath(&#39;//movie&#39;)
for i,r in enumerate(result):
    print(i,r,&quot;:&quot;,r.tag,r.attrib,r.get(&#39;title&#39;))
    print(&quot;text:&quot;,r.text)
    print(&quot;string:&quot;,r.xpath(&#39;string(./description)&#39;))
    print(&#39;rating:&#39;,r.xpath(&#39;./rating/text()&#39;))
</code></pre>
<h2 id="header-19">文档解析之JSonPath</h2>
<ul>
<li>是一种信息抽取类库, 是从<code>JSON</code>文档中抽取指定信息的工具，提供多种语言实现版本，包括：Javascript,Python,PHP，Java</li>
<li>JsonPath对于<code>JSON</code>来说，相当于<code>XPATH</code> 对于<code>XML</code>, Refer <a href="https://goessner.net/articles/JsonPath/" target="_blank" rel="noopener">JSONPath - XPath for JSON</a></li>
<li>python中有2个类库可使用<ul>
<li><code>pip install jsonpath</code>,<code>import jsonpath</code></li>
<li><code>pip install jsonpath-rw</code>, <code>from jsonpath import jsonpath,parse</code> , Refer <a href="https://pypi.org/project/jsonpath-rw/" target="_blank" rel="noopener">Github</a></li>
</ul>
</li>
</ul>
<h3 id="header-20">Jsonpath 操作符</h3>
<ul>
<li><code>$</code>: 根节点</li>
<li><code>@</code>: 当前节点</li>
<li><code>*</code>: 通配符，匹配所有</li>
<li><code>..</code>: 递归搜索</li>
<li><code>.</code> : 子节点</li>
<li><code>[]</code>: 取子节点,迭代器标示(可在里面做简单的迭代操作，如数组下标，根据内容选值等) <ul>
<li><code>[start:end]</code>,<code>[start:end:step]</code></li>
<li><code>[,]</code> 支持迭代器中做多选</li>
</ul>
</li>
<li><code>()</code>: 支持表达式计算<ul>
<li><code>?()</code>: 过滤操作，表达式结果必须是boolean类型</li>
</ul>
</li>
</ul>
<h3 id="header-21">Json转换</h3>
<ul>
<li><code>import json</code></li>
<li>function:<ul>
<li><code>loads</code>,<code>load</code>: jsonString -&gt; pythonObj</li>
<li><code>dumps</code>,<code>dump</code>: pythonObj -&gt; jsonString</li>
</ul>
</li>
<li>转换：<table class="table">
<thead>
<tr>
<th style="text-align:left">Json</th>
<th style="text-align:left">Python</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">object</td>
<td style="text-align:left">dict</td>
</tr>
<tr>
<td style="text-align:left">array</td>
<td style="text-align:left">list</td>
</tr>
<tr>
<td style="text-align:left">string</td>
<td style="text-align:left">unicode</td>
</tr>
<tr>
<td style="text-align:left">number(int)</td>
<td style="text-align:left">int,long</td>
</tr>
<tr>
<td style="text-align:left">number(real)</td>
<td style="text-align:left">float</td>
</tr>
<tr>
<td style="text-align:left">true</td>
<td style="text-align:left">True</td>
</tr>
<tr>
<td style="text-align:left">false</td>
<td style="text-align:left">False</td>
</tr>
<tr>
<td style="text-align:left">null</td>
<td style="text-align:left">None</td>
</tr>
</tbody>
</table>
</li>
</ul>
<p><strong> 示例：</strong></p>
<pre><code class="lang-python">import json

content=&#39;&#39;&#39;
{&quot;subjects&quot;:[
    {&quot;rate&quot;:&quot;6.5&quot;,&quot;cover_x&quot;:1000,&quot;title&quot;:&quot;硬核&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/27109879/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2532653002.webp&quot;,&quot;id&quot;:&quot;27109879&quot;,&quot;cover_y&quot;:1414,&quot;is_new&quot;:false}
    ,{&quot;rate&quot;:&quot;7.1&quot;,&quot;cover_x&quot;:2000,&quot;title&quot;:&quot;奎迪：英雄再起&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/26707088/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2544510053.webp&quot;,&quot;id&quot;:&quot;26707088&quot;,&quot;cover_y&quot;:2800,&quot;is_new&quot;:false}
    ,{&quot;rate&quot;:&quot;6.1&quot;,&quot;cover_x&quot;:800,&quot;title&quot;:&quot;芳龄十六&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/30334122/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2549923514.webp&quot;,&quot;id&quot;:&quot;30334122&quot;,&quot;cover_y&quot;:1185,&quot;is_new&quot;:false}
    ,{&quot;rate&quot;:&quot;7.7&quot;,&quot;cover_x&quot;:1500,&quot;title&quot;:&quot;污垢&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/1945750/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2548709468.webp&quot;,&quot;id&quot;:&quot;1945750&quot;,&quot;cover_y&quot;:2222,&quot;is_new&quot;:false}
    ,{&quot;rate&quot;:&quot;6.8&quot;,&quot;cover_x&quot;:1179,&quot;title&quot;:&quot;欢乐满人间2&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/26611891/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2515404175.webp&quot;,&quot;id&quot;:&quot;26611891&quot;,&quot;cover_y&quot;:1746,&quot;is_new&quot;:false}
]}
&#39;&#39;&#39;

# 1. loads: string -&gt; python obj
print(&#39;---- loads: --------------&#39;)
result=json.loads(content)
print(type(result))                             # &lt;class &#39;dict&#39;&gt;
print(result)

# 2. dumps: python obj -&gt; string
print(&#39;---- dumps: --------------&#39;)
subjects=result.get(&#39;subjects&#39;)
result=json.dumps(subjects,ensure_ascii=False)  # 禁用ascii编码，按utf-8编码    
print(type(result))                             # &lt;class &#39;str&#39;&gt;
print(result)

# 3. dump: python obj -&gt; string -&gt; file
print(&#39;---- dump: --------------&#39;)
json.dump(subjects,open(&#39;test.json&#39;,&#39;w&#39;),ensure_ascii=False)
with open(&#39;test.json&#39;,&#39;r&#39;) as f:
    print(f.read())

# 4. load: file -&gt; string -&gt; python obj
print(&#39;---- load: --------------&#39;)
result=json.load(open(&#39;test.json&#39;,&#39;r&#39;))
print(type(result))                             # &lt;class &#39;list&#39;&gt;
print(result)

print(&#39;-------------------------&#39;)
</code></pre>
<h3 id="header-22">Demo：使用Jsonpath解析JSON</h3>
<pre><code class="lang-python">import json
import jsonpath

content=&#39;&#39;&#39;
{&quot;subjects&quot;:[
    {&quot;rate&quot;:&quot;6.5&quot;,&quot;cover_x&quot;:1000,&quot;title&quot;:&quot;硬核&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/27109879/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2532653002.webp&quot;,&quot;id&quot;:&quot;27109879&quot;,&quot;cover_y&quot;:1414,&quot;is_new&quot;:false}
    ,{&quot;rate&quot;:&quot;7.1&quot;,&quot;cover_x&quot;:2000,&quot;title&quot;:&quot;奎迪：英雄再起&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/26707088/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2544510053.webp&quot;,&quot;id&quot;:&quot;26707088&quot;,&quot;cover_y&quot;:2800,&quot;is_new&quot;:false}
    ,{&quot;rate&quot;:&quot;6.1&quot;,&quot;cover_x&quot;:800,&quot;title&quot;:&quot;芳龄十六&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/30334122/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2549923514.webp&quot;,&quot;id&quot;:&quot;30334122&quot;,&quot;cover_y&quot;:1185,&quot;is_new&quot;:false}
    ,{&quot;rate&quot;:&quot;7.7&quot;,&quot;cover_x&quot;:1500,&quot;title&quot;:&quot;污垢&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/1945750/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2548709468.webp&quot;,&quot;id&quot;:&quot;1945750&quot;,&quot;cover_y&quot;:2222,&quot;is_new&quot;:false}
    ,{&quot;rate&quot;:&quot;6.8&quot;,&quot;cover_x&quot;:1179,&quot;title&quot;:&quot;欢乐满人间2&quot;,&quot;url&quot;:&quot;https://movie.douban.com/subject/26611891/&quot;,&quot;playable&quot;:false,&quot;cover&quot;:&quot;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2515404175.webp&quot;,&quot;id&quot;:&quot;26611891&quot;,&quot;cover_y&quot;:1746,&quot;is_new&quot;:false}
]}
&#39;&#39;&#39;

# 0. 加载
obj=json.loads(content)

# 1. `[?()]`
results=jsonpath.jsonpath(obj,&#39;$.subjects[?(float(@.rate)&gt;=7)]&#39;)
print(type(results))
# &lt;class &#39;list&#39;&gt;    
print(results)
#[{&#39;rate&#39;: &#39;7.1&#39;, &#39;cover_x&#39;: 2000, &#39;title&#39;: &#39;奎迪：英雄再起&#39;, &#39;url&#39;: &#39;https://movie.douban.com/subject/26707088/&#39;, &#39;playable&#39;: False, &#39;cover&#39;: &#39;https://img3.doubanio.com/view/photo/s_ratio_poster/public/p2544510053.webp&#39;, &#39;id&#39;: &#39;26707088&#39;, &#39;cover_y&#39;: 2800, &#39;is_new&#39;: False}
# , {&#39;rate&#39;: &#39;7.7&#39;, &#39;cover_x&#39;: 1500, &#39;title&#39;: &#39;污垢&#39;, &#39;url&#39;: &#39;https://movie.douban.com/subject/1945750/&#39;, &#39;playable&#39;: False, &#39;cover&#39;: &#39;https://img1.doubanio.com/view/photo/s_ratio_poster/public/p2548709468.webp&#39;, &#39;id&#39;: &#39;1945750&#39;, &#39;cover_y&#39;: 2222, &#39;is_new&#39;: False}
# ]

# 2. `.xxx`
results=jsonpath.jsonpath(obj,&#39;$.subjects[?(float(@.rate)&gt;=7)].title&#39;)
print(results)
# [&#39;奎迪：英雄再起&#39;, &#39;污垢&#39;]

# 3. `[index1,index2]`
results=jsonpath.jsonpath(obj,&#39;$.subjects[0,2,3].cover_x&#39;)
print(results)
# [1000, 800, 1500]

# 4. `[start:end]`
results=jsonpath.jsonpath(obj,&#39;$.subjects[0:3].cover_x&#39;)
print(results)
# [1000, 2000, 800]

# 5. `[start:end:step]`
results=jsonpath.jsonpath(obj,&#39;$.subjects[0:3:2].cover_x&#39;)
print(results)
# [1000, 800]

# 6. `?( &amp;&amp; )`,`?(,)`
# cover_x   cover_y
# 1000      1414
# 2000      2800
# 800       1185
# 1500      2222
# 1179      1746
results=jsonpath.jsonpath(obj,&#39;$.subjects[?(@.cover_x&gt;=1000 &amp;&amp; @.cover_y&lt;1500)]&#39;)
print(len(results))
# 1
results=jsonpath.jsonpath(obj,&#39;$.subjects[?(@.cover_x&gt;=1000,@.cover_y&lt;1500)]&#39;)
print(len(results))
# 5
print(&#39;-------------------------&#39;)
</code></pre>
<h2 id="header-23">Reference</h2>
<ul>
<li><a href="https://github.com/sixDegree/python-basic-demo" target="_blank" rel="noopener">My Demo</a></li>
<li><a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/index.html" target="_blank" rel="noopener">Beautiful Soup Documentation</a></li>
<li><a href="http://www.cnblogs.com/descusr/archive/2012/06/20/2557075.html" target="_blank" rel="noopener">用lxml解析HTML</a></li>
<li><a href="https://www.cnblogs.com/MUMO/p/5732836.html" target="_blank" rel="noopener">Python爬虫：Xpath语法笔记</a></li>
<li><a href="https://www.cnblogs.com/lei0213/p/7506130.html" target="_blank" rel="noopener">python爬虫之xpath的基本使用</a></li>
<li><a href="https://cloud.tencent.com/developer/news/374969" target="_blank" rel="noopener">Python使用JsonPath</a></li>
</ul>
  </section>
</article>

      <hr/>
      
<section class="post-comment">
	
		<div id="gitment_container"></div>

<link rel="stylesheet" href="/gitment/default.css">
<script src="/gitment/gitment.browser.js"></script>


<script type="text/javascript">
	var gitment = new Gitment({
	  id: document.location.pathname,
	  owner: 'chenjin-zero',
	  repo: 'blogComment',
	  oauth: {
	    client_id: '36a09bb7399efe69c6ce',
	    client_secret: 'ad9ad546b23b708c71d92e513dc36e0486179dea',
	  }
	})
      
	gitment.render('gitment_container')
</script>
	
</section>

    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>


	<script src="/highlight/highlight.pack.js"></script>
	<script type="text/javascript">
		hljs.initHighlightingOnLoad();
	</script>



<script type="text/javascript">

  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
