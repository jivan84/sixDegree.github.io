<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Babel &amp; Browserify</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="Babel,Browserify">
  
  
    <meta name="description" content="Build and Transform Tool">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
	
		<link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
	
    
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Site Analyse -->
  
	<script>
	var userID='2bbb83cc0f781dd7502e9d5e19661866';
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"+userID;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>


</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">Babel 转码器</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">配置执行</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">钩子</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">代码调用Babel API</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">执行环境</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-6"><span class="sidebar-nav nav-text">Browserify</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-7"><span class="sidebar-nav nav-text">Reference</span></a></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">Babel &amp; Browserify</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2018-08-01T16:00:00.000Z">2018-08-02</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-Node">Node</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h2 id="header-1">Babel 转码器</h2>
<p><a href="https://babeljs.io/" target="_blank" rel="noopener">Babel</a></p>
<blockquote>
<p>Babel is a JavaScript compiler ( Put in next-gen JavaScript, Get browser-compatible JavaScript out)</p>
</blockquote>
<p>一种转码器，将ES6代码转换为ES5代码，从而在现有环境执行</p>
<p>eg：用 ES6 编写程序，特性还没有得到广泛支持，用Babel将其转换为ES5标准的代码，就能在现有的JavaScript环境执行了</p>
<p>转码前</p>
<pre><code class="lang-javascript">input.map(item =&gt; item + 1);
</code></pre>
<p>转码后</p>
<pre><code class="lang-javascript">input.map(function (item) {
  return item + 1;
});
</code></pre>
<h3 id="header-2">配置执行</h3>
<p><strong> .babelrc</strong></p>
<p>Babel的配置文件，用来设置转码规则和插件，存放在项目的根目录下。使用Babel的第一步，就是配置这个文件</p>
<ol>
<li><p>基本格式：</p>
<pre><code class="lang-json"> {
   &quot;presets&quot;: [],
   &quot;plugins&quot;: []
 }
</code></pre>
</li>
<li><p>说明：</p>
<ul>
<li><code>presents</code>字段用来设定转码规则，按需下载安装和配置</li>
<li>官方提供的规则集:<ul>
<li>ES2015转码规则: babel-preset-es2015</li>
<li>react转码规则: babel-preset-react</li>
<li>ES7不同阶段语法提案的转码规则（共有4个阶段），任选一个：<ul>
<li>babel-preset-stage-0</li>
<li>babel-preset-stage-1</li>
<li>babel-preset-stage-2</li>
<li>babel-preset-stage-3</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Demo:</p>
<ul>
<li>安装转码规则集：<pre><code class="lang-bash">  npm install --save-dev babel-preset-es2015 babel-preset-react babel-preset-stage-2
</code></pre>
</li>
<li>配置.babelrc：<pre><code class="lang-json">  {
      &quot;presets&quot;: [
        &quot;es2015&quot;,
        &quot;react&quot;,
        &quot;stage-2&quot;
      ]
  }
</code></pre>
</li>
</ul>
</li>
</ol>
<p><strong> babel-cli </strong></p>
<p>用于命令行转码</p>
<ol>
<li><p>安装</p>
<pre><code class="lang-bash"> npm install --global babel-cli
</code></pre>
</li>
<li><p>使用</p>
<pre><code class="lang-bash"> # 转码结果输出到标准输出
 $ babel example.js

 # 转码结果写入一个文件 ( --out-file 或 -o 参数指定输出文件 )
 $ babel example.js -o compiled.js

 # 整个目录转码 ( --out-dir 或 -d 参数指定输出目录 )
 $ babel src -d lib

 # -s 参数生成source map文件
 $ babel src -d lib -s
</code></pre>
</li>
<li><p>注：若要支持不同项目使用不同版本的Babel，可将babel-cli安装在项目之中，再配置package.json</p>
<ul>
<li>安装：<pre><code class="lang-bash">  $ npm install --save-dev babel-cli
</code></pre>
</li>
<li>package.json配置：<pre><code>  {
    // ...
    &quot;devDependencies&quot;: {
      &quot;babel-cli&quot;: &quot;^6.0.0&quot;
    },
    &quot;scripts&quot;: {
      &quot;build&quot;: &quot;babel src -d lib&quot;
    },
  }
</code></pre></li>
<li>执行转码<pre><code class="lang-bash">  $ npm run build
</code></pre>
</li>
</ul>
</li>
</ol>
<h3 id="header-3">钩子</h3>
<p><strong> babel-polyfill </strong></p>
<p>Babel默认只转换新的JavaScript句法，而不转换新的API（如 Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise等全局对象，以及一些定义在全局对象上的方法，eg：Object.assign）详细清单可以查看<code>babel-plugin-transform-runtime</code>模块的<a href="https://github.com/babel/babel/blob/master/packages/babel-plugin-transform-runtime/src/definitions.js" target="_blank" rel="noopener">definitions.js</a>文件<br>eg：<br>ES6在Array对象上新增了Array.from方法。Babel就不会转码这个方法。如果想让这个方法运行，必须使用babel-polyfill，为当前环境提供一个垫片。</p>
<p>安装：</p>
<pre><code class="lang-bash">npm install --save babel-polyfill
</code></pre>
<p>在脚本头部导入:</p>
<pre><code class="lang-javascript">import &#39;babel-polyfill&#39;;    // 或者 require(&#39;babel-polyfill&#39;);
</code></pre>
<p><strong> babel-register </strong></p>
<p>改写require命令，为它加上一个钩子。此后，每当使用<code>require</code>加载<code>.js</code>、<code>.jsx</code>、<code>.es</code>和<code>.es6</code>后缀名的文件，就会先用Babel进行转码</p>
<p>注: </p>
<ul>
<li>只会对<code>require</code>命令加载的文件转码，不会对当前文件转码</li>
<li>它是实时转码，所以只适合在开发环境使用</li>
</ul>
<p>Demo:</p>
<pre><code class="lang-bash">$ npm install --save-dev babel-register
</code></pre>
<pre><code class="lang-javascript">require(&quot;babel-register&quot;);        // 使用时，必须首先加载babel-register
require(&quot;./index.js&quot;);            // 然后，就不需要手动对index.js转码了
</code></pre>
<h3 id="header-4">代码调用Babel API</h3>
<p>引入babel-core</p>
<ol>
<li><p>安装：</p>
<pre><code class="lang-bash"> $ npm install babel-core --save
</code></pre>
</li>
<li><p>API调用:</p>
<pre><code class="lang-javascript"> var babel = require(&#39;babel-core&#39;);

 // 字符串转码
 babel.transform(&#39;code();&#39;, options);

 // 文件转码（异步）
 babel.transformFile(&#39;filename.js&#39;, options, function(err, result) {
   result;
 });

 // 文件转码（同步）
 babel.transformFileSync(&#39;filename.js&#39;, options);

 // Babel AST转码
 babel.transformFromAst(ast, code, options);
</code></pre>
<ul>
<li>transform方法说明：<ul>
<li>参数：<ul>
<li>参数一：一个字符串，表示需要转换的ES6代码</li>
<li>参数二：配置对象options，可以参看<a href="http://babeljs.io/docs/usage/options/" target="_blank" rel="noopener">官方文档</a></li>
</ul>
</li>
<li>返回对象：<code>{ code, map, ast }</code></li>
</ul>
</li>
</ul>
</li>
<li><p>Demo:</p>
<pre><code class="lang-javascript"> var es6Code = &#39;let x = n =&gt; n + 1&#39;;
 var es5Code = require(&#39;babel-core&#39;)
   .transform(es6Code, {
     presets: [&#39;es2015&#39;]
   })
   .code;        // &#39;&quot;use strict&quot;;\n\nvar x = function x(n) {\n  return n + 1;\n};&#39;
</code></pre>
</li>
</ol>
<h3 id="header-5">执行环境</h3>
<ol>
<li><p><strong> REPL环境：</strong> 可使用babel-cli工具自带的<code>babel-node</code>命令，会提供一个支持ES6的REPL环境 ( 支持Node的REPL环境的所有功能，可直接运行ES6代码 )</p>
<ul>
<li>Demo1: 直接执行babel-node就进入PEPL环境<pre><code class="lang-bash">  $ babel-node
  &gt; (x =&gt; x * 2)(1)
  2
</code></pre>
</li>
<li>Demo2：执行ES6脚本文件 (注：脚本本身不做任何转码处理)<pre><code class="lang-bash">  $ babel-node es6.js
  2
</code></pre>
</li>
</ul>
</li>
<li><p><strong> 浏览器环境：</strong> 使用转换器，直接在浏览器运行</p>
<ul>
<li>使用Babel提供的转换器脚本<code>browser.js</code>，直接在浏览器运行（注：Babel 6.0开始，不再直接提供浏览器版本，而是要用构建工具构建出来；可使用Babel 5.x）<pre><code class="lang-html">  &lt;script type=&quot;text/javascript&quot; src=&quot;bower_components/babel/browser.min.js&quot;&gt;&lt;/script&gt;
  &lt;script type=&quot;text/babel&quot;&gt;
      // write your ES6 code here
  &lt;/script&gt;
</code></pre>
</li>
<li>使用<code>babel-standalone</code>模块提供的浏览器版本，直接在浏览器运行<pre><code class="lang-html">  &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.4.4/babel.min.js&quot;&gt;&lt;/script&gt;
  &lt;script type=&quot;text/babel&quot;&gt;
      // Your ES6 code
  &lt;/script&gt;
</code></pre>
</li>
<li>注：网页中实时将ES6代码转为ES5，对性能会有影响，生产环境最好加载已经转码完成的脚本</li>
</ul>
</li>
<li><p><strong> 浏览器环境：</strong> 先将代码打包转码成浏览器可使用的脚本在加载</p>
<ul>
<li><p>使用Browserify（配合Babel，需安装babelify模块）</p>
<pre><code class="lang-bash">  # 安装babelify模块
  $ npm install --save-dev babelify babel-preset-es2015

  # 执行转换：将ES6脚本script.js，转为bundle.js，然后浏览器直接加载bundle.js即可
  $ browserify script.js -o bundle.js -t [ babelify --presets [ es2015 ] ]
</code></pre>
</li>
<li>使用webpack（babel-loader），配置webpack.config.js，执行webpack<pre><code class="lang-javascript">  module.exports = {
    entry: &quot;./src/a.js&quot;,
    output: {
        path: __dirname+&quot;/dist&quot;,
        filename: &quot;a.js&quot;
        publicPath:&quot;/dist&quot;
    },
    resolve: {
        extensions: [&#39;&#39;,&#39;.js&#39;]
    },
    module: {
        loaders: [
            { test: /\.js$/, loader: &quot;babel&quot;,query:{presets:[&#39;latest&#39;]} }    //babel参数，例如presets，也可以在.babelrc或package.json中指定
        ]
    }
  };
</code></pre>
</li>
<li>在线转换：Babel提供一个<a href="https://babeljs.io/repl/" target="_blank" rel="noopener">REPL在线编译器</a>，可以在线将ES6代码转为ES5代码。转换后的代码，可以直接作为ES5代码插入网页运行</li>
</ul>
</li>
</ol>
<h2 id="header-6">Browserify</h2>
<p><a href="http://browserify.org/" target="_blank" rel="noopener">Browserify</a></p>
<blockquote>
<p>Browserify lets you require(‘modules’) in the browser by bundling up all of your dependencies</p>
</blockquote>
<p>让服务器端的CommonJS格式的模块可以运行在浏览器端（Browserify编译时，会将脚本所依赖的模块一起编译进去，即可以将多个模块合并成一个文件）</p>
<p>Demo:</p>
<ol>
<li>安装<pre><code class="lang-bash"> npm install -g browserify
</code></pre>
</li>
<li>编写一个服务器端脚本a.js,代码中uniq模块是CommonJS格式，无法在浏览器中运行<pre><code class="lang-javascript"> var uniq = require(&#39;uniq&#39;);
 var nums = [ 5, 2, 1, 3, 2, 5, 4, 2, 0, 1 ];
 console.log(uniq(nums));
</code></pre>
</li>
<li>通过Browserify将上面代码编译为浏览器脚本<pre><code class="lang-javascript"> browserify a.js &gt; bundle.js
</code></pre>
</li>
<li>生成的bundle.js可以直接插入网页<pre><code class="lang-html">&lt;script src=&quot;bundle.js&quot;&gt;&lt;/script&gt;
</code></pre>
</li>
</ol>
<h2 id="header-7">Reference</h2>
<p><a href="http://www.ruanyifeng.com/blog/2014/09/package-management.html" target="_blank" rel="noopener">阮一峰/前端模块管理器简介</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2016/01/babel.html" target="_blank" rel="noopener">阮一峰/Babel 入门教程</a></p>
  </section>
</article>

      <hr/>
      
<section class="post-comment">
	
		<div id="gitment_container"></div>

<link rel="stylesheet" href="/gitment/default.css">
<script src="/gitment/gitment.browser.js"></script>


<script type="text/javascript">
	var gitment = new Gitment({
	  id: document.location.pathname,
	  owner: 'chenjin-zero',
	  repo: 'blogComment',
	  oauth: {
	    client_id: '36a09bb7399efe69c6ce',
	    client_secret: 'ad9ad546b23b708c71d92e513dc36e0486179dea',
	  }
	})
      
	gitment.render('gitment_container')
</script>
	
</section>

    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>


	<script src="/highlight/highlight.pack.js"></script>
	<script type="text/javascript">
		hljs.initHighlightingOnLoad();
	</script>



<script type="text/javascript">

  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
