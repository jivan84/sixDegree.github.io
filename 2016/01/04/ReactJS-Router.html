<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ReactJS高阶之Router</title>
  
  <!-- Meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="reactJs,react-router,history,isomorphic">
  
  
    <meta name="description" content="using react router build front router">
  

  <!-- Feed -->
  
    <link rel="alternative" href="/atom.xml" title="SixDegree" type="application/atom+xml">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.css">
  
    <link rel="stylesheet" href="/highlight/demo/styles/tomorrow-night-bright.css">
  
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body data-spy="scroll" data-target="#nav-catalog">
  <div id="top-push"></div>
<a href="#top-push" id="go-top">
	<span class="glyphicon glyphicon-chevron-up"></span>
</a>
  <aside id="sidebar">
    <section class="sidebar-header">Catalog</section>
     <nav id="nav-catalog">
        <ol class="sidebar-nav nav"><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-1"><span class="sidebar-nav nav-text">使用示例</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-2"><span class="sidebar-nav nav-text">History</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-3"><span class="sidebar-nav nav-text">使用Isomorphic</span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-4"><span class="sidebar-nav nav-text">Issues</span></a><ol class="sidebar-nav nav-child"><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-5"><span class="sidebar-nav nav-text">1. Add <Routes baseHref></span></a></li><li class="sidebar-nav nav-item sidebar-nav nav-level-3"><a class="sidebar-nav nav-link" href="#header-6"><span class="sidebar-nav nav-text">2. Passing props to routes</span></a></li></ol></li><li class="sidebar-nav nav-item sidebar-nav nav-level-2"><a class="sidebar-nav nav-link" href="#header-7"><span class="sidebar-nav nav-text">Reference</span></a></li></ol>
    </nav>
  </aside>
  <span id="sidebar-ctrl" class="glyphicon glyphicon-list-alt circle"></span>
  <div id="wrapper">
    <header>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-menu" aria-expanded="false">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">SixDegree</a>
      </div>
      <div class="collapse navbar-collapse" id="nav-menu">
        <ul class="nav navbar-nav navbar-right">
          
              <li  >
                <a href="/">Blogs</a>
              </li>
          
              <li  >
                <a href="/tags.html">Tags</a>
              </li>
          
              <li  >
                <a href="/about.html">About</a>
              </li>
          
          
              <li>
                <a href="/atom.xml" target="_blank">
                  <span class="icon-rss"></span>
                </a>
              </li>
          
              <li>
                <a href="http://github.com/sixdegree" target="_blank">
                  <span class="icon-github"></span>
                </a>
              </li>
          
        </ul>
      </div>
    </div>
  </nav>
</header>



    <div class="container">
      <article class="detail" role="main">
  <section class="post-header">
    <h1 class="post-title">ReactJS高阶之Router</h1>
    <ul class="post-meta">
      <li>
        <span class="glyphicon glyphicon-calendar"></span>
        <time datetime="2016-01-03T16:00:00.000Z">2016-01-04</time>
      </li>
      
        <li>
         <span class="glyphicon glyphicon-tags"></span>
          
            <a href="/tags.html#tag-ReactJs">ReactJs</a>
          
        </li>
      
    </ul>
  </section>
  <section class="post-content">
    <h2 id="header-1">使用示例</h2>
<p>使用 react-router 实现前端路由：建立在history上，方便进行路由管理</p>
<ol>
<li><p>下载</p>
<pre><code class="nullvim"> &gt; npm install react-router --save
 &gt; npm install <span class="keyword">history</span> --save
</code></pre>
</li>
<li><p>加载</p>
<pre><code class="nulljavascript">     <span class="comment">//app.js</span>
     <span class="keyword">var</span> React=<span class="built_in">require</span>(<span class="string">"react"</span>);
     <span class="keyword">var</span> ReactDOM=<span class="built_in">require</span>(<span class="string">"react-dom"</span>);

     <span class="keyword">var</span> ReactRouter=<span class="built_in">require</span>(<span class="string">"react-router"</span>);
     <span class="keyword">var</span> Router=ReactRouter.Router;
     <span class="keyword">var</span> Route=ReactRouter.Route;
</code></pre>
</li>
<li><p>使用Router</p>
<ul>
<li><p>方式1：</p>
<pre><code class="nulljavascript">  <span class="keyword">var</span> routes=(
      &lt;Router&gt;
          &lt;Route path="/" component={App}&gt;
              &lt;Route path="child/:id" component={Child} /&gt;
              &lt;Route path="*" component={NoMatch} /&gt;
          &lt;/Route&gt;
      &lt;/Router&gt;
  );
  ReactDOM.render(routes,document.getElementById("app"));
</code></pre>
</li>
<li><p>方式二：</p>
<pre><code class="nulljavascript">  <span class="keyword">var</span> routes={
      path:<span class="string">'/'</span>,
      component:App,
      childRoutes:[
          {path:<span class="string">"/child/:id"</span>,component:Child},
          {path:<span class="string">"*"</span>,component:NoMatch}
      ]
  };
  ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">routes</span>=<span class="string">{routes}</span> /&gt;</span>,document.getElementById("app"));</span>
</code></pre>
</li>
</ul>
</li>
<li><p>定义Components</p>
<pre><code class="nulljavascript"> <span class="keyword">var</span> App=React.createClass({
     render:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
         <span class="keyword">return</span> (
             <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>
                 <span class="tag">&lt;<span class="name">Header</span>/&gt;</span>
                 <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"container"</span>&gt;</span>
                     {this.props.children || "Welcome !"}
                 <span class="tag">&lt;/<span class="name">div</span>&gt;</span>
             <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>
         )
     }
 });

 <span class="keyword">var</span> Header=React.createClass({
     render:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
         <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>)
     }
 })

 <span class="keyword">var</span> Child=React.createClass({
     render:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
         <span class="keyword">return</span> (
             <span class="xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span> I am Child {this.props.params.id} ! <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>
         )
     }
 });

 <span class="keyword">var</span> NoMatch=React.createClass({
     render:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{
         <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>No Match !<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>)
     }
 })
</code></pre>
</li>
</ol>
<p><strong>PS:</strong> 路由的生命周期处理<br>进入时装载组件离开时卸载组件，不会一下把所有的组件都装载进来</p>
<h2 id="header-2">History</h2>
<ol>
<li><p><code>createHashHistory</code> (default) : 通过 hash 来实现，可以通过 window.location.hash 读取到 # 后的内容</p>
<pre><code class="nulljavascript"> <span class="comment">//has queryKey, eg: ?_k=ckuvup -&gt; remove queryKey:</span>
 ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">routes</span>=<span class="string">{routes}</span> 
     <span class="attr">history</span>=<span class="string">{createHashHistory({queryKey:false})}/</span>&gt;</span>,
     document.getElementById("app"));</span>
</code></pre>
</li>
<li><p><code>createMemoryHistory</code> (test)</p>
</li>
<li><p><code>createBrowserHistory</code>    (production): run on server，HTML5 才有的新 API，可以用来操作浏览器的 session history (会话历史)</p>
<pre><code class="nulljavascript"> <span class="keyword">var</span> createBrowserHistory =<span class="built_in">require</span>(<span class="string">"history/lib/createBrowserHistory"</span>);
 ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">routes</span>=<span class="string">{routes}</span> <span class="attr">history</span>=<span class="string">{createBrowserHistory()}</span> /&gt;</span>,
     document.getElementById("app"));</span>
</code></pre>
<p> Run Based on nodeJS (cmd: node app):</p>
<pre><code class="nulljavascript"> <span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>)
 <span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)
 <span class="keyword">const</span> port = process.env.PORT || <span class="number">3000</span>
 <span class="keyword">const</span> app = express()

 <span class="comment">// serve static assets normally</span>
 app.use(express.static(__dirname + <span class="string">'/public'</span>))

 <span class="comment">// handle every other route with index.html, which will contain</span>
 <span class="comment">// a script tag to your application's JavaScript file(s).</span>
 app.get(<span class="string">'*'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>)</span>{
   response.sendFile(path.resolve(__dirname, <span class="string">'public'</span>, <span class="string">'index.html'</span>))
 })

 app.listen(port)
 <span class="built_in">console</span>.log(<span class="string">"server started on port "</span> + port)
</code></pre>
</li>
</ol>
<h2 id="header-3">使用Isomorphic</h2>
<ol>
<li><p><code>routes.jsx</code> 定义需要同构的React Routes：</p>
<pre><code class="nulljavascript"> <span class="keyword">var</span> Main=<span class="built_in">require</span>(<span class="string">"./src/main"</span>);
 <span class="keyword">var</span> Child=<span class="built_in">require</span>(<span class="string">"./src/child"</span>);

 <span class="keyword">var</span> routes={
     path:<span class="string">'/'</span>,
     component:Main,
     childRoutes:[
         {path:<span class="string">"/child/:id"</span>,component:Child},
         {path:<span class="string">"*"</span>,component:NoMatch}
     ]
 };
 <span class="built_in">module</span>.exports=routes;
</code></pre>
</li>
<li><p><code>app.jsx</code> 实现Client端渲染：</p>
<pre><code class="nulljavascript"> <span class="keyword">var</span> routes=<span class="built_in">require</span>(<span class="string">"./src/routes"</span>);
 <span class="keyword">var</span> createBrowserHistory =<span class="built_in">require</span>(<span class="string">"history/lib/createBrowserHistory"</span>);
 ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">routes</span>=<span class="string">{routes}</span> <span class="attr">history</span>=<span class="string">{createBrowserHistory()}</span> /&gt;</span>,
     document.getElementById("app"));</span>
</code></pre>
</li>
<li><p><code>app.js</code> 编译生成的Client端可执行的js文件</p>
<pre><code class="nullvim"> &gt; browserify app.jsx -t babelify --presets react -o app.js --extension .jsx
</code></pre>
</li>
<li><p><code>index.ejs</code> 定义主页面，加载上面生成的Client的js文件<code>app.js</code></p>
<pre><code class="nullhtml"> <span class="meta">&lt;!DOCTYPE html&gt;</span>
 <span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span>
 <span class="tag">&lt;<span class="name">head</span>&gt;</span>
   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span>
   <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello React-Router <span class="tag">&lt;/<span class="name">title</span>&gt;</span>
 <span class="tag">&lt;/<span class="name">head</span>&gt;</span>
 <span class="tag">&lt;<span class="name">body</span>&gt;</span>

   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;<span class="name">%-</span> <span class="attr">content</span> %&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>

   <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/libs/react/react.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
   <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/libs/react/react-dom.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
   <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>

 <span class="tag">&lt;/<span class="name">body</span>&gt;</span>
 <span class="tag">&lt;/<span class="name">html</span>&gt;</span>
</code></pre>
</li>
<li><p><code>server.js</code> 定义Server端响应渲染</p>
<pre><code class="nulljavascript"> <span class="built_in">require</span>(<span class="string">'babel-core/register'</span>);
 <span class="keyword">var</span> React=<span class="built_in">require</span>(<span class="string">"react"</span>);
 <span class="keyword">var</span> ReactDOMServer=<span class="built_in">require</span>(<span class="string">"react-dom/server"</span>);

 <span class="keyword">var</span> Router=<span class="built_in">require</span>(<span class="string">'react-router'</span>);
 <span class="keyword">var</span> match=Router.match;
 <span class="keyword">var</span> RoutingContext=Router.RoutingContext;
 <span class="keyword">var</span> routes = <span class="built_in">require</span>(<span class="string">"./src/routes"</span>);

 <span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">"express"</span>);
 <span class="keyword">var</span> app = express();
 app.set(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>);
 app.use(express.static(<span class="string">'public'</span>));

 app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>{
     <span class="built_in">console</span>.log(req.url);
     match({routes,location:req.url},<span class="function"><span class="keyword">function</span>(<span class="params">error, redirectLocation, renderProps</span>)</span>{
         <span class="keyword">if</span> (error) {
           res.status(<span class="number">500</span>).send(error.message)
         } <span class="keyword">else</span> <span class="keyword">if</span> (redirectLocation) {
           res.redirect(<span class="number">302</span>, redirectLocation.pathname + redirectLocation.search)
         } <span class="keyword">else</span> <span class="keyword">if</span> (renderProps) {
             <span class="built_in">console</span>.log(<span class="string">"render react router"</span>);
             <span class="keyword">var</span> element=React.createFactory(RoutingContext)(renderProps);
             <span class="keyword">var</span> elementStr=ReactDOMServer.renderToString(element);
             <span class="comment">//res.status(200).send(elementStr);</span>
             res.render(<span class="string">"index"</span>,{content:elementStr});
         } <span class="keyword">else</span> {
           res.status(<span class="number">404</span>).send(<span class="string">'Not found'</span>)
         }
     })
 })

 app.listen(<span class="number">3000</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>)</span>{
     <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);
       <span class="built_in">console</span>.log(<span class="string">'Listening at localhost:3000'</span>);
 });
</code></pre>
</li>
<li><p>执行<code>node server</code>启动服务查看效果</p>
</li>
</ol>
<h2 id="header-4">Issues</h2>
<h3 id="header-5">1. Add <code>&lt;Routes baseHref&gt;</code></h3>
<p><a href="https://github.com/rackt/react-router/issues/353">Issue on Github</a></p>
<pre><code class="nulljavascript"><span class="keyword">import</span> { createHistory, useBasename } <span class="keyword">from</span> <span class="string">'history'</span>

<span class="keyword">const</span> history = useBasename(createHistory)({
  basename: <span class="string">'/my-custom-root'</span>
})
</code></pre>
<pre><code class="nulljavascript">&lt;Router history={history}&gt;
    &lt;Route path="/" component={App}&gt;&lt;/Route&gt;
&lt;/Router&gt;

&lt;Link path="/some_path"&gt;some_path&lt;/Link&gt;
</code></pre>
<h3 id="header-6">2. Passing props to routes</h3>
<p><a href="https://github.com/rackt/react-router/issues/1531">Issue on Github</a></p>
<pre><code class="nulljavascript">React.render((
  <span class="xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span>
    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">{RootComp}</span> <span class="attr">myprop</span>=<span class="string">"foo"</span>&gt;</span>
        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"foo"</span> <span class="attr">component</span>=<span class="string">{FooComp}</span>&gt;</span>
           <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"bar"</span> <span class="attr">component</span>=<span class="string">{BarComp}</span> /&gt;</span>
        <span class="tag">&lt;/<span class="name">Route</span>&gt;</span>
    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span>
  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span>
), document.getElementById('example'));</span>
</code></pre>
<p><strong>Option 1) With route attributes</strong></p>
<pre><code class="nulljavascript"><span class="class"><span class="keyword">class</span> <span class="title">RootComp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>{
    render: {
        <span class="keyword">this</span>.props.route.myprop <span class="comment">// == "foo" (this.props.routes[0].myprop)</span>
    }
}
</code></pre>
<p><strong>Option 2) To first level children with React.cloneElement()</strong></p>
<pre><code class="nulljavascript"><span class="class"><span class="keyword">class</span> <span class="title">RootComp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>{
    render: {
        React.cloneElement(<span class="keyword">this</span>.props.children, {myprop: <span class="keyword">this</span>.route.myprop})
    }
}
<span class="class"><span class="keyword">class</span> <span class="title">FooComp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>{
    render: {
        <span class="keyword">this</span>.props.myprop <span class="comment">// == "foo"</span>
    }
}
<span class="class"><span class="keyword">class</span> <span class="title">BarComp</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>{
    render: {
        <span class="keyword">this</span>.props.myprop <span class="comment">// == undefined</span>
    }
}
</code></pre>
<p><strong>Option 3) To all route components with Router.createElement</strong></p>
<p><a href="https://github.com/rackt/react-router/blob/master/docs/API.md#createelementcomponent-props">Source</a></p>
<pre><code class="nulljavascript">&lt;Router createElement={createElement} /&gt;

<span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">Component, props</span>) </span>{
   <span class="comment">// Add myprop to props for all route components</span>
    _.extend(props, {myprop: <span class="string">"foo"</span>})
  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> {<span class="attr">...props</span>}/&gt;</span>
}</span>
</code></pre>
<h2 id="header-7">Reference</h2>
<ul>
<li><a href="https://github.com/rackt/react-router">react-router on Github </a></li>
<li><a href="https://github.com/sixDegree/react-advance">my demos</a></li>
</ul>
  </section>
</article>

      <hr/>
      <section class="post-comment">
	<!-- disqus默认将数据加载到id为'disqus_thread'的容器中，可配置disqus_container_id改变-->
<div id="disqus_thread"> 
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

	<script type="text/javascript">
		var disqus_shortname = 'sixdegreespace'; 
		var disqus_identifier = '2016/01/04/ReactJS-Router.html';	
		var disqus_title = 'ReactJS高阶之Router';
		var disqus_url = 'http://sixdegree.github.io/2016/01/04/ReactJS-Router.html' ;
		//var disqus_category_id = '4262241'; 

		(function() {
		    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		})();
	</script>


 
</section>
    </div>
  </div>
</body>

<script src="/jquery/dist/jquery.min.js"></script>
<script src="/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/highlight/highlight.pack.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
  
  $(document).ready(function(){
    var sidebarCtrl=$("#sidebar-ctrl");
    var sidebar=$("#sidebar");
    var wrapper=$("#wrapper");
    sidebarCtrl.on("click",function(event){
        //alert("click");
        sidebar.toggleClass("sidebar-toggle");
        wrapper.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("sidebar-toggle");
        sidebarCtrl.toggleClass("active");
    })
  });
</script>


</html>
